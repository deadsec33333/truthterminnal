!function(){var e,t,r,n,i,a={142:function(e,t,r){var n;e=r.nmd(e);var i=r(40);r(43),r(44),r(10),r(45),r(25),r(150),r(66),r(38),r(54),r(26),r(17),r(22),r(2),r(0),r(6),r(16),r(18),r(52),r(12),r(91),r(27),r(47),r(112),r(356),r(357),r(11),r(34),r(139),r(9),r(152),r(153),r(86),r(36),r(92),r(1172),r(1061),r(32),r(39),r(1173),r(687),r(35),r(544),r(205),r(57),r(59),r(537),r(894),r(161),function(){var a,s="Expected a function",o="__lodash_hash_undefined__",l="__lodash_placeholder__",u=32,c=128,d=1/0,f=9007199254740991,h=NaN,v=4294967295,g=[["ary",c],["bind",1],["bindKey",2],["curry",8],["curryRight",16],["flip",512],["partial",u],["partialRight",64],["rearg",256]],p="[object Arguments]",m="[object Array]",y="[object Boolean]",b="[object Date]",k="[object Error]",E="[object Function]",T="[object GeneratorFunction]",_="[object Map]",w="[object Number]",S="[object Object]",L="[object Promise]",R="[object RegExp]",A="[object Set]",x="[object String]",I="[object Symbol]",D="[object WeakMap]",C="[object ArrayBuffer]",P="[object DataView]",M="[object Float32Array]",O="[object Float64Array]",N="[object Int8Array]",F="[object Int16Array]",Z="[object Int32Array]",U="[object Uint8Array]",B="[object Uint8ClampedArray]",j="[object Uint16Array]",G="[object Uint32Array]",K=/\b__p \+= '';/g,H=/\b(__p \+=) '' \+/g,z=/(__e\(.*?\)|\b__t\)) \+\n'';/g,V=/&(?:amp|lt|gt|quot|#39);/g,q=/[&<>"']/g,W=RegExp(V.source),Y=RegExp(q.source),X=/<%-([\s\S]+?)%>/g,Q=/<%([\s\S]+?)%>/g,$=/<%=([\s\S]+?)%>/g,J=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,ee=/^\w*$/,te=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,re=/[\\^$.*+?()[\]{}|]/g,ne=RegExp(re.source),ie=/^\s+/,ae=/\s/,se=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,oe=/\{\n\/\* \[wrapped with (.+)\] \*/,le=/,? & /,ue=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,ce=/[()=,{}\[\]\/\s]/,de=/\\(\\)?/g,fe=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,he=/\w*$/,ve=/^[-+]0x[0-9a-f]+$/i,ge=/^0b[01]+$/i,pe=/^\[object .+?Constructor\]$/,me=/^0o[0-7]+$/i,ye=/^(?:0|[1-9]\d*)$/,be=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,ke=/($^)/,Ee=/['\n\r\u2028\u2029\\]/g,Te="\\ud800-\\udfff",_e="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",we="\\u2700-\\u27bf",Se="a-z\\xdf-\\xf6\\xf8-\\xff",Le="A-Z\\xc0-\\xd6\\xd8-\\xde",Re="\\ufe0e\\ufe0f",Ae="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",xe="["+Te+"]",Ie="["+Ae+"]",De="["+_e+"]",Ce="\\d+",Pe="["+we+"]",Me="["+Se+"]",Oe="[^"+Te+Ae+Ce+we+Se+Le+"]",Ne="\\ud83c[\\udffb-\\udfff]",Fe="[^"+Te+"]",Ze="(?:\\ud83c[\\udde6-\\uddff]){2}",Ue="[\\ud800-\\udbff][\\udc00-\\udfff]",Be="["+Le+"]",je="\\u200d",Ge="(?:"+Me+"|"+Oe+")",Ke="(?:"+Be+"|"+Oe+")",He="(?:['’](?:d|ll|m|re|s|t|ve))?",ze="(?:['’](?:D|LL|M|RE|S|T|VE))?",Ve="(?:"+De+"|"+Ne+")?",qe="["+Re+"]?",We=qe+Ve+"(?:"+je+"(?:"+[Fe,Ze,Ue].join("|")+")"+qe+Ve+")*",Ye="(?:"+[Pe,Ze,Ue].join("|")+")"+We,Xe="(?:"+[Fe+De+"?",De,Ze,Ue,xe].join("|")+")",Qe=RegExp("['’]","g"),$e=RegExp(De,"g"),Je=RegExp(Ne+"(?="+Ne+")|"+Xe+We,"g"),et=RegExp([Be+"?"+Me+"+"+He+"(?="+[Ie,Be,"$"].join("|")+")",Ke+"+"+ze+"(?="+[Ie,Be+Ge,"$"].join("|")+")",Be+"?"+Ge+"+"+He,Be+"+"+ze,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Ce,Ye].join("|"),"g"),tt=RegExp("["+je+Te+_e+Re+"]"),rt=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,nt=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],it=-1,at={};at[M]=at[O]=at[N]=at[F]=at[Z]=at[U]=at[B]=at[j]=at[G]=!0,at[p]=at[m]=at[C]=at[y]=at[P]=at[b]=at[k]=at[E]=at[_]=at[w]=at[S]=at[R]=at[A]=at[x]=at[D]=!1;var st={};st[p]=st[m]=st[C]=st[P]=st[y]=st[b]=st[M]=st[O]=st[N]=st[F]=st[Z]=st[_]=st[w]=st[S]=st[R]=st[A]=st[x]=st[I]=st[U]=st[B]=st[j]=st[G]=!0,st[k]=st[E]=st[D]=!1;var ot={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},lt=parseFloat,ut=parseInt,ct="object"==(void 0===r.g?"undefined":i(r.g))&&r.g&&r.g.Object===Object&&r.g,dt="object"==("undefined"==typeof self?"undefined":i(self))&&self&&self.Object===Object&&self,ft=ct||dt||Function("return this")(),ht="object"==i(t)&&t&&!t.nodeType&&t,vt=ht&&"object"==i(e)&&e&&!e.nodeType&&e,gt=vt&&vt.exports===ht,pt=gt&&ct.process,mt=function(){try{return vt&&vt.require&&vt.require("util").types||pt&&pt.binding&&pt.binding("util")}catch(e){}}(),yt=mt&&mt.isArrayBuffer,bt=mt&&mt.isDate,kt=mt&&mt.isMap,Et=mt&&mt.isRegExp,Tt=mt&&mt.isSet,_t=mt&&mt.isTypedArray;function wt(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}function St(e,t,r,n){for(var i=-1,a=null==e?0:e.length;++i<a;){var s=e[i];t(n,s,r(s),e)}return n}function Lt(e,t){for(var r=-1,n=null==e?0:e.length;++r<n&&!1!==t(e[r],r,e););return e}function Rt(e,t){for(var r=null==e?0:e.length;r--&&!1!==t(e[r],r,e););return e}function At(e,t){for(var r=-1,n=null==e?0:e.length;++r<n;)if(!t(e[r],r,e))return!1;return!0}function xt(e,t){for(var r=-1,n=null==e?0:e.length,i=0,a=[];++r<n;){var s=e[r];t(s,r,e)&&(a[i++]=s)}return a}function It(e,t){return!(null==e||!e.length)&&Bt(e,t,0)>-1}function Dt(e,t,r){for(var n=-1,i=null==e?0:e.length;++n<i;)if(r(t,e[n]))return!0;return!1}function Ct(e,t){for(var r=-1,n=null==e?0:e.length,i=Array(n);++r<n;)i[r]=t(e[r],r,e);return i}function Pt(e,t){for(var r=-1,n=t.length,i=e.length;++r<n;)e[i+r]=t[r];return e}function Mt(e,t,r,n){var i=-1,a=null==e?0:e.length;for(n&&a&&(r=e[++i]);++i<a;)r=t(r,e[i],i,e);return r}function Ot(e,t,r,n){var i=null==e?0:e.length;for(n&&i&&(r=e[--i]);i--;)r=t(r,e[i],i,e);return r}function Nt(e,t){for(var r=-1,n=null==e?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1}var Ft=Ht("length");function Zt(e,t,r){var n;return r(e,(function(e,r,i){if(t(e,r,i))return n=r,!1})),n}function Ut(e,t,r,n){for(var i=e.length,a=r+(n?1:-1);n?a--:++a<i;)if(t(e[a],a,e))return a;return-1}function Bt(e,t,r){return t==t?function(e,t,r){for(var n=r-1,i=e.length;++n<i;)if(e[n]===t)return n;return-1}(e,t,r):Ut(e,Gt,r)}function jt(e,t,r,n){for(var i=r-1,a=e.length;++i<a;)if(n(e[i],t))return i;return-1}function Gt(e){return e!=e}function Kt(e,t){var r=null==e?0:e.length;return r?qt(e,t)/r:h}function Ht(e){return function(t){return null==t?a:t[e]}}function zt(e){return function(t){return null==e?a:e[t]}}function Vt(e,t,r,n,i){return i(e,(function(e,i,a){r=n?(n=!1,e):t(r,e,i,a)})),r}function qt(e,t){for(var r,n=-1,i=e.length;++n<i;){var s=t(e[n]);s!==a&&(r=r===a?s:r+s)}return r}function Wt(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}function Yt(e){return e?e.slice(0,hr(e)+1).replace(ie,""):e}function Xt(e){return function(t){return e(t)}}function Qt(e,t){return Ct(t,(function(t){return e[t]}))}function $t(e,t){return e.has(t)}function Jt(e,t){for(var r=-1,n=e.length;++r<n&&Bt(t,e[r],0)>-1;);return r}function er(e,t){for(var r=e.length;r--&&Bt(t,e[r],0)>-1;);return r}function tr(e,t){for(var r=e.length,n=0;r--;)e[r]===t&&++n;return n}var rr=zt({"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss","Ā":"A","Ă":"A","Ą":"A","ā":"a","ă":"a","ą":"a","Ć":"C","Ĉ":"C","Ċ":"C","Č":"C","ć":"c","ĉ":"c","ċ":"c","č":"c","Ď":"D","Đ":"D","ď":"d","đ":"d","Ē":"E","Ĕ":"E","Ė":"E","Ę":"E","Ě":"E","ē":"e","ĕ":"e","ė":"e","ę":"e","ě":"e","Ĝ":"G","Ğ":"G","Ġ":"G","Ģ":"G","ĝ":"g","ğ":"g","ġ":"g","ģ":"g","Ĥ":"H","Ħ":"H","ĥ":"h","ħ":"h","Ĩ":"I","Ī":"I","Ĭ":"I","Į":"I","İ":"I","ĩ":"i","ī":"i","ĭ":"i","į":"i","ı":"i","Ĵ":"J","ĵ":"j","Ķ":"K","ķ":"k","ĸ":"k","Ĺ":"L","Ļ":"L","Ľ":"L","Ŀ":"L","Ł":"L","ĺ":"l","ļ":"l","ľ":"l","ŀ":"l","ł":"l","Ń":"N","Ņ":"N","Ň":"N","Ŋ":"N","ń":"n","ņ":"n","ň":"n","ŋ":"n","Ō":"O","Ŏ":"O","Ő":"O","ō":"o","ŏ":"o","ő":"o","Ŕ":"R","Ŗ":"R","Ř":"R","ŕ":"r","ŗ":"r","ř":"r","Ś":"S","Ŝ":"S","Ş":"S","Š":"S","ś":"s","ŝ":"s","ş":"s","š":"s","Ţ":"T","Ť":"T","Ŧ":"T","ţ":"t","ť":"t","ŧ":"t","Ũ":"U","Ū":"U","Ŭ":"U","Ů":"U","Ű":"U","Ų":"U","ũ":"u","ū":"u","ŭ":"u","ů":"u","ű":"u","ų":"u","Ŵ":"W","ŵ":"w","Ŷ":"Y","ŷ":"y","Ÿ":"Y","Ź":"Z","Ż":"Z","Ž":"Z","ź":"z","ż":"z","ž":"z","Ĳ":"IJ","ĳ":"ij","Œ":"Oe","œ":"oe","ŉ":"'n","ſ":"s"}),nr=zt({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function ir(e){return"\\"+ot[e]}function ar(e){return tt.test(e)}function sr(e){var t=-1,r=Array(e.size);return e.forEach((function(e,n){r[++t]=[n,e]})),r}function or(e,t){return function(r){return e(t(r))}}function lr(e,t){for(var r=-1,n=e.length,i=0,a=[];++r<n;){var s=e[r];s!==t&&s!==l||(e[r]=l,a[i++]=r)}return a}function ur(e){var t=-1,r=Array(e.size);return e.forEach((function(e){r[++t]=e})),r}function cr(e){var t=-1,r=Array(e.size);return e.forEach((function(e){r[++t]=[e,e]})),r}function dr(e){return ar(e)?function(e){for(var t=Je.lastIndex=0;Je.test(e);)++t;return t}(e):Ft(e)}function fr(e){return ar(e)?function(e){return e.match(Je)||[]}(e):function(e){return e.split("")}(e)}function hr(e){for(var t=e.length;t--&&ae.test(e.charAt(t)););return t}var vr=zt({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"}),gr=function e(t){var r,n=(t=null==t?ft:gr.defaults(ft.Object(),t,gr.pick(ft,nt))).Array,ae=t.Date,Te=t.Error,_e=t.Function,we=t.Math,Se=t.Object,Le=t.RegExp,Re=t.String,Ae=t.TypeError,xe=n.prototype,Ie=_e.prototype,De=Se.prototype,Ce=t["__core-js_shared__"],Pe=Ie.toString,Me=De.hasOwnProperty,Oe=0,Ne=(r=/[^.]+$/.exec(Ce&&Ce.keys&&Ce.keys.IE_PROTO||""))?"Symbol(src)_1."+r:"",Fe=De.toString,Ze=Pe.call(Se),Ue=ft._,Be=Le("^"+Pe.call(Me).replace(re,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),je=gt?t.Buffer:a,Ge=t.Symbol,Ke=t.Uint8Array,He=je?je.allocUnsafe:a,ze=or(Se.getPrototypeOf,Se),Ve=Se.create,qe=De.propertyIsEnumerable,We=xe.splice,Ye=Ge?Ge.isConcatSpreadable:a,Xe=Ge?Ge.iterator:a,Je=Ge?Ge.toStringTag:a,tt=function(){try{var e=ca(Se,"defineProperty");return e({},"",{}),e}catch(e){}}(),ot=t.clearTimeout!==ft.clearTimeout&&t.clearTimeout,ct=ae&&ae.now!==ft.Date.now&&ae.now,dt=t.setTimeout!==ft.setTimeout&&t.setTimeout,ht=we.ceil,vt=we.floor,pt=Se.getOwnPropertySymbols,mt=je?je.isBuffer:a,Ft=t.isFinite,zt=xe.join,pr=or(Se.keys,Se),mr=we.max,yr=we.min,br=ae.now,kr=t.parseInt,Er=we.random,Tr=xe.reverse,_r=ca(t,"DataView"),wr=ca(t,"Map"),Sr=ca(t,"Promise"),Lr=ca(t,"Set"),Rr=ca(t,"WeakMap"),Ar=ca(Se,"create"),xr=Rr&&new Rr,Ir={},Dr=Ua(_r),Cr=Ua(wr),Pr=Ua(Sr),Mr=Ua(Lr),Or=Ua(Rr),Nr=Ge?Ge.prototype:a,Fr=Nr?Nr.valueOf:a,Zr=Nr?Nr.toString:a;function Ur(e){if(ro(e)&&!zs(e)&&!(e instanceof Kr)){if(e instanceof Gr)return e;if(Me.call(e,"__wrapped__"))return Ba(e)}return new Gr(e)}var Br=function(){function e(){}return function(t){if(!to(t))return{};if(Ve)return Ve(t);e.prototype=t;var r=new e;return e.prototype=a,r}}();function jr(){}function Gr(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=a}function Kr(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=v,this.__views__=[]}function Hr(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function zr(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function Vr(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function qr(e){var t=-1,r=null==e?0:e.length;for(this.__data__=new Vr;++t<r;)this.add(e[t])}function Wr(e){var t=this.__data__=new zr(e);this.size=t.size}function Yr(e,t){var r=zs(e),n=!r&&Hs(e),i=!r&&!n&&Ys(e),a=!r&&!n&&!i&&co(e),s=r||n||i||a,o=s?Wt(e.length,Re):[],l=o.length;for(var u in e)!t&&!Me.call(e,u)||s&&("length"==u||i&&("offset"==u||"parent"==u)||a&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||ma(u,l))||o.push(u);return o}function Xr(e){var t=e.length;return t?e[qn(0,t-1)]:a}function Qr(e,t){return Ma(Ai(e),on(t,0,e.length))}function $r(e){return Ma(Ai(e))}function Jr(e,t,r){(r!==a&&!js(e[t],r)||r===a&&!(t in e))&&an(e,t,r)}function en(e,t,r){var n=e[t];Me.call(e,t)&&js(n,r)&&(r!==a||t in e)||an(e,t,r)}function tn(e,t){for(var r=e.length;r--;)if(js(e[r][0],t))return r;return-1}function rn(e,t,r,n){return fn(e,(function(e,i,a){t(n,e,r(e),a)})),n}function nn(e,t){return e&&xi(t,Po(t),e)}function an(e,t,r){"__proto__"==t&&tt?tt(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}function sn(e,t){for(var r=-1,i=t.length,s=n(i),o=null==e;++r<i;)s[r]=o?a:Ao(e,t[r]);return s}function on(e,t,r){return e==e&&(r!==a&&(e=e<=r?e:r),t!==a&&(e=e>=t?e:t)),e}function ln(e,t,r,n,i,s){var o,l=1&t,u=2&t,c=4&t;if(r&&(o=i?r(e,n,i,s):r(e)),o!==a)return o;if(!to(e))return e;var d=zs(e);if(d){if(o=function(e){var t=e.length,r=new e.constructor(t);return t&&"string"==typeof e[0]&&Me.call(e,"index")&&(r.index=e.index,r.input=e.input),r}(e),!l)return Ai(e,o)}else{var f=ha(e),h=f==E||f==T;if(Ys(e))return Ti(e,l);if(f==S||f==p||h&&!i){if(o=u||h?{}:ga(e),!l)return u?function(e,t){return xi(e,fa(e),t)}(e,function(e,t){return e&&xi(t,Mo(t),e)}(o,e)):function(e,t){return xi(e,da(e),t)}(e,nn(o,e))}else{if(!st[f])return i?e:{};o=function(e,t,r){var n,i=e.constructor;switch(t){case C:return _i(e);case y:case b:return new i(+e);case P:return function(e,t){var r=t?_i(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.byteLength)}(e,r);case M:case O:case N:case F:case Z:case U:case B:case j:case G:return wi(e,r);case _:return new i;case w:case x:return new i(e);case R:return function(e){var t=new e.constructor(e.source,he.exec(e));return t.lastIndex=e.lastIndex,t}(e);case A:return new i;case I:return n=e,Fr?Se(Fr.call(n)):{}}}(e,f,l)}}s||(s=new Wr);var v=s.get(e);if(v)return v;s.set(e,o),oo(e)?e.forEach((function(n){o.add(ln(n,t,r,n,e,s))})):no(e)&&e.forEach((function(n,i){o.set(i,ln(n,t,r,i,e,s))}));var g=d?a:(c?u?na:ra:u?Mo:Po)(e);return Lt(g||e,(function(n,i){g&&(n=e[i=n]),en(o,i,ln(n,t,r,i,e,s))})),o}function un(e,t,r){var n=r.length;if(null==e)return!n;for(e=Se(e);n--;){var i=r[n],s=t[i],o=e[i];if(o===a&&!(i in e)||!s(o))return!1}return!0}function cn(e,t,r){if("function"!=typeof e)throw new Ae(s);return Ia((function(){e.apply(a,r)}),t)}function dn(e,t,r,n){var i=-1,a=It,s=!0,o=e.length,l=[],u=t.length;if(!o)return l;r&&(t=Ct(t,Xt(r))),n?(a=Dt,s=!1):t.length>=200&&(a=$t,s=!1,t=new qr(t));e:for(;++i<o;){var c=e[i],d=null==r?c:r(c);if(c=n||0!==c?c:0,s&&d==d){for(var f=u;f--;)if(t[f]===d)continue e;l.push(c)}else a(t,d,n)||l.push(c)}return l}Ur.templateSettings={escape:X,evaluate:Q,interpolate:$,variable:"",imports:{_:Ur}},Ur.prototype=jr.prototype,Ur.prototype.constructor=Ur,Gr.prototype=Br(jr.prototype),Gr.prototype.constructor=Gr,Kr.prototype=Br(jr.prototype),Kr.prototype.constructor=Kr,Hr.prototype.clear=function(){this.__data__=Ar?Ar(null):{},this.size=0},Hr.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},Hr.prototype.get=function(e){var t=this.__data__;if(Ar){var r=t[e];return r===o?a:r}return Me.call(t,e)?t[e]:a},Hr.prototype.has=function(e){var t=this.__data__;return Ar?t[e]!==a:Me.call(t,e)},Hr.prototype.set=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=Ar&&t===a?o:t,this},zr.prototype.clear=function(){this.__data__=[],this.size=0},zr.prototype.delete=function(e){var t=this.__data__,r=tn(t,e);return!(r<0||(r==t.length-1?t.pop():We.call(t,r,1),--this.size,0))},zr.prototype.get=function(e){var t=this.__data__,r=tn(t,e);return r<0?a:t[r][1]},zr.prototype.has=function(e){return tn(this.__data__,e)>-1},zr.prototype.set=function(e,t){var r=this.__data__,n=tn(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this},Vr.prototype.clear=function(){this.size=0,this.__data__={hash:new Hr,map:new(wr||zr),string:new Hr}},Vr.prototype.delete=function(e){var t=la(this,e).delete(e);return this.size-=t?1:0,t},Vr.prototype.get=function(e){return la(this,e).get(e)},Vr.prototype.has=function(e){return la(this,e).has(e)},Vr.prototype.set=function(e,t){var r=la(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this},qr.prototype.add=qr.prototype.push=function(e){return this.__data__.set(e,o),this},qr.prototype.has=function(e){return this.__data__.has(e)},Wr.prototype.clear=function(){this.__data__=new zr,this.size=0},Wr.prototype.delete=function(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r},Wr.prototype.get=function(e){return this.__data__.get(e)},Wr.prototype.has=function(e){return this.__data__.has(e)},Wr.prototype.set=function(e,t){var r=this.__data__;if(r instanceof zr){var n=r.__data__;if(!wr||n.length<199)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new Vr(n)}return r.set(e,t),this.size=r.size,this};var fn=Ci(kn),hn=Ci(En,!0);function vn(e,t){var r=!0;return fn(e,(function(e,n,i){return r=!!t(e,n,i)})),r}function gn(e,t,r){for(var n=-1,i=e.length;++n<i;){var s=e[n],o=t(s);if(null!=o&&(l===a?o==o&&!uo(o):r(o,l)))var l=o,u=s}return u}function pn(e,t){var r=[];return fn(e,(function(e,n,i){t(e,n,i)&&r.push(e)})),r}function mn(e,t,r,n,i){var a=-1,s=e.length;for(r||(r=pa),i||(i=[]);++a<s;){var o=e[a];t>0&&r(o)?t>1?mn(o,t-1,r,n,i):Pt(i,o):n||(i[i.length]=o)}return i}var yn=Pi(),bn=Pi(!0);function kn(e,t){return e&&yn(e,t,Po)}function En(e,t){return e&&bn(e,t,Po)}function Tn(e,t){return xt(t,(function(t){return $s(e[t])}))}function _n(e,t){for(var r=0,n=(t=yi(t,e)).length;null!=e&&r<n;)e=e[Za(t[r++])];return r&&r==n?e:a}function wn(e,t,r){var n=t(e);return zs(e)?n:Pt(n,r(e))}function Sn(e){return null==e?e===a?"[object Undefined]":"[object Null]":Je&&Je in Se(e)?function(e){var t=Me.call(e,Je),r=e[Je];try{e[Je]=a;var n=!0}catch(e){}var i=Fe.call(e);return n&&(t?e[Je]=r:delete e[Je]),i}(e):function(e){return Fe.call(e)}(e)}function Ln(e,t){return e>t}function Rn(e,t){return null!=e&&Me.call(e,t)}function An(e,t){return null!=e&&t in Se(e)}function xn(e,t,r){for(var i=r?Dt:It,s=e[0].length,o=e.length,l=o,u=n(o),c=1/0,d=[];l--;){var f=e[l];l&&t&&(f=Ct(f,Xt(t))),c=yr(f.length,c),u[l]=!r&&(t||s>=120&&f.length>=120)?new qr(l&&f):a}f=e[0];var h=-1,v=u[0];e:for(;++h<s&&d.length<c;){var g=f[h],p=t?t(g):g;if(g=r||0!==g?g:0,!(v?$t(v,p):i(d,p,r))){for(l=o;--l;){var m=u[l];if(!(m?$t(m,p):i(e[l],p,r)))continue e}v&&v.push(p),d.push(g)}}return d}function In(e,t,r){var n=null==(e=La(e,t=yi(t,e)))?e:e[Za(Qa(t))];return null==n?a:wt(n,e,r)}function Dn(e){return ro(e)&&Sn(e)==p}function Cn(e,t,r,n,i){return e===t||(null==e||null==t||!ro(e)&&!ro(t)?e!=e&&t!=t:function(e,t,r,n,i,s){var o=zs(e),l=zs(t),u=o?m:ha(e),c=l?m:ha(t),d=(u=u==p?S:u)==S,f=(c=c==p?S:c)==S,h=u==c;if(h&&Ys(e)){if(!Ys(t))return!1;o=!0,d=!1}if(h&&!d)return s||(s=new Wr),o||co(e)?ea(e,t,r,n,i,s):function(e,t,r,n,i,a,s){switch(r){case P:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case C:return!(e.byteLength!=t.byteLength||!a(new Ke(e),new Ke(t)));case y:case b:case w:return js(+e,+t);case k:return e.name==t.name&&e.message==t.message;case R:case x:return e==t+"";case _:var o=sr;case A:var l=1&n;if(o||(o=ur),e.size!=t.size&&!l)return!1;var u=s.get(e);if(u)return u==t;n|=2,s.set(e,t);var c=ea(o(e),o(t),n,i,a,s);return s.delete(e),c;case I:if(Fr)return Fr.call(e)==Fr.call(t)}return!1}(e,t,u,r,n,i,s);if(!(1&r)){var v=d&&Me.call(e,"__wrapped__"),g=f&&Me.call(t,"__wrapped__");if(v||g){var E=v?e.value():e,T=g?t.value():t;return s||(s=new Wr),i(E,T,r,n,s)}}return!!h&&(s||(s=new Wr),function(e,t,r,n,i,s){var o=1&r,l=ra(e),u=l.length;if(u!=ra(t).length&&!o)return!1;for(var c=u;c--;){var d=l[c];if(!(o?d in t:Me.call(t,d)))return!1}var f=s.get(e),h=s.get(t);if(f&&h)return f==t&&h==e;var v=!0;s.set(e,t),s.set(t,e);for(var g=o;++c<u;){var p=e[d=l[c]],m=t[d];if(n)var y=o?n(m,p,d,t,e,s):n(p,m,d,e,t,s);if(!(y===a?p===m||i(p,m,r,n,s):y)){v=!1;break}g||(g="constructor"==d)}if(v&&!g){var b=e.constructor,k=t.constructor;b==k||!("constructor"in e)||!("constructor"in t)||"function"==typeof b&&b instanceof b&&"function"==typeof k&&k instanceof k||(v=!1)}return s.delete(e),s.delete(t),v}(e,t,r,n,i,s))}(e,t,r,n,Cn,i))}function Pn(e,t,r,n){var i=r.length,s=i,o=!n;if(null==e)return!s;for(e=Se(e);i--;){var l=r[i];if(o&&l[2]?l[1]!==e[l[0]]:!(l[0]in e))return!1}for(;++i<s;){var u=(l=r[i])[0],c=e[u],d=l[1];if(o&&l[2]){if(c===a&&!(u in e))return!1}else{var f=new Wr;if(n)var h=n(c,d,u,e,t,f);if(!(h===a?Cn(d,c,3,n,f):h))return!1}}return!0}function Mn(e){return!(!to(e)||(t=e,Ne&&Ne in t))&&($s(e)?Be:pe).test(Ua(e));var t}function On(e){return"function"==typeof e?e:null==e?al:"object"==i(e)?zs(e)?Bn(e[0],e[1]):Un(e):vl(e)}function Nn(e){if(!Ta(e))return pr(e);var t=[];for(var r in Se(e))Me.call(e,r)&&"constructor"!=r&&t.push(r);return t}function Fn(e,t){return e<t}function Zn(e,t){var r=-1,i=qs(e)?n(e.length):[];return fn(e,(function(e,n,a){i[++r]=t(e,n,a)})),i}function Un(e){var t=ua(e);return 1==t.length&&t[0][2]?wa(t[0][0],t[0][1]):function(r){return r===e||Pn(r,e,t)}}function Bn(e,t){return ba(e)&&_a(t)?wa(Za(e),t):function(r){var n=Ao(r,e);return n===a&&n===t?xo(r,e):Cn(t,n,3)}}function jn(e,t,r,n,i){e!==t&&yn(t,(function(s,o){if(i||(i=new Wr),to(s))!function(e,t,r,n,i,s,o){var l=Aa(e,r),u=Aa(t,r),c=o.get(u);if(c)Jr(e,r,c);else{var d=s?s(l,u,r+"",e,t,o):a,f=d===a;if(f){var h=zs(u),v=!h&&Ys(u),g=!h&&!v&&co(u);d=u,h||v||g?zs(l)?d=l:Ws(l)?d=Ai(l):v?(f=!1,d=Ti(u,!0)):g?(f=!1,d=wi(u,!0)):d=[]:ao(u)||Hs(u)?(d=l,Hs(l)?d=bo(l):to(l)&&!$s(l)||(d=ga(u))):f=!1}f&&(o.set(u,d),i(d,u,n,s,o),o.delete(u)),Jr(e,r,d)}}(e,t,o,r,jn,n,i);else{var l=n?n(Aa(e,o),s,o+"",e,t,i):a;l===a&&(l=s),Jr(e,o,l)}}),Mo)}function Gn(e,t){var r=e.length;if(r)return ma(t+=t<0?r:0,r)?e[t]:a}function Kn(e,t,r){t=t.length?Ct(t,(function(e){return zs(e)?function(t){return _n(t,1===e.length?e[0]:e)}:e})):[al];var n=-1;t=Ct(t,Xt(oa()));var i=Zn(e,(function(e,r,i){var a=Ct(t,(function(t){return t(e)}));return{criteria:a,index:++n,value:e}}));return function(e,t){var n=e.length;for(e.sort((function(e,t){return function(e,t,r){for(var n=-1,i=e.criteria,a=t.criteria,s=i.length,o=r.length;++n<s;){var l=Si(i[n],a[n]);if(l)return n>=o?l:l*("desc"==r[n]?-1:1)}return e.index-t.index}(e,t,r)}));n--;)e[n]=e[n].value;return e}(i)}function Hn(e,t,r){for(var n=-1,i=t.length,a={};++n<i;){var s=t[n],o=_n(e,s);r(o,s)&&$n(a,yi(s,e),o)}return a}function zn(e,t,r,n){var i=n?jt:Bt,a=-1,s=t.length,o=e;for(e===t&&(t=Ai(t)),r&&(o=Ct(e,Xt(r)));++a<s;)for(var l=0,u=t[a],c=r?r(u):u;(l=i(o,c,l,n))>-1;)o!==e&&We.call(o,l,1),We.call(e,l,1);return e}function Vn(e,t){for(var r=e?t.length:0,n=r-1;r--;){var i=t[r];if(r==n||i!==a){var a=i;ma(i)?We.call(e,i,1):ci(e,i)}}return e}function qn(e,t){return e+vt(Er()*(t-e+1))}function Wn(e,t){var r="";if(!e||t<1||t>f)return r;do{t%2&&(r+=e),(t=vt(t/2))&&(e+=e)}while(t);return r}function Yn(e,t){return Da(Sa(e,t,al),e+"")}function Xn(e){return Xr(Go(e))}function Qn(e,t){var r=Go(e);return Ma(r,on(t,0,r.length))}function $n(e,t,r,n){if(!to(e))return e;for(var i=-1,s=(t=yi(t,e)).length,o=s-1,l=e;null!=l&&++i<s;){var u=Za(t[i]),c=r;if("__proto__"===u||"constructor"===u||"prototype"===u)return e;if(i!=o){var d=l[u];(c=n?n(d,u,l):a)===a&&(c=to(d)?d:ma(t[i+1])?[]:{})}en(l,u,c),l=l[u]}return e}var Jn=xr?function(e,t){return xr.set(e,t),e}:al,ei=tt?function(e,t){return tt(e,"toString",{configurable:!0,enumerable:!1,value:rl(t),writable:!0})}:al;function ti(e){return Ma(Go(e))}function ri(e,t,r){var i=-1,a=e.length;t<0&&(t=-t>a?0:a+t),(r=r>a?a:r)<0&&(r+=a),a=t>r?0:r-t>>>0,t>>>=0;for(var s=n(a);++i<a;)s[i]=e[i+t];return s}function ni(e,t){var r;return fn(e,(function(e,n,i){return!(r=t(e,n,i))})),!!r}function ii(e,t,r){var n=0,i=null==e?n:e.length;if("number"==typeof t&&t==t&&i<=2147483647){for(;n<i;){var a=n+i>>>1,s=e[a];null!==s&&!uo(s)&&(r?s<=t:s<t)?n=a+1:i=a}return i}return ai(e,t,al,r)}function ai(e,t,r,n){var i=0,s=null==e?0:e.length;if(0===s)return 0;for(var o=(t=r(t))!=t,l=null===t,u=uo(t),c=t===a;i<s;){var d=vt((i+s)/2),f=r(e[d]),h=f!==a,v=null===f,g=f==f,p=uo(f);if(o)var m=n||g;else m=c?g&&(n||h):l?g&&h&&(n||!v):u?g&&h&&!v&&(n||!p):!v&&!p&&(n?f<=t:f<t);m?i=d+1:s=d}return yr(s,4294967294)}function si(e,t){for(var r=-1,n=e.length,i=0,a=[];++r<n;){var s=e[r],o=t?t(s):s;if(!r||!js(o,l)){var l=o;a[i++]=0===s?0:s}}return a}function oi(e){return"number"==typeof e?e:uo(e)?h:+e}function li(e){if("string"==typeof e)return e;if(zs(e))return Ct(e,li)+"";if(uo(e))return Zr?Zr.call(e):"";var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}function ui(e,t,r){var n=-1,i=It,a=e.length,s=!0,o=[],l=o;if(r)s=!1,i=Dt;else if(a>=200){var u=t?null:Wi(e);if(u)return ur(u);s=!1,i=$t,l=new qr}else l=t?[]:o;e:for(;++n<a;){var c=e[n],d=t?t(c):c;if(c=r||0!==c?c:0,s&&d==d){for(var f=l.length;f--;)if(l[f]===d)continue e;t&&l.push(d),o.push(c)}else i(l,d,r)||(l!==o&&l.push(d),o.push(c))}return o}function ci(e,t){return null==(e=La(e,t=yi(t,e)))||delete e[Za(Qa(t))]}function di(e,t,r,n){return $n(e,t,r(_n(e,t)),n)}function fi(e,t,r,n){for(var i=e.length,a=n?i:-1;(n?a--:++a<i)&&t(e[a],a,e););return r?ri(e,n?0:a,n?a+1:i):ri(e,n?a+1:0,n?i:a)}function hi(e,t){var r=e;return r instanceof Kr&&(r=r.value()),Mt(t,(function(e,t){return t.func.apply(t.thisArg,Pt([e],t.args))}),r)}function vi(e,t,r){var i=e.length;if(i<2)return i?ui(e[0]):[];for(var a=-1,s=n(i);++a<i;)for(var o=e[a],l=-1;++l<i;)l!=a&&(s[a]=dn(s[a]||o,e[l],t,r));return ui(mn(s,1),t,r)}function gi(e,t,r){for(var n=-1,i=e.length,s=t.length,o={};++n<i;){var l=n<s?t[n]:a;r(o,e[n],l)}return o}function pi(e){return Ws(e)?e:[]}function mi(e){return"function"==typeof e?e:al}function yi(e,t){return zs(e)?e:ba(e,t)?[e]:Fa(ko(e))}var bi=Yn;function ki(e,t,r){var n=e.length;return r=r===a?n:r,!t&&r>=n?e:ri(e,t,r)}var Ei=ot||function(e){return ft.clearTimeout(e)};function Ti(e,t){if(t)return e.slice();var r=e.length,n=He?He(r):new e.constructor(r);return e.copy(n),n}function _i(e){var t=new e.constructor(e.byteLength);return new Ke(t).set(new Ke(e)),t}function wi(e,t){var r=t?_i(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)}function Si(e,t){if(e!==t){var r=e!==a,n=null===e,i=e==e,s=uo(e),o=t!==a,l=null===t,u=t==t,c=uo(t);if(!l&&!c&&!s&&e>t||s&&o&&u&&!l&&!c||n&&o&&u||!r&&u||!i)return 1;if(!n&&!s&&!c&&e<t||c&&r&&i&&!n&&!s||l&&r&&i||!o&&i||!u)return-1}return 0}function Li(e,t,r,i){for(var a=-1,s=e.length,o=r.length,l=-1,u=t.length,c=mr(s-o,0),d=n(u+c),f=!i;++l<u;)d[l]=t[l];for(;++a<o;)(f||a<s)&&(d[r[a]]=e[a]);for(;c--;)d[l++]=e[a++];return d}function Ri(e,t,r,i){for(var a=-1,s=e.length,o=-1,l=r.length,u=-1,c=t.length,d=mr(s-l,0),f=n(d+c),h=!i;++a<d;)f[a]=e[a];for(var v=a;++u<c;)f[v+u]=t[u];for(;++o<l;)(h||a<s)&&(f[v+r[o]]=e[a++]);return f}function Ai(e,t){var r=-1,i=e.length;for(t||(t=n(i));++r<i;)t[r]=e[r];return t}function xi(e,t,r,n){var i=!r;r||(r={});for(var s=-1,o=t.length;++s<o;){var l=t[s],u=n?n(r[l],e[l],l,r,e):a;u===a&&(u=e[l]),i?an(r,l,u):en(r,l,u)}return r}function Ii(e,t){return function(r,n){var i=zs(r)?St:rn,a=t?t():{};return i(r,e,oa(n,2),a)}}function Di(e){return Yn((function(t,r){var n=-1,i=r.length,s=i>1?r[i-1]:a,o=i>2?r[2]:a;for(s=e.length>3&&"function"==typeof s?(i--,s):a,o&&ya(r[0],r[1],o)&&(s=i<3?a:s,i=1),t=Se(t);++n<i;){var l=r[n];l&&e(t,l,n,s)}return t}))}function Ci(e,t){return function(r,n){if(null==r)return r;if(!qs(r))return e(r,n);for(var i=r.length,a=t?i:-1,s=Se(r);(t?a--:++a<i)&&!1!==n(s[a],a,s););return r}}function Pi(e){return function(t,r,n){for(var i=-1,a=Se(t),s=n(t),o=s.length;o--;){var l=s[e?o:++i];if(!1===r(a[l],l,a))break}return t}}function Mi(e){return function(t){var r=ar(t=ko(t))?fr(t):a,n=r?r[0]:t.charAt(0),i=r?ki(r,1).join(""):t.slice(1);return n[e]()+i}}function Oi(e){return function(t){return Mt(Jo(zo(t).replace(Qe,"")),e,"")}}function Ni(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var r=Br(e.prototype),n=e.apply(r,t);return to(n)?n:r}}function Fi(e){return function(t,r,n){var i=Se(t);if(!qs(t)){var s=oa(r,3);t=Po(t),r=function(e){return s(i[e],e,i)}}var o=e(t,r,n);return o>-1?i[s?t[o]:o]:a}}function Zi(e){return ta((function(t){var r=t.length,n=r,i=Gr.prototype.thru;for(e&&t.reverse();n--;){var o=t[n];if("function"!=typeof o)throw new Ae(s);if(i&&!l&&"wrapper"==aa(o))var l=new Gr([],!0)}for(n=l?n:r;++n<r;){var u=aa(o=t[n]),c="wrapper"==u?ia(o):a;l=c&&ka(c[0])&&424==c[1]&&!c[4].length&&1==c[9]?l[aa(c[0])].apply(l,c[3]):1==o.length&&ka(o)?l[u]():l.thru(o)}return function(){var e=arguments,n=e[0];if(l&&1==e.length&&zs(n))return l.plant(n).value();for(var i=0,a=r?t[i].apply(this,e):n;++i<r;)a=t[i].call(this,a);return a}}))}function Ui(e,t,r,i,s,o,l,u,d,f){var h=t&c,v=1&t,g=2&t,p=24&t,m=512&t,y=g?a:Ni(e);return function a(){for(var c=arguments.length,b=n(c),k=c;k--;)b[k]=arguments[k];if(p)var E=sa(a),T=tr(b,E);if(i&&(b=Li(b,i,s,p)),o&&(b=Ri(b,o,l,p)),c-=T,p&&c<f){var _=lr(b,E);return Vi(e,t,Ui,a.placeholder,r,b,_,u,d,f-c)}var w=v?r:this,S=g?w[e]:e;return c=b.length,u?b=Ra(b,u):m&&c>1&&b.reverse(),h&&d<c&&(b.length=d),this&&this!==ft&&this instanceof a&&(S=y||Ni(S)),S.apply(w,b)}}function Bi(e,t){return function(r,n){return function(e,t,r,n){return kn(e,(function(e,i,a){t(n,r(e),i,a)})),n}(r,e,t(n),{})}}function ji(e,t){return function(r,n){var i;if(r===a&&n===a)return t;if(r!==a&&(i=r),n!==a){if(i===a)return n;"string"==typeof r||"string"==typeof n?(r=li(r),n=li(n)):(r=oi(r),n=oi(n)),i=e(r,n)}return i}}function Gi(e){return ta((function(t){return t=Ct(t,Xt(oa())),Yn((function(r){var n=this;return e(t,(function(e){return wt(e,n,r)}))}))}))}function Ki(e,t){var r=(t=t===a?" ":li(t)).length;if(r<2)return r?Wn(t,e):t;var n=Wn(t,ht(e/dr(t)));return ar(t)?ki(fr(n),0,e).join(""):n.slice(0,e)}function Hi(e){return function(t,r,i){return i&&"number"!=typeof i&&ya(t,r,i)&&(r=i=a),t=go(t),r===a?(r=t,t=0):r=go(r),function(e,t,r,i){for(var a=-1,s=mr(ht((t-e)/(r||1)),0),o=n(s);s--;)o[i?s:++a]=e,e+=r;return o}(t,r,i=i===a?t<r?1:-1:go(i),e)}}function zi(e){return function(t,r){return"string"==typeof t&&"string"==typeof r||(t=yo(t),r=yo(r)),e(t,r)}}function Vi(e,t,r,n,i,s,o,l,c,d){var f=8&t;t|=f?u:64,4&(t&=~(f?64:u))||(t&=-4);var h=[e,t,i,f?s:a,f?o:a,f?a:s,f?a:o,l,c,d],v=r.apply(a,h);return ka(e)&&xa(v,h),v.placeholder=n,Ca(v,e,t)}function qi(e){var t=we[e];return function(e,r){if(e=yo(e),(r=null==r?0:yr(po(r),292))&&Ft(e)){var n=(ko(e)+"e").split("e");return+((n=(ko(t(n[0]+"e"+(+n[1]+r)))+"e").split("e"))[0]+"e"+(+n[1]-r))}return t(e)}}var Wi=Lr&&1/ur(new Lr([,-0]))[1]==d?function(e){return new Lr(e)}:cl;function Yi(e){return function(t){var r=ha(t);return r==_?sr(t):r==A?cr(t):function(e,t){return Ct(t,(function(t){return[t,e[t]]}))}(t,e(t))}}function Xi(e,t,r,i,o,d,f,h){var v=2&t;if(!v&&"function"!=typeof e)throw new Ae(s);var g=i?i.length:0;if(g||(t&=-97,i=o=a),f=f===a?f:mr(po(f),0),h=h===a?h:po(h),g-=o?o.length:0,64&t){var p=i,m=o;i=o=a}var y=v?a:ia(e),b=[e,t,r,i,o,p,m,d,f,h];if(y&&function(e,t){var r=e[1],n=t[1],i=r|n,a=i<131,s=n==c&&8==r||n==c&&256==r&&e[7].length<=t[8]||384==n&&t[7].length<=t[8]&&8==r;if(!a&&!s)return e;1&n&&(e[2]=t[2],i|=1&r?0:4);var o=t[3];if(o){var u=e[3];e[3]=u?Li(u,o,t[4]):o,e[4]=u?lr(e[3],l):t[4]}(o=t[5])&&(u=e[5],e[5]=u?Ri(u,o,t[6]):o,e[6]=u?lr(e[5],l):t[6]),(o=t[7])&&(e[7]=o),n&c&&(e[8]=null==e[8]?t[8]:yr(e[8],t[8])),null==e[9]&&(e[9]=t[9]),e[0]=t[0],e[1]=i}(b,y),e=b[0],t=b[1],r=b[2],i=b[3],o=b[4],!(h=b[9]=b[9]===a?v?0:e.length:mr(b[9]-g,0))&&24&t&&(t&=-25),t&&1!=t)k=8==t||16==t?function(e,t,r){var i=Ni(e);return function s(){for(var o=arguments.length,l=n(o),u=o,c=sa(s);u--;)l[u]=arguments[u];var d=o<3&&l[0]!==c&&l[o-1]!==c?[]:lr(l,c);return(o-=d.length)<r?Vi(e,t,Ui,s.placeholder,a,l,d,a,a,r-o):wt(this&&this!==ft&&this instanceof s?i:e,this,l)}}(e,t,h):t!=u&&33!=t||o.length?Ui.apply(a,b):function(e,t,r,i){var a=1&t,s=Ni(e);return function t(){for(var o=-1,l=arguments.length,u=-1,c=i.length,d=n(c+l),f=this&&this!==ft&&this instanceof t?s:e;++u<c;)d[u]=i[u];for(;l--;)d[u++]=arguments[++o];return wt(f,a?r:this,d)}}(e,t,r,i);else var k=function(e,t,r){var n=1&t,i=Ni(e);return function t(){return(this&&this!==ft&&this instanceof t?i:e).apply(n?r:this,arguments)}}(e,t,r);return Ca((y?Jn:xa)(k,b),e,t)}function Qi(e,t,r,n){return e===a||js(e,De[r])&&!Me.call(n,r)?t:e}function $i(e,t,r,n,i,s){return to(e)&&to(t)&&(s.set(t,e),jn(e,t,a,$i,s),s.delete(t)),e}function Ji(e){return ao(e)?a:e}function ea(e,t,r,n,i,s){var o=1&r,l=e.length,u=t.length;if(l!=u&&!(o&&u>l))return!1;var c=s.get(e),d=s.get(t);if(c&&d)return c==t&&d==e;var f=-1,h=!0,v=2&r?new qr:a;for(s.set(e,t),s.set(t,e);++f<l;){var g=e[f],p=t[f];if(n)var m=o?n(p,g,f,t,e,s):n(g,p,f,e,t,s);if(m!==a){if(m)continue;h=!1;break}if(v){if(!Nt(t,(function(e,t){if(!$t(v,t)&&(g===e||i(g,e,r,n,s)))return v.push(t)}))){h=!1;break}}else if(g!==p&&!i(g,p,r,n,s)){h=!1;break}}return s.delete(e),s.delete(t),h}function ta(e){return Da(Sa(e,a,Va),e+"")}function ra(e){return wn(e,Po,da)}function na(e){return wn(e,Mo,fa)}var ia=xr?function(e){return xr.get(e)}:cl;function aa(e){for(var t=e.name+"",r=Ir[t],n=Me.call(Ir,t)?r.length:0;n--;){var i=r[n],a=i.func;if(null==a||a==e)return i.name}return t}function sa(e){return(Me.call(Ur,"placeholder")?Ur:e).placeholder}function oa(){var e=Ur.iteratee||sl;return e=e===sl?On:e,arguments.length?e(arguments[0],arguments[1]):e}function la(e,t){var r,n,a=e.__data__;return("string"==(n=i(r=t))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==r:null===r)?a["string"==typeof t?"string":"hash"]:a.map}function ua(e){for(var t=Po(e),r=t.length;r--;){var n=t[r],i=e[n];t[r]=[n,i,_a(i)]}return t}function ca(e,t){var r=function(e,t){return null==e?a:e[t]}(e,t);return Mn(r)?r:a}var da=pt?function(e){return null==e?[]:(e=Se(e),xt(pt(e),(function(t){return qe.call(e,t)})))}:ml,fa=pt?function(e){for(var t=[];e;)Pt(t,da(e)),e=ze(e);return t}:ml,ha=Sn;function va(e,t,r){for(var n=-1,i=(t=yi(t,e)).length,a=!1;++n<i;){var s=Za(t[n]);if(!(a=null!=e&&r(e,s)))break;e=e[s]}return a||++n!=i?a:!!(i=null==e?0:e.length)&&eo(i)&&ma(s,i)&&(zs(e)||Hs(e))}function ga(e){return"function"!=typeof e.constructor||Ta(e)?{}:Br(ze(e))}function pa(e){return zs(e)||Hs(e)||!!(Ye&&e&&e[Ye])}function ma(e,t){var r=i(e);return!!(t=null==t?f:t)&&("number"==r||"symbol"!=r&&ye.test(e))&&e>-1&&e%1==0&&e<t}function ya(e,t,r){if(!to(r))return!1;var n=i(t);return!!("number"==n?qs(r)&&ma(t,r.length):"string"==n&&t in r)&&js(r[t],e)}function ba(e,t){if(zs(e))return!1;var r=i(e);return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=e&&!uo(e))||ee.test(e)||!J.test(e)||null!=t&&e in Se(t)}function ka(e){var t=aa(e),r=Ur[t];if("function"!=typeof r||!(t in Kr.prototype))return!1;if(e===r)return!0;var n=ia(r);return!!n&&e===n[0]}(_r&&ha(new _r(new ArrayBuffer(1)))!=P||wr&&ha(new wr)!=_||Sr&&ha(Sr.resolve())!=L||Lr&&ha(new Lr)!=A||Rr&&ha(new Rr)!=D)&&(ha=function(e){var t=Sn(e),r=t==S?e.constructor:a,n=r?Ua(r):"";if(n)switch(n){case Dr:return P;case Cr:return _;case Pr:return L;case Mr:return A;case Or:return D}return t});var Ea=Ce?$s:yl;function Ta(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||De)}function _a(e){return e==e&&!to(e)}function wa(e,t){return function(r){return null!=r&&r[e]===t&&(t!==a||e in Se(r))}}function Sa(e,t,r){return t=mr(t===a?e.length-1:t,0),function(){for(var i=arguments,a=-1,s=mr(i.length-t,0),o=n(s);++a<s;)o[a]=i[t+a];a=-1;for(var l=n(t+1);++a<t;)l[a]=i[a];return l[t]=r(o),wt(e,this,l)}}function La(e,t){return t.length<2?e:_n(e,ri(t,0,-1))}function Ra(e,t){for(var r=e.length,n=yr(t.length,r),i=Ai(e);n--;){var s=t[n];e[n]=ma(s,r)?i[s]:a}return e}function Aa(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]}var xa=Pa(Jn),Ia=dt||function(e,t){return ft.setTimeout(e,t)},Da=Pa(ei);function Ca(e,t,r){var n=t+"";return Da(e,function(e,t){var r=t.length;if(!r)return e;var n=r-1;return t[n]=(r>1?"& ":"")+t[n],t=t.join(r>2?", ":" "),e.replace(se,"{\n/* [wrapped with "+t+"] */\n")}(n,function(e,t){return Lt(g,(function(r){var n="_."+r[0];t&r[1]&&!It(e,n)&&e.push(n)})),e.sort()}(function(e){var t=e.match(oe);return t?t[1].split(le):[]}(n),r)))}function Pa(e){var t=0,r=0;return function(){var n=br(),i=16-(n-r);if(r=n,i>0){if(++t>=800)return arguments[0]}else t=0;return e.apply(a,arguments)}}function Ma(e,t){var r=-1,n=e.length,i=n-1;for(t=t===a?n:t;++r<t;){var s=qn(r,i),o=e[s];e[s]=e[r],e[r]=o}return e.length=t,e}var Oa,Na,Fa=(Oa=Os((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(te,(function(e,r,n,i){t.push(n?i.replace(de,"$1"):r||e)})),t}),(function(e){return 500===Na.size&&Na.clear(),e})),Na=Oa.cache,Oa);function Za(e){if("string"==typeof e||uo(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}function Ua(e){if(null!=e){try{return Pe.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function Ba(e){if(e instanceof Kr)return e.clone();var t=new Gr(e.__wrapped__,e.__chain__);return t.__actions__=Ai(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}var ja=Yn((function(e,t){return Ws(e)?dn(e,mn(t,1,Ws,!0)):[]})),Ga=Yn((function(e,t){var r=Qa(t);return Ws(r)&&(r=a),Ws(e)?dn(e,mn(t,1,Ws,!0),oa(r,2)):[]})),Ka=Yn((function(e,t){var r=Qa(t);return Ws(r)&&(r=a),Ws(e)?dn(e,mn(t,1,Ws,!0),a,r):[]}));function Ha(e,t,r){var n=null==e?0:e.length;if(!n)return-1;var i=null==r?0:po(r);return i<0&&(i=mr(n+i,0)),Ut(e,oa(t,3),i)}function za(e,t,r){var n=null==e?0:e.length;if(!n)return-1;var i=n-1;return r!==a&&(i=po(r),i=r<0?mr(n+i,0):yr(i,n-1)),Ut(e,oa(t,3),i,!0)}function Va(e){return null!=e&&e.length?mn(e,1):[]}function qa(e){return e&&e.length?e[0]:a}var Wa=Yn((function(e){var t=Ct(e,pi);return t.length&&t[0]===e[0]?xn(t):[]})),Ya=Yn((function(e){var t=Qa(e),r=Ct(e,pi);return t===Qa(r)?t=a:r.pop(),r.length&&r[0]===e[0]?xn(r,oa(t,2)):[]})),Xa=Yn((function(e){var t=Qa(e),r=Ct(e,pi);return(t="function"==typeof t?t:a)&&r.pop(),r.length&&r[0]===e[0]?xn(r,a,t):[]}));function Qa(e){var t=null==e?0:e.length;return t?e[t-1]:a}var $a=Yn(Ja);function Ja(e,t){return e&&e.length&&t&&t.length?zn(e,t):e}var es=ta((function(e,t){var r=null==e?0:e.length,n=sn(e,t);return Vn(e,Ct(t,(function(e){return ma(e,r)?+e:e})).sort(Si)),n}));function ts(e){return null==e?e:Tr.call(e)}var rs=Yn((function(e){return ui(mn(e,1,Ws,!0))})),ns=Yn((function(e){var t=Qa(e);return Ws(t)&&(t=a),ui(mn(e,1,Ws,!0),oa(t,2))})),is=Yn((function(e){var t=Qa(e);return t="function"==typeof t?t:a,ui(mn(e,1,Ws,!0),a,t)}));function as(e){if(!e||!e.length)return[];var t=0;return e=xt(e,(function(e){if(Ws(e))return t=mr(e.length,t),!0})),Wt(t,(function(t){return Ct(e,Ht(t))}))}function ss(e,t){if(!e||!e.length)return[];var r=as(e);return null==t?r:Ct(r,(function(e){return wt(t,a,e)}))}var os=Yn((function(e,t){return Ws(e)?dn(e,t):[]})),ls=Yn((function(e){return vi(xt(e,Ws))})),us=Yn((function(e){var t=Qa(e);return Ws(t)&&(t=a),vi(xt(e,Ws),oa(t,2))})),cs=Yn((function(e){var t=Qa(e);return t="function"==typeof t?t:a,vi(xt(e,Ws),a,t)})),ds=Yn(as),fs=Yn((function(e){var t=e.length,r=t>1?e[t-1]:a;return r="function"==typeof r?(e.pop(),r):a,ss(e,r)}));function hs(e){var t=Ur(e);return t.__chain__=!0,t}function vs(e,t){return t(e)}var gs=ta((function(e){var t=e.length,r=t?e[0]:0,n=this.__wrapped__,i=function(t){return sn(t,e)};return!(t>1||this.__actions__.length)&&n instanceof Kr&&ma(r)?((n=n.slice(r,+r+(t?1:0))).__actions__.push({func:vs,args:[i],thisArg:a}),new Gr(n,this.__chain__).thru((function(e){return t&&!e.length&&e.push(a),e}))):this.thru(i)})),ps=Ii((function(e,t,r){Me.call(e,r)?++e[r]:an(e,r,1)})),ms=Fi(Ha),ys=Fi(za);function bs(e,t){return(zs(e)?Lt:fn)(e,oa(t,3))}function ks(e,t){return(zs(e)?Rt:hn)(e,oa(t,3))}var Es=Ii((function(e,t,r){Me.call(e,r)?e[r].push(t):an(e,r,[t])})),Ts=Yn((function(e,t,r){var i=-1,a="function"==typeof t,s=qs(e)?n(e.length):[];return fn(e,(function(e){s[++i]=a?wt(t,e,r):In(e,t,r)})),s})),_s=Ii((function(e,t,r){an(e,r,t)}));function ws(e,t){return(zs(e)?Ct:Zn)(e,oa(t,3))}var Ss=Ii((function(e,t,r){e[r?0:1].push(t)}),(function(){return[[],[]]})),Ls=Yn((function(e,t){if(null==e)return[];var r=t.length;return r>1&&ya(e,t[0],t[1])?t=[]:r>2&&ya(t[0],t[1],t[2])&&(t=[t[0]]),Kn(e,mn(t,1),[])})),Rs=ct||function(){return ft.Date.now()};function As(e,t,r){return t=r?a:t,t=e&&null==t?e.length:t,Xi(e,c,a,a,a,a,t)}function xs(e,t){var r;if("function"!=typeof t)throw new Ae(s);return e=po(e),function(){return--e>0&&(r=t.apply(this,arguments)),e<=1&&(t=a),r}}var Is=Yn((function(e,t,r){var n=1;if(r.length){var i=lr(r,sa(Is));n|=u}return Xi(e,n,t,r,i)})),Ds=Yn((function(e,t,r){var n=3;if(r.length){var i=lr(r,sa(Ds));n|=u}return Xi(t,n,e,r,i)}));function Cs(e,t,r){var n,i,o,l,u,c,d=0,f=!1,h=!1,v=!0;if("function"!=typeof e)throw new Ae(s);function g(t){var r=n,s=i;return n=i=a,d=t,l=e.apply(s,r)}function p(e){return d=e,u=Ia(y,t),f?g(e):l}function m(e){var r=e-c;return c===a||r>=t||r<0||h&&e-d>=o}function y(){var e=Rs();if(m(e))return b(e);u=Ia(y,function(e){var r=t-(e-c);return h?yr(r,o-(e-d)):r}(e))}function b(e){return u=a,v&&n?g(e):(n=i=a,l)}function k(){var e=Rs(),r=m(e);if(n=arguments,i=this,c=e,r){if(u===a)return p(c);if(h)return Ei(u),u=Ia(y,t),g(c)}return u===a&&(u=Ia(y,t)),l}return t=yo(t)||0,to(r)&&(f=!!r.leading,o=(h="maxWait"in r)?mr(yo(r.maxWait)||0,t):o,v="trailing"in r?!!r.trailing:v),k.cancel=function(){u!==a&&Ei(u),d=0,n=c=i=u=a},k.flush=function(){return u===a?l:b(Rs())},k}var Ps=Yn((function(e,t){return cn(e,1,t)})),Ms=Yn((function(e,t,r){return cn(e,yo(t)||0,r)}));function Os(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new Ae(s);var r=function r(){var n=arguments,i=t?t.apply(this,n):n[0],a=r.cache;if(a.has(i))return a.get(i);var s=e.apply(this,n);return r.cache=a.set(i,s)||a,s};return r.cache=new(Os.Cache||Vr),r}function Ns(e){if("function"!=typeof e)throw new Ae(s);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}Os.Cache=Vr;var Fs=bi((function(e,t){var r=(t=1==t.length&&zs(t[0])?Ct(t[0],Xt(oa())):Ct(mn(t,1),Xt(oa()))).length;return Yn((function(n){for(var i=-1,a=yr(n.length,r);++i<a;)n[i]=t[i].call(this,n[i]);return wt(e,this,n)}))})),Zs=Yn((function(e,t){var r=lr(t,sa(Zs));return Xi(e,u,a,t,r)})),Us=Yn((function(e,t){var r=lr(t,sa(Us));return Xi(e,64,a,t,r)})),Bs=ta((function(e,t){return Xi(e,256,a,a,a,t)}));function js(e,t){return e===t||e!=e&&t!=t}var Gs=zi(Ln),Ks=zi((function(e,t){return e>=t})),Hs=Dn(function(){return arguments}())?Dn:function(e){return ro(e)&&Me.call(e,"callee")&&!qe.call(e,"callee")},zs=n.isArray,Vs=yt?Xt(yt):function(e){return ro(e)&&Sn(e)==C};function qs(e){return null!=e&&eo(e.length)&&!$s(e)}function Ws(e){return ro(e)&&qs(e)}var Ys=mt||yl,Xs=bt?Xt(bt):function(e){return ro(e)&&Sn(e)==b};function Qs(e){if(!ro(e))return!1;var t=Sn(e);return t==k||"[object DOMException]"==t||"string"==typeof e.message&&"string"==typeof e.name&&!ao(e)}function $s(e){if(!to(e))return!1;var t=Sn(e);return t==E||t==T||"[object AsyncFunction]"==t||"[object Proxy]"==t}function Js(e){return"number"==typeof e&&e==po(e)}function eo(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=f}function to(e){var t=i(e);return null!=e&&("object"==t||"function"==t)}function ro(e){return null!=e&&"object"==i(e)}var no=kt?Xt(kt):function(e){return ro(e)&&ha(e)==_};function io(e){return"number"==typeof e||ro(e)&&Sn(e)==w}function ao(e){if(!ro(e)||Sn(e)!=S)return!1;var t=ze(e);if(null===t)return!0;var r=Me.call(t,"constructor")&&t.constructor;return"function"==typeof r&&r instanceof r&&Pe.call(r)==Ze}var so=Et?Xt(Et):function(e){return ro(e)&&Sn(e)==R},oo=Tt?Xt(Tt):function(e){return ro(e)&&ha(e)==A};function lo(e){return"string"==typeof e||!zs(e)&&ro(e)&&Sn(e)==x}function uo(e){return"symbol"==i(e)||ro(e)&&Sn(e)==I}var co=_t?Xt(_t):function(e){return ro(e)&&eo(e.length)&&!!at[Sn(e)]},fo=zi(Fn),ho=zi((function(e,t){return e<=t}));function vo(e){if(!e)return[];if(qs(e))return lo(e)?fr(e):Ai(e);if(Xe&&e[Xe])return function(e){for(var t,r=[];!(t=e.next()).done;)r.push(t.value);return r}(e[Xe]());var t=ha(e);return(t==_?sr:t==A?ur:Go)(e)}function go(e){return e?(e=yo(e))===d||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0}function po(e){var t=go(e),r=t%1;return t==t?r?t-r:t:0}function mo(e){return e?on(po(e),0,v):0}function yo(e){if("number"==typeof e)return e;if(uo(e))return h;if(to(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=to(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=Yt(e);var r=ge.test(e);return r||me.test(e)?ut(e.slice(2),r?2:8):ve.test(e)?h:+e}function bo(e){return xi(e,Mo(e))}function ko(e){return null==e?"":li(e)}var Eo=Di((function(e,t){if(Ta(t)||qs(t))xi(t,Po(t),e);else for(var r in t)Me.call(t,r)&&en(e,r,t[r])})),To=Di((function(e,t){xi(t,Mo(t),e)})),_o=Di((function(e,t,r,n){xi(t,Mo(t),e,n)})),wo=Di((function(e,t,r,n){xi(t,Po(t),e,n)})),So=ta(sn),Lo=Yn((function(e,t){e=Se(e);var r=-1,n=t.length,i=n>2?t[2]:a;for(i&&ya(t[0],t[1],i)&&(n=1);++r<n;)for(var s=t[r],o=Mo(s),l=-1,u=o.length;++l<u;){var c=o[l],d=e[c];(d===a||js(d,De[c])&&!Me.call(e,c))&&(e[c]=s[c])}return e})),Ro=Yn((function(e){return e.push(a,$i),wt(No,a,e)}));function Ao(e,t,r){var n=null==e?a:_n(e,t);return n===a?r:n}function xo(e,t){return null!=e&&va(e,t,An)}var Io=Bi((function(e,t,r){null!=t&&"function"!=typeof t.toString&&(t=Fe.call(t)),e[t]=r}),rl(al)),Do=Bi((function(e,t,r){null!=t&&"function"!=typeof t.toString&&(t=Fe.call(t)),Me.call(e,t)?e[t].push(r):e[t]=[r]}),oa),Co=Yn(In);function Po(e){return qs(e)?Yr(e):Nn(e)}function Mo(e){return qs(e)?Yr(e,!0):function(e){if(!to(e))return function(e){var t=[];if(null!=e)for(var r in Se(e))t.push(r);return t}(e);var t=Ta(e),r=[];for(var n in e)("constructor"!=n||!t&&Me.call(e,n))&&r.push(n);return r}(e)}var Oo=Di((function(e,t,r){jn(e,t,r)})),No=Di((function(e,t,r,n){jn(e,t,r,n)})),Fo=ta((function(e,t){var r={};if(null==e)return r;var n=!1;t=Ct(t,(function(t){return t=yi(t,e),n||(n=t.length>1),t})),xi(e,na(e),r),n&&(r=ln(r,7,Ji));for(var i=t.length;i--;)ci(r,t[i]);return r})),Zo=ta((function(e,t){return null==e?{}:function(e,t){return Hn(e,t,(function(t,r){return xo(e,r)}))}(e,t)}));function Uo(e,t){if(null==e)return{};var r=Ct(na(e),(function(e){return[e]}));return t=oa(t),Hn(e,r,(function(e,r){return t(e,r[0])}))}var Bo=Yi(Po),jo=Yi(Mo);function Go(e){return null==e?[]:Qt(e,Po(e))}var Ko=Oi((function(e,t,r){return t=t.toLowerCase(),e+(r?Ho(t):t)}));function Ho(e){return $o(ko(e).toLowerCase())}function zo(e){return(e=ko(e))&&e.replace(be,rr).replace($e,"")}var Vo=Oi((function(e,t,r){return e+(r?"-":"")+t.toLowerCase()})),qo=Oi((function(e,t,r){return e+(r?" ":"")+t.toLowerCase()})),Wo=Mi("toLowerCase"),Yo=Oi((function(e,t,r){return e+(r?"_":"")+t.toLowerCase()})),Xo=Oi((function(e,t,r){return e+(r?" ":"")+$o(t)})),Qo=Oi((function(e,t,r){return e+(r?" ":"")+t.toUpperCase()})),$o=Mi("toUpperCase");function Jo(e,t,r){return e=ko(e),(t=r?a:t)===a?function(e){return rt.test(e)}(e)?function(e){return e.match(et)||[]}(e):function(e){return e.match(ue)||[]}(e):e.match(t)||[]}var el=Yn((function(e,t){try{return wt(e,a,t)}catch(e){return Qs(e)?e:new Te(e)}})),tl=ta((function(e,t){return Lt(t,(function(t){t=Za(t),an(e,t,Is(e[t],e))})),e}));function rl(e){return function(){return e}}var nl=Zi(),il=Zi(!0);function al(e){return e}function sl(e){return On("function"==typeof e?e:ln(e,1))}var ol=Yn((function(e,t){return function(r){return In(r,e,t)}})),ll=Yn((function(e,t){return function(r){return In(e,r,t)}}));function ul(e,t,r){var n=Po(t),i=Tn(t,n);null!=r||to(t)&&(i.length||!n.length)||(r=t,t=e,e=this,i=Tn(t,Po(t)));var a=!(to(r)&&"chain"in r&&!r.chain),s=$s(e);return Lt(i,(function(r){var n=t[r];e[r]=n,s&&(e.prototype[r]=function(){var t=this.__chain__;if(a||t){var r=e(this.__wrapped__),i=r.__actions__=Ai(this.__actions__);return i.push({func:n,args:arguments,thisArg:e}),r.__chain__=t,r}return n.apply(e,Pt([this.value()],arguments))})})),e}function cl(){}var dl=Gi(Ct),fl=Gi(At),hl=Gi(Nt);function vl(e){return ba(e)?Ht(Za(e)):function(e){return function(t){return _n(t,e)}}(e)}var gl=Hi(),pl=Hi(!0);function ml(){return[]}function yl(){return!1}var bl,kl=ji((function(e,t){return e+t}),0),El=qi("ceil"),Tl=ji((function(e,t){return e/t}),1),_l=qi("floor"),wl=ji((function(e,t){return e*t}),1),Sl=qi("round"),Ll=ji((function(e,t){return e-t}),0);return Ur.after=function(e,t){if("function"!=typeof t)throw new Ae(s);return e=po(e),function(){if(--e<1)return t.apply(this,arguments)}},Ur.ary=As,Ur.assign=Eo,Ur.assignIn=To,Ur.assignInWith=_o,Ur.assignWith=wo,Ur.at=So,Ur.before=xs,Ur.bind=Is,Ur.bindAll=tl,Ur.bindKey=Ds,Ur.castArray=function(){if(!arguments.length)return[];var e=arguments[0];return zs(e)?e:[e]},Ur.chain=hs,Ur.chunk=function(e,t,r){t=(r?ya(e,t,r):t===a)?1:mr(po(t),0);var i=null==e?0:e.length;if(!i||t<1)return[];for(var s=0,o=0,l=n(ht(i/t));s<i;)l[o++]=ri(e,s,s+=t);return l},Ur.compact=function(e){for(var t=-1,r=null==e?0:e.length,n=0,i=[];++t<r;){var a=e[t];a&&(i[n++]=a)}return i},Ur.concat=function(){var e=arguments.length;if(!e)return[];for(var t=n(e-1),r=arguments[0],i=e;i--;)t[i-1]=arguments[i];return Pt(zs(r)?Ai(r):[r],mn(t,1))},Ur.cond=function(e){var t=null==e?0:e.length,r=oa();return e=t?Ct(e,(function(e){if("function"!=typeof e[1])throw new Ae(s);return[r(e[0]),e[1]]})):[],Yn((function(r){for(var n=-1;++n<t;){var i=e[n];if(wt(i[0],this,r))return wt(i[1],this,r)}}))},Ur.conforms=function(e){return function(e){var t=Po(e);return function(r){return un(r,e,t)}}(ln(e,1))},Ur.constant=rl,Ur.countBy=ps,Ur.create=function(e,t){var r=Br(e);return null==t?r:nn(r,t)},Ur.curry=function e(t,r,n){var i=Xi(t,8,a,a,a,a,a,r=n?a:r);return i.placeholder=e.placeholder,i},Ur.curryRight=function e(t,r,n){var i=Xi(t,16,a,a,a,a,a,r=n?a:r);return i.placeholder=e.placeholder,i},Ur.debounce=Cs,Ur.defaults=Lo,Ur.defaultsDeep=Ro,Ur.defer=Ps,Ur.delay=Ms,Ur.difference=ja,Ur.differenceBy=Ga,Ur.differenceWith=Ka,Ur.drop=function(e,t,r){var n=null==e?0:e.length;return n?ri(e,(t=r||t===a?1:po(t))<0?0:t,n):[]},Ur.dropRight=function(e,t,r){var n=null==e?0:e.length;return n?ri(e,0,(t=n-(t=r||t===a?1:po(t)))<0?0:t):[]},Ur.dropRightWhile=function(e,t){return e&&e.length?fi(e,oa(t,3),!0,!0):[]},Ur.dropWhile=function(e,t){return e&&e.length?fi(e,oa(t,3),!0):[]},Ur.fill=function(e,t,r,n){var i=null==e?0:e.length;return i?(r&&"number"!=typeof r&&ya(e,t,r)&&(r=0,n=i),function(e,t,r,n){var i=e.length;for((r=po(r))<0&&(r=-r>i?0:i+r),(n=n===a||n>i?i:po(n))<0&&(n+=i),n=r>n?0:mo(n);r<n;)e[r++]=t;return e}(e,t,r,n)):[]},Ur.filter=function(e,t){return(zs(e)?xt:pn)(e,oa(t,3))},Ur.flatMap=function(e,t){return mn(ws(e,t),1)},Ur.flatMapDeep=function(e,t){return mn(ws(e,t),d)},Ur.flatMapDepth=function(e,t,r){return r=r===a?1:po(r),mn(ws(e,t),r)},Ur.flatten=Va,Ur.flattenDeep=function(e){return null!=e&&e.length?mn(e,d):[]},Ur.flattenDepth=function(e,t){return null!=e&&e.length?mn(e,t=t===a?1:po(t)):[]},Ur.flip=function(e){return Xi(e,512)},Ur.flow=nl,Ur.flowRight=il,Ur.fromPairs=function(e){for(var t=-1,r=null==e?0:e.length,n={};++t<r;){var i=e[t];n[i[0]]=i[1]}return n},Ur.functions=function(e){return null==e?[]:Tn(e,Po(e))},Ur.functionsIn=function(e){return null==e?[]:Tn(e,Mo(e))},Ur.groupBy=Es,Ur.initial=function(e){return null!=e&&e.length?ri(e,0,-1):[]},Ur.intersection=Wa,Ur.intersectionBy=Ya,Ur.intersectionWith=Xa,Ur.invert=Io,Ur.invertBy=Do,Ur.invokeMap=Ts,Ur.iteratee=sl,Ur.keyBy=_s,Ur.keys=Po,Ur.keysIn=Mo,Ur.map=ws,Ur.mapKeys=function(e,t){var r={};return t=oa(t,3),kn(e,(function(e,n,i){an(r,t(e,n,i),e)})),r},Ur.mapValues=function(e,t){var r={};return t=oa(t,3),kn(e,(function(e,n,i){an(r,n,t(e,n,i))})),r},Ur.matches=function(e){return Un(ln(e,1))},Ur.matchesProperty=function(e,t){return Bn(e,ln(t,1))},Ur.memoize=Os,Ur.merge=Oo,Ur.mergeWith=No,Ur.method=ol,Ur.methodOf=ll,Ur.mixin=ul,Ur.negate=Ns,Ur.nthArg=function(e){return e=po(e),Yn((function(t){return Gn(t,e)}))},Ur.omit=Fo,Ur.omitBy=function(e,t){return Uo(e,Ns(oa(t)))},Ur.once=function(e){return xs(2,e)},Ur.orderBy=function(e,t,r,n){return null==e?[]:(zs(t)||(t=null==t?[]:[t]),zs(r=n?a:r)||(r=null==r?[]:[r]),Kn(e,t,r))},Ur.over=dl,Ur.overArgs=Fs,Ur.overEvery=fl,Ur.overSome=hl,Ur.partial=Zs,Ur.partialRight=Us,Ur.partition=Ss,Ur.pick=Zo,Ur.pickBy=Uo,Ur.property=vl,Ur.propertyOf=function(e){return function(t){return null==e?a:_n(e,t)}},Ur.pull=$a,Ur.pullAll=Ja,Ur.pullAllBy=function(e,t,r){return e&&e.length&&t&&t.length?zn(e,t,oa(r,2)):e},Ur.pullAllWith=function(e,t,r){return e&&e.length&&t&&t.length?zn(e,t,a,r):e},Ur.pullAt=es,Ur.range=gl,Ur.rangeRight=pl,Ur.rearg=Bs,Ur.reject=function(e,t){return(zs(e)?xt:pn)(e,Ns(oa(t,3)))},Ur.remove=function(e,t){var r=[];if(!e||!e.length)return r;var n=-1,i=[],a=e.length;for(t=oa(t,3);++n<a;){var s=e[n];t(s,n,e)&&(r.push(s),i.push(n))}return Vn(e,i),r},Ur.rest=function(e,t){if("function"!=typeof e)throw new Ae(s);return Yn(e,t=t===a?t:po(t))},Ur.reverse=ts,Ur.sampleSize=function(e,t,r){return t=(r?ya(e,t,r):t===a)?1:po(t),(zs(e)?Qr:Qn)(e,t)},Ur.set=function(e,t,r){return null==e?e:$n(e,t,r)},Ur.setWith=function(e,t,r,n){return n="function"==typeof n?n:a,null==e?e:$n(e,t,r,n)},Ur.shuffle=function(e){return(zs(e)?$r:ti)(e)},Ur.slice=function(e,t,r){var n=null==e?0:e.length;return n?(r&&"number"!=typeof r&&ya(e,t,r)?(t=0,r=n):(t=null==t?0:po(t),r=r===a?n:po(r)),ri(e,t,r)):[]},Ur.sortBy=Ls,Ur.sortedUniq=function(e){return e&&e.length?si(e):[]},Ur.sortedUniqBy=function(e,t){return e&&e.length?si(e,oa(t,2)):[]},Ur.split=function(e,t,r){return r&&"number"!=typeof r&&ya(e,t,r)&&(t=r=a),(r=r===a?v:r>>>0)?(e=ko(e))&&("string"==typeof t||null!=t&&!so(t))&&!(t=li(t))&&ar(e)?ki(fr(e),0,r):e.split(t,r):[]},Ur.spread=function(e,t){if("function"!=typeof e)throw new Ae(s);return t=null==t?0:mr(po(t),0),Yn((function(r){var n=r[t],i=ki(r,0,t);return n&&Pt(i,n),wt(e,this,i)}))},Ur.tail=function(e){var t=null==e?0:e.length;return t?ri(e,1,t):[]},Ur.take=function(e,t,r){return e&&e.length?ri(e,0,(t=r||t===a?1:po(t))<0?0:t):[]},Ur.takeRight=function(e,t,r){var n=null==e?0:e.length;return n?ri(e,(t=n-(t=r||t===a?1:po(t)))<0?0:t,n):[]},Ur.takeRightWhile=function(e,t){return e&&e.length?fi(e,oa(t,3),!1,!0):[]},Ur.takeWhile=function(e,t){return e&&e.length?fi(e,oa(t,3)):[]},Ur.tap=function(e,t){return t(e),e},Ur.throttle=function(e,t,r){var n=!0,i=!0;if("function"!=typeof e)throw new Ae(s);return to(r)&&(n="leading"in r?!!r.leading:n,i="trailing"in r?!!r.trailing:i),Cs(e,t,{leading:n,maxWait:t,trailing:i})},Ur.thru=vs,Ur.toArray=vo,Ur.toPairs=Bo,Ur.toPairsIn=jo,Ur.toPath=function(e){return zs(e)?Ct(e,Za):uo(e)?[e]:Ai(Fa(ko(e)))},Ur.toPlainObject=bo,Ur.transform=function(e,t,r){var n=zs(e),i=n||Ys(e)||co(e);if(t=oa(t,4),null==r){var a=e&&e.constructor;r=i?n?new a:[]:to(e)&&$s(a)?Br(ze(e)):{}}return(i?Lt:kn)(e,(function(e,n,i){return t(r,e,n,i)})),r},Ur.unary=function(e){return As(e,1)},Ur.union=rs,Ur.unionBy=ns,Ur.unionWith=is,Ur.uniq=function(e){return e&&e.length?ui(e):[]},Ur.uniqBy=function(e,t){return e&&e.length?ui(e,oa(t,2)):[]},Ur.uniqWith=function(e,t){return t="function"==typeof t?t:a,e&&e.length?ui(e,a,t):[]},Ur.unset=function(e,t){return null==e||ci(e,t)},Ur.unzip=as,Ur.unzipWith=ss,Ur.update=function(e,t,r){return null==e?e:di(e,t,mi(r))},Ur.updateWith=function(e,t,r,n){return n="function"==typeof n?n:a,null==e?e:di(e,t,mi(r),n)},Ur.values=Go,Ur.valuesIn=function(e){return null==e?[]:Qt(e,Mo(e))},Ur.without=os,Ur.words=Jo,Ur.wrap=function(e,t){return Zs(mi(t),e)},Ur.xor=ls,Ur.xorBy=us,Ur.xorWith=cs,Ur.zip=ds,Ur.zipObject=function(e,t){return gi(e||[],t||[],en)},Ur.zipObjectDeep=function(e,t){return gi(e||[],t||[],$n)},Ur.zipWith=fs,Ur.entries=Bo,Ur.entriesIn=jo,Ur.extend=To,Ur.extendWith=_o,ul(Ur,Ur),Ur.add=kl,Ur.attempt=el,Ur.camelCase=Ko,Ur.capitalize=Ho,Ur.ceil=El,Ur.clamp=function(e,t,r){return r===a&&(r=t,t=a),r!==a&&(r=(r=yo(r))==r?r:0),t!==a&&(t=(t=yo(t))==t?t:0),on(yo(e),t,r)},Ur.clone=function(e){return ln(e,4)},Ur.cloneDeep=function(e){return ln(e,5)},Ur.cloneDeepWith=function(e,t){return ln(e,5,t="function"==typeof t?t:a)},Ur.cloneWith=function(e,t){return ln(e,4,t="function"==typeof t?t:a)},Ur.conformsTo=function(e,t){return null==t||un(e,t,Po(t))},Ur.deburr=zo,Ur.defaultTo=function(e,t){return null==e||e!=e?t:e},Ur.divide=Tl,Ur.endsWith=function(e,t,r){e=ko(e),t=li(t);var n=e.length,i=r=r===a?n:on(po(r),0,n);return(r-=t.length)>=0&&e.slice(r,i)==t},Ur.eq=js,Ur.escape=function(e){return(e=ko(e))&&Y.test(e)?e.replace(q,nr):e},Ur.escapeRegExp=function(e){return(e=ko(e))&&ne.test(e)?e.replace(re,"\\$&"):e},Ur.every=function(e,t,r){var n=zs(e)?At:vn;return r&&ya(e,t,r)&&(t=a),n(e,oa(t,3))},Ur.find=ms,Ur.findIndex=Ha,Ur.findKey=function(e,t){return Zt(e,oa(t,3),kn)},Ur.findLast=ys,Ur.findLastIndex=za,Ur.findLastKey=function(e,t){return Zt(e,oa(t,3),En)},Ur.floor=_l,Ur.forEach=bs,Ur.forEachRight=ks,Ur.forIn=function(e,t){return null==e?e:yn(e,oa(t,3),Mo)},Ur.forInRight=function(e,t){return null==e?e:bn(e,oa(t,3),Mo)},Ur.forOwn=function(e,t){return e&&kn(e,oa(t,3))},Ur.forOwnRight=function(e,t){return e&&En(e,oa(t,3))},Ur.get=Ao,Ur.gt=Gs,Ur.gte=Ks,Ur.has=function(e,t){return null!=e&&va(e,t,Rn)},Ur.hasIn=xo,Ur.head=qa,Ur.identity=al,Ur.includes=function(e,t,r,n){e=qs(e)?e:Go(e),r=r&&!n?po(r):0;var i=e.length;return r<0&&(r=mr(i+r,0)),lo(e)?r<=i&&e.indexOf(t,r)>-1:!!i&&Bt(e,t,r)>-1},Ur.indexOf=function(e,t,r){var n=null==e?0:e.length;if(!n)return-1;var i=null==r?0:po(r);return i<0&&(i=mr(n+i,0)),Bt(e,t,i)},Ur.inRange=function(e,t,r){return t=go(t),r===a?(r=t,t=0):r=go(r),function(e,t,r){return e>=yr(t,r)&&e<mr(t,r)}(e=yo(e),t,r)},Ur.invoke=Co,Ur.isArguments=Hs,Ur.isArray=zs,Ur.isArrayBuffer=Vs,Ur.isArrayLike=qs,Ur.isArrayLikeObject=Ws,Ur.isBoolean=function(e){return!0===e||!1===e||ro(e)&&Sn(e)==y},Ur.isBuffer=Ys,Ur.isDate=Xs,Ur.isElement=function(e){return ro(e)&&1===e.nodeType&&!ao(e)},Ur.isEmpty=function(e){if(null==e)return!0;if(qs(e)&&(zs(e)||"string"==typeof e||"function"==typeof e.splice||Ys(e)||co(e)||Hs(e)))return!e.length;var t=ha(e);if(t==_||t==A)return!e.size;if(Ta(e))return!Nn(e).length;for(var r in e)if(Me.call(e,r))return!1;return!0},Ur.isEqual=function(e,t){return Cn(e,t)},Ur.isEqualWith=function(e,t,r){var n=(r="function"==typeof r?r:a)?r(e,t):a;return n===a?Cn(e,t,a,r):!!n},Ur.isError=Qs,Ur.isFinite=function(e){return"number"==typeof e&&Ft(e)},Ur.isFunction=$s,Ur.isInteger=Js,Ur.isLength=eo,Ur.isMap=no,Ur.isMatch=function(e,t){return e===t||Pn(e,t,ua(t))},Ur.isMatchWith=function(e,t,r){return r="function"==typeof r?r:a,Pn(e,t,ua(t),r)},Ur.isNaN=function(e){return io(e)&&e!=+e},Ur.isNative=function(e){if(Ea(e))throw new Te("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return Mn(e)},Ur.isNil=function(e){return null==e},Ur.isNull=function(e){return null===e},Ur.isNumber=io,Ur.isObject=to,Ur.isObjectLike=ro,Ur.isPlainObject=ao,Ur.isRegExp=so,Ur.isSafeInteger=function(e){return Js(e)&&e>=-9007199254740991&&e<=f},Ur.isSet=oo,Ur.isString=lo,Ur.isSymbol=uo,Ur.isTypedArray=co,Ur.isUndefined=function(e){return e===a},Ur.isWeakMap=function(e){return ro(e)&&ha(e)==D},Ur.isWeakSet=function(e){return ro(e)&&"[object WeakSet]"==Sn(e)},Ur.join=function(e,t){return null==e?"":zt.call(e,t)},Ur.kebabCase=Vo,Ur.last=Qa,Ur.lastIndexOf=function(e,t,r){var n=null==e?0:e.length;if(!n)return-1;var i=n;return r!==a&&(i=(i=po(r))<0?mr(n+i,0):yr(i,n-1)),t==t?function(e,t,r){for(var n=r+1;n--;)if(e[n]===t)return n;return n}(e,t,i):Ut(e,Gt,i,!0)},Ur.lowerCase=qo,Ur.lowerFirst=Wo,Ur.lt=fo,Ur.lte=ho,Ur.max=function(e){return e&&e.length?gn(e,al,Ln):a},Ur.maxBy=function(e,t){return e&&e.length?gn(e,oa(t,2),Ln):a},Ur.mean=function(e){return Kt(e,al)},Ur.meanBy=function(e,t){return Kt(e,oa(t,2))},Ur.min=function(e){return e&&e.length?gn(e,al,Fn):a},Ur.minBy=function(e,t){return e&&e.length?gn(e,oa(t,2),Fn):a},Ur.stubArray=ml,Ur.stubFalse=yl,Ur.stubObject=function(){return{}},Ur.stubString=function(){return""},Ur.stubTrue=function(){return!0},Ur.multiply=wl,Ur.nth=function(e,t){return e&&e.length?Gn(e,po(t)):a},Ur.noConflict=function(){return ft._===this&&(ft._=Ue),this},Ur.noop=cl,Ur.now=Rs,Ur.pad=function(e,t,r){e=ko(e);var n=(t=po(t))?dr(e):0;if(!t||n>=t)return e;var i=(t-n)/2;return Ki(vt(i),r)+e+Ki(ht(i),r)},Ur.padEnd=function(e,t,r){e=ko(e);var n=(t=po(t))?dr(e):0;return t&&n<t?e+Ki(t-n,r):e},Ur.padStart=function(e,t,r){e=ko(e);var n=(t=po(t))?dr(e):0;return t&&n<t?Ki(t-n,r)+e:e},Ur.parseInt=function(e,t,r){return r||null==t?t=0:t&&(t=+t),kr(ko(e).replace(ie,""),t||0)},Ur.random=function(e,t,r){if(r&&"boolean"!=typeof r&&ya(e,t,r)&&(t=r=a),r===a&&("boolean"==typeof t?(r=t,t=a):"boolean"==typeof e&&(r=e,e=a)),e===a&&t===a?(e=0,t=1):(e=go(e),t===a?(t=e,e=0):t=go(t)),e>t){var n=e;e=t,t=n}if(r||e%1||t%1){var i=Er();return yr(e+i*(t-e+lt("1e-"+((i+"").length-1))),t)}return qn(e,t)},Ur.reduce=function(e,t,r){var n=zs(e)?Mt:Vt,i=arguments.length<3;return n(e,oa(t,4),r,i,fn)},Ur.reduceRight=function(e,t,r){var n=zs(e)?Ot:Vt,i=arguments.length<3;return n(e,oa(t,4),r,i,hn)},Ur.repeat=function(e,t,r){return t=(r?ya(e,t,r):t===a)?1:po(t),Wn(ko(e),t)},Ur.replace=function(){var e=arguments,t=ko(e[0]);return e.length<3?t:t.replace(e[1],e[2])},Ur.result=function(e,t,r){var n=-1,i=(t=yi(t,e)).length;for(i||(i=1,e=a);++n<i;){var s=null==e?a:e[Za(t[n])];s===a&&(n=i,s=r),e=$s(s)?s.call(e):s}return e},Ur.round=Sl,Ur.runInContext=e,Ur.sample=function(e){return(zs(e)?Xr:Xn)(e)},Ur.size=function(e){if(null==e)return 0;if(qs(e))return lo(e)?dr(e):e.length;var t=ha(e);return t==_||t==A?e.size:Nn(e).length},Ur.snakeCase=Yo,Ur.some=function(e,t,r){var n=zs(e)?Nt:ni;return r&&ya(e,t,r)&&(t=a),n(e,oa(t,3))},Ur.sortedIndex=function(e,t){return ii(e,t)},Ur.sortedIndexBy=function(e,t,r){return ai(e,t,oa(r,2))},Ur.sortedIndexOf=function(e,t){var r=null==e?0:e.length;if(r){var n=ii(e,t);if(n<r&&js(e[n],t))return n}return-1},Ur.sortedLastIndex=function(e,t){return ii(e,t,!0)},Ur.sortedLastIndexBy=function(e,t,r){return ai(e,t,oa(r,2),!0)},Ur.sortedLastIndexOf=function(e,t){if(null!=e&&e.length){var r=ii(e,t,!0)-1;if(js(e[r],t))return r}return-1},Ur.startCase=Xo,Ur.startsWith=function(e,t,r){return e=ko(e),r=null==r?0:on(po(r),0,e.length),t=li(t),e.slice(r,r+t.length)==t},Ur.subtract=Ll,Ur.sum=function(e){return e&&e.length?qt(e,al):0},Ur.sumBy=function(e,t){return e&&e.length?qt(e,oa(t,2)):0},Ur.template=function(e,t,r){var n=Ur.templateSettings;r&&ya(e,t,r)&&(t=a),e=ko(e),t=_o({},t,n,Qi);var i,s,o=_o({},t.imports,n.imports,Qi),l=Po(o),u=Qt(o,l),c=0,d=t.interpolate||ke,f="__p += '",h=Le((t.escape||ke).source+"|"+d.source+"|"+(d===$?fe:ke).source+"|"+(t.evaluate||ke).source+"|$","g"),v="//# sourceURL="+(Me.call(t,"sourceURL")?(t.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++it+"]")+"\n";e.replace(h,(function(t,r,n,a,o,l){return n||(n=a),f+=e.slice(c,l).replace(Ee,ir),r&&(i=!0,f+="' +\n__e("+r+") +\n'"),o&&(s=!0,f+="';\n"+o+";\n__p += '"),n&&(f+="' +\n((__t = ("+n+")) == null ? '' : __t) +\n'"),c=l+t.length,t})),f+="';\n";var g=Me.call(t,"variable")&&t.variable;if(g){if(ce.test(g))throw new Te("Invalid `variable` option passed into `_.template`")}else f="with (obj) {\n"+f+"\n}\n";f=(s?f.replace(K,""):f).replace(H,"$1").replace(z,"$1;"),f="function("+(g||"obj")+") {\n"+(g?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(i?", __e = _.escape":"")+(s?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+f+"return __p\n}";var p=el((function(){return _e(l,v+"return "+f).apply(a,u)}));if(p.source=f,Qs(p))throw p;return p},Ur.times=function(e,t){if((e=po(e))<1||e>f)return[];var r=v,n=yr(e,v);t=oa(t),e-=v;for(var i=Wt(n,t);++r<e;)t(r);return i},Ur.toFinite=go,Ur.toInteger=po,Ur.toLength=mo,Ur.toLower=function(e){return ko(e).toLowerCase()},Ur.toNumber=yo,Ur.toSafeInteger=function(e){return e?on(po(e),-9007199254740991,f):0===e?e:0},Ur.toString=ko,Ur.toUpper=function(e){return ko(e).toUpperCase()},Ur.trim=function(e,t,r){if((e=ko(e))&&(r||t===a))return Yt(e);if(!e||!(t=li(t)))return e;var n=fr(e),i=fr(t);return ki(n,Jt(n,i),er(n,i)+1).join("")},Ur.trimEnd=function(e,t,r){if((e=ko(e))&&(r||t===a))return e.slice(0,hr(e)+1);if(!e||!(t=li(t)))return e;var n=fr(e);return ki(n,0,er(n,fr(t))+1).join("")},Ur.trimStart=function(e,t,r){if((e=ko(e))&&(r||t===a))return e.replace(ie,"");if(!e||!(t=li(t)))return e;var n=fr(e);return ki(n,Jt(n,fr(t))).join("")},Ur.truncate=function(e,t){var r=30,n="...";if(to(t)){var i="separator"in t?t.separator:i;r="length"in t?po(t.length):r,n="omission"in t?li(t.omission):n}var s=(e=ko(e)).length;if(ar(e)){var o=fr(e);s=o.length}if(r>=s)return e;var l=r-dr(n);if(l<1)return n;var u=o?ki(o,0,l).join(""):e.slice(0,l);if(i===a)return u+n;if(o&&(l+=u.length-l),so(i)){if(e.slice(l).search(i)){var c,d=u;for(i.global||(i=Le(i.source,ko(he.exec(i))+"g")),i.lastIndex=0;c=i.exec(d);)var f=c.index;u=u.slice(0,f===a?l:f)}}else if(e.indexOf(li(i),l)!=l){var h=u.lastIndexOf(i);h>-1&&(u=u.slice(0,h))}return u+n},Ur.unescape=function(e){return(e=ko(e))&&W.test(e)?e.replace(V,vr):e},Ur.uniqueId=function(e){var t=++Oe;return ko(e)+t},Ur.upperCase=Qo,Ur.upperFirst=$o,Ur.each=bs,Ur.eachRight=ks,Ur.first=qa,ul(Ur,(bl={},kn(Ur,(function(e,t){Me.call(Ur.prototype,t)||(bl[t]=e)})),bl),{chain:!1}),Ur.VERSION="4.17.21",Lt(["bind","bindKey","curry","curryRight","partial","partialRight"],(function(e){Ur[e].placeholder=Ur})),Lt(["drop","take"],(function(e,t){Kr.prototype[e]=function(r){r=r===a?1:mr(po(r),0);var n=this.__filtered__&&!t?new Kr(this):this.clone();return n.__filtered__?n.__takeCount__=yr(r,n.__takeCount__):n.__views__.push({size:yr(r,v),type:e+(n.__dir__<0?"Right":"")}),n},Kr.prototype[e+"Right"]=function(t){return this.reverse()[e](t).reverse()}})),Lt(["filter","map","takeWhile"],(function(e,t){var r=t+1,n=1==r||3==r;Kr.prototype[e]=function(e){var t=this.clone();return t.__iteratees__.push({iteratee:oa(e,3),type:r}),t.__filtered__=t.__filtered__||n,t}})),Lt(["head","last"],(function(e,t){var r="take"+(t?"Right":"");Kr.prototype[e]=function(){return this[r](1).value()[0]}})),Lt(["initial","tail"],(function(e,t){var r="drop"+(t?"":"Right");Kr.prototype[e]=function(){return this.__filtered__?new Kr(this):this[r](1)}})),Kr.prototype.compact=function(){return this.filter(al)},Kr.prototype.find=function(e){return this.filter(e).head()},Kr.prototype.findLast=function(e){return this.reverse().find(e)},Kr.prototype.invokeMap=Yn((function(e,t){return"function"==typeof e?new Kr(this):this.map((function(r){return In(r,e,t)}))})),Kr.prototype.reject=function(e){return this.filter(Ns(oa(e)))},Kr.prototype.slice=function(e,t){e=po(e);var r=this;return r.__filtered__&&(e>0||t<0)?new Kr(r):(e<0?r=r.takeRight(-e):e&&(r=r.drop(e)),t!==a&&(r=(t=po(t))<0?r.dropRight(-t):r.take(t-e)),r)},Kr.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},Kr.prototype.toArray=function(){return this.take(v)},kn(Kr.prototype,(function(e,t){var r=/^(?:filter|find|map|reject)|While$/.test(t),n=/^(?:head|last)$/.test(t),i=Ur[n?"take"+("last"==t?"Right":""):t],s=n||/^find/.test(t);i&&(Ur.prototype[t]=function(){var t=this.__wrapped__,o=n?[1]:arguments,l=t instanceof Kr,u=o[0],c=l||zs(t),d=function(e){var t=i.apply(Ur,Pt([e],o));return n&&f?t[0]:t};c&&r&&"function"==typeof u&&1!=u.length&&(l=c=!1);var f=this.__chain__,h=!!this.__actions__.length,v=s&&!f,g=l&&!h;if(!s&&c){t=g?t:new Kr(this);var p=e.apply(t,o);return p.__actions__.push({func:vs,args:[d],thisArg:a}),new Gr(p,f)}return v&&g?e.apply(this,o):(p=this.thru(d),v?n?p.value()[0]:p.value():p)})})),Lt(["pop","push","shift","sort","splice","unshift"],(function(e){var t=xe[e],r=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",n=/^(?:pop|shift)$/.test(e);Ur.prototype[e]=function(){var e=arguments;if(n&&!this.__chain__){var i=this.value();return t.apply(zs(i)?i:[],e)}return this[r]((function(r){return t.apply(zs(r)?r:[],e)}))}})),kn(Kr.prototype,(function(e,t){var r=Ur[t];if(r){var n=r.name+"";Me.call(Ir,n)||(Ir[n]=[]),Ir[n].push({name:t,func:r})}})),Ir[Ui(a,2).name]=[{name:"wrapper",func:a}],Kr.prototype.clone=function(){var e=new Kr(this.__wrapped__);return e.__actions__=Ai(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=Ai(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=Ai(this.__views__),e},Kr.prototype.reverse=function(){if(this.__filtered__){var e=new Kr(this);e.__dir__=-1,e.__filtered__=!0}else(e=this.clone()).__dir__*=-1;return e},Kr.prototype.value=function(){var e=this.__wrapped__.value(),t=this.__dir__,r=zs(e),n=t<0,i=r?e.length:0,a=function(e,t,r){for(var n=-1,i=r.length;++n<i;){var a=r[n],s=a.size;switch(a.type){case"drop":e+=s;break;case"dropRight":t-=s;break;case"take":t=yr(t,e+s);break;case"takeRight":e=mr(e,t-s)}}return{start:e,end:t}}(0,i,this.__views__),s=a.start,o=a.end,l=o-s,u=n?o:s-1,c=this.__iteratees__,d=c.length,f=0,h=yr(l,this.__takeCount__);if(!r||!n&&i==l&&h==l)return hi(e,this.__actions__);var v=[];e:for(;l--&&f<h;){for(var g=-1,p=e[u+=t];++g<d;){var m=c[g],y=m.iteratee,b=m.type,k=y(p);if(2==b)p=k;else if(!k){if(1==b)continue e;break e}}v[f++]=p}return v},Ur.prototype.at=gs,Ur.prototype.chain=function(){return hs(this)},Ur.prototype.commit=function(){return new Gr(this.value(),this.__chain__)},Ur.prototype.next=function(){this.__values__===a&&(this.__values__=vo(this.value()));var e=this.__index__>=this.__values__.length;return{done:e,value:e?a:this.__values__[this.__index__++]}},Ur.prototype.plant=function(e){for(var t,r=this;r instanceof jr;){var n=Ba(r);n.__index__=0,n.__values__=a,t?i.__wrapped__=n:t=n;var i=n;r=r.__wrapped__}return i.__wrapped__=e,t},Ur.prototype.reverse=function(){var e=this.__wrapped__;if(e instanceof Kr){var t=e;return this.__actions__.length&&(t=new Kr(this)),(t=t.reverse()).__actions__.push({func:vs,args:[ts],thisArg:a}),new Gr(t,this.__chain__)}return this.thru(ts)},Ur.prototype.toJSON=Ur.prototype.valueOf=Ur.prototype.value=function(){return hi(this.__wrapped__,this.__actions__)},Ur.prototype.first=Ur.prototype.head,Xe&&(Ur.prototype[Xe]=function(){return this}),Ur}();"object"==i(r.amdO)&&r.amdO?(ft._=gr,(n=function(){return gr}.call(t,r,t,e))===a||(e.exports=n)):vt?((vt.exports=gr)._=gr,ht._=gr):ft._=gr}.call(this)},519:function(e,t,r){var n,i,a;e=r.nmd(e);var s,o=r(40);r(5),r(4),r(24),r(0),r(19),r(11),r(2),r(35),r(10),r(26),r(27),r(12),r(62),r(83),r(33),r(16),r(20),r(18),r(49),r(43),r(44),r(45),r(25),r(139),r(1202),r(54),r(17),s=function(e){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/",r(r.s=11)}([function(e,t,r){(function(t){if("production"!==t.env.NODE_ENV){var n="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103;e.exports=r(14)((function(e){return"object"===o(e)&&null!==e&&e.$$typeof===n}),!0)}else e.exports=r(16)()}).call(t,r(2))},function(t,r){t.exports=e},function(e,t){var r,n,i=e.exports={};function a(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function o(e){if(r===setTimeout)return setTimeout(e,0);if((r===a||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:a}catch(e){r=a}try{n="function"==typeof clearTimeout?clearTimeout:s}catch(e){n=s}}();var l,u=[],c=!1,d=-1;function f(){c&&l&&(c=!1,l.length?u=l.concat(u):d=-1,u.length&&h())}function h(){if(!c){var e=o(f);c=!0;for(var t=u.length;t;){for(l=u,u=[];++d<t;)l&&l[d].run();d=-1,t=u.length}l=null,c=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===s||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function v(e,t){this.fun=e,this.array=t}function g(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];u.push(new v(e,t)),1!==u.length||c||o(h)},v.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=g,i.addListener=g,i.once=g,i.off=g,i.removeListener=g,i.removeAllListeners=g,i.emit=g,i.prependListener=g,i.prependOnceListener=g,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return e.reduce((function(e,t){return e+t}))/e.length}},function(e,t,r){"use strict";function n(e){return function(){return e}}var i=function(){};i.thatReturns=n,i.thatReturnsFalse=n(!1),i.thatReturnsTrue=n(!0),i.thatReturnsNull=n(null),i.thatReturnsThis=function(){return this},i.thatReturnsArgument=function(e){return e},e.exports=i},function(e,t,r){"use strict";(function(t){var r=function(e){};"production"!==t.env.NODE_ENV&&(r=function(e){if(void 0===e)throw new Error("invariant requires an error message argument")}),e.exports=function(e,t,n,i,a,s,o,l){if(r(t),!e){var u;if(void 0===t)u=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var c=[n,i,a,s,o,l],d=0;(u=new Error(t.replace(/%s/g,(function(){return c[d++]})))).name="Invariant Violation"}throw u.framesToPop=1,u}}}).call(t,r(2))},function(e,t,r){"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return Math.min.apply(Math,e)}},function(e,t,r){"use strict";(function(t){var n=r(4);if("production"!==t.env.NODE_ENV){var i=function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];var i=0,a="Warning: "+e.replace(/%s/g,(function(){return r[i++]}));"undefined"!=typeof console&&console.error(a);try{throw new Error(a)}catch(e){}};n=function(e,t){if(void 0===t)throw new Error("`warning(condition, format, ...args)` requires a warning message argument");if(0!==t.indexOf("Failed Composite propType: ")&&!e){for(var r=arguments.length,n=Array(r>2?r-2:0),a=2;a<r;a++)n[a-2]=arguments[a];i.apply(void 0,[t].concat(n))}}}e.exports=n}).call(t,r(2))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return Math.max.apply(Math,e)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,i=(n=r(3))&&n.__esModule?n:{default:n};t.default=function(e){var t=(0,i.default)(e),r=e.map((function(e){return Math.pow(e-t,2)})),n=(0,i.default)(r);return Math.sqrt(n)}},function(e,t,r){e.exports=r(12)},function(e,t,r){"use strict";e.exports=r(13)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SparklinesText=t.SparklinesNormalBand=t.SparklinesReferenceLine=t.SparklinesSpots=t.SparklinesBars=t.SparklinesCurve=t.SparklinesLine=t.Sparklines=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=p(r(0)),a=r(1),s=p(a),l=p(r(17)),u=p(r(18)),c=p(r(19)),d=p(r(20)),f=p(r(21)),h=p(r(22)),v=p(r(27)),g=p(r(28));function p(e){return e&&e.__esModule?e:{default:e}}var m=function(e){function t(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==o(t)&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+o(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),n(t,[{key:"render",value:function(){var e=this.props,t=e.data,r=e.limit,n=e.width,i=e.height,a=e.svgWidth,o=e.svgHeight,l=e.preserveAspectRatio,u=e.margin,c=e.style,d=e.max,f=e.min;if(0===t.length)return null;var h=(0,g.default)({data:t,limit:r,width:n,height:i,margin:u,max:d,min:f}),v={style:c,viewBox:"0 0 "+n+" "+i,preserveAspectRatio:l};return a>0&&(v.width=a),o>0&&(v.height=o),s.default.createElement("svg",v,s.default.Children.map(this.props.children,(function(e){return s.default.cloneElement(e,{data:t,points:h,width:n,height:i,margin:u})})))}}]),t}(a.PureComponent);m.propTypes={data:i.default.array,limit:i.default.number,width:i.default.number,height:i.default.number,svgWidth:i.default.number,svgHeight:i.default.number,preserveAspectRatio:i.default.string,margin:i.default.number,style:i.default.object,min:i.default.number,max:i.default.number,onMouseMove:i.default.func},m.defaultProps={data:[],width:240,height:60,preserveAspectRatio:"none",margin:2},t.Sparklines=m,t.SparklinesLine=u.default,t.SparklinesCurve=c.default,t.SparklinesBars=d.default,t.SparklinesSpots=f.default,t.SparklinesReferenceLine=h.default,t.SparklinesNormalBand=v.default,t.SparklinesText=l.default},function(e,t,r){"use strict";(function(t){var n=r(4),i=r(5),a=r(8),s=r(6),l=r(15);e.exports=function(e,r){var u="function"==typeof Symbol&&Symbol.iterator,c="<<anonymous>>",d={array:v("array"),bool:v("boolean"),func:v("function"),number:v("number"),object:v("object"),string:v("string"),symbol:v("symbol"),any:h(n.thatReturnsNull),arrayOf:function(e){return h((function(t,r,n,i,a){if("function"!=typeof e)return new f("Property `"+a+"` of component `"+n+"` has invalid PropType notation inside arrayOf.");var o=t[r];if(!Array.isArray(o))return new f("Invalid "+i+" `"+a+"` of type `"+p(o)+"` supplied to `"+n+"`, expected an array.");for(var l=0;l<o.length;l++){var u=e(o,l,n,i,a+"["+l+"]",s);if(u instanceof Error)return u}return null}))},element:h((function(t,r,n,i,a){var s=t[r];return e(s)?null:new f("Invalid "+i+" `"+a+"` of type `"+p(s)+"` supplied to `"+n+"`, expected a single ReactElement.")})),instanceOf:function(e){return h((function(t,r,n,i,a){if(!(t[r]instanceof e)){var s=e.name||c;return new f("Invalid "+i+" `"+a+"` of type `"+((o=t[r]).constructor&&o.constructor.name?o.constructor.name:c)+"` supplied to `"+n+"`, expected instance of `"+s+"`.")}var o;return null}))},node:h((function(e,t,r,n,i){return g(e[t])?null:new f("Invalid "+n+" `"+i+"` supplied to `"+r+"`, expected a ReactNode.")})),objectOf:function(e){return h((function(t,r,n,i,a){if("function"!=typeof e)return new f("Property `"+a+"` of component `"+n+"` has invalid PropType notation inside objectOf.");var o=t[r],l=p(o);if("object"!==l)return new f("Invalid "+i+" `"+a+"` of type `"+l+"` supplied to `"+n+"`, expected an object.");for(var u in o)if(o.hasOwnProperty(u)){var c=e(o,u,n,i,a+"."+u,s);if(c instanceof Error)return c}return null}))},oneOf:function(e){return Array.isArray(e)?h((function(t,r,n,i,a){for(var s=t[r],o=0;o<e.length;o++)if(l=s,u=e[o],l===u?0!==l||1/l==1/u:l!=l&&u!=u)return null;var l,u;return new f("Invalid "+i+" `"+a+"` of value `"+s+"` supplied to `"+n+"`, expected one of "+JSON.stringify(e)+".")})):("production"!==t.env.NODE_ENV&&a(!1,"Invalid argument supplied to oneOf, expected an instance of array."),n.thatReturnsNull)},oneOfType:function(e){if(!Array.isArray(e))return"production"!==t.env.NODE_ENV&&a(!1,"Invalid argument supplied to oneOfType, expected an instance of array."),n.thatReturnsNull;for(var r=0;r<e.length;r++){var i=e[r];if("function"!=typeof i)return a(!1,"Invalid argument supplid to oneOfType. Expected an array of check functions, but received %s at index %s.",y(i),r),n.thatReturnsNull}return h((function(t,r,n,i,a){for(var o=0;o<e.length;o++)if(null==(0,e[o])(t,r,n,i,a,s))return null;return new f("Invalid "+i+" `"+a+"` supplied to `"+n+"`.")}))},shape:function(e){return h((function(t,r,n,i,a){var o=t[r],l=p(o);if("object"!==l)return new f("Invalid "+i+" `"+a+"` of type `"+l+"` supplied to `"+n+"`, expected `object`.");for(var u in e){var c=e[u];if(c){var d=c(o,u,n,i,a+"."+u,s);if(d)return d}}return null}))}};function f(e){this.message=e,this.stack=""}function h(e){if("production"!==t.env.NODE_ENV)var n={},o=0;function l(l,u,d,h,v,g,p){if(h=h||c,g=g||d,p!==s)if(r)i(!1,"Calling PropTypes validators directly is not supported by the `prop-types` package. Use `PropTypes.checkPropTypes()` to call them. Read more at http://fb.me/use-check-prop-types");else if("production"!==t.env.NODE_ENV&&"undefined"!=typeof console){var m=h+":"+d;!n[m]&&o<3&&(a(!1,"You are manually calling a React.PropTypes validation function for the `%s` prop on `%s`. This is deprecated and will throw in the standalone `prop-types` package. You may be seeing this warning due to a third-party PropTypes library. See https://fb.me/react-warning-dont-call-proptypes for details.",g,h),n[m]=!0,o++)}return null==u[d]?l?null===u[d]?new f("The "+v+" `"+g+"` is marked as required in `"+h+"`, but its value is `null`."):new f("The "+v+" `"+g+"` is marked as required in `"+h+"`, but its value is `undefined`."):null:e(u,d,h,v,g)}var u=l.bind(null,!1);return u.isRequired=l.bind(null,!0),u}function v(e){return h((function(t,r,n,i,a,s){var o=t[r];return p(o)!==e?new f("Invalid "+i+" `"+a+"` of type `"+m(o)+"` supplied to `"+n+"`, expected `"+e+"`."):null}))}function g(t){switch(o(t)){case"number":case"string":case"undefined":return!0;case"boolean":return!t;case"object":if(Array.isArray(t))return t.every(g);if(null===t||e(t))return!0;var r=function(e){var t=e&&(u&&e[u]||e["@@iterator"]);if("function"==typeof t)return t}(t);if(!r)return!1;var n,i=r.call(t);if(r!==t.entries){for(;!(n=i.next()).done;)if(!g(n.value))return!1}else for(;!(n=i.next()).done;){var a=n.value;if(a&&!g(a[1]))return!1}return!0;default:return!1}}function p(e){var t=o(e);return Array.isArray(e)?"array":e instanceof RegExp?"object":function(e,t){return"symbol"===e||"Symbol"===t["@@toStringTag"]||"function"==typeof Symbol&&t instanceof Symbol}(t,e)?"symbol":t}function m(e){if(null==e)return""+e;var t=p(e);if("object"===t){if(e instanceof Date)return"date";if(e instanceof RegExp)return"regexp"}return t}function y(e){var t=m(e);switch(t){case"array":case"object":return"an "+t;case"boolean":case"date":case"regexp":return"a "+t;default:return t}}return f.prototype=Error.prototype,d.checkPropTypes=l,d.PropTypes=d,d}}).call(t,r(2))},function(e,t,r){"use strict";(function(t){if("production"!==t.env.NODE_ENV)var n=r(5),i=r(8),a=r(6),s={};e.exports=function(e,r,l,u,c){if("production"!==t.env.NODE_ENV)for(var d in e)if(e.hasOwnProperty(d)){var f;try{n("function"==typeof e[d],"%s: %s type `%s` is invalid; it must be a function, usually from React.PropTypes.",u||"React class",l,d),f=e[d](r,d,u,l,null,a)}catch(e){f=e}if(i(!f||f instanceof Error,"%s: type specification of %s `%s` is invalid; the type checker function must return `null` or an `Error` but returned a %s. You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument).",u||"React class",l,d,o(f)),f instanceof Error&&!(f.message in s)){s[f.message]=!0;var h=c?c():"";i(!1,"Failed %s type: %s%s",l,f.message,null!=h?h:"")}}}}).call(t,r(2))},function(e,t,r){"use strict";var n=r(4),i=r(5),a=r(6);e.exports=function(){function e(e,t,r,n,s,o){o!==a&&i(!1,"Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types")}function t(){return e}e.isRequired=e;var r={array:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t};return r.checkPropTypes=n,r.PropTypes=r,r}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=s(r(0)),a=s(r(1));function s(e){return e&&e.__esModule?e:{default:e}}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==o(t)&&"function"!=typeof t?e:t}var c=function(e){function t(){return l(this,t),u(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+o(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),n(t,[{key:"render",value:function(){var e=this.props,t=e.point,r=e.text,n=e.fontSize,i=e.fontFamily,s=t.x,o=t.y;return a.default.createElement("g",null,a.default.createElement("text",{x:s,y:o,fontFamily:i||"Verdana",fontSize:n||10},r))}}]),t}(a.default.Component);c.propTypes={text:i.default.string,point:i.default.object,fontSize:i.default.number,fontFamily:i.default.string},c.defaultProps={text:"",point:{x:0,y:0}},t.default=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=s(r(0)),a=s(r(1));function s(e){return e&&e.__esModule?e:{default:e}}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==o(t)&&"function"!=typeof t?e:t}var c=function(e){function t(){return l(this,t),u(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+o(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),n(t,[{key:"render",value:function(){var e=this.props,t=e.data,r=e.points,n=(e.width,e.height),i=e.margin,s=e.color,o=e.style,l=e.onMouseMove,u=r.map((function(e){return[e.x,e.y]})).reduce((function(e,t){return e.concat(t)})),c=[r[r.length-1].x,n-i,i,n-i,i,r[0].y],d=u.concat(c),f={stroke:s||o.stroke||"slategray",strokeWidth:o.strokeWidth||"1",strokeLinejoin:o.strokeLinejoin||"round",strokeLinecap:o.strokeLinecap||"round",fill:"none"},h={stroke:o.stroke||"none",strokeWidth:"0",fillOpacity:o.fillOpacity||".1",fill:o.fill||s||"slategray",pointerEvents:"auto"},v=r.map((function(e,r){return a.default.createElement("circle",{key:r,cx:e.x,cy:e.y,r:2,style:h,onMouseEnter:function(n){return l("enter",t[r],e)},onClick:function(n){return l("click",t[r],e)}})}));return a.default.createElement("g",null,v,a.default.createElement("polyline",{points:d.join(" "),style:h}),a.default.createElement("polyline",{points:u.join(" "),style:f}))}}]),t}(a.default.Component);c.propTypes={color:i.default.string,style:i.default.object},c.defaultProps={style:{},onMouseMove:function(){}},t.default=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=s(r(0)),a=s(r(1));function s(e){return e&&e.__esModule?e:{default:e}}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==o(t)&&"function"!=typeof t?e:t}var c=function(e){function t(){return l(this,t),u(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+o(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),n(t,[{key:"render",value:function(){var e=this.props,t=e.points,r=(e.width,e.height),n=e.margin,i=e.color,s=e.style,o=e.divisor,l=void 0===o?.25:o,u=void 0,c=t.map((function(e){return function(e){var t=void 0;if(u){var r=(e.x-u.x)*l;t=["C",u.x+r,u.y,e.x-r,e.y,e.x,e.y]}else t=[e.x,e.y];return u=e,t}(e)})).reduce((function(e,t){return e.concat(t)})),d=["L"+t[t.length-1].x,r-n,n,r-n,n,t[0].y],f=c.concat(d),h={stroke:i||s.stroke||"slategray",strokeWidth:s.strokeWidth||"1",strokeLinejoin:s.strokeLinejoin||"round",strokeLinecap:s.strokeLinecap||"round",fill:"none"},v={stroke:s.stroke||"none",strokeWidth:"0",fillOpacity:s.fillOpacity||".1",fill:s.fill||i||"slategray"};return a.default.createElement("g",null,a.default.createElement("path",{d:"M"+f.join(" "),style:v}),a.default.createElement("path",{d:"M"+c.join(" "),style:h}))}}]),t}(a.default.Component);c.propTypes={color:i.default.string,style:i.default.object},c.defaultProps={style:{}},t.default=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=s(r(0)),a=s(r(1));function s(e){return e&&e.__esModule?e:{default:e}}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==o(t)&&"function"!=typeof t?e:t}var c=function(e){function t(){return l(this,t),u(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+o(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),n(t,[{key:"render",value:function(){var e=this,t=this.props,r=t.points,n=t.height,i=t.style,s=t.barWidth,o=t.margin,l=t.onMouseMove,u=1*(i&&i.strokeWidth||0),c=o?2*o:0,d=s||(r&&r.length>=2?Math.max(0,r[1].x-r[0].x-u-c):0);return a.default.createElement("g",{transform:"scale(1,-1)"},r.map((function(t,r){return a.default.createElement("rect",{key:r,x:t.x-(d+u)/2,y:-n,width:d,height:Math.max(0,n-t.y),style:i,onMouseMove:l&&l.bind(e,t)})})))}}]),t}(a.default.Component);c.propTypes={points:i.default.arrayOf(i.default.object),height:i.default.number,style:i.default.object,barWidth:i.default.number,margin:i.default.number,onMouseMove:i.default.func},c.defaultProps={style:{fill:"slategray"}},t.default=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=s(r(0)),a=s(r(1));function s(e){return e&&e.__esModule?e:{default:e}}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==o(t)&&"function"!=typeof t?e:t}var c=function(e){function t(){return l(this,t),u(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+o(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),n(t,[{key:"lastDirection",value:function(e){return Math.sign=Math.sign||function(e){return e>0?1:-1},e.length<2?0:Math.sign(e[e.length-2].y-e[e.length-1].y)}},{key:"render",value:function(){var e=this.props,t=e.points,r=(e.width,e.height,e.size),n=e.style,i=e.spotColors,s=a.default.createElement("circle",{cx:t[0].x,cy:t[0].y,r:r,style:n}),o=a.default.createElement("circle",{cx:t[t.length-1].x,cy:t[t.length-1].y,r:r,style:n||{fill:i[this.lastDirection(t)]}});return a.default.createElement("g",null,n&&s,o)}}]),t}(a.default.Component);c.propTypes={size:i.default.number,style:i.default.object,spotColors:i.default.object},c.defaultProps={size:2,spotColors:{"-1":"red",0:"black",1:"green"}},t.default=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=l(r(0)),a=l(r(1)),s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(23));function l(e){return e&&e.__esModule?e:{default:e}}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==o(t)&&"function"!=typeof t?e:t}var d=function(e){function t(){return u(this,t),c(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+o(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),n(t,[{key:"render",value:function(){var e=this.props,t=e.points,r=e.margin,n=e.type,i=e.style,o=e.value,l=t.map((function(e){return e.y})),u="custom"==n?o:s[n](l);return a.default.createElement("line",{x1:t[0].x,y1:u+r,x2:t[t.length-1].x,y2:u+r,style:i})}}]),t}(a.default.Component);d.propTypes={type:i.default.oneOf(["max","min","mean","avg","median","custom"]),value:i.default.number,style:i.default.object},d.defaultProps={type:"mean",style:{stroke:"red",strokeOpacity:.75,strokeDasharray:"2, 2"}},t.default=d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.variance=t.stdev=t.median=t.midRange=t.avg=t.mean=t.max=t.min=void 0;var n=u(r(7)),i=u(r(3)),a=u(r(24)),s=u(r(25)),o=u(r(10)),l=u(r(26));function u(e){return e&&e.__esModule?e:{default:e}}t.min=n.default,t.max=n.default,t.mean=i.default,t.avg=i.default,t.midRange=a.default,t.median=s.default,t.stdev=o.default,t.variance=l.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(r(7)),i=a(r(9));function a(e){return e&&e.__esModule?e:{default:e}}t.default=function(e){return(0,i.default)(e)-(0,n.default)(e)/2}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return e.sort((function(e,t){return e-t}))[Math.floor(e.length/2)]}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,i=(n=r(3))&&n.__esModule?n:{default:n};t.default=function(e){var t=(0,i.default)(e),r=e.map((function(e){return Math.pow(e-t,2)}));return(0,i.default)(r)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=u(r(0)),a=u(r(1)),s=u(r(3)),l=u(r(10));function u(e){return e&&e.__esModule?e:{default:e}}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function d(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==o(t)&&"function"!=typeof t?e:t}var f=function(e){function t(){return c(this,t),d(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+o(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),n(t,[{key:"render",value:function(){var e=this.props,t=e.points,r=e.margin,n=e.style,i=t.map((function(e){return e.y})),o=(0,s.default)(i),u=(0,l.default)(i);return a.default.createElement("rect",{x:t[0].x,y:o-u+r,width:t[t.length-1].x-t[0].x,height:2*l.default,style:n})}}]),t}(a.default.Component);f.propTypes={style:i.default.object},f.defaultProps={style:{fill:"red",fillOpacity:.1}},t.default=f},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(r(7)),i=a(r(9));function a(e){return e&&e.__esModule?e:{default:e}}t.default=function(e){var t=e.data,r=e.limit,a=e.width,s=void 0===a?1:a,o=e.height,l=void 0===o?1:o,u=e.margin,c=void 0===u?0:u,d=e.max,f=void 0===d?(0,i.default)(t):d,h=e.min,v=void 0===h?(0,n.default)(t):h,g=t.length;r&&r<g&&(t=t.slice(g-r));var p=(l-2*c)/(f-v||2),m=(s-2*c)/((r||g)-(g>1?1:0));return t.map((function(e,t){return{x:t*m+c,y:(f===v?1:f-e)*p+c}}))}}])},"object"===o(t)&&"object"===o(e)?e.exports=s(r(1)):(i=[r(1)],void 0===(a="function"==typeof(n=s)?n.apply(t,i):n)||(e.exports=a))},975:function(e){e.exports=Math.sign||function(e){var t=+e;return 0==t||t!=t?t:t<0?-1:1}},1172:function(e,t,r){"use strict";var n=r(28),i=r(347).findLast,a=r(158);n({target:"Array",proto:!0},{findLast:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),a("findLast")},1202:function(e,t,r){r(28)({target:"Math",stat:!0},{sign:r(975)})},1173:function(e,t,r){"use strict";var n=r(28),i=r(688).end;n({target:"String",proto:!0,forced:r(689)},{padEnd:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}})},575:function(e,t,r){"use strict";r.d(t,{sc:function(){return d},zu:function(){return h},Wq:function(){return p},AP:function(){return T}}),r(8),r(4),r(9),r(0),r(13),r(2),r(6),r(14),r(15),r(5);var n=r(1468),i=r(1491),a=r(21),s=r(7),o=r(23),l=["data"];function u(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?u(Object(r),!0).forEach((function(t){(0,n.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):u(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function d(e){var t=(0,s.hz)(),r=(0,a.X2)({queryKey:a.iP.feeds.feed(e),endpoint:"/api/v1/feeds/".concat(e),schema:o.w6,enabled:t.feeds,id:e}),n=r.data;return c(c({},(0,i.Z)(r,l)),{},{feed:n})}var f=r(48);function h(){var e,t=(0,s.hz)(),r=(0,f.GU)().me;return(0,a.lN)({queryKey:a.iP.feeds.list(),endpoint:null!==(e=r.features)&&void 0!==e&&e.for_you?"/api/v2/feeds":"/api/v1/feeds",schema:o.w6,enabled:t.feeds})}function v(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function g(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?v(Object(r),!0).forEach((function(t){(0,n.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):v(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function p(){var e=(0,s.h_)();return(0,a.Ap)({globalQueryKey:a.iP.feeds.global,idAttributeFromVariables:"id",action:a.bS.UPDATE,schema:o.w6,mutationFn:function(t){var r="recommended"===t.feedId?"for_you":t.feedId;return e.patch("/api/v1/feeds/".concat(r,"/seen"))},setNextEntity:function(e){var t=a.Eh.getQueryData(a.iP.feeds.global);if(t)return g(g({},t.find((function(t){return t.id===e.feedId}))),{},{seen:!0})}})}r(36);var m=r(1483),y=(r(30),r(352)),b=r(63);function k(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function E(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?k(Object(r),!0).forEach((function(t){(0,n.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):k(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function T(){var e=(0,y.h)();return(0,a.Ap)({globalQueryKey:a.iP.feeds.global,idAttributeFromVariables:"id",action:a.bS.UPDATE,schema:o.w6,mutationFn:function(t){return e.patch("/api/v1/feeds/".concat(t.id),{pinned:t.pinned})},onMutate:function(e){return(0,m.Z)(regeneratorRuntime.mark((function t(){var r,n,i,s;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=a.iP.feeds.list(),t.next=3,a.Eh.cancelQueries(n);case 3:return i=a.Eh.getQueryData(n),(s=null===(r=(0,b.MH)(i))||void 0===r?void 0:r.find((function(t){return t.id===e.id})))&&(0,b.uH)(n,E(E({},s),{},{pinned:e.pinned}),(function(e,t){return String(e.id)===String(t.id)})),t.abrupt("return",{prevFeeds:i,queryKey:n});case 7:case"end":return t.stop()}}),t)})))()},onError:function(e,t,r){r&&a.Eh.setQueryData(r.queryKey,r.prevFeeds)}})}},1041:function(e,t,r){"use strict";r.d(t,{H:function(){return u}}),r(8),r(4),r(9),r(0),r(13),r(2),r(6),r(14),r(15),r(5);var n=r(1468),i=r(7),a=r(23),s=r(21);function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){(0,n.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function u(){var e=(0,i.Pk)().isLoggedIn,t=(0,s.lN)({queryKey:s.iP.tags.trending(),endpoint:"/api/v1/trends",schema:a.VY,enabled:e,staleTime:6e5});return l(l({},t),{},{tags:t.entities})}},650:function(e,t,r){"use strict";r.d(t,{Z:function(){return p}});var n=r(1519),i=r(238),a=r(1474),s=r(1469);r(2),r(41),r(62),r(19),r(27),r(4),r(13),r(0),r(56),r(5),r(82),r(24),r(34),r(33),r(16),r(20),r(18),r(11),r(17),r(415),Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError;var o=r(1);function l(e){var t=e.className,r=void 0===t?"":t,n=e.style,i=void 0===n?{display:"block"}:n,a=e.client,l=e.slot,u=e.layout,c=void 0===u?"":u,d=e.layoutKey,f=void 0===d?"":d,h=e.format,v=void 0===h?"auto":h,g=e.responsive,p=void 0===g?"false":g,m=e.pageLevelAds,y=void 0!==m&&m,b=e.adTest,k=e.children,E=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r}(e,["className","style","client","slot","layout","layoutKey","format","responsive","pageLevelAds","adTest","children"]);return(0,o.useEffect)((function(){var e={};y&&(e.google_ad_client=a,e.enable_page_level_ads=!0);try{"object"===("undefined"==typeof window?"undefined":(0,s.Z)(window))&&(window.adsbygoogle=window.adsbygoogle||[]).push(e)}catch(e){}}),[]),o.createElement("ins",Object.assign({className:"adsbygoogle ".concat(r),style:i,"data-ad-client":a,"data-ad-slot":l,"data-ad-layout":c,"data-ad-layout-key":f,"data-ad-format":v,"data-full-width-responsive":p,"data-adtest":b},E),k)}var u=r(310),c=r(3),d=r(1007),f=r(7),h=r(1523),v=function(e){var t=e.metrics,i=(0,f.fz)(),s=(0,o.useRef)(null),l=(0,o.useState)(!1),u=(0,a.Z)(l,2),d=u[0],v=u[1],g=function(e){e.target&&s.current&&!s.current.contains(e.target)&&v(!1)};return(0,o.useEffect)((function(){return document.addEventListener("mousedown",g),function(){document.removeEventListener("mousedown",g)}}),[s]),(0,n.Z)("div",{className:"relative"},void 0,(0,n.Z)(c.hU,{iconClassName:"h-6 w-6 stroke-gray-600",src:r(298),onClick:function(e){e.stopPropagation(),e.preventDefault(),v(!d)}}),d&&o.createElement("div",{ref:s,className:"absolute bottom-10 right-0 z-10 w-[234px]"},(0,n.Z)(c.Zb,{variant:"rounded"},void 0,(0,n.Z)(c.Kq,{space:2},void 0,(0,n.Z)(c.xv,{size:"sm",weight:"bold"},void 0,(0,n.Z)(h.Z,{id:"sponsored.info.title",defaultMessage:"Why am I seeing this ad?"})),(0,n.Z)(c.xv,{size:"sm",theme:"muted"},void 0,t.reason?t.reason:(0,n.Z)(h.Z,{id:"sponsored.info.message",defaultMessage:"{siteTitle} displays ads to help fund our service.",values:{siteTitle:i.title}}))))))},g=function(e){var t=e.ad,r=e.provider,i=e.source,s=e.isThreadStatus,h=void 0!==s&&s,g=(0,f.hz)();(0,u.B)(t.metrics,i);var p=(0,o.useRef)(null),m=(0,f.l0)(p,".adsbygoogle"),y=(0,a.Z)(m,1)[0];return(0,n.Z)("div",{className:'relative has-[.adsbygoogle[data-ad-status="unfilled"]]:hidden'},void 0,(0,n.Z)(c.Zb,{className:h?"pb-4":"p-4",variant:"default"},void 0,(0,n.Z)(c.Kq,{space:4,className:h?"pl-[calc(42px+12px)]":""},void 0,g.adsV4&&"google"===r?o.createElement("div",{ref:p},(0,n.Z)(l,{format:"fluid",layoutKey:"-6y+ed+2x-11-88",client:"ca-pub-3228864317569395",slot:"1470909433"}),!y&&(0,n.Z)("div",{className:"w-full animate-pulse overflow-hidden"},void 0,(0,n.Z)("div",{className:"h-[400px] rounded-lg bg-primary-100 dark:bg-gray-800"}))):(0,n.Z)(d.Z,{card:t.card,onOpenMedia:function(){},horizontal:!0,infoActionComponent:(0,n.Z)(v,{metrics:t.metrics})}))))},p=function(e){var t,r=e.ad,a=e.source,s=e.isThreadStatus,o=void 0!==s&&s;return null!==(t=r.status)&&void 0!==t&&t.id?(0,n.Z)("div",{className:o?"thread__status":""},void 0,(0,n.Z)(i.Z,{id:r.status.id,accountAction:r.status.metrics?(0,n.Z)(v,{metrics:r.status.metrics}):void 0,source:a})):r.ad?(0,n.Z)(g,{ad:r.ad,source:a,provider:r.provider,isThreadStatus:o}):null}},1203:function(e,t,r){"use strict";var n=r(1519),i=r(1),a=r(1523),s=r(3);t.Z=function(e){var t=e.value,r=(0,i.useRef)(null),o=function(){var e;null===(e=r.current)||void 0===e||e.select(),navigator.clipboard?navigator.clipboard.writeText(t):document.execCommand("copy")};return(0,n.Z)(s.Ug,{alignItems:"center"},void 0,i.createElement(s.II,{ref:r,type:"text",value:t,className:"rounded-r-none rtl:rounded-l-none rtl:rounded-r-lg",outerClassName:"grow",onClick:o,readOnly:!0}),(0,n.Z)(s.zx,{theme:"primary",className:"mt-1 h-full rounded-l-none rounded-r-lg rtl:rounded-l-lg rtl:rounded-r-none",onClick:o},void 0,(0,n.Z)(a.Z,{id:"input.copy",defaultMessage:"Copy"})))}},779:function(e,t,r){"use strict";var n=r(1519),i=r(1044),a=r(562),s=r(563),o=r(1059),l=r(235),u=r(3);t.Z=function(e){var t,r=e.group;return(0,n.Z)(u.Kq,{className:"relative h-[240px] rounded-lg border border-solid border-gray-300 bg-white dark:border-gray-800 dark:bg-gray-900","data-testid":"group-card"},void 0,(0,n.Z)(u.Kq,{grow:!0,className:"relative basis-1/2 rounded-t-lg bg-primary-200 dark:bg-gray-800"},void 0,(0,n.Z)(i.Z,{group:r,className:"absolute inset-0 size-full rounded-t-lg object-cover"})),(0,n.Z)("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2"},void 0,(0,n.Z)(l.Z,{group:r,size:64,withRing:!0})),(0,n.Z)(u.Kq,{alignItems:"center",justifyContent:"end",grow:!0,className:"basis-1/2 py-4",space:.5},void 0,(0,n.Z)(u.Ug,{alignItems:"center",space:1.5},void 0,(0,n.Z)(u.xv,{size:"lg",weight:"bold",dangerouslySetInnerHTML:{__html:r.display_name_html}}),(null===(t=r.relationship)||void 0===t?void 0:t.pending_requests)&&(0,n.Z)("div",{className:"size-2 rounded-full bg-secondary-500"})),(0,n.Z)(u.Ug,{className:"text-gray-700 dark:text-gray-600",space:2,wrap:!0},void 0,(0,n.Z)(o.Z,{group:r}),(0,n.Z)(s.Z,{group:r}),(0,n.Z)(a.Z,{group:r}))))}},1204:function(e,t,r){"use strict";var n=r(1519),i=r(1523),a=r(1522),s=r(519),o=r(105),l=r(3);t.Z=function(e){var t=e.afterClick,r=e.hashtag,u=r.recent_statuses_count;return(0,n.Z)(l.Ug,{alignItems:"center",justifyContent:"between","data-testid":"hashtag"},void 0,(0,n.Z)(l.Kq,{className:"min-w-0 flex-1 truncate"},void 0,(0,n.Z)(a.rU,{to:"/tags/".concat(r.name),className:"truncate hover:underline",onClick:t},void 0,(0,n.Z)(l.xv,{tag:"span",size:"sm",weight:"semibold"},void 0,"#",r.name)),r.recent_statuses_count>0&&(0,n.Z)(l.xv,{theme:"muted",size:"sm"},void 0,(0,n.Z)(i.Z,{id:"trends.count_by_accounts",defaultMessage:"Total Posts: {count}",values:{rawCount:u,count:(0,n.Z)("strong",{},void 0,(0,o.w8)(u))}}))),r.recent_history&&(0,n.Z)("div",{className:"w-[40px]","data-testid":"sparklines"},void 0,(0,n.Z)(s.Sparklines,{width:40,height:28,data:r.recent_history},void 0,(0,n.Z)(s.SparklinesCurve,{style:{fill:"none"},color:"#818cf8"}))))}},573:function(e,t,r){"use strict";r.d(t,{Z:function(){return g}});var n,i=r(1521),a=r(1519),s=r(1491),o=(r(0),r(34),r(1));function l(e,t){return!!function(e,t){if(!function(e){var t=getComputedStyle(e).overflowY;return e===document.scrollingElement&&"visible"===t||"scroll"===t||"auto"===t}(e))return!1;if(t===n.DOWN)return e.scrollTop+e.clientHeight<e.scrollHeight;if(t===n.UP)return e.scrollTop>0;throw new Error("unsupported direction")}(e,t)||null!=e.parentElement&&l(e.parentElement,t)}function u(e,t){void 0===t&&(t={});var r=t.insertAt;if(e&&"undefined"!=typeof document){var n=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css","top"===r&&n.firstChild?n.insertBefore(i,n.firstChild):n.appendChild(i),i.styleSheet?i.styleSheet.cssText=e:i.appendChild(document.createTextNode(e))}}r(19),r(25),function(e){e[e.UP=-1]="UP",e[e.DOWN=1]="DOWN"}(n||(n={})),u(".lds-ellipsis {\n  display: inline-block;\n  position: relative;\n  width: 64px;\n  height: 64px; }\n\n.lds-ellipsis div {\n  position: absolute;\n  top: 27px;\n  width: 11px;\n  height: 11px;\n  border-radius: 50%;\n  background: #363636;\n  animation-timing-function: cubic-bezier(0, 1, 1, 0); }\n\n.lds-ellipsis div:nth-child(1) {\n  left: 6px;\n  animation: lds-ellipsis1 0.6s infinite; }\n\n.lds-ellipsis div:nth-child(2) {\n  left: 6px;\n  animation: lds-ellipsis2 0.6s infinite; }\n\n.lds-ellipsis div:nth-child(3) {\n  left: 26px;\n  animation: lds-ellipsis2 0.6s infinite; }\n\n.lds-ellipsis div:nth-child(4) {\n  left: 45px;\n  animation: lds-ellipsis3 0.6s infinite; }\n\n@keyframes lds-ellipsis1 {\n  0% {\n    transform: scale(0); }\n  100% {\n    transform: scale(1); } }\n\n@keyframes lds-ellipsis3 {\n  0% {\n    transform: scale(1); }\n  100% {\n    transform: scale(0); } }\n\n@keyframes lds-ellipsis2 {\n  0% {\n    transform: translate(0, 0); }\n  100% {\n    transform: translate(19px, 0); } }\n");var c=function(){return o.createElement("div",{className:"lds-ellipsis"},o.createElement("div",null),o.createElement("div",null),o.createElement("div",null),o.createElement("div",null))},d=function(){return o.createElement("div",null,o.createElement("p",null,"↧  pull to refresh  ↧"))};u(".ptr,\n.ptr__children {\n  height: 100%;\n  width: 100%;\n  overflow: hidden;\n  -webkit-overflow-scrolling: touch;\n  position: relative; }\n\n.ptr.ptr--fetch-more-treshold-breached .ptr__fetch-more {\n  display: block; }\n\n.ptr__fetch-more {\n  display: none; }\n\n/**\n  * Pull down transition \n  */\n.ptr__children,\n.ptr__pull-down {\n  transition: transform 0.2s cubic-bezier(0, 0, 0.31, 1); }\n\n.ptr__pull-down {\n  position: absolute;\n  overflow: hidden;\n  left: 0;\n  right: 0;\n  top: 0;\n  visibility: hidden; }\n  .ptr__pull-down > div {\n    display: none; }\n\n.ptr--dragging {\n  /**\n    * Hide PullMore content is treshold breached\n    */\n  /**\n    * Otherwize, display content\n    */ }\n  .ptr--dragging.ptr--pull-down-treshold-breached .ptr__pull-down--pull-more {\n    display: none; }\n  .ptr--dragging .ptr__pull-down--pull-more {\n    display: block; }\n\n.ptr--pull-down-treshold-breached {\n  /**\n    * Force opacity to 1 is pull down trashold breached\n    */\n  /**\n    * And display loader\n    */ }\n  .ptr--pull-down-treshold-breached .ptr__pull-down {\n    opacity: 1 !important; }\n  .ptr--pull-down-treshold-breached .ptr__pull-down--loading {\n    display: block; }\n\n.ptr__loader {\n  margin: 0 auto;\n  text-align: center; }\n");var f=function(e){var t=e.isPullable,r=void 0===t||t,i=e.canFetchMore,a=void 0!==i&&i,s=e.onRefresh,u=e.onFetchMore,f=e.refreshingContent,h=void 0===f?o.createElement(c,null):f,v=e.pullingContent,g=void 0===v?o.createElement(d,null):v,p=e.children,m=e.pullDownThreshold,y=void 0===m?67:m,b=e.fetchMoreThreshold,k=void 0===b?100:b,E=e.maxPullDownDistance,T=void 0===E?95:E,_=e.resistance,w=void 0===_?1:_,S=e.backgroundColor,L=e.className,R=void 0===L?"":L,A=(0,o.useRef)(null),x=(0,o.useRef)(null),I=(0,o.useRef)(null),D=(0,o.useRef)(null),C=!1,P=!1,M=!1,O=0,N=0;(0,o.useEffect)((function(){if(r&&x&&x.current){var e=x.current;return e.addEventListener("touchstart",U,{passive:!0}),e.addEventListener("mousedown",U),e.addEventListener("touchmove",B,{passive:!1}),e.addEventListener("mousemove",B),window.addEventListener("scroll",j),e.addEventListener("touchend",G),e.addEventListener("mouseup",G),document.body.addEventListener("mouseleave",G),function(){e.removeEventListener("touchstart",U),e.removeEventListener("mousedown",U),e.removeEventListener("touchmove",B),e.removeEventListener("mousemove",B),window.removeEventListener("scroll",j),e.removeEventListener("touchend",G),e.removeEventListener("mouseup",G),document.body.removeEventListener("mouseleave",G)}}}),[p,r,s,y,T,a,k]),(0,o.useEffect)((function(){var e;(null===(e=A)||void 0===e?void 0:e.current)&&(A.current.classList.contains("ptr--fetch-more-treshold-breached")||a&&F()<k&&u&&(A.current.classList.add("ptr--fetch-more-treshold-breached"),P=!0,u().then(Z).catch(Z)))}),[a,p]);var F=function(){if(!x||!x.current)return-1;var e=window.scrollY;return x.current.scrollHeight-e-window.innerHeight},Z=function(){requestAnimationFrame((function(){x.current&&(x.current.style.overflowX="hidden",x.current.style.overflowY="auto",x.current.style.transform="unset"),I.current&&(I.current.style.opacity="0"),A.current&&(A.current.classList.remove("ptr--pull-down-treshold-breached"),A.current.classList.remove("ptr--dragging"),A.current.classList.remove("ptr--fetch-more-treshold-breached")),C&&(C=!1),P&&(P=!1)}))},U=function(e){M=!1,e instanceof MouseEvent&&(O=e.pageY),window.TouchEvent&&e instanceof TouchEvent&&(O=e.touches[0].pageY),N=O,"touchstart"===e.type&&l(e.target,n.UP)||x.current.getBoundingClientRect().top<0||(M=!0)},B=function(e){if(M)if(N=window.TouchEvent&&e instanceof TouchEvent?e.touches[0].pageY:e.pageY,A.current.classList.add("ptr--dragging"),N<O)M=!1;else{e.cancelable&&e.preventDefault();var t=Math.min((N-O)/w,T);t>=y&&(M=!0,C=!0,A.current.classList.remove("ptr--dragging"),A.current.classList.add("ptr--pull-down-treshold-breached")),t>=T||(I.current.style.opacity=(t/65).toString(),x.current.style.overflow="visible",x.current.style.transform="translate(0px, "+t+"px)",I.current.style.visibility="visible")}},j=function(e){P||a&&F()<k&&u&&(P=!0,A.current.classList.add("ptr--fetch-more-treshold-breached"),u().then(Z).catch(Z))},G=function(){if(M=!1,O=0,N=0,!C)return I.current&&(I.current.style.visibility="hidden"),void Z();x.current&&(x.current.style.overflow="visible",x.current.style.transform="translate(0px, "+y+"px)"),s().then(Z).catch(Z)};return o.createElement("div",{className:"ptr "+R,style:{backgroundColor:S},ref:A},o.createElement("div",{className:"ptr__pull-down",ref:I},o.createElement("div",{className:"ptr__loader ptr__pull-down--loading"},h),o.createElement("div",{className:"ptr__pull-down--pull-more"},g)),o.createElement("div",{className:"ptr__children",ref:x},p,o.createElement("div",{className:"ptr__fetch-more",ref:D},o.createElement("div",{className:"ptr__loader ptr__fetch-more--loading"},h))))},h=r(3),v=["children","onRefresh"],g=function(e){var t=e.children,r=e.onRefresh,n=(0,s.Z)(e,v);return o.createElement(f,(0,i.Z)({onRefresh:function(){return r?r():Promise.resolve()},pullingContent:o.createElement(o.Fragment,null),refreshingContent:r?(0,a.Z)(h.$j,{size:30,withText:!1}):o.createElement(o.Fragment,null),pullDownThreshold:67,maxPullDownDistance:95,resistance:2},n),o.createElement(o.Fragment,null,t))}},733:function(e,t,r){"use strict";var n=r(1519),i=(r(9),r(0),r(17),r(12),r(1520)),a=r(142),s=r(1),o=r(1509),l=r(3),u=r(174),c=r(7),d=r(1212);t.Z=function(e){var t=e.onClick,f=e.count,h=e.message,v=e.statuses,g=e.threshold,p=void 0===g?400:g,m=(0,o.Z)(),y=(0,u.i)(),b=y.pinnedAccount,k=y.pinnedGroup,E="recommended"===y.timelineId,T=(0,c.LC)(),_=T.position,w=T.direction,S=_.top>p,L=void 0!==v,R=f>0,A=function(){window.scrollTo({top:0})},x=function(){setTimeout(A,10),t()},I=(0,s.useMemo)((function(){if(!v||0===v.length)return[];var e=(0,a.uniqBy)(v,(function(e){return e.account.id}));return b?e=v.filter((function(e){return e.account.id===b.account_id})):k&&(e=(0,a.uniqBy)(v.filter((function(e){var t;return(null===(t=e.group)||void 0===t?void 0:t.id)===k.group_id})),(function(e){var t;return null===(t=e.group)||void 0===t?void 0:t.id}))),e.slice(0,3)}),[v,b,k]),D=function(){return(0,n.Z)(s.Fragment,{},void 0,I.length>0?(0,n.Z)(l.Ug,{alignItems:"center",space:-2},void 0,I.map((function(e){var t=e.group||e.account;return(0,n.Z)(l.qE,{size:24,src:t.avatar_static,className:(0,i.Z)("ring-2",{"ring-primary-600":S,"ring-gray-200 dark:ring-gray-800":!S})},t.id)}))):(0,n.Z)(l.JO,{src:r(1187),className:"size-4"}),f>0&&(0,n.Z)(l.xv,{theme:S?"inherit":"primary",size:"sm",weight:"medium"},void 0,m.formatMessage(h,{count:f})))};return E||L&&0===I.length?null:R?(0,n.Z)("div",{},void 0,(0,n.Z)("a",{className:"flex cursor-pointer items-center justify-center space-x-3 whitespace-nowrap py-4 hover:bg-gray-200 dark:hover:bg-gray-800/50",onClick:x},void 0,D()),S&&(0,n.Z)("div",{className:(0,i.Z)("fixed left-1/2 top-36 -z-10 -translate-x-1/2 transition-all duration-500",{"!top-20 -z-10":w===d.N.Down&&L,"!top-48 z-10":w===d.N.Up&&L,"!top-36 z-10":S&&!L})},void 0,(0,n.Z)("a",{className:"flex cursor-pointer items-center space-x-1.5 whitespace-nowrap rounded-full bg-primary-600 py-2 pl-2 pr-3 text-white transition-transform hover:scale-[1.025] hover:bg-primary-500 active:scale-100 dark:hover:bg-primary-500",onClick:x},void 0,D())),!S&&(0,n.Z)(l.iz,{})):null}},1076:function(e,t,r){"use strict";r.d(t,{Z:function(){return w}});var n=r(1521),i=r(1519),a=r(1491),s=(r(92),r(10),r(26),r(12),r(0),r(34),r(35),r(32),r(39),r(2),r(57),r(11),r(1520)),o=r(140),l=r.n(o),u=r(1),c=r(1523),d=r(310),f=r(650),h=r(1508),v=r(1509),g=r(154),p=(0,h.vU)({load_more:{id:"status.load_more",defaultMessage:"Load more"}}),m=function(e){var t=e.disabled,n=e.maxId,a=e.onClick,s=(0,v.Z)();return(0,i.Z)("button",{className:"load-more load-gap",disabled:t,onClick:function(){return a(n)},"aria-label":s.formatMessage(p.load_more)},void 0,(0,i.Z)(g.Z,{src:r(197)}))},y=r(76),b=r(238),k=r(1174),E=r(266),T=r(7),_=["statusIds","lastStatusId","featuredStatusIds","divideType","onLoadMore","timelineId","isLoading","isPartial","showAds","showGroup"],w=function(e){var t,r,o=e.statusIds,h=e.lastStatusId,v=e.featuredStatusIds,g=e.divideType,p=void 0===g?"border":g,w=e.onLoadMore,S=e.timelineId,L=e.isLoading,R=e.isPartial,A=e.showAds,x=void 0!==A&&A,I=e.showGroup,D=void 0===I||I,C=(0,a.Z)(e,_),P=(0,d.N)().entities,M=(0,T.Dn)(),O=(0,T.CG)((function(e){return e.timelines.getIn([S,"adIndexes"],[[]])})),N=(0,u.useRef)(null),F=function(e,t){return t?(null==v?void 0:v.keySeq().findIndex((function(t){return t===e})))||0:o.keySeq().findIndex((function(t){return t===e}))+((null==v?void 0:v.size)||0)},Z=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=F(e,t)-1;j(r)},U=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=F(e,t)+1;j(r)},B=(0,u.useCallback)(l()((function(){var e=h||o.last();w&&e&&w(e.replace("末suggestions-",""))}),300,{leading:!0}),[w,h,o.last()]),j=function(e){var t;null===(t=N.current)||void 0===t||t.scrollIntoView({index:e,behavior:"smooth",done:function(){var t=document.querySelector('#status-list [data-index="'.concat(e,'"] .focusable'));null==t||t.focus()}})};return R?(0,i.Z)("div",{className:"regeneration-indicator"},void 0,(0,i.Z)("div",{},void 0,(0,i.Z)("div",{className:"regeneration-indicator__label"},void 0,(0,i.Z)(c.Z,{id:"regeneration_indicator.label",tagName:"strong",defaultMessage:"Loading…"}),(0,i.Z)(c.Z,{id:"regeneration_indicator.sublabel",defaultMessage:"Your home feed is being prepared!"})))):u.createElement(y.Z,(0,n.Z)({id:"status-list",key:"scrollable-list",isLoading:L,onLoadMore:B,placeholderComponent:function(){return(0,i.Z)(E.Z,{variant:"border"===p?"slim":"rounded"})},placeholderCount:20,ref:N,className:(0,s.Z)("divide-y divide-solid divide-gray-300 dark:divide-gray-800",{"divide-none":"border"!==p}),itemClassName:(0,s.Z)({"pb-3":"border"!==p})},C),(t=v?v.toArray().map((function(e){return(0,i.Z)(b.Z,{id:e,featured:!0,onMoveUp:Z,onMoveDown:U,contextType:S,showGroup:D,variant:"border"===p?"slim":"default"},"f-".concat(e))})):[],r=function(){if(L||o.size>0){var e=0;return o.toList().reduce((function(t,r,n){if(x&&P&&(O[Math.floor(n/20)]||[]).includes(n)){var a=P[e%P.length];a&&t.push(function(e,t){return(0,i.Z)(f.Z,{ad:e,source:S},"ad-".concat(t))}(a,n)),e++}if(null===r){var s=function(e){var t=o.toList(),r=t.get(e+1),n=t.get(e-1);return e<1||!r||!n||!w?null:(0,i.Z)(m,{disabled:L,maxId:n,onClick:w},"gap:"+r)}(n);s&&t.push(s)}else r.startsWith("末suggestions-")?M.feedInjection&&t.push((0,i.Z)(k.Z,{},"suggestions")):t.push(function(e){return(0,i.Z)(b.Z,{id:e,onMoveUp:Z,onMoveDown:U,contextType:S,showGroup:D},e)}(r));return t}),[])}return[]}(),t&&r?t.concat(r):r))}},1025:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return f}});var n=r(1521),i=r(1491),a=(r(12),r(4),r(24),r(50),r(1)),s=r(1483),o=(r(30),r(1492)),l=r(7),u=r(179),c=r(1580),d=["shouldAutoPlayVideo","attachment","isSensitive"],f=function(e){var t,r,f,h=e.shouldAutoPlayVideo,v=void 0!==h&&h,g=e.attachment,p=e.isSensitive,m=void 0!==p&&p,y=(0,i.Z)(e,d),b=function(e){var t=(0,l.h_)();function r(){return(r=(0,s.Z)(regeneratorRuntime.mark((function r(){var n,i;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.get("/api/v1/truth/videos/".concat(e));case 2:return n=r.sent,i=n.data,r.abrupt("return",i.video);case 5:case"end":return r.stop()}}),r)})))).apply(this,arguments)}return(0,o.a)({queryKey:u.i.videos.video(e),queryFn:function(){return r.apply(this,arguments)},cacheTime:1/0,staleTime:1/0,enabled:!!e})}(g.external_video_id),k=b.data,E=b.isLoading,T=(0,a.useMemo)((function(){return g.external_video_id?E||!k?[]:k.assets.video.map((function(e){return{type:"video/mp4",url:e.url,quality:e.quality}})):[{type:"video/mp4",url:g.url}]}),[E]);return a.createElement(c.Z,(0,n.Z)({poster:g.preview_url,assets:T,duration:(null===(t=g.meta.original)||void 0===t?void 0:t.duration)||(null==k?void 0:k.duration),shouldAutoPlayVideo:v,isSensitive:m,blurhash:g.blurhash,title:g.description,aspectRatio:Number(null===(r=g.meta.original)||void 0===r?void 0:r.aspect)||Number(null===(f=g.meta.small)||void 0===f?void 0:f.aspect)},y))}},461:function(e,t,r){"use strict";r(8),r(4),r(9),r(13),r(6),r(14),r(15),r(5);var n=r(1519),i=r(1468),a=(r(92),r(12),r(35),r(0),r(2),r(86),r(11),r(142)),s=r(1),o=r(1508),l=r(310),u=r(404),c=r(650),d=r(238),f=r(180),h=r(174),v=r(1174),g=r(7),p=r(733),m=r(76),y=r(3);function b(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function k(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?b(Object(r),!0).forEach((function(t){(0,i.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):b(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var E=(0,o.vU)({queue:{id:"status_list.queue_label",defaultMessage:"{count} New {count, plural, one {Truth} other {Truths}}"}});t.Z=function(e){var t=e.featuredStatuses,r=void 0===t?[]:t,o=e.hasMore,b=e.emptyMessage,T=e.isAdsSupported,_=void 0===T||T,w=e.isLoading,S=e.onLoadMore,L=e.scrollKey,R=e.showGroupContext,A=void 0===R||R,x=e.statuses,I=e.withScrollTopButton,D=void 0!==I&&I,C=(0,s.useRef)(null),P=(0,s.useRef)((0,a.sample)([5,6,7,8,9])),M=(0,u.m)().refetch,O=(0,l.N)().entities,N=(0,g.Dn)(),F=(0,h.i)(),Z=F.timelineId,U=F.pinnedAccount,B=F.pinnedGroup,j=(0,f.g)(),G=j.unreadFeeds,K=j.setUnreadFeeds,H=_&&x.length>=10&&!0,z=(0,s.useRef)(0),V="recommended"===Z,q=function(){U||B||0===G[Z].length||(M(),K((function(e){return k(k({},e),{},(0,i.Z)({},Z,[]))})))},W=(0,s.useCallback)((0,a.debounce)((function(){q()}),100),[Z]),Y=function(e){return x.findIndex((function(t){return t.id===e}))||0},X=function(e){var t;null===(t=C.current)||void 0===t||t.scrollIntoView({index:e,behavior:"smooth",done:function(){var t=document.querySelector('#timeline [data-index="'.concat(e,'"] .focusable'));null==t||t.focus()}})},Q=function(e){var t=Y(e)-1;X(t)},$=function(e){var t=Y(e)+1;X(t)},J=function(e,t){return(0,n.Z)(s.Fragment,{},t,e,(0,n.Z)(y.iz,{}))},ee=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return J((0,n.Z)(d.Z,{id:e,onMoveUp:Q,onMoveDown:$,featured:t,isRecommended:V,showGroup:A}),e)},te=function(){return r.map((function(e){return ee(e.id,!0)}))},re=(0,s.useMemo)((function(){return x.reduce((function(e,t,r){if(N.feedInjection&&P.current===r&&e.push(J((0,n.Z)(v.Z,{}),"suggestions")),t.id.endsWith("-ad")){if(!O||0===O.length||!H)return e;var i=O[z.current%O.length];e.push(function(e,t){return J((0,n.Z)("div",{"data-type":"ad"},void 0,(0,n.Z)(c.Z,{ad:e,source:Z})),"ad-".concat(t))}(i,r)),z.current++}else e.push(ee(t.id));return e}),[])}),[x,H,O]);return s.createElement(s.Fragment,null,D&&(0,n.Z)(p.Z,{onClick:q,count:G[Z].length,message:E.queue,statuses:G[Z]},"timeline-queue-button-header"),s.createElement(m.Z,{id:"timeline",scrollKey:L,key:L,ref:C,isLoading:w,onLoadMore:S,onScrollToTop:W,hasMore:o,emptyMessage:b},function(){var e=te();return e&&re?e.concat(re):re}()))}},781:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return Wa}});var n=r(1519),i=r(1483),a=r(1474),s=(r(30),r(16),r(0),r(20),r(18),r(51),r(10),r(47),r(1520)),o=(r(56),r(67),r(33),r(1470)),l=r(1487),u=r(1490),c=r(1537),d=r(1488),f=r(1486),h=r(1485),v=r(1468),g=r(1479),p=r(1480),m=r(1469);function y(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return b(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?b(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,o=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){o=!0,a=e},f:function(){try{s||null==r.return||r.return()}finally{if(o)throw a}}}}function b(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function k(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,h.Z)(e);if(t){var i=(0,h.Z)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,f.Z)(this,r)}}function E(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}r(59),r(19),r(112),r(26),r(8),r(4),r(9),r(13),r(2),r(6),r(14),r(15),r(5),r(41),r(899),r(900),r(24),r(50),r(66),r(526),r(17),r(144),r(114),r(115),r(116),r(117),r(118),r(119),r(120),r(121),r(122),r(123),r(124),r(125),r(126),r(127),r(128),r(129),r(130),r(131),r(132),r(133),r(134),r(135),r(136),r(137),r(138),r(150),r(27),r(11),r(931),r(292),r(223),r(224),r(225),r(52),r(12),r(25),r(35),r(251),r(895),r(593),r(31),r(22),r(74),r(43),r(44),r(45),r(91),r(38),r(82),r(32),r(39),r(54),r(49),r(57),r(34),r(521),r(594),r(591);var T,_,w,S,L,R={exports:{}};T=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,_=/^(?=([^\/?#]*))\1([^]*)$/,w=/(?:\/|^)\.(?=\/)/g,S=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,R.exports=L={buildAbsoluteURL:function(e,t,r){if(r=r||{},e=e.trim(),!(t=t.trim())){if(!r.alwaysNormalize)return e;var n=L.parseURL(e);if(!n)throw new Error("Error trying to parse base URL.");return n.path=L.normalizePath(n.path),L.buildURLFromParts(n)}var i=L.parseURL(t);if(!i)throw new Error("Error trying to parse relative URL.");if(i.scheme)return r.alwaysNormalize?(i.path=L.normalizePath(i.path),L.buildURLFromParts(i)):t;var a=L.parseURL(e);if(!a)throw new Error("Error trying to parse base URL.");if(!a.netLoc&&a.path&&"/"!==a.path[0]){var s=_.exec(a.path);a.netLoc=s[1],a.path=s[2]}a.netLoc&&!a.path&&(a.path="/");var o={scheme:a.scheme,netLoc:i.netLoc,path:null,params:i.params,query:i.query,fragment:i.fragment};if(!i.netLoc&&(o.netLoc=a.netLoc,"/"!==i.path[0]))if(i.path){var l=a.path,u=l.substring(0,l.lastIndexOf("/")+1)+i.path;o.path=L.normalizePath(u)}else o.path=a.path,i.params||(o.params=a.params,i.query||(o.query=a.query));return null===o.path&&(o.path=r.alwaysNormalize?L.normalizePath(i.path):i.path),L.buildURLFromParts(o)},parseURL:function(e){var t=T.exec(e);return t?{scheme:t[1]||"",netLoc:t[2]||"",path:t[3]||"",params:t[4]||"",query:t[5]||"",fragment:t[6]||""}:null},normalizePath:function(e){for(e=e.split("").reverse().join("").replace(w,"");e.length!==(e=e.replace(S,"")).length;);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}};var A=R.exports;function x(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function I(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?x(Object(r),!0).forEach((function(t){D(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):x(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function D(e,t,r){return(t=function(e){var t=function(e,t){if("object"!==(0,m.Z)(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==(0,m.Z)(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===(0,m.Z)(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function C(){return C=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},C.apply(this,arguments)}var P=Number.isFinite||function(e){return"number"==typeof e&&isFinite(e)},M=function(e){return e.MEDIA_ATTACHING="hlsMediaAttaching",e.MEDIA_ATTACHED="hlsMediaAttached",e.MEDIA_DETACHING="hlsMediaDetaching",e.MEDIA_DETACHED="hlsMediaDetached",e.BUFFER_RESET="hlsBufferReset",e.BUFFER_CODECS="hlsBufferCodecs",e.BUFFER_CREATED="hlsBufferCreated",e.BUFFER_APPENDING="hlsBufferAppending",e.BUFFER_APPENDED="hlsBufferAppended",e.BUFFER_EOS="hlsBufferEos",e.BUFFER_FLUSHING="hlsBufferFlushing",e.BUFFER_FLUSHED="hlsBufferFlushed",e.MANIFEST_LOADING="hlsManifestLoading",e.MANIFEST_LOADED="hlsManifestLoaded",e.MANIFEST_PARSED="hlsManifestParsed",e.LEVEL_SWITCHING="hlsLevelSwitching",e.LEVEL_SWITCHED="hlsLevelSwitched",e.LEVEL_LOADING="hlsLevelLoading",e.LEVEL_LOADED="hlsLevelLoaded",e.LEVEL_UPDATED="hlsLevelUpdated",e.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",e.LEVELS_UPDATED="hlsLevelsUpdated",e.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",e.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",e.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",e.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",e.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",e.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",e.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",e.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",e.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",e.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",e.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",e.CUES_PARSED="hlsCuesParsed",e.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",e.INIT_PTS_FOUND="hlsInitPtsFound",e.FRAG_LOADING="hlsFragLoading",e.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",e.FRAG_LOADED="hlsFragLoaded",e.FRAG_DECRYPTED="hlsFragDecrypted",e.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",e.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",e.FRAG_PARSING_METADATA="hlsFragParsingMetadata",e.FRAG_PARSED="hlsFragParsed",e.FRAG_BUFFERED="hlsFragBuffered",e.FRAG_CHANGED="hlsFragChanged",e.FPS_DROP="hlsFpsDrop",e.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",e.ERROR="hlsError",e.DESTROYING="hlsDestroying",e.KEY_LOADING="hlsKeyLoading",e.KEY_LOADED="hlsKeyLoaded",e.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",e.BACK_BUFFER_REACHED="hlsBackBufferReached",e}({}),O=function(e){return e.NETWORK_ERROR="networkError",e.MEDIA_ERROR="mediaError",e.KEY_SYSTEM_ERROR="keySystemError",e.MUX_ERROR="muxError",e.OTHER_ERROR="otherError",e}({}),N=function(e){return e.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",e.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",e.KEY_SYSTEM_NO_SESSION="keySystemNoSession",e.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",e.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",e.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",e.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",e.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",e.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",e.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",e.MANIFEST_LOAD_ERROR="manifestLoadError",e.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",e.MANIFEST_PARSING_ERROR="manifestParsingError",e.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",e.LEVEL_EMPTY_ERROR="levelEmptyError",e.LEVEL_LOAD_ERROR="levelLoadError",e.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",e.LEVEL_PARSING_ERROR="levelParsingError",e.LEVEL_SWITCH_ERROR="levelSwitchError",e.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",e.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",e.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",e.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",e.FRAG_LOAD_ERROR="fragLoadError",e.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",e.FRAG_DECRYPT_ERROR="fragDecryptError",e.FRAG_PARSING_ERROR="fragParsingError",e.FRAG_GAP="fragGap",e.REMUX_ALLOC_ERROR="remuxAllocError",e.KEY_LOAD_ERROR="keyLoadError",e.KEY_LOAD_TIMEOUT="keyLoadTimeOut",e.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",e.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",e.BUFFER_APPEND_ERROR="bufferAppendError",e.BUFFER_APPENDING_ERROR="bufferAppendingError",e.BUFFER_STALLED_ERROR="bufferStalledError",e.BUFFER_FULL_ERROR="bufferFullError",e.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",e.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",e.INTERNAL_EXCEPTION="internalException",e.INTERNAL_ABORTED="aborted",e.UNKNOWN="unknown",e}({}),F=function(){},Z={trace:F,debug:F,log:F,warn:F,info:F,error:F},U=Z;function B(e){var t=self.console[e];return t?t.bind(self.console,"[".concat(e,"] >")):F}function j(e,t){if(self.console&&!0===e||"object"===(0,m.Z)(e)){!function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];r.forEach((function(t){U[t]=e[t]?e[t].bind(e):B(t)}))}(e,"debug","log","info","warn","error");try{U.log('Debug logs enabled for "'.concat(t,'" in hls.js version ',"1.4.12"))}catch(e){U=Z}}else U=Z}var G=U,K=/^(\d+)x(\d+)$/,H=/(.+?)=(".*?"|.*?)(?:,|$)/g,z=function(){function e(t){for(var r in(0,g.Z)(this,e),"string"==typeof t&&(t=e.parseAttrList(t)),t)t.hasOwnProperty(r)&&("X-"===r.substring(0,2)&&(this.clientAttrs=this.clientAttrs||[],this.clientAttrs.push(r)),this[r]=t[r])}return(0,p.Z)(e,[{key:"decimalInteger",value:function(e){var t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}},{key:"hexadecimalInteger",value:function(e){if(this[e]){var t=(this[e]||"0x").slice(2);t=(1&t.length?"0":"")+t;for(var r=new Uint8Array(t.length/2),n=0;n<t.length/2;n++)r[n]=parseInt(t.slice(2*n,2*n+2),16);return r}return null}},{key:"hexadecimalIntegerAsNumber",value:function(e){var t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}},{key:"decimalFloatingPoint",value:function(e){return parseFloat(this[e])}},{key:"optionalFloat",value:function(e,t){var r=this[e];return r?parseFloat(r):t}},{key:"enumeratedString",value:function(e){return this[e]}},{key:"bool",value:function(e){return"YES"===this[e]}},{key:"decimalResolution",value:function(e){var t=K.exec(this[e]);if(null!==t)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}}],[{key:"parseAttrList",value:function(e){var t,r={};for(H.lastIndex=0;null!==(t=H.exec(e));){var n=t[2];0===n.indexOf('"')&&n.lastIndexOf('"')===n.length-1&&(n=n.slice(1,-1)),r[t[1].trim()]=n}return r}}]),e}();function V(e){return"SCTE35-OUT"===e||"SCTE35-IN"===e}var q=function(){function e(t,r){if((0,g.Z)(this,e),this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,r){var n=r.attr;for(var i in n)if(Object.prototype.hasOwnProperty.call(t,i)&&t[i]!==n[i]){G.warn('DATERANGE tag attribute: "'.concat(i,'" does not match for tags with ID: "').concat(t.ID,'"')),this._badValueForSameId=i;break}t=C(new z({}),n,t)}if(this.attr=t,this._startDate=new Date(t["START-DATE"]),"END-DATE"in this.attr){var a=new Date(this.attr["END-DATE"]);P(a.getTime())&&(this._endDate=a)}}return(0,p.Z)(e,[{key:"id",get:function(){return this.attr.ID}},{key:"class",get:function(){return this.attr.CLASS}},{key:"startDate",get:function(){return this._startDate}},{key:"endDate",get:function(){if(this._endDate)return this._endDate;var e=this.duration;return null!==e?new Date(this._startDate.getTime()+1e3*e):null}},{key:"duration",get:function(){if("DURATION"in this.attr){var e=this.attr.decimalFloatingPoint("DURATION");if(P(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}},{key:"plannedDuration",get:function(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}},{key:"endOnNext",get:function(){return this.attr.bool("END-ON-NEXT")}},{key:"isValid",get:function(){return!!this.id&&!this._badValueForSameId&&P(this.startDate.getTime())&&(null===this.duration||this.duration>=0)&&(!this.endOnNext||!!this.class)}}]),e}(),W=(0,p.Z)((function e(){(0,g.Z)(this,e),this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}})),Y="audio",X="video",Q="audiovideo",$=function(){function e(t){var r;(0,g.Z)(this,e),this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=(r={},(0,v.Z)(r,Y,null),(0,v.Z)(r,X,null),(0,v.Z)(r,Q,null),r),this.baseurl=t}return(0,p.Z)(e,[{key:"setByteRange",value:function(e,t){var r=e.split("@",2),n=[];1===r.length?n[0]=t?t.byteRangeEndOffset:0:n[0]=parseInt(r[1]),n[1]=parseInt(r[0])+n[0],this._byteRange=n}},{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=A.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(e){this._url=e}}]),e}(),J=function(e){(0,d.Z)(r,e);var t=k(r);function r(e,n){var i;return(0,g.Z)(this,r),(i=t.call(this,n))._decryptdata=null,i.rawProgramDateTime=null,i.programDateTime=null,i.tagList=[],i.duration=0,i.sn=0,i.levelkeys=void 0,i.type=void 0,i.loader=null,i.keyLoader=null,i.level=-1,i.cc=0,i.startPTS=void 0,i.endPTS=void 0,i.startDTS=void 0,i.endDTS=void 0,i.start=0,i.deltaPTS=void 0,i.maxStartPTS=void 0,i.minEndPTS=void 0,i.stats=new W,i.urlId=0,i.data=void 0,i.bitrateTest=!1,i.title=null,i.initSegment=null,i.endList=void 0,i.gap=void 0,i.type=e,i}return(0,p.Z)(r,[{key:"decryptdata",get:function(){if(!this.levelkeys&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){var e=this.levelkeys.identity;if(e)this._decryptdata=e.getDecryptData(this.sn);else{var t=Object.keys(this.levelkeys);if(1===t.length)return this._decryptdata=this.levelkeys[t[0]].getDecryptData(this.sn)}}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(null===this.programDateTime)return null;if(!P(this.programDateTime))return null;var e=P(this.duration)?this.duration:0;return this.programDateTime+1e3*e}},{key:"encrypted",get:function(){var e;if(null!=(e=this._decryptdata)&&e.encrypted)return!0;if(this.levelkeys){var t=Object.keys(this.levelkeys),r=t.length;if(r>1||1===r&&this.levelkeys[t[0]].encrypted)return!0}return!1}},{key:"setKeyFormat",value:function(e){if(this.levelkeys){var t=this.levelkeys[e];t&&!this._decryptdata&&(this._decryptdata=t.getDecryptData(this.sn))}}},{key:"abortRequests",value:function(){var e,t;null==(e=this.loader)||e.abort(),null==(t=this.keyLoader)||t.abort()}},{key:"setElementaryStreamInfo",value:function(e,t,r,n,i){var a=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=this.elementaryStreams,o=s[e];o?(o.startPTS=Math.min(o.startPTS,t),o.endPTS=Math.max(o.endPTS,r),o.startDTS=Math.min(o.startDTS,n),o.endDTS=Math.max(o.endDTS,i)):s[e]={startPTS:t,endPTS:r,startDTS:n,endDTS:i,partial:a}}},{key:"clearElementaryStreamInfo",value:function(){var e=this.elementaryStreams;e[Y]=null,e[X]=null,e[Q]=null}}]),r}($),ee=function(e){(0,d.Z)(r,e);var t=k(r);function r(e,n,i,a,s){var o;(0,g.Z)(this,r),(o=t.call(this,i)).fragOffset=0,o.duration=0,o.gap=!1,o.independent=!1,o.relurl=void 0,o.fragment=void 0,o.index=void 0,o.stats=new W,o.duration=e.decimalFloatingPoint("DURATION"),o.gap=e.bool("GAP"),o.independent=e.bool("INDEPENDENT"),o.relurl=e.enumeratedString("URI"),o.fragment=n,o.index=a;var l=e.enumeratedString("BYTERANGE");return l&&o.setByteRange(l,s),s&&(o.fragOffset=s.fragOffset+s.duration),o}return(0,p.Z)(r,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var e=this.elementaryStreams;return!!(e.audio||e.video||e.audiovideo)}}]),r}($),te=function(){function e(t){(0,g.Z)(this,e),this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=t}return(0,p.Z)(e,[{key:"reloaded",value:function(e){if(!e)return this.advanced=!0,void(this.updated=!0);var t=this.lastPartSn-e.lastPartSn,r=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!r||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||0===t&&r>0,this.updated||this.advanced?this.misses=Math.floor(.6*e.misses):this.misses=e.misses+1,this.availabilityDelay=e.availabilityDelay}},{key:"hasProgramDateTime",get:function(){return!!this.fragments.length&&P(this.fragments[this.fragments.length-1].programDateTime)}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||10}},{key:"drift",get:function(){var e=this.driftEndTime-this.driftStartTime;return e>0?1e3*(this.driftEnd-this.driftStart)/e:1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var e;return null!=(e=this.fragments)&&e.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}]),e}();function re(e){return Uint8Array.from(atob(e),(function(e){return e.charCodeAt(0)}))}function ne(e){return Uint8Array.from(unescape(encodeURIComponent(e)),(function(e){return e.charCodeAt(0)}))}var ie={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},ae="org.w3.clearkey",se="com.apple.streamingkeydelivery",oe="com.microsoft.playready",le="urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed";function ue(e){switch(e){case se:return ie.FAIRPLAY;case oe:return ie.PLAYREADY;case le:return ie.WIDEVINE;case ae:return ie.CLEARKEY}}var ce="edef8ba979d64acea3c827dcd51d21ed";function de(e){switch(e){case ie.FAIRPLAY:return se;case ie.PLAYREADY:return oe;case ie.WIDEVINE:return le;case ie.CLEARKEY:return ae}}function fe(e){var t=e.drmSystems,r=e.widevineLicenseUrl,n=t?[ie.FAIRPLAY,ie.WIDEVINE,ie.PLAYREADY,ie.CLEARKEY].filter((function(e){return!!t[e]})):[];return!n[ie.WIDEVINE]&&r&&n.push(ie.WIDEVINE),n}var he="undefined"!=typeof self&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null;function ve(e,t,r){return Uint8Array.prototype.slice?e.slice(t,r):new Uint8Array(Array.prototype.slice.call(e,t,r))}var ge,pe=function(e,t){return t+10<=e.length&&73===e[t]&&68===e[t+1]&&51===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128},me=function(e,t){return t+10<=e.length&&51===e[t]&&68===e[t+1]&&73===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128},ye=function(e,t){for(var r=t,n=0;pe(e,t);)n+=10,n+=be(e,t+6),me(e,t+10)&&(n+=10),t+=n;if(n>0)return e.subarray(r,r+n)},be=function(e,t){var r=0;return r=(127&e[t])<<21,r|=(127&e[t+1])<<14,(r|=(127&e[t+2])<<7)|127&e[t+3]},ke=function(e,t){return pe(e,t)&&be(e,t+6)+10<=e.length-t},Ee=function(e){return e&&"PRIV"===e.key&&"com.apple.streaming.transportStreamTimestamp"===e.info},Te=function(e){var t=String.fromCharCode(e[0],e[1],e[2],e[3]),r=be(e,4);return{type:t,size:r,data:e.subarray(10,10+r)}},_e=function(e){for(var t=0,r=[];pe(e,t);){for(var n=be(e,t+6),i=(t+=10)+n;t+8<i;){var a=Te(e.subarray(t)),s=we(a);s&&r.push(s),t+=a.size+10}me(e,t)&&(t+=10)}return r},we=function(e){return"PRIV"===e.type?Se(e):"W"===e.type[0]?Re(e):Le(e)},Se=function(e){if(!(e.size<2)){var t=xe(e.data,!0),r=new Uint8Array(e.data.subarray(t.length+1));return{key:e.type,info:t,data:r.buffer}}},Le=function(e){if(!(e.size<2)){if("TXXX"===e.type){var t=1,r=xe(e.data.subarray(t),!0);t+=r.length+1;var n=xe(e.data.subarray(t));return{key:e.type,info:r,data:n}}var i=xe(e.data.subarray(1));return{key:e.type,data:i}}},Re=function(e){if("WXXX"===e.type){if(e.size<2)return;var t=1,r=xe(e.data.subarray(t),!0);t+=r.length+1;var n=xe(e.data.subarray(t));return{key:e.type,info:r,data:n}}var i=xe(e.data);return{key:e.type,data:i}},Ae=function(e){if(8===e.data.byteLength){var t=new Uint8Array(e.data),r=1&t[3],n=(t[4]<<23)+(t[5]<<15)+(t[6]<<7)+t[7];return n/=45,r&&(n+=47721858.84),Math.round(n)}},xe=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=Ie();if(r){var n=r.decode(e);if(t){var i=n.indexOf("\0");return-1!==i?n.substring(0,i):n}return n.replace(/\0/g,"")}for(var a,s,o,l=e.length,u="",c=0;c<l;){if(0===(a=e[c++])&&t)return u;if(0!==a&&3!==a)switch(a>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:u+=String.fromCharCode(a);break;case 12:case 13:s=e[c++],u+=String.fromCharCode((31&a)<<6|63&s);break;case 14:s=e[c++],o=e[c++],u+=String.fromCharCode((15&a)<<12|(63&s)<<6|(63&o)<<0)}}return u};function Ie(){return ge||void 0===self.TextDecoder||(ge=new self.TextDecoder("utf-8")),ge}var De=function(e){for(var t="",r=0;r<e.length;r++){var n=e[r].toString(16);n.length<2&&(n="0"+n),t+=n}return t},Ce=Math.pow(2,32)-1,Pe=[].push,Me={video:1,audio:2,id3:3,text:4};function Oe(e){return String.fromCharCode.apply(null,e)}function Ne(e,t){var r=e[t]<<8|e[t+1];return r<0?65536+r:r}function Fe(e,t){var r=Ze(e,t);return r<0?4294967296+r:r}function Ze(e,t){return e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]}function Ue(e,t,r){e[t]=r>>24,e[t+1]=r>>16&255,e[t+2]=r>>8&255,e[t+3]=255&r}function Be(e,t){var r=[];if(!t.length)return r;for(var n=e.byteLength,i=0;i<n;){var a=Fe(e,i),s=a>1?i+a:n;if(Oe(e.subarray(i+4,i+8))===t[0])if(1===t.length)r.push(e.subarray(i+8,s));else{var o=Be(e.subarray(i+8,s),t.slice(1));o.length&&Pe.apply(r,o)}i=s}return r}function je(e){var t=[],r=e[0],n=8,i=Fe(e,n);n+=4,n+=0===r?8:16,n+=2;var a=e.length+0,s=Ne(e,n);n+=2;for(var o=0;o<s;o++){var l=n,u=Fe(e,l);l+=4;var c=2147483647&u;if(1==(2147483648&u)>>>31)return G.warn("SIDX has hierarchical references (not supported)"),null;var d=Fe(e,l);l+=4,t.push({referenceSize:c,subsegmentDuration:d,info:{duration:d/i,start:a,end:a+c-1}}),a+=c,n=l+=4}return{earliestPresentationTime:0,timescale:i,version:r,referencesCount:s,references:t}}function Ge(e){for(var t=[],r=Be(e,["moov","trak"]),n=0;n<r.length;n++){var i=r[n],a=Be(i,["tkhd"])[0];if(a){var s=a[0],o=0===s?12:20,l=Fe(a,o),u=Be(i,["mdia","mdhd"])[0];if(u){var c=Fe(u,o=0===(s=u[0])?12:20),d=Be(i,["mdia","hdlr"])[0];if(d){var f=Oe(d.subarray(8,12)),h={soun:Y,vide:X}[f];if(h){var v=Be(i,["mdia","minf","stbl","stsd"])[0],g=void 0;v&&(g=Oe(v.subarray(12,16))),t[l]={timescale:c,type:h},t[h]={timescale:c,id:l,codec:g}}}}}}return Be(e,["moov","mvex","trex"]).forEach((function(e){var r=Fe(e,4),n=t[r];n&&(n.default={duration:Fe(e,12),flags:Fe(e,20)})})),t}function Ke(e){var t=Be(e,["schm"])[0];if(t){var r=Oe(t.subarray(4,8));if("cbcs"===r||"cenc"===r)return Be(e,["schi","tenc"])[0]}return G.error("[eme] missing 'schm' box"),null}function He(e){var t=Fe(e,0),r=8;1&t&&(r+=4),4&t&&(r+=4);for(var n=0,i=Fe(e,4),a=0;a<i;a++)256&t&&(n+=Fe(e,r),r+=4),512&t&&(r+=4),1024&t&&(r+=4),2048&t&&(r+=4);return n}function ze(e,t){var r=new Uint8Array(e.length+t.length);return r.set(e),r.set(t,e.length),r}function Ve(e,t){var r=[],n=t.samples,i=t.timescale,a=t.id,s=!1;return Be(n,["moof"]).map((function(o){var l=o.byteOffset-8;Be(o,["traf"]).map((function(o){var u=Be(o,["tfdt"]).map((function(e){var t=e[0],r=Fe(e,4);return 1===t&&(r*=Math.pow(2,32),r+=Fe(e,8)),r/i}))[0];return void 0!==u&&(e=u),Be(o,["tfhd"]).map((function(u){var c=Fe(u,4),d=16777215&Fe(u,0),f=0,h=0!=(16&d),v=0,g=0!=(32&d),p=8;c===a&&(0!=(1&d)&&(p+=8),0!=(2&d)&&(p+=4),0!=(8&d)&&(f=Fe(u,p),p+=4),h&&(v=Fe(u,p),p+=4),g&&(p+=4),"video"===t.type&&(s=function(e){if(!e)return!1;var t=e.indexOf("."),r=t<0?e:e.substring(0,t);return"hvc1"===r||"hev1"===r||"dvh1"===r||"dvhe"===r}(t.codec)),Be(o,["trun"]).map((function(a){var o=a[0],u=16777215&Fe(a,0),c=0!=(1&u),d=0,h=0!=(4&u),g=0!=(256&u),p=0,m=0!=(512&u),y=0,b=0!=(1024&u),k=0!=(2048&u),E=0,T=Fe(a,4),_=8;c&&(d=Fe(a,_),_+=4),h&&(_+=4);for(var w=d+l,S=0;S<T;S++){if(g?(p=Fe(a,_),_+=4):p=f,m?(y=Fe(a,_),_+=4):y=v,b&&(_+=4),k&&(E=0===o?Fe(a,_):Ze(a,_),_+=4),t.type===X)for(var L=0;L<y;){var R=Fe(n,w);qe(s,n[w+=4])&&We(n.subarray(w,w+R),s?2:1,e+E/i,r),w+=R,L+=R+4}e+=p/i}})))}))}))})),r}function qe(e,t){if(e){var r=t>>1&63;return 39===r||40===r}return 6==(31&t)}function We(e,t,r,n){var i=Ye(e),a=0;a+=t;for(var s=0,o=0,l=!1,u=0;a<i.length;){s=0;do{if(a>=i.length)break;s+=u=i[a++]}while(255===u);o=0;do{if(a>=i.length)break;o+=u=i[a++]}while(255===u);var c=i.length-a;if(!l&&4===s&&a<i.length){if(l=!0,181===i[a++]){var d=Ne(i,a);if(a+=2,49===d){var f=Fe(i,a);if(a+=4,1195456820===f){var h=i[a++];if(3===h){var v=i[a++],g=64&v,p=g?2+3*(31&v):0,m=new Uint8Array(p);if(g){m[0]=v;for(var y=1;y<p;y++)m[y]=i[a++]}n.push({type:h,payloadType:s,pts:r,bytes:m})}}}}}else if(5===s&&o<c){if(l=!0,o>16){for(var b=[],k=0;k<16;k++){var E=i[a++].toString(16);b.push(1==E.length?"0"+E:E),3!==k&&5!==k&&7!==k&&9!==k||b.push("-")}for(var T=o-16,_=new Uint8Array(T),w=0;w<T;w++)_[w]=i[a++];n.push({payloadType:s,pts:r,uuid:b.join(""),userData:xe(_),userDataBytes:_})}}else if(o<c)a+=o;else if(o>c)break}}function Ye(e){for(var t=e.byteLength,r=[],n=1;n<t-2;)0===e[n]&&0===e[n+1]&&3===e[n+2]?(r.push(n+2),n+=2):n++;if(0===r.length)return e;var i=t-r.length,a=new Uint8Array(i),s=0;for(n=0;n<i;s++,n++)s===r[0]&&(s++,r.shift()),a[n]=e[s];return a}var Xe={},Qe=function(){function e(t,r,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;(0,g.Z)(this,e),this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=t,this.uri=r,this.keyFormat=n,this.keyFormatVersions=i,this.iv=a,this.encrypted=!!t&&"NONE"!==t,this.isCommonEncryption=this.encrypted&&"AES-128"!==t}return(0,p.Z)(e,[{key:"isSupported",value:function(){if(this.method){if("AES-128"===this.method||"NONE"===this.method)return!0;if("identity"===this.keyFormat)return"SAMPLE-AES"===this.method;switch(this.keyFormat){case se:case le:case oe:case ae:return-1!==["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)}}return!1}},{key:"getDecryptData",value:function(t){if(!this.encrypted||!this.uri)return null;if("AES-128"===this.method&&this.uri&&!this.iv){"number"!=typeof t&&("AES-128"!==this.method||this.iv||G.warn('missing IV for initialization segment with method="'.concat(this.method,'" - compliance issue')),t=0);var r=function(e){for(var t=new Uint8Array(16),r=12;r<16;r++)t[r]=e>>8*(15-r)&255;return t}(t);return new e(this.method,this.uri,"identity",this.keyFormatVersions,r)}var n=function(e){var t,r,n=e.split(":"),i=null;if("data"===n[0]&&2===n.length){var a=n[1].split(";"),s=a[a.length-1].split(",");if(2===s.length){var o="base64"===s[0],l=s[1];o?(a.splice(-1,1),i=re(l)):(t=ne(l).subarray(0,16),(r=new Uint8Array(16)).set(t,16-t.length),i=r)}}return i}(this.uri);if(n)switch(this.keyFormat){case le:this.pssh=n,n.length>=22&&(this.keyId=n.subarray(n.length-22,n.length-6));break;case oe:var i=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=function(e,t,r){if(16!==e.byteLength)throw new RangeError("Invalid system id");var n,i,a;if(t){n=1,i=new Uint8Array(16*t.length);for(var s=0;s<t.length;s++){var o=t[s];if(16!==o.byteLength)throw new RangeError("Invalid key");i.set(o,16*s)}}else n=0,i=new Uint8Array;n>0?(a=new Uint8Array(4),t.length>0&&new DataView(a.buffer).setUint32(0,t.length,!1)):a=new Uint8Array;var l=new Uint8Array(4);return r&&r.byteLength>0&&new DataView(l.buffer).setUint32(0,r.byteLength,!1),function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];for(var i=r.length,a=8,s=i;s--;)a+=r[s].byteLength;var o=new Uint8Array(a);for(o[0]=a>>24&255,o[1]=a>>16&255,o[2]=a>>8&255,o[3]=255&a,o.set(e,4),s=0,a=8;s<i;s++)o.set(r[s],a),a+=r[s].byteLength;return o}([112,115,115,104],new Uint8Array([n,0,0,0]),e,a,i,l,r||new Uint8Array)}(i,null,n);var a=new Uint16Array(n.buffer,n.byteOffset,n.byteLength/2),s=String.fromCharCode.apply(null,Array.from(a)),o=s.substring(s.indexOf("<"),s.length),l=(new DOMParser).parseFromString(o,"text/xml").getElementsByTagName("KID")[0];if(l){var u=l.childNodes[0]?l.childNodes[0].nodeValue:l.getAttribute("VALUE");if(u){var c=re(u).subarray(0,16);!function(e){var t=function(e,t,r){var n=e[t];e[t]=e[r],e[r]=n};t(e,0,3),t(e,1,2),t(e,4,5),t(e,6,7)}(c),this.keyId=c}}break;default:var d=n.subarray(0,16);if(16!==d.length){var f=new Uint8Array(16);f.set(d,16-d.length),d=f}this.keyId=d}if(!this.keyId||16!==this.keyId.byteLength){var h=Xe[this.uri];if(!h){var v=Object.keys(Xe).length%Number.MAX_SAFE_INTEGER;h=new Uint8Array(16),new DataView(h.buffer,12,4).setUint32(0,v),Xe[this.uri]=h}this.keyId=h}return this}}],[{key:"clearKeyUriToKeyIdMap",value:function(){Xe={}}}]),e}(),$e=/\{\$([a-zA-Z0-9-_]+)\}/g;function Je(e){return $e.test(e)}function et(e,t,r){if(null!==e.variableList||e.hasVariableRefs)for(var n=r.length;n--;){var i=r[n],a=t[i];a&&(t[i]=tt(e,a))}}function tt(e,t){if(null!==e.variableList||e.hasVariableRefs){var r=e.variableList;return t.replace($e,(function(t){var n=t.substring(2,t.length-1),i=null==r?void 0:r[n];return void 0===i?(e.playlistParsingError||(e.playlistParsingError=new Error('Missing preceding EXT-X-DEFINE tag for Variable Reference: "'.concat(n,'"'))),t):i}))}return t}function rt(e,t,r){var n,i,a=e.variableList;if(a||(e.variableList=a={}),"QUERYPARAM"in t){n=t.QUERYPARAM;try{var s=new self.URL(r).searchParams;if(!s.has(n))throw new Error('"'.concat(n,'" does not match any query parameter in URI: "').concat(r,'"'));i=s.get(n)}catch(t){e.playlistParsingError||(e.playlistParsingError=new Error("EXT-X-DEFINE QUERYPARAM: ".concat(t.message)))}}else n=t.NAME,i=t.VALUE;n in a?e.playlistParsingError||(e.playlistParsingError=new Error('EXT-X-DEFINE duplicate Variable Name declarations: "'.concat(n,'"'))):a[n]=i||""}function nt(e,t,r){var n=t.IMPORT;if(r&&n in r){var i=e.variableList;i||(e.variableList=i={}),i[n]=r[n]}else e.playlistParsingError||(e.playlistParsingError=new Error('EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "'.concat(n,'"')))}function it(){if("undefined"!=typeof self)return self.MediaSource||self.WebKitMediaSource}var at={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dva1:!0,dvav:!0,dvh1:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}},st=it();function ot(e,t){var r;return null!=(r=null==st?void 0:st.isTypeSupported("".concat(t||"video",'/mp4;codecs="').concat(e,'"')))&&r}var lt=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,ut=/#EXT-X-MEDIA:(.*)/g,ct=/^#EXT(?:INF|-X-TARGETDURATION):/m,dt=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),ft=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),ht=function(){function e(){(0,g.Z)(this,e)}return(0,p.Z)(e,null,[{key:"findGroup",value:function(e,t){for(var r=0;r<e.length;r++){var n=e[r];if(n.id===t)return n}}},{key:"convertAVC1ToAVCOTI",value:function(e){var t=e.split(".");if(t.length>2){var r=t.shift()+".";return(r+=parseInt(t.shift()).toString(16))+("000"+parseInt(t.shift()).toString(16)).slice(-4)}return e}},{key:"resolve",value:function(e,t){return A.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}},{key:"isMediaPlaylist",value:function(e){return ct.test(e)}},{key:"parseMasterPlaylist",value:function(t,r){var n,i={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:Je(t)},a=[];for(lt.lastIndex=0;null!=(n=lt.exec(t));)if(n[1]){var s,o=new z(n[1]);et(i,o,["CODECS","SUPPLEMENTAL-CODECS","ALLOWED-CPC","PATHWAY-ID","STABLE-VARIANT-ID","AUDIO","VIDEO","SUBTITLES","CLOSED-CAPTIONS","NAME"]);var l=tt(i,n[2]),u={attrs:o,bitrate:o.decimalInteger("AVERAGE-BANDWIDTH")||o.decimalInteger("BANDWIDTH"),name:o.NAME,url:e.resolve(l,r)},c=o.decimalResolution("RESOLUTION");c&&(u.width=c.width,u.height=c.height),pt((o.CODECS||"").split(/[ ,]+/).filter((function(e){return e})),u),u.videoCodec&&-1!==u.videoCodec.indexOf("avc1")&&(u.videoCodec=e.convertAVC1ToAVCOTI(u.videoCodec)),null!=(s=u.unknownCodecs)&&s.length||a.push(u),i.levels.push(u)}else if(n[3]){var d=n[3],f=n[4];switch(d){case"SESSION-DATA":var h=new z(f);et(i,h,["DATA-ID","LANGUAGE","VALUE","URI"]);var v=h["DATA-ID"];v&&(null===i.sessionData&&(i.sessionData={}),i.sessionData[v]=h);break;case"SESSION-KEY":var g=vt(f,r,i);g.encrypted&&g.isSupported()?(null===i.sessionKeys&&(i.sessionKeys=[]),i.sessionKeys.push(g)):G.warn('[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "'.concat(f,'"'));break;case"DEFINE":var p=new z(f);et(i,p,["NAME","VALUE","QUERYPARAM"]),rt(i,p,r);break;case"CONTENT-STEERING":var m=new z(f);et(i,m,["SERVER-URI","PATHWAY-ID"]),i.contentSteering={uri:e.resolve(m["SERVER-URI"],r),pathwayId:m["PATHWAY-ID"]||"."};break;case"START":i.startTimeOffset=gt(f)}}var y=a.length>0&&a.length<i.levels.length;return i.levels=y?a:i.levels,0===i.levels.length&&(i.playlistParsingError=new Error("no levels found in manifest")),i}},{key:"parseMasterPlaylistMedia",value:function(t,r,n){var i,a={},s=n.levels,o={AUDIO:s.map((function(e){return{id:e.attrs.AUDIO,audioCodec:e.audioCodec}})),SUBTITLES:s.map((function(e){return{id:e.attrs.SUBTITLES,textCodec:e.textCodec}})),"CLOSED-CAPTIONS":[]},l=0;for(ut.lastIndex=0;null!==(i=ut.exec(t));){var u=new z(i[1]),c=u.TYPE;if(c){var d=o[c],f=a[c]||[];a[c]=f,et(n,u,["URI","GROUP-ID","LANGUAGE","ASSOC-LANGUAGE","STABLE-RENDITION-ID","NAME","INSTREAM-ID","CHARACTERISTICS","CHANNELS"]);var h={attrs:u,bitrate:0,id:l++,groupId:u["GROUP-ID"]||"",instreamId:u["INSTREAM-ID"],name:u.NAME||u.LANGUAGE||"",type:c,default:u.bool("DEFAULT"),autoselect:u.bool("AUTOSELECT"),forced:u.bool("FORCED"),lang:u.LANGUAGE,url:u.URI?e.resolve(u.URI,r):""};if(null!=d&&d.length){var v=e.findGroup(d,h.groupId)||d[0];mt(h,v,"audioCodec"),mt(h,v,"textCodec")}f.push(h)}}return a}},{key:"parseLevelPlaylist",value:function(e,t,r,n,i,a){var s,o,l,u=new te(t),c=u.fragments,d=null,f=0,h=0,v=0,g=0,p=null,m=new J(n,t),y=-1,b=!1;for(dt.lastIndex=0,u.m3u8=e,u.hasVariableRefs=Je(e);null!==(s=dt.exec(e));){b&&(b=!1,(m=new J(n,t)).start=v,m.sn=f,m.cc=g,m.level=r,d&&(m.initSegment=d,m.rawProgramDateTime=d.rawProgramDateTime,d.rawProgramDateTime=null));var k=s[1];if(k){m.duration=parseFloat(k);var E=(" "+s[2]).slice(1);m.title=E||null,m.tagList.push(E?["INF",k,E]:["INF",k])}else if(s[3]){if(P(m.duration)){m.start=v,l&&kt(m,l,u),m.sn=f,m.level=r,m.cc=g,m.urlId=i,c.push(m);var T=(" "+s[3]).slice(1);m.relurl=tt(u,T),yt(m,p),p=m,v+=m.duration,f++,h=0,b=!0}}else if(s[4]){var _=(" "+s[4]).slice(1);p?m.setByteRange(_,p):m.setByteRange(_)}else if(s[5])m.rawProgramDateTime=(" "+s[5]).slice(1),m.tagList.push(["PROGRAM-DATE-TIME",m.rawProgramDateTime]),-1===y&&(y=c.length);else{if(!(s=s[0].match(ft))){G.warn("No matches on slow regex match for level playlist!");continue}for(o=1;o<s.length&&void 0===s[o];o++);var w=(" "+s[o]).slice(1),S=(" "+s[o+1]).slice(1),L=s[o+2]?(" "+s[o+2]).slice(1):"";switch(w){case"PLAYLIST-TYPE":u.type=S.toUpperCase();break;case"MEDIA-SEQUENCE":f=u.startSN=parseInt(S);break;case"SKIP":var R=new z(S);et(u,R,["RECENTLY-REMOVED-DATERANGES"]);var A=R.decimalInteger("SKIPPED-SEGMENTS");if(P(A)){u.skippedSegments=A;for(var x=A;x--;)c.unshift(null);f+=A}var I=R.enumeratedString("RECENTLY-REMOVED-DATERANGES");I&&(u.recentlyRemovedDateranges=I.split("\t"));break;case"TARGETDURATION":u.targetduration=Math.max(parseInt(S),1);break;case"VERSION":u.version=parseInt(S);break;case"EXTM3U":break;case"ENDLIST":u.live=!1;break;case"#":(S||L)&&m.tagList.push(L?[S,L]:[S]);break;case"DISCONTINUITY":g++,m.tagList.push(["DIS"]);break;case"GAP":m.gap=!0,m.tagList.push([w]);break;case"BITRATE":m.tagList.push([w,S]);break;case"DATERANGE":var D=new z(S);et(u,D,["ID","CLASS","START-DATE","END-DATE","SCTE35-CMD","SCTE35-OUT","SCTE35-IN"]),et(u,D,D.clientAttrs);var M=new q(D,u.dateRanges[D.ID]);M.isValid||u.skippedSegments?u.dateRanges[M.id]=M:G.warn('Ignoring invalid DATERANGE tag: "'.concat(S,'"')),m.tagList.push(["EXT-X-DATERANGE",S]);break;case"DEFINE":var O=new z(S);et(u,O,["NAME","VALUE","IMPORT","QUERYPARAM"]),"IMPORT"in O?nt(u,O,a):rt(u,O,t);break;case"DISCONTINUITY-SEQUENCE":g=parseInt(S);break;case"KEY":var N=vt(S,t,u);if(N.isSupported()){if("NONE"===N.method){l=void 0;break}l||(l={}),l[N.keyFormat]&&(l=C({},l)),l[N.keyFormat]=N}else G.warn('[Keys] Ignoring invalid EXT-X-KEY tag: "'.concat(S,'"'));break;case"START":u.startTimeOffset=gt(S);break;case"MAP":var F=new z(S);if(et(u,F,["BYTERANGE","URI"]),m.duration){var Z=new J(n,t);bt(Z,F,r,l),d=Z,m.initSegment=d,d.rawProgramDateTime&&!m.rawProgramDateTime&&(m.rawProgramDateTime=d.rawProgramDateTime)}else bt(m,F,r,l),d=m,b=!0;break;case"SERVER-CONTROL":var U=new z(S);u.canBlockReload=U.bool("CAN-BLOCK-RELOAD"),u.canSkipUntil=U.optionalFloat("CAN-SKIP-UNTIL",0),u.canSkipDateRanges=u.canSkipUntil>0&&U.bool("CAN-SKIP-DATERANGES"),u.partHoldBack=U.optionalFloat("PART-HOLD-BACK",0),u.holdBack=U.optionalFloat("HOLD-BACK",0);break;case"PART-INF":var B=new z(S);u.partTarget=B.decimalFloatingPoint("PART-TARGET");break;case"PART":var j=u.partList;j||(j=u.partList=[]);var K=h>0?j[j.length-1]:void 0,H=h++,V=new z(S);et(u,V,["BYTERANGE","URI"]);var W=new ee(V,m,t,H,K);j.push(W),m.duration+=W.duration;break;case"PRELOAD-HINT":var Y=new z(S);et(u,Y,["URI"]),u.preloadHint=Y;break;case"RENDITION-REPORT":var X=new z(S);et(u,X,["URI"]),u.renditionReports=u.renditionReports||[],u.renditionReports.push(X);break;default:G.warn("line parsed but not handled: ".concat(s))}}}p&&!p.relurl?(c.pop(),v-=p.duration,u.partList&&(u.fragmentHint=p)):u.partList&&(yt(m,p),m.cc=g,u.fragmentHint=m,l&&kt(m,l,u));var Q=c.length,$=c[0],re=c[Q-1];if((v+=u.skippedSegments*u.targetduration)>0&&Q&&re){u.averagetargetduration=v/Q;var ne=re.sn;u.endSN="initSegment"!==ne?ne:0,u.live||(re.endList=!0),$&&(u.startCC=$.cc)}else u.endSN=0,u.startCC=0;return u.fragmentHint&&(v+=u.fragmentHint.duration),u.totalduration=v,u.endCC=g,y>0&&function(e,t){for(var r=e[t],n=t;n--;){var i=e[n];if(!i)return;i.programDateTime=r.programDateTime-1e3*i.duration,r=i}}(c,y),u}}]),e}();function vt(e,t,r){var n,i,a=new z(e);et(r,a,["KEYFORMAT","KEYFORMATVERSIONS","URI","IV","URI"]);var s=null!=(n=a.METHOD)?n:"",o=a.URI,l=a.hexadecimalInteger("IV"),u=a.KEYFORMATVERSIONS,c=null!=(i=a.KEYFORMAT)?i:"identity";o&&a.IV&&!l&&G.error("Invalid IV: ".concat(a.IV));var d=o?ht.resolve(o,t):"",f=(u||"1").split("/").map(Number).filter(Number.isFinite);return new Qe(s,d,c,f,l)}function gt(e){var t=new z(e).decimalFloatingPoint("TIME-OFFSET");return P(t)?t:null}function pt(e,t){["video","audio","text"].forEach((function(r){var n=e.filter((function(e){return function(e,t){var r=at[t];return!!r&&!0===r[e.slice(0,4)]}(e,r)}));if(n.length){var i=n.filter((function(e){return 0===e.lastIndexOf("avc1",0)||0===e.lastIndexOf("mp4a",0)}));t["".concat(r,"Codec")]=i.length>0?i[0]:n[0],e=e.filter((function(e){return-1===n.indexOf(e)}))}})),t.unknownCodecs=e}function mt(e,t,r){var n=t[r];n&&(e[r]=n)}function yt(e,t){e.rawProgramDateTime?e.programDateTime=Date.parse(e.rawProgramDateTime):null!=t&&t.programDateTime&&(e.programDateTime=t.endProgramDateTime),P(e.programDateTime)||(e.programDateTime=null,e.rawProgramDateTime=null)}function bt(e,t,r,n){e.relurl=t.URI,t.BYTERANGE&&e.setByteRange(t.BYTERANGE),e.level=r,e.sn="initSegment",n&&(e.levelkeys=n),e.initSegment=null}function kt(e,t,r){e.levelkeys=t;var n=r.encryptedFragments;n.length&&n[n.length-1].levelkeys===t||!Object.keys(t).some((function(e){return t[e].isCommonEncryption}))||n.push(e)}var Et="manifest",Tt="level",_t="audioTrack",wt="subtitleTrack",St="main",Lt="audio",Rt="subtitle";function At(e){switch(e.type){case _t:return Lt;case wt:return Rt;default:return St}}function xt(e,t){var r=e.url;return void 0!==r&&0!==r.indexOf("data:")||(r=t.url),r}var It=function(){function e(t){(0,g.Z)(this,e),this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.hls=t,this.registerListeners()}return(0,p.Z)(e,[{key:"startLoad",value:function(e){}},{key:"stopLoad",value:function(){this.destroyInternalLoaders()}},{key:"registerListeners",value:function(){var e=this.hls;e.on(M.MANIFEST_LOADING,this.onManifestLoading,this),e.on(M.LEVEL_LOADING,this.onLevelLoading,this),e.on(M.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(M.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}},{key:"unregisterListeners",value:function(){var e=this.hls;e.off(M.MANIFEST_LOADING,this.onManifestLoading,this),e.off(M.LEVEL_LOADING,this.onLevelLoading,this),e.off(M.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(M.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}},{key:"createInternalLoader",value:function(e){var t=this.hls.config,r=t.pLoader,n=t.loader,i=new(r||n)(t);return this.loaders[e.type]=i,i}},{key:"getInternalLoader",value:function(e){return this.loaders[e.type]}},{key:"resetInternalLoader",value:function(e){this.loaders[e]&&delete this.loaders[e]}},{key:"destroyInternalLoaders",value:function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}},{key:"destroy",value:function(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}},{key:"onManifestLoading",value:function(e,t){var r=t.url;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:Et,url:r,deliveryDirectives:null})}},{key:"onLevelLoading",value:function(e,t){var r=t.id,n=t.level,i=t.url,a=t.deliveryDirectives;this.load({id:r,level:n,responseType:"text",type:Tt,url:i,deliveryDirectives:a})}},{key:"onAudioTrackLoading",value:function(e,t){var r=t.id,n=t.groupId,i=t.url,a=t.deliveryDirectives;this.load({id:r,groupId:n,level:null,responseType:"text",type:_t,url:i,deliveryDirectives:a})}},{key:"onSubtitleTrackLoading",value:function(e,t){var r=t.id,n=t.groupId,i=t.url,a=t.deliveryDirectives;this.load({id:r,groupId:n,level:null,responseType:"text",type:wt,url:i,deliveryDirectives:a})}},{key:"load",value:function(e){var t,r,n,i=this,a=this.hls.config,s=this.getInternalLoader(e);if(s){var o=s.context;if(o&&o.url===e.url)return void G.trace("[playlist-loader]: playlist request ongoing");G.log("[playlist-loader]: aborting previous loader for type: ".concat(e.type)),s.abort()}if(r=e.type===Et?a.manifestLoadPolicy.default:C({},a.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),s=this.createInternalLoader(e),null!=(t=e.deliveryDirectives)&&t.part&&(e.type===Tt&&null!==e.level?n=this.hls.levels[e.level].details:e.type===_t&&null!==e.id?n=this.hls.audioTracks[e.id].details:e.type===wt&&null!==e.id&&(n=this.hls.subtitleTracks[e.id].details),n)){var l=n.partTarget,u=n.targetduration;if(l&&u){var c=1e3*Math.max(3*l,.8*u);r=C({},r,{maxTimeToFirstByteMs:Math.min(c,r.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(c,r.maxTimeToFirstByteMs)})}}var d=r.errorRetry||r.timeoutRetry||{},f={loadPolicy:r,timeout:r.maxLoadTimeMs,maxRetry:d.maxNumRetry||0,retryDelay:d.retryDelayMs||0,maxRetryDelay:d.maxRetryDelayMs||0},h={onSuccess:function(e,t,r,n){var a=i.getInternalLoader(r);i.resetInternalLoader(r.type);var s=e.data;0===s.indexOf("#EXTM3U")?(t.parsing.start=performance.now(),ht.isMediaPlaylist(s)?i.handleTrackOrLevelPlaylist(e,t,r,n||null,a):i.handleMasterPlaylist(e,t,r,n)):i.handleManifestParsingError(e,r,new Error("no EXTM3U delimiter"),n||null,t)},onError:function(e,t,r,n){i.handleNetworkError(t,r,!1,e,n)},onTimeout:function(e,t,r){i.handleNetworkError(t,r,!0,void 0,e)}};s.load(e,f,h)}},{key:"handleMasterPlaylist",value:function(e,t,r,n){var i=this.hls,a=e.data,s=xt(e,r),o=ht.parseMasterPlaylist(a,s);if(o.playlistParsingError)this.handleManifestParsingError(e,r,o.playlistParsingError,n,t);else{var l=o.contentSteering,u=o.levels,c=o.sessionData,d=o.sessionKeys,f=o.startTimeOffset,h=o.variableList;this.variableList=h;var v=ht.parseMasterPlaylistMedia(a,s,o),g=v.AUDIO,p=void 0===g?[]:g,m=v.SUBTITLES,y=v["CLOSED-CAPTIONS"];p.length&&(p.some((function(e){return!e.url}))||!u[0].audioCodec||u[0].attrs.AUDIO||(G.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),p.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new z({}),bitrate:0,url:""}))),i.trigger(M.MANIFEST_LOADED,{levels:u,audioTracks:p,subtitles:m,captions:y,contentSteering:l,url:s,stats:t,networkDetails:n,sessionData:c,sessionKeys:d,startTimeOffset:f,variableList:h})}}},{key:"handleTrackOrLevelPlaylist",value:function(e,t,r,n,i){var a=this.hls,s=r.id,o=r.level,l=r.type,u=xt(e,r),c=P(s)?s:0,d=P(o)?o:c,f=At(r),h=ht.parseLevelPlaylist(e.data,u,d,f,c,this.variableList);if(l===Et){var v={attrs:new z({}),bitrate:0,details:h,name:"",url:u};a.trigger(M.MANIFEST_LOADED,{levels:[v],audioTracks:[],url:u,stats:t,networkDetails:n,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),r.levelDetails=h,this.handlePlaylistLoaded(h,e,t,r,n,i)}},{key:"handleManifestParsingError",value:function(e,t,r,n,i){this.hls.trigger(M.ERROR,{type:O.NETWORK_ERROR,details:N.MANIFEST_PARSING_ERROR,fatal:t.type===Et,url:e.url,err:r,error:r,reason:r.message,response:e,context:t,networkDetails:n,stats:i})}},{key:"handleNetworkError",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0,a="A network ".concat(r?"timeout":"error"+(n?" (status "+n.code+")":"")," occurred while loading ").concat(e.type);e.type===Tt?a+=": ".concat(e.level," id: ").concat(e.id):e.type!==_t&&e.type!==wt||(a+=" id: ".concat(e.id,' group-id: "').concat(e.groupId,'"'));var s=new Error(a);G.warn("[playlist-loader]: ".concat(a));var o=N.UNKNOWN,l=!1,u=this.getInternalLoader(e);switch(e.type){case Et:o=r?N.MANIFEST_LOAD_TIMEOUT:N.MANIFEST_LOAD_ERROR,l=!0;break;case Tt:o=r?N.LEVEL_LOAD_TIMEOUT:N.LEVEL_LOAD_ERROR,l=!1;break;case _t:o=r?N.AUDIO_TRACK_LOAD_TIMEOUT:N.AUDIO_TRACK_LOAD_ERROR,l=!1;break;case wt:o=r?N.SUBTITLE_TRACK_LOAD_TIMEOUT:N.SUBTITLE_LOAD_ERROR,l=!1}u&&this.resetInternalLoader(e.type);var c={type:O.NETWORK_ERROR,details:o,fatal:l,url:e.url,loader:u,context:e,error:s,networkDetails:t,stats:i};if(n){var d=(null==t?void 0:t.url)||e.url;c.response=I({url:d,data:void 0},n)}this.hls.trigger(M.ERROR,c)}},{key:"handlePlaylistLoaded",value:function(e,t,r,n,i,a){var s=this.hls,o=n.type,l=n.level,u=n.id,c=n.groupId,d=n.deliveryDirectives,f=xt(t,n),h=At(n),v="number"==typeof n.level&&h===St?l:void 0;if(e.fragments.length){e.targetduration||(e.playlistParsingError=new Error("Missing Target Duration"));var g=e.playlistParsingError;if(g)s.trigger(M.ERROR,{type:O.NETWORK_ERROR,details:N.LEVEL_PARSING_ERROR,fatal:!1,url:f,error:g,reason:g.message,response:t,context:n,level:v,parent:h,networkDetails:i,stats:r});else switch(e.live&&a&&(a.getCacheAge&&(e.ageHeader=a.getCacheAge()||0),a.getCacheAge&&!isNaN(e.ageHeader)||(e.ageHeader=0)),o){case Et:case Tt:s.trigger(M.LEVEL_LOADED,{details:e,level:v||0,id:u||0,stats:r,networkDetails:i,deliveryDirectives:d});break;case _t:s.trigger(M.AUDIO_TRACK_LOADED,{details:e,id:u||0,groupId:c||"",stats:r,networkDetails:i,deliveryDirectives:d});break;case wt:s.trigger(M.SUBTITLE_TRACK_LOADED,{details:e,id:u||0,groupId:c||"",stats:r,networkDetails:i,deliveryDirectives:d})}}else{var p=new Error("No Segments found in Playlist");s.trigger(M.ERROR,{type:O.NETWORK_ERROR,details:N.LEVEL_EMPTY_ERROR,fatal:!1,url:f,error:p,reason:p.message,response:t,context:n,level:v,parent:h,networkDetails:i,stats:r})}}}]),e}();function Dt(e,t){var r;try{r=new Event("addtrack")}catch(e){(r=document.createEvent("Event")).initEvent("addtrack",!1,!1)}r.track=e,t.dispatchEvent(r)}function Ct(e,t){var r=e.mode;if("disabled"===r&&(e.mode="hidden"),e.cues&&!e.cues.getCueById(t.id))try{if(e.addCue(t),!e.cues.getCueById(t.id))throw new Error("addCue is failed for: ".concat(t))}catch(r){G.debug("[texttrack-utils]: ".concat(r));try{var n=new self.TextTrackCue(t.startTime,t.endTime,t.text);n.id=t.id,e.addCue(n)}catch(e){G.debug("[texttrack-utils]: Legacy TextTrackCue fallback failed: ".concat(e))}}"disabled"===r&&(e.mode=r)}function Pt(e){var t=e.mode;if("disabled"===t&&(e.mode="hidden"),e.cues)for(var r=e.cues.length;r--;)e.removeCue(e.cues[r]);"disabled"===t&&(e.mode=t)}function Mt(e,t,r,n){var i=e.mode;if("disabled"===i&&(e.mode="hidden"),e.cues&&e.cues.length>0)for(var a=function(e,t,r){var n=[],i=function(e,t){if(t<e[0].startTime)return 0;var r=e.length-1;if(t>e[r].endTime)return-1;for(var n=0,i=r;n<=i;){var a=Math.floor((i+n)/2);if(t<e[a].startTime)i=a-1;else{if(!(t>e[a].startTime&&n<r))return a;n=a+1}}return e[n].startTime-t<t-e[i].startTime?n:i}(e,t);if(i>-1)for(var a=i,s=e.length;a<s;a++){var o=e[a];if(o.startTime>=t&&o.endTime<=r)n.push(o);else if(o.startTime>r)return n}return n}(e.cues,t,r),s=0;s<a.length;s++)n&&!n(a[s])||e.removeCue(a[s]);"disabled"===i&&(e.mode=i)}var Ot="org.id3",Nt="https://aomedia.org/emsg/ID3";function Ft(){if("undefined"!=typeof self)return self.WebKitDataCue||self.VTTCue||self.TextTrackCue}var Zt=function(){var e=Ft();try{new e(0,Number.POSITIVE_INFINITY,"")}catch(e){return Number.MAX_VALUE}return Number.POSITIVE_INFINITY}();function Ut(e,t){return e.getTime()/1e3-t}var Bt=function(){function e(t){(0,g.Z)(this,e),this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=t,this._registerListeners()}return(0,p.Z)(e,[{key:"destroy",value:function(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null}},{key:"_registerListeners",value:function(){var e=this.hls;e.on(M.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(M.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(M.MANIFEST_LOADING,this.onManifestLoading,this),e.on(M.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(M.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(M.LEVEL_UPDATED,this.onLevelUpdated,this)}},{key:"_unregisterListeners",value:function(){var e=this.hls;e.off(M.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(M.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(M.MANIFEST_LOADING,this.onManifestLoading,this),e.off(M.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(M.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(M.LEVEL_UPDATED,this.onLevelUpdated,this)}},{key:"onMediaAttached",value:function(e,t){this.media=t.media}},{key:"onMediaDetaching",value:function(){this.id3Track&&(Pt(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})}},{key:"onManifestLoading",value:function(){this.dateRangeCuesAppended={}}},{key:"createTrack",value:function(e){var t=this.getID3Track(e.textTracks);return t.mode="hidden",t}},{key:"getID3Track",value:function(e){if(this.media){for(var t=0;t<e.length;t++){var r=e[t];if("metadata"===r.kind&&"id3"===r.label)return Dt(r,this.media),r}return this.media.addTextTrack("metadata","id3")}}},{key:"onFragParsingMetadata",value:function(e,t){if(this.media){var r=this.hls.config,n=r.enableEmsgMetadataCues,i=r.enableID3MetadataCues;if(n||i){var a=t.samples;this.id3Track||(this.id3Track=this.createTrack(this.media));for(var s=Ft(),o=0;o<a.length;o++){var l=a[o].type;if((l!==Nt||n)&&i){var u=_e(a[o].data);if(u){var c=a[o].pts,d=c+a[o].duration;d>Zt&&(d=Zt),d-c<=0&&(d=c+.25);for(var f=0;f<u.length;f++){var h=u[f];if(!Ee(h)){this.updateId3CueEnds(c,l);var v=new s(c,d,"");v.value=h,l&&(v.type=l),this.id3Track.addCue(v)}}}}}}}}},{key:"updateId3CueEnds",value:function(e,t){var r,n=null==(r=this.id3Track)?void 0:r.cues;if(n)for(var i=n.length;i--;){var a=n[i];a.type===t&&a.startTime<e&&a.endTime===Zt&&(a.endTime=e)}}},{key:"onBufferFlushing",value:function(e,t){var r=t.startOffset,n=t.endOffset,i=t.type,a=this.id3Track,s=this.hls;if(s){var o=s.config,l=o.enableEmsgMetadataCues,u=o.enableID3MetadataCues;a&&(l||u)&&Mt(a,r,n,"audio"===i?function(e){return e.type===Ot&&u}:"video"===i?function(e){return e.type===Nt&&l}:function(e){return e.type===Ot&&u||e.type===Nt&&l})}}},{key:"onLevelUpdated",value:function(e,t){var r=this,n=t.details;if(this.media&&n.hasProgramDateTime&&this.hls.config.enableDateRangeMetadataCues){var i=this.dateRangeCuesAppended,a=this.id3Track,s=n.dateRanges,o=Object.keys(s);if(a)for(var l=Object.keys(i).filter((function(e){return!o.includes(e)})),u=function(){var e=l[c];Object.keys(i[e].cues).forEach((function(t){a.removeCue(i[e].cues[t])})),delete i[e]},c=l.length;c--;)u();var d=n.fragments[n.fragments.length-1];if(0!==o.length&&P(null==d?void 0:d.programDateTime)){this.id3Track||(this.id3Track=this.createTrack(this.media));for(var f=d.programDateTime/1e3-d.start,h=Ft(),v=function(){var e=o[g],t=s[e],n=i[e],a=(null==n?void 0:n.cues)||{},l=(null==n?void 0:n.durationKnown)||!1,u=Ut(t.startDate,f),c=Zt,d=t.endDate;if(d)c=Ut(d,f),l=!0;else if(t.endOnNext&&!l){var v=o.reduce((function(e,r){var n=s[r];return n.class===t.class&&n.id!==r&&n.startDate>t.startDate&&e.push(n),e}),[]).sort((function(e,t){return e.startDate.getTime()-t.startDate.getTime()}))[0];v&&(c=Ut(v.startDate,f),l=!0)}for(var p,m,y=Object.keys(t.attr),b=0;b<y.length;b++){var k=y[b];if("ID"!==(m=k)&&"CLASS"!==m&&"START-DATE"!==m&&"DURATION"!==m&&"END-DATE"!==m&&"END-ON-NEXT"!==m){var E=a[k];if(E)l&&!n.durationKnown&&(E.endTime=c);else{var T=t.attr[k];E=new h(u,c,""),V(k)&&(p=T,T=Uint8Array.from(p.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer),E.value={key:k,data:T},E.type="com.apple.quicktime.HLS",E.id=e,r.id3Track.addCue(E),a[k]=E}}}i[e]={cues:a,dateRange:t,durationKnown:l}},g=0;g<o.length;g++)v()}}}}]),e}(),jt=function(){function e(t){var r=this;(0,g.Z)(this,e),this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return r.timeupdate()},this.hls=t,this.config=t.config,this.registerListeners()}return(0,p.Z)(e,[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var e=this.config,t=this.levelDetails;return void 0!==e.liveMaxLatencyDuration?e.liveMaxLatencyDuration:t?e.liveMaxLatencyDurationCount*t.targetduration:0}},{key:"targetLatency",get:function(){var e=this.levelDetails;if(null===e)return null;var t=e.holdBack,r=e.partHoldBack,n=e.targetduration,i=this.config,a=i.liveSyncDuration,s=i.liveSyncDurationCount,o=i.lowLatencyMode,l=this.hls.userConfig,u=o&&r||t;(l.liveSyncDuration||l.liveSyncDurationCount||0===u)&&(u=void 0!==a?a:s*n);var c=n;return u+Math.min(1*this.stallCount,c)}},{key:"liveSyncPosition",get:function(){var e=this.estimateLiveEdge(),t=this.targetLatency,r=this.levelDetails;if(null===e||null===t||null===r)return null;var n=r.edge,i=e-t-this.edgeStalled,a=n-r.totalduration,s=n-(this.config.lowLatencyMode&&r.partTarget||r.targetduration);return Math.min(Math.max(a,i),s)}},{key:"drift",get:function(){var e=this.levelDetails;return null===e?1:e.drift}},{key:"edgeStalled",get:function(){var e=this.levelDetails;if(null===e)return 0;var t=3*(this.config.lowLatencyMode&&e.partTarget||e.targetduration);return Math.max(e.age-t,0)}},{key:"forwardBufferLength",get:function(){var e=this.media,t=this.levelDetails;if(!e||!t)return 0;var r=e.buffered.length;return(r?e.buffered.end(r-1):t.edge)-this.currentTime}},{key:"destroy",value:function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null}},{key:"registerListeners",value:function(){this.hls.on(M.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(M.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(M.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(M.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(M.ERROR,this.onError,this)}},{key:"unregisterListeners",value:function(){this.hls.off(M.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(M.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.off(M.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(M.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.off(M.ERROR,this.onError,this)}},{key:"onMediaAttached",value:function(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)}},{key:"onMediaDetaching",value:function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)}},{key:"onManifestLoading",value:function(){this.levelDetails=null,this._latency=null,this.stallCount=0}},{key:"onLevelUpdated",value:function(e,t){var r=t.details;this.levelDetails=r,r.advanced&&this.timeupdate(),!r.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)}},{key:"onError",value:function(e,t){var r;t.details===N.BUFFER_STALLED_ERROR&&(this.stallCount++,null!=(r=this.levelDetails)&&r.live&&G.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))}},{key:"timeupdate",value:function(){var e=this.media,t=this.levelDetails;if(e&&t){this.currentTime=e.currentTime;var r=this.computeLatency();if(null!==r){this._latency=r;var n=this.config,i=n.lowLatencyMode,a=n.maxLiveSyncPlaybackRate;if(i&&1!==a){var s=this.targetLatency;if(null!==s){var o=r-s,l=o<Math.min(this.maxLatency,s+t.targetduration);if(t.live&&l&&o>.05&&this.forwardBufferLength>1){var u=Math.min(2,Math.max(1,a)),c=Math.round(2/(1+Math.exp(-.75*o-this.edgeStalled))*20)/20;e.playbackRate=Math.min(u,Math.max(1,c))}else 1!==e.playbackRate&&0!==e.playbackRate&&(e.playbackRate=1)}}}}}},{key:"estimateLiveEdge",value:function(){var e=this.levelDetails;return null===e?null:e.edge+e.age}},{key:"computeLatency",value:function(){var e=this.estimateLiveEdge();return null===e?null:e-this.currentTime}}]),e}(),Gt=["NONE","TYPE-0","TYPE-1",null],Kt=function(){function e(t,r,n){(0,g.Z)(this,e),this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=t,this.part=r,this.skip=n}return(0,p.Z)(e,[{key:"addDirectives",value:function(e){var t=new self.URL(e);return void 0!==this.msn&&t.searchParams.set("_HLS_msn",this.msn.toString()),void 0!==this.part&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}]),e}(),Ht=function(){function e(t){(0,g.Z)(this,e),this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[t.url],this._attrs=[t.attrs],this.bitrate=t.bitrate,t.details&&(this.details=t.details),this.id=t.id||0,this.name=t.name,this.width=t.width||0,this.height=t.height||0,this.audioCodec=t.audioCodec,this.videoCodec=t.videoCodec,this.unknownCodecs=t.unknownCodecs,this.codecSet=[t.videoCodec,t.audioCodec].filter((function(e){return e})).join(",").replace(/\.[^.,]+/g,"")}return(0,p.Z)(e,[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"attrs",get:function(){return this._attrs[this._urlId]}},{key:"pathwayId",get:function(){return this.attrs["PATHWAY-ID"]||"."}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(e){var t=e%this.url.length;this._urlId!==t&&(this.fragmentError=0,this.loadError=0,this.details=void 0,this._urlId=t)}},{key:"audioGroupId",get:function(){var e;return null==(e=this.audioGroupIds)?void 0:e[this.urlId]}},{key:"textGroupId",get:function(){var e;return null==(e=this.textGroupIds)?void 0:e[this.urlId]}},{key:"addFallback",value:function(e){this.url.push(e.url),this._attrs.push(e.attrs)}}]),e}();function zt(e,t){var r=t.startPTS;if(P(r)){var n,i=0;t.sn>e.sn?(i=r-e.start,n=e):(i=e.start-r,n=t),n.duration!==i&&(n.duration=i)}else t.sn>e.sn?e.cc===t.cc&&e.minEndPTS?t.start=e.start+(e.minEndPTS-e.start):t.start=e.start+e.duration:t.start=Math.max(e.start-t.duration,0)}function Vt(e,t,r,n,i,a){n-r<=0&&(G.warn("Fragment should have a positive duration",t),n=r+t.duration,a=i+t.duration);var s=r,o=n,l=t.startPTS,u=t.endPTS;if(P(l)){var c=Math.abs(l-r);P(t.deltaPTS)?t.deltaPTS=Math.max(c,t.deltaPTS):t.deltaPTS=c,s=Math.max(r,l),r=Math.min(r,l),i=Math.min(i,t.startDTS),o=Math.min(n,u),n=Math.max(n,u),a=Math.max(a,t.endDTS)}var d=r-t.start;0!==t.start&&(t.start=r),t.duration=n-t.start,t.startPTS=r,t.maxStartPTS=s,t.startDTS=i,t.endPTS=n,t.minEndPTS=o,t.endDTS=a;var f,h=t.sn;if(!e||h<e.startSN||h>e.endSN)return 0;var v=h-e.startSN,g=e.fragments;for(g[v]=t,f=v;f>0;f--)zt(g[f],g[f-1]);for(f=v;f<g.length-1;f++)zt(g[f],g[f+1]);return e.fragmentHint&&zt(g[g.length-1],e.fragmentHint),e.PTSKnown=e.alignedSliding=!0,d}function qt(e,t){var r=t.startSN+t.skippedSegments-e.startSN,n=e.fragments;r<0||r>=n.length||Wt(t,n[r].start)}function Wt(e,t){if(t){for(var r=e.fragments,n=e.skippedSegments;n<r.length;n++)r[n].start+=t;e.fragmentHint&&(e.fragmentHint.start+=t)}}function Yt(e,t,r){var n;return null!=e&&e.details?Xt(null==(n=e.details)?void 0:n.partList,t,r):null}function Xt(e,t,r){if(e)for(var n=e.length;n--;){var i=e[n];if(i.index===r&&i.fragment.sn===t)return i}return null}function Qt(e){switch(e.details){case N.FRAG_LOAD_TIMEOUT:case N.KEY_LOAD_TIMEOUT:case N.LEVEL_LOAD_TIMEOUT:case N.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function $t(e,t){var r=Qt(t);return e.default["".concat(r?"timeout":"error","Retry")]}function Jt(e,t){var r="linear"===e.backoff?1:Math.pow(2,t);return Math.min(r*e.retryDelayMs,e.maxRetryDelayMs)}function er(e){return I(I({},e),{errorRetry:null,timeoutRetry:null})}function tr(e,t,r,n){return!!e&&t<e.maxNumRetry&&(function(e){return 0===e&&!1===navigator.onLine||!!e&&(e<400||e>499)}(n)||!!r)}var rr=function(e,t){for(var r=0,n=e.length-1,i=null,a=null;r<=n;){var s=t(a=e[i=(r+n)/2|0]);if(s>0)r=i+1;else{if(!(s<0))return a;n=i-1}}return null};function nr(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=null;if(e?i=t[e.sn-t[0].sn+1]||null:0===r&&0===t[0].start&&(i=t[0]),i&&0===ir(r,n,i))return i;var a=rr(t,ir.bind(null,r,n));return!a||a===e&&i?i:a}function ir(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0;if(r.start<=e&&r.start+r.duration>e)return 0;var n=Math.min(t,r.duration+(r.deltaPTS?r.deltaPTS:0));return r.start+r.duration-n<=e?1:r.start-n>e&&r.start?-1:0}function ar(e,t,r){var n=1e3*Math.min(t,r.duration+(r.deltaPTS?r.deltaPTS:0));return(r.endProgramDateTime||0)-n>e}var sr,or=function(){function e(t){(0,g.Z)(this,e),this.hls=void 0,this.playlistError=0,this.penalizedRenditions={},this.log=void 0,this.warn=void 0,this.error=void 0,this.hls=t,this.log=G.log.bind(G,"[info]:"),this.warn=G.warn.bind(G,"[warning]:"),this.error=G.error.bind(G,"[error]:"),this.registerListeners()}return(0,p.Z)(e,[{key:"registerListeners",value:function(){var e=this.hls;e.on(M.ERROR,this.onError,this),e.on(M.MANIFEST_LOADING,this.onManifestLoading,this),e.on(M.LEVEL_UPDATED,this.onLevelUpdated,this)}},{key:"unregisterListeners",value:function(){var e=this.hls;e&&(e.off(M.ERROR,this.onError,this),e.off(M.ERROR,this.onErrorOut,this),e.off(M.MANIFEST_LOADING,this.onManifestLoading,this),e.off(M.LEVEL_UPDATED,this.onLevelUpdated,this))}},{key:"destroy",value:function(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}}},{key:"startLoad",value:function(e){this.playlistError=0}},{key:"stopLoad",value:function(){}},{key:"getVariantLevelIndex",value:function(e){return(null==e?void 0:e.type)===St?e.level:this.hls.loadLevel}},{key:"onManifestLoading",value:function(){this.playlistError=0,this.penalizedRenditions={}}},{key:"onLevelUpdated",value:function(){this.playlistError=0}},{key:"onError",value:function(e,t){var r,n;if(!t.fatal){var i=this.hls,a=t.context;switch(t.details){case N.FRAG_LOAD_ERROR:case N.FRAG_LOAD_TIMEOUT:case N.KEY_LOAD_ERROR:case N.KEY_LOAD_TIMEOUT:return void(t.errorAction=this.getFragRetryOrSwitchAction(t));case N.FRAG_PARSING_ERROR:if(null!=(r=t.frag)&&r.gap)return void(t.errorAction={action:0,flags:0});case N.FRAG_GAP:case N.FRAG_DECRYPT_ERROR:return t.errorAction=this.getFragRetryOrSwitchAction(t),void(t.errorAction.action=2);case N.LEVEL_EMPTY_ERROR:case N.LEVEL_PARSING_ERROR:var s,o,l=t.parent===St?t.level:i.loadLevel;return void(t.details===N.LEVEL_EMPTY_ERROR&&null!=(s=t.context)&&null!=(o=s.levelDetails)&&o.live?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,l):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,l)));case N.LEVEL_LOAD_ERROR:case N.LEVEL_LOAD_TIMEOUT:return void("number"==typeof(null==a?void 0:a.level)&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,a.level)));case N.AUDIO_TRACK_LOAD_ERROR:case N.AUDIO_TRACK_LOAD_TIMEOUT:case N.SUBTITLE_LOAD_ERROR:case N.SUBTITLE_TRACK_LOAD_TIMEOUT:if(a){var u=i.levels[i.loadLevel];if(u&&(a.type===_t&&a.groupId===u.audioGroupId||a.type===wt&&a.groupId===u.textGroupId))return t.errorAction=this.getPlaylistRetryOrSwitchAction(t,i.loadLevel),t.errorAction.action=2,void(t.errorAction.flags=1)}return;case N.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:var c=i.levels[i.loadLevel],d=null==c?void 0:c.attrs["HDCP-LEVEL"];return void(d&&(t.errorAction={action:2,flags:2,hdcpLevel:d}));case N.BUFFER_ADD_CODEC_ERROR:case N.REMUX_ALLOC_ERROR:return void(t.errorAction=this.getLevelSwitchAction(t,null!=(n=t.level)?n:i.loadLevel));case N.INTERNAL_EXCEPTION:case N.BUFFER_APPENDING_ERROR:case N.BUFFER_APPEND_ERROR:case N.BUFFER_FULL_ERROR:case N.LEVEL_SWITCH_ERROR:case N.BUFFER_STALLED_ERROR:case N.BUFFER_SEEK_OVER_HOLE:case N.BUFFER_NUDGE_ON_STALL:return void(t.errorAction={action:0,flags:0})}if(t.type===O.KEY_SYSTEM_ERROR){var f=this.getVariantLevelIndex(t.frag);return t.levelRetry=!1,void(t.errorAction=this.getLevelSwitchAction(t,f))}}}},{key:"getPlaylistRetryOrSwitchAction",value:function(e,t){var r,n=$t(this.hls.config.playlistLoadPolicy,e),i=this.playlistError++,a=null==(r=e.response)?void 0:r.code;if(tr(n,i,Qt(e),a))return{action:5,flags:0,retryConfig:n,retryCount:i};var s=this.getLevelSwitchAction(e,t);return n&&(s.retryConfig=n,s.retryCount=i),s}},{key:"getFragRetryOrSwitchAction",value:function(e){var t=this.hls,r=this.getVariantLevelIndex(e.frag),n=t.levels[r],i=t.config,a=i.fragLoadPolicy,s=i.keyLoadPolicy,o=$t(e.details.startsWith("key")?s:a,e),l=t.levels.reduce((function(e,t){return e+t.fragmentError}),0);if(n){var u;e.details!==N.FRAG_GAP&&n.fragmentError++;var c=null==(u=e.response)?void 0:u.code;if(tr(o,l,Qt(e),c))return{action:5,flags:0,retryConfig:o,retryCount:l}}var d=this.getLevelSwitchAction(e,r);return o&&(d.retryConfig=o,d.retryCount=l),d}},{key:"getLevelSwitchAction",value:function(e,t){var r=this.hls;null==t&&(t=r.loadLevel);var n=this.hls.levels[t];if(n&&(n.loadError++,r.autoLevelEnabled)){for(var i,a,s=-1,o=r.levels,l=r.loadLevel,u=r.minAutoLevel,c=r.maxAutoLevel,d=null==(i=e.frag)?void 0:i.type,f=null!=(a=e.context)?a:{},h=f.type,v=f.groupId,g=o.length;g--;){var p=(g+l)%o.length;if(p!==l&&p>=u&&p<=c&&0===o[p].loadError){var m=o[p];if(e.details===N.FRAG_GAP&&e.frag){var y=o[p].details;if(y){var b=nr(e.frag,y.fragments,e.frag.start);if(null!=b&&b.gap)continue}}else{if(h===_t&&v===m.audioGroupId||h===wt&&v===m.textGroupId)continue;if(d===Lt&&n.audioGroupId===m.audioGroupId||d===Rt&&n.textGroupId===m.textGroupId)continue}s=p;break}}if(s>-1&&r.loadLevel!==s)return e.levelRetry=!0,this.playlistError=0,{action:2,flags:0,nextAutoLevel:s}}return{action:2,flags:1}}},{key:"onErrorOut",value:function(e,t){var r;switch(null==(r=t.errorAction)?void 0:r.action){case 0:break;case 2:this.sendAlternateToPenaltyBox(t),t.errorAction.resolved||t.details===N.FRAG_GAP||(t.fatal=!0)}t.fatal&&this.hls.stopLoad()}},{key:"sendAlternateToPenaltyBox",value:function(e){var t=this.hls,r=e.errorAction;if(r){var n=r.flags,i=r.hdcpLevel,a=r.nextAutoLevel;switch(n){case 0:this.switchLevel(e,a);break;case 1:r.resolved||(r.resolved=this.redundantFailover(e));break;case 2:i&&(t.maxHdcpLevel=Gt[Gt.indexOf(i)-1],r.resolved=!0),this.warn('Restricting playback to HDCP-LEVEL of "'.concat(t.maxHdcpLevel,'" or lower'))}r.resolved||this.switchLevel(e,a)}}},{key:"switchLevel",value:function(e,t){void 0!==t&&e.errorAction&&(this.warn("switching to level ".concat(t," after ").concat(e.details)),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel)}},{key:"redundantFailover",value:function(e){var t=this,r=this.hls,n=this.penalizedRenditions,i=e.parent===St?e.level:r.loadLevel,a=r.levels[i],s=a.url.length,o=e.frag?e.frag.urlId:a.urlId;a.urlId!==o||e.frag&&!a.details||this.penalizeRendition(a,e);for(var l=function(){var l=(o+u)%s,c=n[l];if(!c||function(e,t,r){if(performance.now()-e.lastErrorPerfMs>3e5)return!0;var n=e.details;if(t.details===N.FRAG_GAP&&n&&t.frag){var i=t.frag.start,a=nr(null,n.fragments,i);if(a&&!a.gap)return!0}if(r&&e.errors.length<r.errors.length){var s=e.errors[e.errors.length-1];if(n&&s.frag&&t.frag&&Math.abs(s.frag.start-t.frag.start)>3*n.targetduration)return!0}return!1}(c,e,n[o]))return t.warn("Switching to Redundant Stream ".concat(l+1,"/").concat(s,': "').concat(a.url[l],'" after ').concat(e.details)),t.playlistError=0,r.levels.forEach((function(e){e.urlId=l})),r.nextLoadLevel=i,{v:!0}},u=1;u<s;u++){var c=l();if("object"===(0,m.Z)(c))return c.v}return!1}},{key:"penalizeRendition",value:function(e,t){var r=this.penalizedRenditions,n=r[e.urlId]||{lastErrorPerfMs:0,errors:[],details:void 0};n.lastErrorPerfMs=performance.now(),n.errors.push(t),n.details=e.details,r[e.urlId]=n}}]),e}(),lr=function(){function e(t,r){(0,g.Z)(this,e),this.hls=void 0,this.timer=-1,this.requestScheduled=-1,this.canLoad=!1,this.log=void 0,this.warn=void 0,this.log=G.log.bind(G,"".concat(r,":")),this.warn=G.warn.bind(G,"".concat(r,":")),this.hls=t}return(0,p.Z)(e,[{key:"destroy",value:function(){this.clearTimer(),this.hls=this.log=this.warn=null}},{key:"clearTimer",value:function(){clearTimeout(this.timer),this.timer=-1}},{key:"startLoad",value:function(){this.canLoad=!0,this.requestScheduled=-1,this.loadPlaylist()}},{key:"stopLoad",value:function(){this.canLoad=!1,this.clearTimer()}},{key:"switchParams",value:function(e,t){var r=null==t?void 0:t.renditionReports;if(r){for(var n=-1,i=0;i<r.length;i++){var a=r[i],s=void 0;try{s=new self.URL(a.URI,t.url).href}catch(e){G.warn("Could not construct new URL for Rendition Report: ".concat(e)),s=a.URI||""}if(s===e){n=i;break}s===e.substring(0,s.length)&&(n=i)}if(-1!==n){var o=r[n],l=parseInt(o["LAST-MSN"])||(null==t?void 0:t.lastPartSn),u=parseInt(o["LAST-PART"])||(null==t?void 0:t.lastPartIndex);if(this.hls.config.lowLatencyMode){var c=Math.min(t.age-t.partTarget,t.targetduration);u>=0&&c>t.partTarget&&(u+=1)}return new Kt(l,u>=0?u:void 0,"")}}}},{key:"loadPlaylist",value:function(e){-1===this.requestScheduled&&(this.requestScheduled=self.performance.now())}},{key:"shouldLoadPlaylist",value:function(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}},{key:"shouldReloadPlaylist",value:function(e){return-1===this.timer&&-1===this.requestScheduled&&this.shouldLoadPlaylist(e)}},{key:"playlistLoaded",value:function(e,t,r){var n=this,i=t.details,a=t.stats,s=self.performance.now(),o=a.loading.first?Math.max(0,s-a.loading.first):0;if(i.advancedDateTime=Date.now()-o,i.live||null!=r&&r.live){if(i.reloaded(r),r&&this.log("live playlist ".concat(e," ").concat(i.advanced?"REFRESHED "+i.lastPartSn+"-"+i.lastPartIndex:i.updated?"UPDATED":"MISSED")),r&&i.fragments.length>0&&function(e,t){for(var r=null,n=e.fragments,i=n.length-1;i>=0;i--){var a=n[i].initSegment;if(a){r=a;break}}e.fragmentHint&&delete e.fragmentHint.endPTS;var s,o,l,u,c,d=0;if(function(e,t,r){for(var n=t.skippedSegments,i=Math.max(e.startSN,t.startSN)-t.startSN,a=(e.fragmentHint?1:0)+(n?t.endSN:Math.min(e.endSN,t.endSN))-t.startSN,s=t.startSN-e.startSN,o=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments,l=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,u=i;u<=a;u++){var c=l[s+u],d=o[u];n&&!d&&u<n&&(d=t.fragments[u]=c),c&&d&&r(c,d)}}(e,t,(function(e,n){e.relurl&&(d=e.cc-n.cc),P(e.startPTS)&&P(e.endPTS)&&(n.start=n.startPTS=e.startPTS,n.startDTS=e.startDTS,n.maxStartPTS=e.maxStartPTS,n.endPTS=e.endPTS,n.endDTS=e.endDTS,n.minEndPTS=e.minEndPTS,n.duration=e.endPTS-e.startPTS,n.duration&&(s=n),t.PTSKnown=t.alignedSliding=!0),n.elementaryStreams=e.elementaryStreams,n.loader=e.loader,n.stats=e.stats,n.urlId=e.urlId,e.initSegment&&(n.initSegment=e.initSegment,r=e.initSegment)})),r&&(t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments).forEach((function(e){var t;e.initSegment&&e.initSegment.relurl!==(null==(t=r)?void 0:t.relurl)||(e.initSegment=r)})),t.skippedSegments)if(t.deltaUpdateFailed=t.fragments.some((function(e){return!e})),t.deltaUpdateFailed){G.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var f=t.skippedSegments;f--;)t.fragments.shift();t.startSN=t.fragments[0].sn,t.startCC=t.fragments[0].cc}else t.canSkipDateRanges&&(t.dateRanges=(o=e.dateRanges,l=t.dateRanges,u=t.recentlyRemovedDateranges,c=C({},o),u&&u.forEach((function(e){delete c[e]})),Object.keys(l).forEach((function(e){var t=new q(l[e].attr,c[e]);t.isValid?c[e]=t:G.warn('Ignoring invalid Playlist Delta Update DATERANGE tag: "'.concat(JSON.stringify(l[e].attr),'"'))})),c));var h=t.fragments;if(d){G.warn("discontinuity sliding from playlist, take drift into account");for(var v=0;v<h.length;v++)h[v].cc+=d}t.skippedSegments&&(t.startCC=t.fragments[0].cc),function(e,t,r){if(e&&t)for(var n=0,i=0,a=e.length;i<=a;i++){var s=e[i],o=t[i+n];s&&o&&s.index===o.index&&s.fragment.sn===o.fragment.sn?r(s,o):n--}}(e.partList,t.partList,(function(e,t){t.elementaryStreams=e.elementaryStreams,t.stats=e.stats})),s?Vt(t,s,s.startPTS,s.endPTS,s.startDTS,s.endDTS):qt(e,t),h.length&&(t.totalduration=t.edge-h[0].start),t.driftStartTime=e.driftStartTime,t.driftStart=e.driftStart;var g=t.advancedDateTime;if(t.advanced&&g){var p=t.edge;t.driftStart||(t.driftStartTime=g,t.driftStart=p),t.driftEndTime=g,t.driftEnd=p}else t.driftEndTime=e.driftEndTime,t.driftEnd=e.driftEnd,t.advancedDateTime=e.advancedDateTime}(r,i),!this.canLoad||!i.live)return;var l,u=void 0,c=void 0;if(i.canBlockReload&&i.endSN&&i.advanced){var d=this.hls.config.lowLatencyMode,f=i.lastPartSn,h=i.endSN,v=i.lastPartIndex,g=f===h;-1!==v?(u=g?h+1:f,c=g?d?0:v:v+1):u=h+1;var p=i.age,m=p+i.ageHeader,y=Math.min(m-i.partTarget,1.5*i.targetduration);if(y>0){if(r&&y>r.tuneInGoal)this.warn("CDN Tune-in goal increased from: ".concat(r.tuneInGoal," to: ").concat(y," with playlist age: ").concat(i.age)),y=0;else{var b=Math.floor(y/i.targetduration);u+=b,void 0!==c&&(c+=Math.round(y%i.targetduration/i.partTarget)),this.log("CDN Tune-in age: ".concat(i.ageHeader,"s last advanced ").concat(p.toFixed(2),"s goal: ").concat(y," skip sn ").concat(b," to part ").concat(c))}i.tuneInGoal=y}if(l=this.getDeliveryDirectives(i,t.deliveryDirectives,u,c),d||!g)return void this.loadPlaylist(l)}else(i.canBlockReload||i.canSkipUntil)&&(l=this.getDeliveryDirectives(i,t.deliveryDirectives,u,c));var k=this.hls.mainForwardBufferInfo,E=k?k.end-k.len:0,T=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0,r=1e3*e.targetduration;if(e.updated){var n=e.fragments,i=4;if(n.length&&r*i>t){var a=1e3*n[n.length-1].duration;a<r&&(r=a)}}else r/=2;return Math.round(r)}(i,1e3*(i.edge-E));i.updated&&s>this.requestScheduled+T&&(this.requestScheduled=a.loading.start),void 0!==u&&i.canBlockReload?this.requestScheduled=a.loading.first+T-(1e3*i.partTarget||1e3):-1===this.requestScheduled||this.requestScheduled+T<s?this.requestScheduled=s:this.requestScheduled-s<=0&&(this.requestScheduled+=T);var _=this.requestScheduled-s;_=Math.max(0,_),this.log("reload live playlist ".concat(e," in ").concat(Math.round(_)," ms")),this.timer=self.setTimeout((function(){return n.loadPlaylist(l)}),_)}else this.clearTimer()}},{key:"getDeliveryDirectives",value:function(e,t,r,n){var i=function(e,t){var r=e.canSkipUntil,n=e.canSkipDateRanges,i=e.endSN;return r&&(void 0!==t?t-i:0)<r?n?"v2":"YES":""}(e,r);return null!=t&&t.skip&&e.deltaUpdateFailed&&(r=t.msn,n=t.part,i=""),new Kt(r,n,i)}},{key:"checkRetry",value:function(e){var t=this,r=e.details,n=Qt(e),i=e.errorAction,a=i||{},s=a.action,o=a.retryCount,l=void 0===o?0:o,u=a.retryConfig,c=!!i&&!!u&&(5===s||!i.resolved&&2===s);if(c){var d;if(this.requestScheduled=-1,l>=u.maxNumRetry)return!1;if(n&&null!=(d=e.context)&&d.deliveryDirectives)this.warn("Retrying playlist loading ".concat(l+1,"/").concat(u.maxNumRetry,' after "').concat(r,'" without delivery-directives')),this.loadPlaylist();else{var f=Jt(u,l);this.timer=self.setTimeout((function(){return t.loadPlaylist()}),f),this.warn("Retrying playlist loading ".concat(l+1,"/").concat(u.maxNumRetry,' after "').concat(r,'" in ').concat(f,"ms"))}e.levelRetry=!0,i.resolved=!0}return c}}]),e}(),ur=function(e){(0,d.Z)(r,e);var t=k(r);function r(e,n){var i;return(0,g.Z)(this,r),(i=t.call(this,e,"[level-controller]"))._levels=[],i._firstLevel=-1,i._startLevel=void 0,i.currentLevel=null,i.currentLevelIndex=-1,i.manualLevelIndex=-1,i.steering=void 0,i.onParsedComplete=void 0,i.steering=n,i._registerListeners(),i}return(0,p.Z)(r,[{key:"_registerListeners",value:function(){var e=this.hls;e.on(M.MANIFEST_LOADING,this.onManifestLoading,this),e.on(M.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(M.LEVEL_LOADED,this.onLevelLoaded,this),e.on(M.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(M.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(M.FRAG_LOADED,this.onFragLoaded,this),e.on(M.ERROR,this.onError,this)}},{key:"_unregisterListeners",value:function(){var e=this.hls;e.off(M.MANIFEST_LOADING,this.onManifestLoading,this),e.off(M.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(M.LEVEL_LOADED,this.onLevelLoaded,this),e.off(M.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(M.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(M.FRAG_LOADED,this.onFragLoaded,this),e.off(M.ERROR,this.onError,this)}},{key:"destroy",value:function(){this._unregisterListeners(),this.steering=null,this.resetLevels(),(0,c.Z)((0,h.Z)(r.prototype),"destroy",this).call(this)}},{key:"startLoad",value:function(){this._levels.forEach((function(e){e.loadError=0,e.fragmentError=0})),(0,c.Z)((0,h.Z)(r.prototype),"startLoad",this).call(this)}},{key:"resetLevels",value:function(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[]}},{key:"onManifestLoading",value:function(e,t){this.resetLevels()}},{key:"onManifestLoaded",value:function(e,t){var r,n=[],i={};t.levels.forEach((function(e){var t,a=e.attrs;-1!==(null==(t=e.audioCodec)?void 0:t.indexOf("mp4a.40.34"))&&(sr||(sr=/chrome|firefox/i.test(navigator.userAgent)),sr&&(e.audioCodec=void 0));var s=a.AUDIO,o=a.CODECS,l=a["FRAME-RATE"],u=a["PATHWAY-ID"],c=a.RESOLUTION,d=a.SUBTITLES,f="".concat(u||".","-"),h="".concat(f).concat(e.bitrate,"-").concat(c,"-").concat(l,"-").concat(o);(r=i[h])?r.addFallback(e):(r=new Ht(e),i[h]=r,n.push(r)),cr(r,"audio",s),cr(r,"text",d)})),this.filterAndSortMediaOptions(n,t)}},{key:"filterAndSortMediaOptions",value:function(e,t){var r=this,n=[],i=[],a=!1,s=!1,o=!1,l=e.filter((function(e){var t=e.audioCodec,r=e.videoCodec,n=e.width,i=e.height,l=e.unknownCodecs;return a||(a=!(!n||!i)),s||(s=!!r),o||(o=!!t),!(null!=l&&l.length)&&(!t||ot(t,"audio"))&&(!r||ot(r,"video"))}));if((a||s)&&o&&(l=l.filter((function(e){var t=e.videoCodec,r=e.width,n=e.height;return!!t||!(!r||!n)}))),0!==l.length){t.audioTracks&&dr(n=t.audioTracks.filter((function(e){return!e.audioCodec||ot(e.audioCodec,"audio")}))),t.subtitles&&dr(i=t.subtitles);var u=l.slice(0);l.sort((function(e,t){return e.attrs["HDCP-LEVEL"]!==t.attrs["HDCP-LEVEL"]?(e.attrs["HDCP-LEVEL"]||"")>(t.attrs["HDCP-LEVEL"]||"")?1:-1:e.bitrate!==t.bitrate?e.bitrate-t.bitrate:e.attrs["FRAME-RATE"]!==t.attrs["FRAME-RATE"]?e.attrs.decimalFloatingPoint("FRAME-RATE")-t.attrs.decimalFloatingPoint("FRAME-RATE"):e.attrs.SCORE!==t.attrs.SCORE?e.attrs.decimalFloatingPoint("SCORE")-t.attrs.decimalFloatingPoint("SCORE"):a&&e.height!==t.height?e.height-t.height:0}));var c=u[0];if(this.steering&&(l=this.steering.filterParsedLevels(l)).length!==u.length)for(var d=0;d<u.length;d++)if(u[d].pathwayId===l[0].pathwayId){c=u[d];break}this._levels=l;for(var f=0;f<l.length;f++)if(l[f]===c){this._firstLevel=f,this.log("manifest loaded, ".concat(l.length," level(s) found, first bitrate: ").concat(c.bitrate));break}var h=o&&!s,v={levels:l,audioTracks:n,subtitleTracks:i,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:o,video:s,altAudio:!h&&n.some((function(e){return!!e.url}))};this.hls.trigger(M.MANIFEST_PARSED,v),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else Promise.resolve().then((function(){if(r.hls){var e=new Error("no level with compatible codecs found in manifest");r.hls.trigger(M.ERROR,{type:O.MEDIA_ERROR,details:N.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:e,reason:e.message})}}))}},{key:"levels",get:function(){return 0===this._levels.length?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(e){var t=this._levels;if(0!==t.length){if(e<0||e>=t.length){var r=new Error("invalid level idx"),n=e<0;if(this.hls.trigger(M.ERROR,{type:O.OTHER_ERROR,details:N.LEVEL_SWITCH_ERROR,level:e,fatal:n,error:r,reason:r.message}),n)return;e=Math.min(e,t.length-1)}var i=this.currentLevelIndex,a=this.currentLevel,s=a?a.attrs["PATHWAY-ID"]:void 0,o=t[e],l=o.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=o,i!==e||!o.details||!a||s!==l){this.log("Switching to level ".concat(e).concat(l?" with Pathway "+l:""," from level ").concat(i).concat(s?" with Pathway "+s:""));var u=C({},o,{level:e,maxBitrate:o.maxBitrate,attrs:o.attrs,uri:o.uri,urlId:o.urlId});delete u._attrs,delete u._urlId,this.hls.trigger(M.LEVEL_SWITCHING,u);var c=o.details;if(!c||c.live){var d=this.switchParams(o.uri,null==a?void 0:a.details);this.loadPlaylist(d)}}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(e){this.manualLevelIndex=e,void 0===this._startLevel&&(this._startLevel=e),-1!==e&&(this.level=e)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(e){this._firstLevel=e}},{key:"startLevel",get:function(){if(void 0===this._startLevel){var e=this.hls.config.startLevel;return void 0!==e?e:this._firstLevel}return this._startLevel},set:function(e){this._startLevel=e}},{key:"onError",value:function(e,t){!t.fatal&&t.context&&t.context.type===Tt&&t.context.level===this.level&&this.checkRetry(t)}},{key:"onFragLoaded",value:function(e,t){var r=t.frag;if(void 0!==r&&r.type===St){var n=this._levels[r.level];void 0!==n&&(n.loadError=0)}}},{key:"onLevelLoaded",value:function(e,t){var r,n,i=t.level,a=t.details,s=this._levels[i];if(!s)return this.warn("Invalid level index ".concat(i)),void(null!=(n=t.deliveryDirectives)&&n.skip&&(a.deltaUpdateFailed=!0));i===this.currentLevelIndex?(0===s.fragmentError&&(s.loadError=0),this.playlistLoaded(i,t,s.details)):null!=(r=t.deliveryDirectives)&&r.skip&&(a.deltaUpdateFailed=!0)}},{key:"onAudioTrackSwitched",value:function(e,t){var r=this.currentLevel;if(r){var n=this.hls.audioTracks[t.id].groupId;if(r.audioGroupIds&&r.audioGroupId!==n){for(var i=-1,a=0;a<r.audioGroupIds.length;a++)if(r.audioGroupIds[a]===n){i=a;break}-1!==i&&i!==r.urlId&&(r.urlId=i,this.canLoad&&this.startLoad())}}}},{key:"loadPlaylist",value:function(e){(0,c.Z)((0,h.Z)(r.prototype),"loadPlaylist",this).call(this);var t=this.currentLevelIndex,n=this.currentLevel;if(n&&this.shouldLoadPlaylist(n)){var i=n.urlId,a=n.uri;if(e)try{a=e.addDirectives(a)}catch(e){this.warn("Could not construct new URL with HLS Delivery Directives: ".concat(e))}var s=n.attrs["PATHWAY-ID"];this.log("Loading level index ".concat(t).concat(void 0!==(null==e?void 0:e.msn)?" at sn "+e.msn+" part "+e.part:""," with").concat(s?" Pathway "+s:""," URI ").concat(i+1,"/").concat(n.url.length," ").concat(a)),this.clearTimer(),this.hls.trigger(M.LEVEL_LOADING,{url:a,level:t,id:i,deliveryDirectives:e||null})}}},{key:"nextLoadLevel",get:function(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(e){this.level=e,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=e)}},{key:"removeLevel",value:function(e,t){var r=this,n=function(e,r){return r!==t},i=this._levels.filter((function(i,a){return a!==e||(i.url.length>1&&void 0!==t?(i.url=i.url.filter(n),i.audioGroupIds&&(i.audioGroupIds=i.audioGroupIds.filter(n)),i.textGroupIds&&(i.textGroupIds=i.textGroupIds.filter(n)),i.urlId=0,!0):(r.steering&&r.steering.removeLevel(i),!1))}));this.hls.trigger(M.LEVELS_UPDATED,{levels:i})}},{key:"onLevelsUpdated",value:function(e,t){var r=t.levels;r.forEach((function(e,t){var r=e.details;null!=r&&r.fragments&&r.fragments.forEach((function(e){e.level=t}))})),this._levels=r}}]),r}(lr);function cr(e,t,r){r&&("audio"===t?(e.audioGroupIds||(e.audioGroupIds=[]),e.audioGroupIds[e.url.length-1]=r):"text"===t&&(e.textGroupIds||(e.textGroupIds=[]),e.textGroupIds[e.url.length-1]=r))}function dr(e){var t={};e.forEach((function(e){var r=e.groupId||"";e.id=t[r]=t[r]||0,t[r]++}))}var fr="NOT_LOADED",hr="APPENDING",vr="PARTIAL",gr="OK",pr=function(){function e(t){(0,g.Z)(this,e),this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=t,this._registerListeners()}return(0,p.Z)(e,[{key:"_registerListeners",value:function(){var e=this.hls;e.on(M.BUFFER_APPENDED,this.onBufferAppended,this),e.on(M.FRAG_BUFFERED,this.onFragBuffered,this),e.on(M.FRAG_LOADED,this.onFragLoaded,this)}},{key:"_unregisterListeners",value:function(){var e=this.hls;e.off(M.BUFFER_APPENDED,this.onBufferAppended,this),e.off(M.FRAG_BUFFERED,this.onFragBuffered,this),e.off(M.FRAG_LOADED,this.onFragLoaded,this)}},{key:"destroy",value:function(){this._unregisterListeners(),this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}},{key:"getAppendedFrag",value:function(e,t){var r=this.activePartLists[t];if(r)for(var n=r.length;n--;){var i=r[n];if(!i)break;var a=i.end;if(i.start<=e&&null!==a&&e<=a)return i}return this.getBufferedFrag(e,t)}},{key:"getBufferedFrag",value:function(e,t){for(var r=this.fragments,n=Object.keys(r),i=n.length;i--;){var a=r[n[i]];if((null==a?void 0:a.body.type)===t&&a.buffered){var s=a.body;if(s.start<=e&&e<=s.end)return s}}return null}},{key:"detectEvictedFragments",value:function(e,t,r,n){var i=this;this.timeRanges&&(this.timeRanges[e]=t);var a=(null==n?void 0:n.fragment.sn)||-1;Object.keys(this.fragments).forEach((function(n){var s=i.fragments[n];if(s&&!(a>=s.body.sn))if(s.buffered||s.loaded){var o=s.range[e];o&&o.time.some((function(e){var r=!i.isTimeBuffered(e.startPTS,e.endPTS,t);return r&&i.removeFragment(s.body),r}))}else s.body.type===r&&i.removeFragment(s.body)}))}},{key:"detectPartialFragments",value:function(e){var t=this,r=this.timeRanges,n=e.frag,i=e.part;if(r&&"initSegment"!==n.sn){var a=yr(n),s=this.fragments[a];if(!(!s||s.buffered&&n.gap)){var o=!n.relurl;Object.keys(r).forEach((function(e){var a=n.elementaryStreams[e];if(a){var l=r[e],u=o||!0===a.partial;s.range[e]=t.getBufferedTimes(n,i,u,l)}})),s.loaded=null,Object.keys(s.range).length?(s.buffered=!0,(s.body.endList=n.endList||s.body.endList)&&(this.endListFragments[s.body.type]=s),mr(s)||this.removeParts(n.sn-1,n.type)):this.removeFragment(s.body)}}}},{key:"removeParts",value:function(e,t){var r=this.activePartLists[t];r&&(this.activePartLists[t]=r.filter((function(t){return t.fragment.sn>=e})))}},{key:"fragBuffered",value:function(e,t){var r=yr(e),n=this.fragments[r];!n&&t&&(n=this.fragments[r]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),n&&(n.loaded=null,n.buffered=!0)}},{key:"getBufferedTimes",value:function(e,t,r,n){for(var i={time:[],partial:r},a=e.start,s=e.end,o=e.minEndPTS||s,l=e.maxStartPTS||a,u=0;u<n.length;u++){var c=n.start(u)-this.bufferPadding,d=n.end(u)+this.bufferPadding;if(l>=c&&o<=d){i.time.push({startPTS:Math.max(a,n.start(u)),endPTS:Math.min(s,n.end(u))});break}if(a<d&&s>c)i.partial=!0,i.time.push({startPTS:Math.max(a,n.start(u)),endPTS:Math.min(s,n.end(u))});else if(s<=c)break}return i}},{key:"getPartialFragment",value:function(e){var t,r,n,i=null,a=0,s=this.bufferPadding,o=this.fragments;return Object.keys(o).forEach((function(l){var u=o[l];u&&mr(u)&&(r=u.body.start-s,n=u.body.end+s,e>=r&&e<=n&&(t=Math.min(e-r,n-e),a<=t&&(i=u.body,a=t)))})),i}},{key:"isEndListAppended",value:function(e){var t=this.endListFragments[e];return void 0!==t&&(t.buffered||mr(t))}},{key:"getState",value:function(e){var t=yr(e),r=this.fragments[t];return r?r.buffered?mr(r)?vr:gr:hr:fr}},{key:"isTimeBuffered",value:function(e,t,r){for(var n,i,a=0;a<r.length;a++){if(n=r.start(a)-this.bufferPadding,i=r.end(a)+this.bufferPadding,e>=n&&t<=i)return!0;if(t<=n)return!1}return!1}},{key:"onFragLoaded",value:function(e,t){var r=t.frag,n=t.part;if("initSegment"!==r.sn&&!r.bitrateTest){var i=n?null:t,a=yr(r);this.fragments[a]={body:r,appendedPTS:null,loaded:i,buffered:!1,range:Object.create(null)}}}},{key:"onBufferAppended",value:function(e,t){var r=this,n=t.frag,i=t.part,a=t.timeRanges;if("initSegment"!==n.sn){var s=n.type;if(i){var o=this.activePartLists[s];o||(this.activePartLists[s]=o=[]),o.push(i)}this.timeRanges=a,Object.keys(a).forEach((function(e){var t=a[e];r.detectEvictedFragments(e,t,s,i)}))}}},{key:"onFragBuffered",value:function(e,t){this.detectPartialFragments(t)}},{key:"hasFragment",value:function(e){var t=yr(e);return!!this.fragments[t]}},{key:"hasParts",value:function(e){var t;return!(null==(t=this.activePartLists[e])||!t.length)}},{key:"removeFragmentsInRange",value:function(e,t,r,n,i){var a=this;n&&!this.hasGaps||Object.keys(this.fragments).forEach((function(s){var o=a.fragments[s];if(o){var l=o.body;l.type!==r||n&&!l.gap||l.start<t&&l.end>e&&(o.buffered||i)&&a.removeFragment(l)}}))}},{key:"removeFragment",value:function(e){var t=yr(e);e.stats.loaded=0,e.clearElementaryStreamInfo();var r=this.activePartLists[e.type];if(r){var n=e.sn;this.activePartLists[e.type]=r.filter((function(e){return e.fragment.sn!==n}))}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}},{key:"removeAllFragments",value:function(){this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1}}]),e}();function mr(e){var t,r,n;return e.buffered&&(e.body.gap||(null==(t=e.range.video)?void 0:t.partial)||(null==(r=e.range.audio)?void 0:r.partial)||(null==(n=e.range.audiovideo)?void 0:n.partial))}function yr(e){return"".concat(e.type,"_").concat(e.level,"_").concat(e.urlId,"_").concat(e.sn)}var br=Math.pow(2,17),kr=function(){function e(t){(0,g.Z)(this,e),this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=t}return(0,p.Z)(e,[{key:"destroy",value:function(){this.loader&&(this.loader.destroy(),this.loader=null)}},{key:"abort",value:function(){this.loader&&this.loader.abort()}},{key:"load",value:function(e,t){var r=this,n=e.url;if(!n)return Promise.reject(new _r({type:O.NETWORK_ERROR,details:N.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error("Fragment does not have a ".concat(n?"part list":"url")),networkDetails:null}));this.abort();var i=this.config,a=i.fLoader,s=i.loader;return new Promise((function(o,l){if(r.loader&&r.loader.destroy(),e.gap){if(e.tagList.some((function(e){return"GAP"===e[0]})))return void l(Tr(e));e.gap=!1}var u=r.loader=e.loader=a?new a(i):new s(i),c=Er(e),d=er(i.fragLoadPolicy.default),f={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:"initSegment"===e.sn?1/0:br};e.stats=u.stats,u.load(c,f,{onSuccess:function(t,n,i,a){r.resetLoader(e,u);var s=t.data;i.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(s.slice(0,16)),s=s.slice(16)),o({frag:e,part:null,payload:s,networkDetails:a})},onError:function(t,i,a,s){r.resetLoader(e,u),l(new _r({type:O.NETWORK_ERROR,details:N.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:I({url:n,data:void 0},t),error:new Error("HTTP Error ".concat(t.code," ").concat(t.text)),networkDetails:a,stats:s}))},onAbort:function(t,n,i){r.resetLoader(e,u),l(new _r({type:O.NETWORK_ERROR,details:N.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:i,stats:t}))},onTimeout:function(t,n,i){r.resetLoader(e,u),l(new _r({type:O.NETWORK_ERROR,details:N.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error("Timeout after ".concat(f.timeout,"ms")),networkDetails:i,stats:t}))},onProgress:function(r,n,i,a){t&&t({frag:e,part:null,payload:i,networkDetails:a})}})}))}},{key:"loadPart",value:function(e,t,r){var n=this;this.abort();var i=this.config,a=i.fLoader,s=i.loader;return new Promise((function(o,l){if(n.loader&&n.loader.destroy(),e.gap||t.gap)l(Tr(e,t));else{var u=n.loader=e.loader=a?new a(i):new s(i),c=Er(e,t),d=er(i.fragLoadPolicy.default),f={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:br};t.stats=u.stats,u.load(c,f,{onSuccess:function(i,a,s,l){n.resetLoader(e,u),n.updateStatsFromPart(e,t);var c={frag:e,part:t,payload:i.data,networkDetails:l};r(c),o(c)},onError:function(r,i,a,s){n.resetLoader(e,u),l(new _r({type:O.NETWORK_ERROR,details:N.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:I({url:c.url,data:void 0},r),error:new Error("HTTP Error ".concat(r.code," ").concat(r.text)),networkDetails:a,stats:s}))},onAbort:function(r,i,a){e.stats.aborted=t.stats.aborted,n.resetLoader(e,u),l(new _r({type:O.NETWORK_ERROR,details:N.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:a,stats:r}))},onTimeout:function(r,i,a){n.resetLoader(e,u),l(new _r({type:O.NETWORK_ERROR,details:N.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error("Timeout after ".concat(f.timeout,"ms")),networkDetails:a,stats:r}))}})}}))}},{key:"updateStatsFromPart",value:function(e,t){var r=e.stats,n=t.stats,i=n.total;if(r.loaded+=n.loaded,i){var a=Math.round(e.duration/t.duration),s=Math.min(Math.round(r.loaded/i),a),o=(a-s)*Math.round(r.loaded/s);r.total=r.loaded+o}else r.total=Math.max(r.loaded,r.total);var l=r.loading,u=n.loading;l.start?l.first+=u.first-u.start:(l.start=u.start,l.first=u.first),l.end=u.end}},{key:"resetLoader",value:function(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}]),e}();function Er(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=t||e,n={frag:e,part:t,responseType:"arraybuffer",url:r.url,headers:{},rangeStart:0,rangeEnd:0},i=r.byteRangeStartOffset,a=r.byteRangeEndOffset;if(P(i)&&P(a)){var s,o=i,l=a;if("initSegment"===e.sn&&"AES-128"===(null==(s=e.decryptdata)?void 0:s.method)){var u=a-i;u%16&&(l=a+(16-u%16)),0!==i&&(n.resetIV=!0,o=i-16)}n.rangeStart=o,n.rangeEnd=l}return n}function Tr(e,t){var r=new Error("GAP ".concat(e.gap?"tag":"attribute"," found")),n={type:O.MEDIA_ERROR,details:N.FRAG_GAP,fatal:!1,frag:e,error:r,networkDetails:null};return t&&(n.part=t),(t||e).stats.aborted=!0,new _r(n)}var _r=function(e){(0,d.Z)(r,e);var t=k(r);function r(e){var n;return(0,g.Z)(this,r),(n=t.call(this,e.error.message)).data=void 0,n.data=e,n}return(0,p.Z)(r)}((0,u.Z)(Error)),wr=function(){function e(t){(0,g.Z)(this,e),this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=t}return(0,p.Z)(e,[{key:"abort",value:function(e){for(var t in this.keyUriToKeyInfo){var r=this.keyUriToKeyInfo[t].loader;if(r){if(e&&e!==r.context.frag.type)return;r.abort()}}}},{key:"detach",value:function(){for(var e in this.keyUriToKeyInfo){var t=this.keyUriToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[e]}}},{key:"destroy",value:function(){for(var e in this.detach(),this.keyUriToKeyInfo){var t=this.keyUriToKeyInfo[e].loader;t&&t.destroy()}this.keyUriToKeyInfo={}}},{key:"createKeyLoadError",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:N.KEY_LOAD_ERROR,r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0;return new _r({type:O.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:i,error:r,networkDetails:n})}},{key:"loadClear",value:function(e,t){var r=this;if(this.emeController&&this.config.emeEnabled)for(var n=e.sn,i=e.cc,a=function(){var e=t[s];if(i<=e.cc&&("initSegment"===n||"initSegment"===e.sn||n<e.sn))return r.emeController.selectKeySystemFormat(e).then((function(t){e.setKeyFormat(t)})),"break"},s=0;s<t.length&&"break"!==a();s++);}},{key:"load",value:function(e){var t=this;return!e.decryptdata&&e.encrypted&&this.emeController?this.emeController.selectKeySystemFormat(e).then((function(r){return t.loadInternal(e,r)})):this.loadInternal(e)}},{key:"loadInternal",value:function(e,t){var r,n;t&&e.setKeyFormat(t);var i=e.decryptdata;if(!i){var a=new Error(t?"Expected frag.decryptdata to be defined after setting format ".concat(t):"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(e,N.KEY_LOAD_ERROR,a))}var s=i.uri;if(!s)return Promise.reject(this.createKeyLoadError(e,N.KEY_LOAD_ERROR,new Error('Invalid key URI: "'.concat(s,'"'))));var o,l=this.keyUriToKeyInfo[s];if(null!=(r=l)&&r.decryptdata.key)return i.key=l.decryptdata.key,Promise.resolve({frag:e,keyInfo:l});if(null!=(n=l)&&n.keyLoadPromise)switch(null==(o=l.mediaKeySessionContext)?void 0:o.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return l.keyLoadPromise.then((function(t){return i.key=t.keyInfo.decryptdata.key,{frag:e,keyInfo:l}}))}switch(l=this.keyUriToKeyInfo[s]={decryptdata:i,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},i.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return"identity"===i.keyFormat?this.loadKeyHTTP(l,e):this.loadKeyEME(l,e);case"AES-128":return this.loadKeyHTTP(l,e);default:return Promise.reject(this.createKeyLoadError(e,N.KEY_LOAD_ERROR,new Error('Key supplied with unsupported METHOD: "'.concat(i.method,'"'))))}}},{key:"loadKeyEME",value:function(e,t){var r={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){var n=this.emeController.loadKey(r);if(n)return(e.keyLoadPromise=n.then((function(t){return e.mediaKeySessionContext=t,r}))).catch((function(t){throw e.keyLoadPromise=null,t}))}return Promise.resolve(r)}},{key:"loadKeyHTTP",value:function(e,t){var r=this,n=this.config,i=new(0,n.loader)(n);return t.keyLoader=e.loader=i,e.keyLoadPromise=new Promise((function(a,s){var o={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},l=n.keyLoadPolicy.default,u={loadPolicy:l,timeout:l.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},c={onSuccess:function(e,t,n,i){var o=n.frag,l=n.keyInfo,u=n.url;if(!o.decryptdata||l!==r.keyUriToKeyInfo[u])return s(r.createKeyLoadError(o,N.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),i));l.decryptdata.key=o.decryptdata.key=new Uint8Array(e.data),o.keyLoader=null,l.loader=null,a({frag:o,keyInfo:l})},onError:function(e,n,i,a){r.resetLoader(n),s(r.createKeyLoadError(t,N.KEY_LOAD_ERROR,new Error("HTTP Error ".concat(e.code," loading key ").concat(e.text)),i,I({url:o.url,data:void 0},e)))},onTimeout:function(e,n,i){r.resetLoader(n),s(r.createKeyLoadError(t,N.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),i))},onAbort:function(e,n,i){r.resetLoader(n),s(r.createKeyLoadError(t,N.INTERNAL_ABORTED,new Error("key loading aborted"),i))}};i.load(o,u,c)}))}},{key:"resetLoader",value:function(e){var t=e.frag,r=e.keyInfo,n=e.url,i=r.loader;t.keyLoader===i&&(t.keyLoader=null,r.loader=null),delete this.keyUriToKeyInfo[n],i&&i.destroy()}}]),e}(),Sr=function(){function e(){(0,g.Z)(this,e),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}return(0,p.Z)(e,[{key:"destroy",value:function(){this.onHandlerDestroying(),this.onHandlerDestroyed()}},{key:"onHandlerDestroying",value:function(){this.clearNextTick(),this.clearInterval()}},{key:"onHandlerDestroyed",value:function(){}},{key:"hasInterval",value:function(){return!!this._tickInterval}},{key:"hasNextTick",value:function(){return!!this._tickTimer}},{key:"setInterval",value:function(e){return!this._tickInterval&&(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}},{key:"clearInterval",value:function(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)}},{key:"clearNextTick",value:function(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)}},{key:"tick",value:function(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}},{key:"tickImmediate",value:function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}},{key:"doTick",value:function(){}}]),e}(),Lr={length:0,start:function(){return 0},end:function(){return 0}},Rr=function(){function e(){(0,g.Z)(this,e)}return(0,p.Z)(e,null,[{key:"isBuffered",value:function(t,r){try{if(t)for(var n=e.getBuffered(t),i=0;i<n.length;i++)if(r>=n.start(i)&&r<=n.end(i))return!0}catch(e){}return!1}},{key:"bufferInfo",value:function(t,r,n){try{if(t){var i,a=e.getBuffered(t),s=[];for(i=0;i<a.length;i++)s.push({start:a.start(i),end:a.end(i)});return this.bufferedInfo(s,r,n)}}catch(e){}return{len:0,start:r,end:r,nextStart:void 0}}},{key:"bufferedInfo",value:function(e,t,r){t=Math.max(0,t),e.sort((function(e,t){return e.start-t.start||t.end-e.end}));var n=[];if(r)for(var i=0;i<e.length;i++){var a=n.length;if(a){var s=n[a-1].end;e[i].start-s<r?e[i].end>s&&(n[a-1].end=e[i].end):n.push(e[i])}else n.push(e[i])}else n=e;for(var o,l=0,u=t,c=t,d=0;d<n.length;d++){var f=n[d].start,h=n[d].end;if(t+r>=f&&t<h)u=f,l=(c=h)-t;else if(t+r<f){o=f;break}}return{len:l,start:u||0,end:c||0,nextStart:o}}},{key:"getBuffered",value:function(e){try{return e.buffered}catch(e){return G.log("failed to get media.buffered",e),Lr}}}]),e}(),Ar=(0,p.Z)((function e(t,r,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:-1,s=arguments.length>5&&void 0!==arguments[5]&&arguments[5];(0,g.Z)(this,e),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing={start:0,executeStart:0,executeEnd:0,end:0},this.buffering={audio:{start:0,executeStart:0,executeEnd:0,end:0},video:{start:0,executeStart:0,executeEnd:0,end:0},audiovideo:{start:0,executeStart:0,executeEnd:0,end:0}},this.level=t,this.sn=r,this.id=n,this.size=i,this.part=a,this.partial=s}));function xr(e,t){for(var r=null,n=0,i=e.length;n<i;n++){var a=e[n];if(a&&a.cc===t){r=a;break}}return r}function Ir(e,t){if(e){var r=e.start+t;e.start=e.startPTS=r,e.endPTS=r+e.duration}}function Dr(e,t){for(var r=t.fragments,n=0,i=r.length;n<i;n++)Ir(r[n],e);t.fragmentHint&&Ir(t.fragmentHint,e),t.alignedSliding=!0}function Cr(e,t){if(e.hasProgramDateTime&&t.hasProgramDateTime){var r=e.fragments,n=t.fragments;if(r.length&&n.length){var i=n[Math.round(n.length/2)-1],a=xr(r,i.cc)||r[Math.round(r.length/2)-1],s=i.programDateTime,o=a.programDateTime;null!==s&&null!==o&&Dr((o-s)/1e3-(a.start-i.start),e)}}}var Pr=function(){function e(t,r){(0,g.Z)(this,e),this.subtle=void 0,this.aesIV=void 0,this.subtle=t,this.aesIV=r}return(0,p.Z)(e,[{key:"decrypt",value:function(e,t){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e)}}]),e}(),Mr=function(){function e(t,r){(0,g.Z)(this,e),this.subtle=void 0,this.key=void 0,this.subtle=t,this.key=r}return(0,p.Z)(e,[{key:"expandKey",value:function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])}}]),e}(),Or=function(){function e(){(0,g.Z)(this,e),this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}return(0,p.Z)(e,[{key:"uint8ArrayToUint32Array_",value:function(e){for(var t=new DataView(e),r=new Uint32Array(4),n=0;n<4;n++)r[n]=t.getUint32(4*n);return r}},{key:"initTable",value:function(){var e=this.sBox,t=this.invSBox,r=this.subMix,n=r[0],i=r[1],a=r[2],s=r[3],o=this.invSubMix,l=o[0],u=o[1],c=o[2],d=o[3],f=new Uint32Array(256),h=0,v=0,g=0;for(g=0;g<256;g++)f[g]=g<128?g<<1:g<<1^283;for(g=0;g<256;g++){var p=v^v<<1^v<<2^v<<3^v<<4;p=p>>>8^255&p^99,e[h]=p,t[p]=h;var m=f[h],y=f[m],b=f[y],k=257*f[p]^16843008*p;n[h]=k<<24|k>>>8,i[h]=k<<16|k>>>16,a[h]=k<<8|k>>>24,s[h]=k,k=16843009*b^65537*y^257*m^16843008*h,l[p]=k<<24|k>>>8,u[p]=k<<16|k>>>16,c[p]=k<<8|k>>>24,d[p]=k,h?(h=m^f[f[f[b^m]]],v^=f[f[v]]):h=v=1}}},{key:"expandKey",value:function(e){for(var t=this.uint8ArrayToUint32Array_(e),r=!0,n=0;n<t.length&&r;)r=t[n]===this.key[n],n++;if(!r){this.key=t;var i=this.keySize=t.length;if(4!==i&&6!==i&&8!==i)throw new Error("Invalid aes key size="+i);var a,s,o,l,u=this.ksRows=4*(i+6+1),c=this.keySchedule=new Uint32Array(u),d=this.invKeySchedule=new Uint32Array(u),f=this.sBox,h=this.rcon,v=this.invSubMix,g=v[0],p=v[1],m=v[2],y=v[3];for(a=0;a<u;a++)a<i?o=c[a]=t[a]:(l=o,a%i==0?(l=f[(l=l<<8|l>>>24)>>>24]<<24|f[l>>>16&255]<<16|f[l>>>8&255]<<8|f[255&l],l^=h[a/i|0]<<24):i>6&&a%i==4&&(l=f[l>>>24]<<24|f[l>>>16&255]<<16|f[l>>>8&255]<<8|f[255&l]),c[a]=o=(c[a-i]^l)>>>0);for(s=0;s<u;s++)a=u-s,l=3&s?c[a]:c[a-4],d[s]=s<4||a<=4?l:g[f[l>>>24]]^p[f[l>>>16&255]]^m[f[l>>>8&255]]^y[f[255&l]],d[s]=d[s]>>>0}}},{key:"networkToHostOrderSwap",value:function(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24}},{key:"decrypt",value:function(e,t,r){for(var n,i,a,s,o,l,u,c,d,f,h,v,g,p,m=this.keySize+6,y=this.invKeySchedule,b=this.invSBox,k=this.invSubMix,E=k[0],T=k[1],_=k[2],w=k[3],S=this.uint8ArrayToUint32Array_(r),L=S[0],R=S[1],A=S[2],x=S[3],I=new Int32Array(e),D=new Int32Array(I.length),C=this.networkToHostOrderSwap;t<I.length;){for(d=C(I[t]),f=C(I[t+1]),h=C(I[t+2]),v=C(I[t+3]),o=d^y[0],l=v^y[1],u=h^y[2],c=f^y[3],g=4,p=1;p<m;p++)n=E[o>>>24]^T[l>>16&255]^_[u>>8&255]^w[255&c]^y[g],i=E[l>>>24]^T[u>>16&255]^_[c>>8&255]^w[255&o]^y[g+1],a=E[u>>>24]^T[c>>16&255]^_[o>>8&255]^w[255&l]^y[g+2],s=E[c>>>24]^T[o>>16&255]^_[l>>8&255]^w[255&u]^y[g+3],o=n,l=i,u=a,c=s,g+=4;n=b[o>>>24]<<24^b[l>>16&255]<<16^b[u>>8&255]<<8^b[255&c]^y[g],i=b[l>>>24]<<24^b[u>>16&255]<<16^b[c>>8&255]<<8^b[255&o]^y[g+1],a=b[u>>>24]<<24^b[c>>16&255]<<16^b[o>>8&255]<<8^b[255&l]^y[g+2],s=b[c>>>24]<<24^b[o>>16&255]<<16^b[l>>8&255]<<8^b[255&u]^y[g+3],D[t]=C(n^L),D[t+1]=C(s^R),D[t+2]=C(a^A),D[t+3]=C(i^x),L=d,R=f,A=h,x=v,t+=4}return D.buffer}}]),e}(),Nr=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.removePKCS7Padding,i=void 0===n||n;if((0,g.Z)(this,e),this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.useSoftware=t.enableSoftwareAES,this.removePKCS7Padding=i,i)try{var a=self.crypto;a&&(this.subtle=a.subtle||a.webkitSubtle)}catch(e){}null===this.subtle&&(this.useSoftware=!0)}return(0,p.Z)(e,[{key:"destroy",value:function(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}},{key:"isSync",value:function(){return this.useSoftware}},{key:"flush",value:function(){var e=this.currentResult,t=this.remainderData;if(!e||t)return this.reset(),null;var r,n,i,a=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?(i=(n=(r=a).byteLength)&&new DataView(r.buffer).getUint8(n-1))?ve(r,0,n-i):r:a}},{key:"reset",value:function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}},{key:"decrypt",value:function(e,t,r){var n=this;return this.useSoftware?new Promise((function(i,a){n.softwareDecrypt(new Uint8Array(e),t,r);var s=n.flush();s?i(s.buffer):a(new Error("[softwareDecrypt] Failed to decrypt data"))})):this.webCryptoDecrypt(new Uint8Array(e),t,r)}},{key:"softwareDecrypt",value:function(e,t,r){var n=this.currentIV,i=this.currentResult,a=this.remainderData;this.logOnce("JS AES decrypt"),a&&(e=ze(a,e),this.remainderData=null);var s=this.getValidChunk(e);if(!s.length)return null;n&&(r=n);var o=this.softwareDecrypter;o||(o=this.softwareDecrypter=new Or),o.expandKey(t);var l=i;return this.currentResult=o.decrypt(s.buffer,0,r),this.currentIV=ve(s,-16).buffer,l||null}},{key:"webCryptoDecrypt",value:function(e,t,r){var n=this,i=this.subtle;return this.key===t&&this.fastAesKey||(this.key=t,this.fastAesKey=new Mr(i,t)),this.fastAesKey.expandKey().then((function(t){return i?(n.logOnce("WebCrypto AES decrypt"),new Pr(i,new Uint8Array(r)).decrypt(e.buffer,t)):Promise.reject(new Error("web crypto not initialized"))})).catch((function(i){return G.warn("[decrypter]: WebCrypto Error, disable WebCrypto API, ".concat(i.name,": ").concat(i.message)),n.onWebCryptoError(e,t,r)}))}},{key:"onWebCryptoError",value:function(e,t,r){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,r);var n=this.flush();if(n)return n.buffer;throw new Error("WebCrypto and softwareDecrypt: failed to decrypt data")}},{key:"getValidChunk",value:function(e){var t=e,r=e.length-e.length%16;return r!==e.length&&(t=ve(e,0,r),this.remainderData=ve(e,r)),t}},{key:"logOnce",value:function(e){this.logEnabled&&(G.log("[decrypter]: ".concat(e)),this.logEnabled=!1)}}]),e}(),Fr="STOPPED",Zr="IDLE",Ur="KEY_LOADING",Br="FRAG_LOADING",jr="FRAG_LOADING_WAITING_RETRY",Gr="WAITING_TRACK",Kr="PARSING",Hr="PARSED",zr="ENDED",Vr="ERROR",qr="WAITING_INIT_PTS",Wr="WAITING_LEVEL",Yr=function(e){(0,d.Z)(r,e);var t=k(r);function r(e,n,i,a,s){var o;return(0,g.Z)(this,r),(o=t.call(this)).hls=void 0,o.fragPrevious=null,o.fragCurrent=null,o.fragmentTracker=void 0,o.transmuxer=null,o._state=Fr,o.playlistType=void 0,o.media=null,o.mediaBuffer=null,o.config=void 0,o.bitrateTest=!1,o.lastCurrentTime=0,o.nextLoadPosition=0,o.startPosition=0,o.startTimeOffset=null,o.loadedmetadata=!1,o.retryDate=0,o.levels=null,o.fragmentLoader=void 0,o.keyLoader=void 0,o.levelLastLoaded=null,o.startFragRequested=!1,o.decrypter=void 0,o.initPTS=[],o.onvseeking=null,o.onvended=null,o.logPrefix="",o.log=void 0,o.warn=void 0,o.playlistType=s,o.logPrefix=a,o.log=G.log.bind(G,"".concat(a,":")),o.warn=G.warn.bind(G,"".concat(a,":")),o.hls=e,o.fragmentLoader=new kr(e.config),o.keyLoader=i,o.fragmentTracker=n,o.config=e.config,o.decrypter=new Nr(e.config),e.on(M.MANIFEST_LOADED,o.onManifestLoaded,(0,l.Z)(o)),o}return(0,p.Z)(r,[{key:"doTick",value:function(){this.onTickEnd()}},{key:"onTickEnd",value:function(){}},{key:"startLoad",value:function(e){}},{key:"stopLoad",value:function(){this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);var e=this.fragCurrent;null!=e&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=Fr}},{key:"_streamEnded",value:function(e,t){if(t.live||e.nextStart||!e.end||!this.media)return!1;var r=t.partList;if(null!=r&&r.length){var n=r[r.length-1];return Rr.isBuffered(this.media,n.start+n.duration/2)}var i=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(i)}},{key:"getLevelDetails",value:function(){var e;if(this.levels&&null!==this.levelLastLoaded)return null==(e=this.levels[this.levelLastLoaded])?void 0:e.details}},{key:"onMediaAttached",value:function(e,t){var r=this.media=this.mediaBuffer=t.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),r.addEventListener("seeking",this.onvseeking),r.addEventListener("ended",this.onvended);var n=this.config;this.levels&&n.autoStartLoad&&this.state===Fr&&this.startLoad(n.startPosition)}},{key:"onMediaDetaching",value:function(){var e=this.media;null!=e&&e.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),e&&this.onvseeking&&this.onvended&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.keyLoader&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}},{key:"onMediaSeeking",value:function(){var e=this.config,t=this.fragCurrent,r=this.media,n=this.mediaBuffer,i=this.state,a=r?r.currentTime:0,s=Rr.bufferInfo(n||r,a,e.maxBufferHole);if(this.log("media seeking to ".concat(P(a)?a.toFixed(3):a,", state: ").concat(i)),this.state===zr)this.resetLoadingState();else if(t){var o=e.maxFragLookUpTolerance,l=t.start-o,u=t.start+t.duration+o;if(!s.len||u<s.start||l>s.end){var c=a>u;(a<l||c)&&(c&&t.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),t.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}r&&(this.fragmentTracker.removeFragmentsInRange(a,1/0,this.playlistType,!0),this.lastCurrentTime=a),this.loadedmetadata||s.len||(this.nextLoadPosition=this.startPosition=a),this.tickImmediate()}},{key:"onMediaEnded",value:function(){this.startPosition=this.lastCurrentTime=0}},{key:"onManifestLoaded",value:function(e,t){this.startTimeOffset=t.startTimeOffset,this.initPTS=[]}},{key:"onHandlerDestroying",value:function(){this.stopLoad(),(0,c.Z)((0,h.Z)(r.prototype),"onHandlerDestroying",this).call(this)}},{key:"onHandlerDestroyed",value:function(){this.state=Fr,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,(0,c.Z)((0,h.Z)(r.prototype),"onHandlerDestroyed",this).call(this)}},{key:"loadFragment",value:function(e,t,r){this._loadFragForPlayback(e,t,r)}},{key:"_loadFragForPlayback",value:function(e,t,r){var n=this;this._doFragLoad(e,t,r,(function(t){if(n.fragContextChanged(e))return n.warn("Fragment ".concat(e.sn).concat(t.part?" p: "+t.part.index:""," of level ").concat(e.level," was dropped during download.")),void n.fragmentTracker.removeFragment(e);e.stats.chunkCount++,n._handleFragmentLoadProgress(t)})).then((function(t){if(t){var r=n.state;n.fragContextChanged(e)?(r===Br||!n.fragCurrent&&r===Kr)&&(n.fragmentTracker.removeFragment(e),n.state=Zr):("payload"in t&&(n.log("Loaded fragment ".concat(e.sn," of level ").concat(e.level)),n.hls.trigger(M.FRAG_LOADED,t)),n._handleFragmentLoadComplete(t))}})).catch((function(t){n.state!==Fr&&n.state!==Vr&&(n.warn(t),n.resetFragmentLoading(e))}))}},{key:"clearTrackerIfNeeded",value:function(e){var t,r=this.fragmentTracker;if(r.getState(e)===hr){var n=e.type,i=this.getFwdBufferInfo(this.mediaBuffer,n),a=Math.max(e.duration,i?i.len:this.config.maxBufferLength);this.reduceMaxBufferLength(a)&&r.removeFragment(e)}else 0===(null==(t=this.mediaBuffer)?void 0:t.buffered.length)?r.removeAllFragments():r.hasParts(e.type)&&(r.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),r.getState(e)===vr&&r.removeFragment(e))}},{key:"checkLiveUpdate",value:function(e){if(e.updated&&!e.live){var t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}},{key:"flushMainBuffer",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(e-t){var n={startOffset:e,endOffset:t,type:r};this.hls.trigger(M.BUFFER_FLUSHING,n)}}},{key:"_loadInitSegment",value:function(e,t){var r=this;this._doFragLoad(e,t).then((function(t){if(!t||r.fragContextChanged(e)||!r.levels)throw new Error("init load aborted");return t})).then((function(t){var n=r.hls,i=t.payload,a=e.decryptdata;if(i&&i.byteLength>0&&a&&a.key&&a.iv&&"AES-128"===a.method){var s=self.performance.now();return r.decrypter.decrypt(new Uint8Array(i),a.key.buffer,a.iv.buffer).catch((function(t){throw n.trigger(M.ERROR,{type:O.MEDIA_ERROR,details:N.FRAG_DECRYPT_ERROR,fatal:!1,error:t,reason:t.message,frag:e}),t})).then((function(r){var i=self.performance.now();return n.trigger(M.FRAG_DECRYPTED,{frag:e,payload:r,stats:{tstart:s,tdecrypt:i}}),t.payload=r,t}))}return t})).then((function(n){var i=r.fragCurrent,a=r.hls;if(!r.levels)throw new Error("init load aborted, missing levels");var s=e.stats;r.state=Zr,t.fragmentError=0,e.data=new Uint8Array(n.payload),s.parsing.start=s.buffering.start=self.performance.now(),s.parsing.end=s.buffering.end=self.performance.now(),n.frag===i&&a.trigger(M.FRAG_BUFFERED,{stats:s,frag:i,part:null,id:e.type}),r.tick()})).catch((function(t){r.state!==Fr&&r.state!==Vr&&(r.warn(t),r.resetFragmentLoading(e))}))}},{key:"fragContextChanged",value:function(e){var t=this.fragCurrent;return!e||!t||e.level!==t.level||e.sn!==t.sn||e.urlId!==t.urlId}},{key:"fragBufferedComplete",value:function(e,t){var r,n,i,a,s=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered ".concat(e.type," sn: ").concat(e.sn).concat(t?" part: "+t.index:""," of ").concat(this.playlistType===St?"level":"track"," ").concat(e.level," (frag:[").concat((null!=(r=e.startPTS)?r:NaN).toFixed(3),"-").concat((null!=(n=e.endPTS)?n:NaN).toFixed(3),"] > buffer:").concat(s?function(e){for(var t="",r=e.length,n=0;n<r;n++)t+="[".concat(e.start(n).toFixed(3),"-").concat(e.end(n).toFixed(3),"]");return t}(Rr.getBuffered(s)):"(detached)",")")),this.state=Zr,s&&(!this.loadedmetadata&&e.type==St&&s.buffered.length&&(null==(i=this.fragCurrent)?void 0:i.sn)===(null==(a=this.fragPrevious)?void 0:a.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())}},{key:"seekToStartPos",value:function(){}},{key:"_handleFragmentLoadComplete",value:function(e){var t=this.transmuxer;if(t){var r=e.frag,n=e.part,i=e.partsLoaded,a=!i||0===i.length||i.some((function(e){return!e})),s=new Ar(r.level,r.sn,r.stats.chunkCount+1,0,n?n.index:-1,!a);t.flush(s)}}},{key:"_handleFragmentLoadProgress",value:function(e){}},{key:"_doFragLoad",value:function(e,t){var r,n=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=arguments.length>3?arguments[3]:void 0,o=null==t?void 0:t.details;if(!this.levels||!o)throw new Error("frag load aborted, missing level".concat(o?"":" detail","s"));var l=null;if(!e.encrypted||null!=(r=e.decryptdata)&&r.key?!e.encrypted&&o.encryptedFragments.length&&this.keyLoader.loadClear(e,o.encryptedFragments):(this.log("Loading key for ".concat(e.sn," of [").concat(o.startSN,"-").concat(o.endSN,"], ").concat("[stream-controller]"===this.logPrefix?"level":"track"," ").concat(e.level)),this.state=Ur,this.fragCurrent=e,l=this.keyLoader.load(e).then((function(e){if(!n.fragContextChanged(e.frag))return n.hls.trigger(M.KEY_LOADED,e),n.state===Ur&&(n.state=Zr),e})),this.hls.trigger(M.KEY_LOADING,{frag:e}),null===this.fragCurrent&&(l=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING")))),i=Math.max(e.start,i||0),this.config.lowLatencyMode&&"initSegment"!==e.sn){var u=o.partList;if(u&&s){i>e.end&&o.fragmentHint&&(e=o.fragmentHint);var c=this.getNextPart(u,e,i);if(c>-1){var d,f=u[c];return this.log("Loading part sn: ".concat(e.sn," p: ").concat(f.index," cc: ").concat(e.cc," of playlist [").concat(o.startSN,"-").concat(o.endSN,"] parts [0-").concat(c,"-").concat(u.length-1,"] ").concat("[stream-controller]"===this.logPrefix?"level":"track",": ").concat(e.level,", target: ").concat(parseFloat(i.toFixed(3)))),this.nextLoadPosition=f.start+f.duration,this.state=Br,d=l?l.then((function(r){return!r||n.fragContextChanged(r.frag)?null:n.doFragPartsLoad(e,f,t,s)})).catch((function(e){return n.handleFragLoadError(e)})):this.doFragPartsLoad(e,f,t,s).catch((function(e){return n.handleFragLoadError(e)})),this.hls.trigger(M.FRAG_LOADING,{frag:e,part:f,targetBufferTime:i}),null===this.fragCurrent?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):d}if(!e.url||this.loadedEndOfParts(u,i))return Promise.resolve(null)}}this.log("Loading fragment ".concat(e.sn," cc: ").concat(e.cc," ").concat(o?"of ["+o.startSN+"-"+o.endSN+"] ":"").concat("[stream-controller]"===this.logPrefix?"level":"track",": ").concat(e.level,", target: ").concat(parseFloat(i.toFixed(3)))),P(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=Br;var h,v=this.config.progressive;return h=v&&l?l.then((function(t){return!t||n.fragContextChanged(null==t?void 0:t.frag)?null:n.fragmentLoader.load(e,s)})).catch((function(e){return n.handleFragLoadError(e)})):Promise.all([this.fragmentLoader.load(e,v?s:void 0),l]).then((function(e){var t=(0,a.Z)(e,1)[0];return!v&&t&&s&&s(t),t})).catch((function(e){return n.handleFragLoadError(e)})),this.hls.trigger(M.FRAG_LOADING,{frag:e,targetBufferTime:i}),null===this.fragCurrent?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):h}},{key:"doFragPartsLoad",value:function(e,t,r,n){var i=this;return new Promise((function(a,s){var o,l=[],u=null==(o=r.details)?void 0:o.partList;!function t(o){i.fragmentLoader.loadPart(e,o,n).then((function(n){l[o.index]=n;var s=n.part;i.hls.trigger(M.FRAG_LOADED,n);var c=Yt(r,e.sn,o.index+1)||Xt(u,e.sn,o.index+1);if(!c)return a({frag:e,part:s,partsLoaded:l});t(c)})).catch(s)}(t)}))}},{key:"handleFragLoadError",value:function(e){if("data"in e){var t=e.data;e.data&&t.details===N.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):this.hls.trigger(M.ERROR,t)}else this.hls.trigger(M.ERROR,{type:O.OTHER_ERROR,details:N.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}},{key:"_handleTransmuxerFlush",value:function(e){var t=this.getCurrentContext(e);if(t&&this.state===Kr){var r=t.frag,n=t.part,i=t.level,a=self.performance.now();r.stats.parsing.end=a,n&&(n.stats.parsing.end=a),this.updateLevelTiming(r,n,i,e.partial)}else this.fragCurrent||this.state===Fr||this.state===Vr||(this.state=Zr)}},{key:"getCurrentContext",value:function(e){var t=this.levels,r=this.fragCurrent,n=e.level,i=e.sn,a=e.part;if(null==t||!t[n])return this.warn("Levels object was unset while buffering fragment ".concat(i," of level ").concat(n,". The current chunk will not be buffered.")),null;var s=t[n],o=a>-1?Yt(s,i,a):null,l=o?o.fragment:function(e,t,r){if(null==e||!e.details)return null;var n=e.details,i=n.fragments[t-n.startSN];return i||((i=n.fragmentHint)&&i.sn===t?i:t<n.startSN&&r&&r.sn===t?r:null)}(s,i,r);return l?(r&&r!==l&&(l.stats=r.stats),{frag:l,part:o,level:s}):null}},{key:"bufferFragmentData",value:function(e,t,r,n,i){var a;if(e&&this.state===Kr){var s=e.data1,o=e.data2,l=s;if(s&&o&&(l=ze(s,o)),null!=(a=l)&&a.length){var u={type:e.type,frag:t,part:r,chunkMeta:n,parent:t.type,data:l};if(this.hls.trigger(M.BUFFER_APPENDING,u),e.dropped&&e.independent&&!r){if(i)return;this.flushBufferGap(t)}}}}},{key:"flushBufferGap",value:function(e){var t=this.media;if(t)if(Rr.isBuffered(t,t.currentTime)){var r=t.currentTime,n=Rr.bufferInfo(t,r,0),i=e.duration,a=Math.min(2*this.config.maxFragLookUpTolerance,.25*i),s=Math.max(Math.min(e.start-a,n.end-a),r+a);e.start-s>a&&this.flushMainBuffer(s,e.start)}else this.flushMainBuffer(0,e.start)}},{key:"getFwdBufferInfo",value:function(e,t){var r=this.getLoadPosition();return P(r)?this.getFwdBufferInfoAtPos(e,r,t):null}},{key:"getFwdBufferInfoAtPos",value:function(e,t,r){var n=this.config.maxBufferHole,i=Rr.bufferInfo(e,t,n);if(0===i.len&&void 0!==i.nextStart){var a=this.fragmentTracker.getBufferedFrag(t,r);if(a&&i.nextStart<a.end)return Rr.bufferInfo(e,t,Math.max(i.nextStart,n))}return i}},{key:"getMaxBufferLength",value:function(e){var t,r=this.config;return t=e?Math.max(8*r.maxBufferSize/e,r.maxBufferLength):r.maxBufferLength,Math.min(t,r.maxMaxBufferLength)}},{key:"reduceMaxBufferLength",value:function(e){var t=this.config,r=e||t.maxBufferLength;return t.maxMaxBufferLength>=r&&(t.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to ".concat(t.maxMaxBufferLength,"s")),!0)}},{key:"getAppendedFrag",value:function(e){var t=this.fragmentTracker.getAppendedFrag(e,St);return t&&"fragment"in t?t.fragment:t}},{key:"getNextFragment",value:function(e,t){var r=t.fragments,n=r.length;if(!n)return null;var i,a=this.config,s=r[0].start;if(t.live){var o=a.initialLiveManifestSize;if(n<o)return this.warn("Not enough fragments to start playback (have: ".concat(n,", need: ").concat(o,")")),null;t.PTSKnown||this.startFragRequested||-1!==this.startPosition||(i=this.getInitialLiveFragment(t,r),this.startPosition=i?this.hls.liveSyncPosition||i.start:e)}else e<=s&&(i=r[0]);if(!i){var l=a.lowLatencyMode?t.partEnd:t.fragmentEnd;i=this.getFragmentAtPosition(e,l,t)}return this.mapToInitFragWhenRequired(i)}},{key:"isLoopLoading",value:function(e,t){var r=this.fragmentTracker.getState(e);return(r===gr||r===vr&&!!e.gap)&&this.nextLoadPosition>t}},{key:"getNextFragmentLoopLoading",value:function(e,t,r,n,i){var a=e.gap,s=this.getNextFragment(this.nextLoadPosition,t);if(null===s)return s;if(e=s,a&&e&&!e.gap&&r.nextStart){var o=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,r.nextStart,n);if(null!==o&&r.len+o.len>=i)return this.log('buffer full after gaps in "'.concat(n,'" playlist starting at sn: ').concat(e.sn)),null}return e}},{key:"mapToInitFragWhenRequired",value:function(e){return null==e||!e.initSegment||null!=e&&e.initSegment.data||this.bitrateTest?e:e.initSegment}},{key:"getNextPart",value:function(e,t,r){for(var n=-1,i=!1,a=!0,s=0,o=e.length;s<o;s++){var l=e[s];if(a=a&&!l.independent,n>-1&&r<l.start)break;var u=l.loaded;u?n=-1:(i||l.independent||a)&&l.fragment===t&&(n=s),i=u}return n}},{key:"loadedEndOfParts",value:function(e,t){var r=e[e.length-1];return r&&t>r.start&&r.loaded}},{key:"getInitialLiveFragment",value:function(e,t){var r=this.fragPrevious,n=null;if(r){if(e.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: ".concat(r.programDateTime)),n=function(e,t,r){if(null===t||!Array.isArray(e)||!e.length||!P(t))return null;if(t<(e[0].programDateTime||0))return null;if(t>=(e[e.length-1].endProgramDateTime||0))return null;r=r||0;for(var n=0;n<e.length;++n){var i=e[n];if(ar(t,r,i))return i}return null}(t,r.endProgramDateTime,this.config.maxFragLookUpTolerance)),!n){var i=r.sn+1;if(i>=e.startSN&&i<=e.endSN){var a=t[i-e.startSN];r.cc===a.cc&&(n=a,this.log("Live playlist, switching playlist, load frag with next SN: ".concat(n.sn)))}n||(n=function(e,t){return rr(e,(function(e){return e.cc<t?1:e.cc>t?-1:0}))}(t,r.cc),n&&this.log("Live playlist, switching playlist, load frag with same CC: ".concat(n.sn)))}}else{var s=this.hls.liveSyncPosition;null!==s&&(n=this.getFragmentAtPosition(s,this.bitrateTest?e.fragmentEnd:e.edge,e))}return n}},{key:"getFragmentAtPosition",value:function(e,t,r){var n,i=this.config,a=this.fragPrevious,s=r.fragments,o=r.endSN,l=r.fragmentHint,u=i.maxFragLookUpTolerance,c=r.partList,d=!!(i.lowLatencyMode&&null!=c&&c.length&&l);if(d&&l&&!this.bitrateTest&&(s=s.concat(l),o=l.sn),n=e<t?nr(a,s,e,e>t-u?0:u):s[s.length-1]){var f=n.sn-r.startSN,h=this.fragmentTracker.getState(n);if((h===gr||h===vr&&n.gap)&&(a=n),a&&n.sn===a.sn&&(!d||c[0].fragment.sn>n.sn)&&a&&n.level===a.level){var v=s[f+1];n=n.sn<o&&this.fragmentTracker.getState(v)!==gr?v:null}}return n}},{key:"synchronizeToLiveEdge",value:function(e){var t=this.config,r=this.media;if(r){var n=this.hls.liveSyncPosition,i=r.currentTime,a=e.fragments[0].start,s=e.edge,o=i>=a-t.maxFragLookUpTolerance&&i<=s;if(null!==n&&r.duration>n&&(i<n||!o)){var l=void 0!==t.liveMaxLatencyDuration?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;(!o&&r.readyState<4||i<s-l)&&(this.loadedmetadata||(this.nextLoadPosition=n),r.readyState&&(this.warn("Playback: ".concat(i.toFixed(3)," is located too far from the end of live sliding playlist: ").concat(s,", reset currentTime to : ").concat(n.toFixed(3))),r.currentTime=n))}}}},{key:"alignPlaylists",value:function(e,t){var r=this.levels,n=this.levelLastLoaded,i=this.fragPrevious,a=null!==n?r[n]:null,s=e.fragments.length;if(!s)return this.warn("No fragments in live playlist"),0;var o=e.fragments[0].start,l=!t,u=e.alignedSliding&&P(o);if(l||!u&&!o){!function(e,t,r){t&&(function(e,t,r){if(function(e,t,r){return!(!t.details||!(r.endCC>r.startCC||e&&e.cc<r.startCC))}(e,r,t)){var n=function(e,t){var r=e.fragments,n=t.fragments;if(n.length&&r.length){var i=xr(r,n[0].cc);if(i&&(!i||i.startPTS))return i;G.log("No frag in previous level to align on")}else G.log("No fragments to align")}(r.details,t);n&&P(n.start)&&(G.log("Adjusting PTS using last level due to CC increase within current level ".concat(t.url)),Dr(n.start,t))}}(e,r,t),!r.alignedSliding&&t.details&&function(e,t){if(t.fragments.length&&e.hasProgramDateTime&&t.hasProgramDateTime){var r=t.fragments[0].programDateTime,n=e.fragments[0].programDateTime,i=(n-r)/1e3+t.fragments[0].start;i&&P(i)&&(G.log("Adjusting PTS using programDateTime delta ".concat(n-r,"ms, sliding:").concat(i.toFixed(3)," ").concat(e.url," ")),Dr(i,e))}}(r,t.details),r.alignedSliding||!t.details||r.skippedSegments||qt(t.details,r))}(i,a,e);var c=e.fragments[0].start;return this.log("Live playlist sliding: ".concat(c.toFixed(2)," start-sn: ").concat(t?t.startSN:"na","->").concat(e.startSN," prev-sn: ").concat(i?i.sn:"na"," fragments: ").concat(s)),c}return o}},{key:"waitForCdnTuneIn",value:function(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,3*e.partTarget)}},{key:"setStartPosition",value:function(e,t){var r=this.startPosition;if(r<t&&(r=-1),-1===r||-1===this.lastCurrentTime){var n=null!==this.startTimeOffset,i=n?this.startTimeOffset:e.startTimeOffset;null!==i&&P(i)?(r=t+i,i<0&&(r+=e.totalduration),r=Math.min(Math.max(t,r),t+e.totalduration),this.log("Start time offset ".concat(i," found in ").concat(n?"multivariant":"media"," playlist, adjust startPosition to ").concat(r)),this.startPosition=r):e.live?r=this.hls.liveSyncPosition||t:this.startPosition=r=0,this.lastCurrentTime=r}this.nextLoadPosition=r}},{key:"getLoadPosition",value:function(){var e=this.media,t=0;return this.loadedmetadata&&e?t=e.currentTime:this.nextLoadPosition&&(t=this.nextLoadPosition),t}},{key:"handleFragLoadAborted",value:function(e,t){this.transmuxer&&"initSegment"!==e.sn&&e.stats.aborted&&(this.warn("Fragment ".concat(e.sn).concat(t?" part "+t.index:""," of level ").concat(e.level," was aborted")),this.resetFragmentLoading(e))}},{key:"resetFragmentLoading",value:function(e){this.fragCurrent&&(this.fragContextChanged(e)||this.state===jr)||(this.state=Zr)}},{key:"onFragmentOrKeyLoadError",value:function(e,t){if(t.chunkMeta&&!t.frag){var r=this.getCurrentContext(t.chunkMeta);r&&(t.frag=r.frag)}var n=t.frag;if(n&&n.type===e&&this.levels)if(this.fragContextChanged(n)){var i;this.warn("Frag load error must match current frag to retry ".concat(n.url," > ").concat(null==(i=this.fragCurrent)?void 0:i.url))}else{var a=t.details===N.FRAG_GAP;a&&this.fragmentTracker.fragBuffered(n,!0);var s=t.errorAction,o=s||{},l=o.action,u=o.retryCount,c=void 0===u?0:u,d=o.retryConfig;if(s&&5===l&&d){var f;this.resetStartWhenNotLoaded(null!=(f=this.levelLastLoaded)?f:n.level);var h=Jt(d,c);this.warn("Fragment ".concat(n.sn," of ").concat(e," ").concat(n.level," errored with ").concat(t.details,", retrying loading ").concat(c+1,"/").concat(d.maxNumRetry," in ").concat(h,"ms")),s.resolved=!0,this.retryDate=self.performance.now()+h,this.state=jr}else d&&s?(this.resetFragmentErrors(e),c<d.maxNumRetry?a||(s.resolved=!0):G.warn("".concat(t.details," reached or exceeded max retry (").concat(c,")"))):2===(null==s?void 0:s.action)?this.state=Wr:this.state=Vr;this.tickImmediate()}}},{key:"reduceLengthAndFlushBuffer",value:function(e){if(this.state===Kr||this.state===Hr){var t=e.parent,r=this.getFwdBufferInfo(this.mediaBuffer,t),n=r&&r.len>.5;n&&this.reduceMaxBufferLength(r.len);var i=!n;return i&&this.warn("Buffer full error while media.currentTime is not buffered, flush ".concat(t," buffer")),e.frag&&(this.fragmentTracker.removeFragment(e.frag),this.nextLoadPosition=e.frag.start),this.resetLoadingState(),i}return!1}},{key:"resetFragmentErrors",value:function(e){e===Lt&&(this.fragCurrent=null),this.loadedmetadata||(this.startFragRequested=!1),this.state!==Fr&&(this.state=Zr)}},{key:"afterBufferFlushed",value:function(e,t,r){if(e){var n=Rr.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,n,r),this.state===zr&&this.resetLoadingState()}}},{key:"resetLoadingState",value:function(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state=Zr}},{key:"resetStartWhenNotLoaded",value:function(e){if(!this.loadedmetadata){this.startFragRequested=!1;var t=this.levels?this.levels[e].details:null;null!=t&&t.live?(this.startPosition=-1,this.setStartPosition(t,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}},{key:"resetWhenMissingContext",value:function(e){var t;this.warn("The loading context changed while buffering fragment ".concat(e.sn," of level ").concat(e.level,". This chunk will not be buffered.")),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(null!=(t=this.levelLastLoaded)?t:e.level),this.resetLoadingState()}},{key:"removeUnbufferedFrags",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}},{key:"updateLevelTiming",value:function(e,t,r,n){var i,a=this,s=r.details;if(s){if(Object.keys(e.elementaryStreams).reduce((function(t,i){var o=e.elementaryStreams[i];if(o){var l=o.endPTS-o.startPTS;if(l<=0)return a.warn("Could not parse fragment ".concat(e.sn," ").concat(i," duration reliably (").concat(l,")")),t||!1;var u=n?0:Vt(s,e,o.startPTS,o.endPTS,o.startDTS,o.endDTS);return a.hls.trigger(M.LEVEL_PTS_UPDATED,{details:s,level:r,drift:u,type:i,frag:e,start:o.startPTS,end:o.endPTS}),!0}return t}),!1))r.fragmentError=0;else if(null===(null==(i=this.transmuxer)?void 0:i.error)){var o=new Error("Found no media in fragment ".concat(e.sn," of level ").concat(e.level," resetting transmuxer to fallback to playlist timing"));if(0===r.fragmentError&&(r.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)),this.warn(o.message),this.hls.trigger(M.ERROR,{type:O.MEDIA_ERROR,details:N.FRAG_PARSING_ERROR,fatal:!1,error:o,frag:e,reason:"Found no media in msn ".concat(e.sn,' of level "').concat(r.url,'"')}),!this.hls)return;this.resetTransmuxer()}this.state=Hr,this.hls.trigger(M.FRAG_PARSED,{frag:e,part:t})}else this.warn("level.details undefined")}},{key:"resetTransmuxer",value:function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)}},{key:"recoverWorkerError",value:function(e){var t,r,n;"demuxerWorker"===e.event&&(this.fragmentTracker.removeAllFragments(),this.resetTransmuxer(),this.resetStartWhenNotLoaded(null!=(t=null!=(r=this.levelLastLoaded)?r:null==(n=this.fragCurrent)?void 0:n.level)?t:0),this.resetLoadingState())}},{key:"state",get:function(){return this._state},set:function(e){var t=this._state;t!==e&&(this._state=e,this.log("".concat(t,"->").concat(e)))}}]),r}(Sr);function Xr(){return self.SourceBuffer||self.WebKitSourceBuffer}function Qr(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:9e4;return{type:e,id:-1,pid:-1,inputTimeScale:t,sequenceNumber:-1,samples:[],dropped:0}}var $r=function(){function e(){(0,g.Z)(this,e),this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}return(0,p.Z)(e,[{key:"resetInitSegment",value:function(e,t,r,n){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}},{key:"resetTimeStamp",value:function(e){this.initPTS=e,this.resetContiguity()}},{key:"resetContiguity",value:function(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}},{key:"canParse",value:function(e,t){return!1}},{key:"appendFrame",value:function(e,t,r){}},{key:"demux",value:function(e,t){this.cachedData&&(e=ze(this.cachedData,e),this.cachedData=null);var r,n=ye(e,0),i=n?n.length:0,a=this._audioTrack,s=this._id3Track,o=n?function(e){for(var t=_e(e),r=0;r<t.length;r++){var n=t[r];if(Ee(n))return Ae(n)}}(n):void 0,l=e.length;for((null===this.basePTS||0===this.frameIndex&&P(o))&&(this.basePTS=Jr(o,t,this.initPTS),this.lastPTS=this.basePTS),null===this.lastPTS&&(this.lastPTS=this.basePTS),n&&n.length>0&&s.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:n,type:Ot,duration:Number.POSITIVE_INFINITY});i<l;){if(this.canParse(e,i)){var u=this.appendFrame(a,e,i);u?(this.frameIndex++,this.lastPTS=u.sample.pts,r=i+=u.length):i=l}else ke(e,i)?(n=ye(e,i),s.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:n,type:Ot,duration:Number.POSITIVE_INFINITY}),r=i+=n.length):i++;if(i===l&&r!==l){var c=ve(e,r);this.cachedData?this.cachedData=ze(this.cachedData,c):this.cachedData=c}}return{audioTrack:a,videoTrack:Qr(),id3Track:s,textTrack:Qr()}}},{key:"demuxSampleAes",value:function(e,t,r){return Promise.reject(new Error("[".concat(this,"] This demuxer does not support Sample-AES decryption")))}},{key:"flush",value:function(e){var t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:Qr(),id3Track:this._id3Track,textTrack:Qr()}}},{key:"destroy",value:function(){}}]),e}(),Jr=function(e,t,r){return P(e)?90*e:9e4*t+(r?9e4*r.baseTime/r.timescale:0)};function en(e,t){return 255===e[t]&&240==(246&e[t+1])}function tn(e,t){return 1&e[t+1]?7:9}function rn(e,t){return(3&e[t+3])<<11|e[t+4]<<3|(224&e[t+5])>>>5}function nn(e,t){return t+1<e.length&&en(e,t)}function an(e,t){if(nn(e,t)){var r=tn(e,t);if(t+r>=e.length)return!1;var n=rn(e,t);if(n<=r)return!1;var i=t+n;return i===e.length||nn(e,i)}return!1}function sn(e,t,r,n,i){if(!e.samplerate){var a=function(e,t,r,n){var i,a,s,o,l=navigator.userAgent.toLowerCase(),u=n,c=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];i=1+((192&t[r+2])>>>6);var d=(60&t[r+2])>>>2;if(!(d>c.length-1))return s=(1&t[r+2])<<2,s|=(192&t[r+3])>>>6,G.log("manifest codec:".concat(n,", ADTS type:").concat(i,", samplingIndex:").concat(d)),/firefox/i.test(l)?d>=6?(i=5,o=new Array(4),a=d-3):(i=2,o=new Array(2),a=d):-1!==l.indexOf("android")?(i=2,o=new Array(2),a=d):(i=5,o=new Array(4),n&&(-1!==n.indexOf("mp4a.40.29")||-1!==n.indexOf("mp4a.40.5"))||!n&&d>=6?a=d-3:((n&&-1!==n.indexOf("mp4a.40.2")&&(d>=6&&1===s||/vivaldi/i.test(l))||!n&&1===s)&&(i=2,o=new Array(2)),a=d)),o[0]=i<<3,o[0]|=(14&d)>>1,o[1]|=(1&d)<<7,o[1]|=s<<3,5===i&&(o[1]|=(14&a)>>1,o[2]=(1&a)<<7,o[2]|=8,o[3]=0),{config:o,samplerate:c[d],channelCount:s,codec:"mp4a.40."+i,manifestCodec:u};e.trigger(M.ERROR,{type:O.MEDIA_ERROR,details:N.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:".concat(d)})}(t,r,n,i);if(!a)return;e.config=a.config,e.samplerate=a.samplerate,e.channelCount=a.channelCount,e.codec=a.codec,e.manifestCodec=a.manifestCodec,G.log("parsed codec:".concat(e.codec,", rate:").concat(a.samplerate,", channels:").concat(a.channelCount))}}function on(e){return 9216e4/e}function ln(e,t,r,n,i){var a,s=n+i*on(e.samplerate),o=function(e,t){var r=tn(e,t);if(t+r<=e.length){var n=rn(e,t)-r;if(n>0)return{headerLength:r,frameLength:n}}}(t,r);if(o){var l=o.frameLength,u=o.headerLength,c=u+l,d=Math.max(0,r+c-t.length);d?(a=new Uint8Array(c-u)).set(t.subarray(r+u,t.length),0):a=t.subarray(r+u,r+c);var f={unit:a,pts:s};return d||e.samples.push(f),{sample:f,length:c,missing:d}}var h=t.length-r;return(a=new Uint8Array(h)).set(t.subarray(r,t.length),0),{sample:{unit:a,pts:s},length:h,missing:-1}}var un=function(e){(0,d.Z)(r,e);var t=k(r);function r(e,n){var i;return(0,g.Z)(this,r),(i=t.call(this)).observer=void 0,i.config=void 0,i.observer=e,i.config=n,i}return(0,p.Z)(r,[{key:"resetInitSegment",value:function(e,t,n,i){(0,c.Z)((0,h.Z)(r.prototype),"resetInitSegment",this).call(this,e,t,n,i),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}},{key:"canParse",value:function(e,t){return function(e,t){return function(e,t){return t+5<e.length}(e,t)&&en(e,t)&&rn(e,t)<=e.length-t}(e,t)}},{key:"appendFrame",value:function(e,t,r){sn(e,this.observer,t,r,e.manifestCodec);var n=ln(e,t,r,this.basePTS,this.frameIndex);if(n&&0===n.missing)return n}}],[{key:"probe",value:function(e){if(!e)return!1;for(var t=(ye(e,0)||[]).length,r=e.length;t<r;t++)if(an(e,t))return G.log("ADTS sync word found !"),!0;return!1}}]),r}($r),cn=/\/emsg[-/]ID3/i,dn=function(){function e(t,r){(0,g.Z)(this,e),this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=r}return(0,p.Z)(e,[{key:"resetTimeStamp",value:function(){}},{key:"resetInitSegment",value:function(e,t,r,n){var i=this.videoTrack=Qr("video",1),a=this.audioTrack=Qr("audio",1),s=this.txtTrack=Qr("text",1);if(this.id3Track=Qr("id3",1),this.timeOffset=0,null!=e&&e.byteLength){var o=Ge(e);if(o.video){var l=o.video,u=l.id,c=l.timescale,d=l.codec;i.id=u,i.timescale=s.timescale=c,i.codec=d}if(o.audio){var f=o.audio,h=f.id,v=f.timescale,g=f.codec;a.id=h,a.timescale=v,a.codec=g}s.id=Me.text,i.sampleDuration=0,i.duration=a.duration=n}}},{key:"resetContiguity",value:function(){this.remainderData=null}},{key:"demux",value:function(e,t){this.timeOffset=t;var r=e,n=this.videoTrack,i=this.txtTrack;if(this.config.progressive){this.remainderData&&(r=ze(this.remainderData,e));var a=function(e){var t={valid:null,remainder:null},r=Be(e,["moof"]);if(!r)return t;if(r.length<2)return t.remainder=e,t;var n=r[r.length-1];return t.valid=ve(e,0,n.byteOffset-8),t.remainder=ve(e,n.byteOffset-8),t}(r);this.remainderData=a.remainder,n.samples=a.valid||new Uint8Array}else n.samples=r;var s=this.extractID3Track(n,t);return i.samples=Ve(t,n),{videoTrack:n,audioTrack:this.audioTrack,id3Track:s,textTrack:this.txtTrack}}},{key:"flush",value:function(){var e=this.timeOffset,t=this.videoTrack,r=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;var n=this.extractID3Track(t,this.timeOffset);return r.samples=Ve(e,t),{videoTrack:t,audioTrack:Qr(),id3Track:n,textTrack:Qr()}}},{key:"extractID3Track",value:function(e,t){var r=this.id3Track;if(e.samples.length){var n=Be(e.samples,["emsg"]);n&&n.forEach((function(e){var n=function(e){var t=e[0],r="",n="",i=0,a=0,s=0,o=0,l=0,u=0;if(0===t){for(;"\0"!==Oe(e.subarray(u,u+1));)r+=Oe(e.subarray(u,u+1)),u+=1;for(r+=Oe(e.subarray(u,u+1)),u+=1;"\0"!==Oe(e.subarray(u,u+1));)n+=Oe(e.subarray(u,u+1)),u+=1;n+=Oe(e.subarray(u,u+1)),u+=1,i=Fe(e,12),a=Fe(e,16),o=Fe(e,20),l=Fe(e,24),u=28}else if(1===t){i=Fe(e,u+=4);var c=Fe(e,u+=4),d=Fe(e,u+=4);for(u+=4,s=Math.pow(2,32)*c+d,Number.isSafeInteger(s)||(s=Number.MAX_SAFE_INTEGER,G.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),o=Fe(e,u),l=Fe(e,u+=4),u+=4;"\0"!==Oe(e.subarray(u,u+1));)r+=Oe(e.subarray(u,u+1)),u+=1;for(r+=Oe(e.subarray(u,u+1)),u+=1;"\0"!==Oe(e.subarray(u,u+1));)n+=Oe(e.subarray(u,u+1)),u+=1;n+=Oe(e.subarray(u,u+1)),u+=1}return{schemeIdUri:r,value:n,timeScale:i,presentationTime:s,presentationTimeDelta:a,eventDuration:o,id:l,payload:e.subarray(u,e.byteLength)}}(e);if(cn.test(n.schemeIdUri)){var i=P(n.presentationTime)?n.presentationTime/n.timeScale:t+n.presentationTimeDelta/n.timeScale,a=4294967295===n.eventDuration?Number.POSITIVE_INFINITY:n.eventDuration/n.timeScale;a<=.001&&(a=Number.POSITIVE_INFINITY);var s=n.payload;r.samples.push({data:s,len:s.byteLength,dts:i,pts:i,type:Nt,duration:a})}}))}return r}},{key:"demuxSampleAes",value:function(e,t,r){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}},{key:"destroy",value:function(){}}],[{key:"probe",value:function(e){return Be(e=e.length>16384?e.subarray(0,16384):e,["moof"]).length>0}}]),e}(),fn=null,hn=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],vn=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],gn=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],pn=[0,1,1,4];function mn(e,t,r,n,i){if(!(r+24>t.length)){var a=yn(t,r);if(a&&r+a.frameLength<=t.length){var s=n+i*(9e4*a.samplesPerFrame/a.sampleRate),o={unit:t.subarray(r,r+a.frameLength),pts:s,dts:s};return e.config=[],e.channelCount=a.channelCount,e.samplerate=a.sampleRate,e.samples.push(o),{sample:o,length:a.frameLength,missing:0}}}}function yn(e,t){var r=e[t+1]>>3&3,n=e[t+1]>>1&3,i=e[t+2]>>4&15,a=e[t+2]>>2&3;if(1!==r&&0!==i&&15!==i&&3!==a){var s=e[t+2]>>1&1,o=e[t+3]>>6,l=1e3*hn[14*(3===r?3-n:3===n?3:4)+i-1],u=vn[3*(3===r?0:2===r?1:2)+a],c=3===o?1:2,d=gn[r][n],f=pn[n],h=8*d*f,v=Math.floor(d*l/u+s)*f;if(null===fn){var g=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);fn=g?parseInt(g[1]):0}return!!fn&&fn<=87&&2===n&&l>=224e3&&0===o&&(e[t+3]=128|e[t+3]),{sampleRate:u,channelCount:c,frameLength:v,samplesPerFrame:h}}}function bn(e,t){return 255===e[t]&&224==(224&e[t+1])&&0!=(6&e[t+1])}function kn(e,t){return t+1<e.length&&bn(e,t)}function En(e,t){if(t+1<e.length&&bn(e,t)){var r=yn(e,t),n=4;null!=r&&r.frameLength&&(n=r.frameLength);var i=t+n;return i===e.length||kn(e,i)}return!1}var Tn=function(){function e(t){(0,g.Z)(this,e),this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=t,this.bytesAvailable=t.byteLength,this.word=0,this.bitsAvailable=0}return(0,p.Z)(e,[{key:"loadWord",value:function(){var e=this.data,t=this.bytesAvailable,r=e.byteLength-t,n=new Uint8Array(4),i=Math.min(4,t);if(0===i)throw new Error("no bytes available");n.set(e.subarray(r,r+i)),this.word=new DataView(n.buffer).getUint32(0),this.bitsAvailable=8*i,this.bytesAvailable-=i}},{key:"skipBits",value:function(e){var t;e=Math.min(e,8*this.bytesAvailable+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,e-=(t=e>>3)<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}},{key:"readBits",value:function(e){var t=Math.min(this.bitsAvailable,e),r=this.word>>>32-t;if(e>32&&G.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else{if(!(this.bytesAvailable>0))throw new Error("no bits available");this.loadWord()}return(t=e-t)>0&&this.bitsAvailable?r<<t|this.readBits(t):r}},{key:"skipLZ",value:function(){var e;for(e=0;e<this.bitsAvailable;++e)if(0!=(this.word&2147483648>>>e))return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}},{key:"skipUEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"skipEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"readUEG",value:function(){var e=this.skipLZ();return this.readBits(e+1)-1}},{key:"readEG",value:function(){var e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}},{key:"readBoolean",value:function(){return 1===this.readBits(1)}},{key:"readUByte",value:function(){return this.readBits(8)}},{key:"readUShort",value:function(){return this.readBits(16)}},{key:"readUInt",value:function(){return this.readBits(32)}},{key:"skipScalingList",value:function(e){for(var t=8,r=8,n=0;n<e;n++)0!==r&&(r=(t+this.readEG()+256)%256),t=0===r?t:r}},{key:"readSPS",value:function(){var e,t,r,n=0,i=0,a=0,s=0,o=this.readUByte.bind(this),l=this.readBits.bind(this),u=this.readUEG.bind(this),c=this.readBoolean.bind(this),d=this.skipBits.bind(this),f=this.skipEG.bind(this),h=this.skipUEG.bind(this),v=this.skipScalingList.bind(this);o();var g=o();if(l(5),d(3),o(),h(),100===g||110===g||122===g||244===g||44===g||83===g||86===g||118===g||128===g){var p=u();if(3===p&&d(1),h(),h(),d(1),c())for(t=3!==p?8:12,r=0;r<t;r++)c()&&v(r<6?16:64)}h();var m=u();if(0===m)u();else if(1===m)for(d(1),f(),f(),e=u(),r=0;r<e;r++)f();h(),d(1);var y=u(),b=u(),k=l(1);0===k&&d(1),d(1),c()&&(n=u(),i=u(),a=u(),s=u());var E=[1,1];if(c()&&c())switch(o()){case 1:E=[1,1];break;case 2:E=[12,11];break;case 3:E=[10,11];break;case 4:E=[16,11];break;case 5:E=[40,33];break;case 6:E=[24,11];break;case 7:E=[20,11];break;case 8:E=[32,11];break;case 9:E=[80,33];break;case 10:E=[18,11];break;case 11:E=[15,11];break;case 12:E=[64,33];break;case 13:E=[160,99];break;case 14:E=[4,3];break;case 15:E=[3,2];break;case 16:E=[2,1];break;case 255:E=[o()<<8|o(),o()<<8|o()]}return{width:Math.ceil(16*(y+1)-2*n-2*i),height:(2-k)*(b+1)*16-(k?2:4)*(a+s),pixelRatio:E}}},{key:"readSliceType",value:function(){return this.readUByte(),this.readUEG(),this.readUEG()}}]),e}(),_n=function(){function e(t,r,n){(0,g.Z)(this,e),this.keyData=void 0,this.decrypter=void 0,this.keyData=n,this.decrypter=new Nr(r,{removePKCS7Padding:!1})}return(0,p.Z)(e,[{key:"decryptBuffer",value:function(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer)}},{key:"decryptAacSample",value:function(e,t,r){var n=this,i=e[t].unit;if(!(i.length<=16)){var a=i.subarray(16,i.length-i.length%16),s=a.buffer.slice(a.byteOffset,a.byteOffset+a.length);this.decryptBuffer(s).then((function(a){var s=new Uint8Array(a);i.set(s,16),n.decrypter.isSync()||n.decryptAacSamples(e,t+1,r)}))}}},{key:"decryptAacSamples",value:function(e,t,r){for(;;t++){if(t>=e.length)return void r();if(!(e[t].unit.length<32||(this.decryptAacSample(e,t,r),this.decrypter.isSync())))return}}},{key:"getAvcEncryptedData",value:function(e){for(var t=16*Math.floor((e.length-48)/160)+16,r=new Int8Array(t),n=0,i=32;i<e.length-16;i+=160,n+=16)r.set(e.subarray(i,i+16),n);return r}},{key:"getAvcDecryptedUnit",value:function(e,t){for(var r=new Uint8Array(t),n=0,i=32;i<e.length-16;i+=160,n+=16)e.set(r.subarray(n,n+16),i);return e}},{key:"decryptAvcSample",value:function(e,t,r,n,i){var a=this,s=Ye(i.data),o=this.getAvcEncryptedData(s);this.decryptBuffer(o.buffer).then((function(o){i.data=a.getAvcDecryptedUnit(s,o),a.decrypter.isSync()||a.decryptAvcSamples(e,t,r+1,n)}))}},{key:"decryptAvcSamples",value:function(e,t,r,n){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,r=0){if(t>=e.length)return void n();for(var i=e[t].units;!(r>=i.length);r++){var a=i[r];if(!(a.data.length<=48||1!==a.type&&5!==a.type||(this.decryptAvcSample(e,t,r,n,a),this.decrypter.isSync())))return}}}}]),e}(),wn=188,Sn=function(){function e(t,r,n){(0,g.Z)(this,e),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=t,this.config=r,this.typeSupported=n}return(0,p.Z)(e,[{key:"resetInitSegment",value:function(t,r,n,i){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=e.createTrack("video"),this._audioTrack=e.createTrack("audio",i),this._id3Track=e.createTrack("id3"),this._txtTrack=e.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.audioCodec=r,this.videoCodec=n,this._duration=i}},{key:"resetTimeStamp",value:function(){}},{key:"resetContiguity",value:function(){var e=this._audioTrack,t=this._avcTrack,r=this._id3Track;e&&(e.pesData=null),t&&(t.pesData=null),r&&(r.pesData=null),this.aacOverFlow=null,this.avcSample=null,this.remainderData=null}},{key:"demux",value:function(t,r){var n,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];i||(this.sampleAes=null);var s=this._avcTrack,o=this._audioTrack,l=this._id3Track,u=this._txtTrack,c=s.pid,d=s.pesData,f=o.pid,h=l.pid,v=o.pesData,g=l.pesData,p=null,m=this.pmtParsed,y=this._pmtId,b=t.length;if(this.remainderData&&(b=(t=ze(this.remainderData,t)).length,this.remainderData=null),b<wn&&!a)return this.remainderData=t,{audioTrack:o,videoTrack:s,id3Track:l,textTrack:u};var k=Math.max(0,e.syncOffset(t));(b-=(b-k)%wn)<t.byteLength&&!a&&(this.remainderData=new Uint8Array(t.buffer,b,t.buffer.byteLength-b));for(var E=0,T=k;T<b;T+=wn)if(71===t[T]){var _=!!(64&t[T+1]),w=Rn(t,T),S=(48&t[T+3])>>4,L=void 0;if(S>1){if((L=T+5+t[T+4])===T+wn)continue}else L=T+4;switch(w){case c:_&&(d&&(n=In(d))&&this.parseAVCPES(s,u,n,!1),d={data:[],size:0}),d&&(d.data.push(t.subarray(L,T+wn)),d.size+=T+wn-L);break;case f:if(_){if(v&&(n=In(v)))switch(o.segmentCodec){case"aac":this.parseAACPES(o,n);break;case"mp3":this.parseMPEGPES(o,n)}v={data:[],size:0}}v&&(v.data.push(t.subarray(L,T+wn)),v.size+=T+wn-L);break;case h:_&&(g&&(n=In(g))&&this.parseID3PES(l,n),g={data:[],size:0}),g&&(g.data.push(t.subarray(L,T+wn)),g.size+=T+wn-L);break;case 0:_&&(L+=t[L]+1),y=this._pmtId=An(t,L);break;case y:_&&(L+=t[L]+1);var R=xn(t,L,this.typeSupported,i);(c=R.avc)>0&&(s.pid=c),(f=R.audio)>0&&(o.pid=f,o.segmentCodec=R.segmentCodec),(h=R.id3)>0&&(l.pid=h),null===p||m||(G.warn("MPEG-TS PMT found at ".concat(T," after unknown PID '").concat(p,"'. Backtracking to sync byte @").concat(k," to parse all TS packets.")),p=null,T=k-188),m=this.pmtParsed=!0;break;case 17:case 8191:break;default:p=w}}else E++;if(E>0){var A=new Error("Found ".concat(E," TS packet/s that do not start with 0x47"));this.observer.emit(M.ERROR,M.ERROR,{type:O.MEDIA_ERROR,details:N.FRAG_PARSING_ERROR,fatal:!1,error:A,reason:A.message})}s.pesData=d,o.pesData=v,l.pesData=g;var x={audioTrack:o,videoTrack:s,id3Track:l,textTrack:u};return a&&this.extractRemainingSamples(x),x}},{key:"flush",value:function(){var e,t=this.remainderData;return this.remainderData=null,e=t?this.demux(t,-1,!1,!0):{videoTrack:this._avcTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(e),this.sampleAes?this.decrypt(e,this.sampleAes):e}},{key:"extractRemainingSamples",value:function(e){var t,r=e.audioTrack,n=e.videoTrack,i=e.id3Track,a=e.textTrack,s=n.pesData,o=r.pesData,l=i.pesData;if(s&&(t=In(s))?(this.parseAVCPES(n,a,t,!0),n.pesData=null):n.pesData=s,o&&(t=In(o))){switch(r.segmentCodec){case"aac":this.parseAACPES(r,t);break;case"mp3":this.parseMPEGPES(r,t)}r.pesData=null}else null!=o&&o.size&&G.log("last AAC PES packet truncated,might overlap between fragments"),r.pesData=o;l&&(t=In(l))?(this.parseID3PES(i,t),i.pesData=null):i.pesData=l}},{key:"demuxSampleAes",value:function(e,t,r){var n=this.demux(e,r,!0,!this.config.progressive),i=this.sampleAes=new _n(this.observer,this.config,t);return this.decrypt(n,i)}},{key:"decrypt",value:function(e,t){return new Promise((function(r){var n=e.audioTrack,i=e.videoTrack;n.samples&&"aac"===n.segmentCodec?t.decryptAacSamples(n.samples,0,(function(){i.samples?t.decryptAvcSamples(i.samples,0,0,(function(){r(e)})):r(e)})):i.samples&&t.decryptAvcSamples(i.samples,0,0,(function(){r(e)}))}))}},{key:"destroy",value:function(){this._duration=0}},{key:"parseAVCPES",value:function(e,t,r,n){var i,a=this,s=this.parseAVCNALu(e,r.data),o=this.avcSample,l=!1;r.data=null,o&&s.length&&!e.audFound&&(Dn(o,e),o=this.avcSample=Ln(!1,r.pts,r.dts,"")),s.forEach((function(n){var s;switch(n.type){case 1:var u=!1;i=!0;var c,d=n.data;if(l&&d.length>4){var f=new Tn(d).readSliceType();2!==f&&4!==f&&7!==f&&9!==f||(u=!0)}u&&null!=(c=o)&&c.frame&&!o.key&&(Dn(o,e),o=a.avcSample=null),o||(o=a.avcSample=Ln(!0,r.pts,r.dts,"")),o.frame=!0,o.key=u;break;case 5:i=!0,null!=(s=o)&&s.frame&&!o.key&&(Dn(o,e),o=a.avcSample=null),o||(o=a.avcSample=Ln(!0,r.pts,r.dts,"")),o.key=!0,o.frame=!0;break;case 6:i=!0,We(n.data,1,r.pts,t.samples);break;case 7:if(i=!0,l=!0,!e.sps){var h=n.data,v=new Tn(h).readSPS();e.width=v.width,e.height=v.height,e.pixelRatio=v.pixelRatio,e.sps=[h],e.duration=a._duration;for(var g=h.subarray(1,4),p="avc1.",m=0;m<3;m++){var y=g[m].toString(16);y.length<2&&(y="0"+y),p+=y}e.codec=p}break;case 8:i=!0,e.pps||(e.pps=[n.data]);break;case 9:i=!1,e.audFound=!0,o&&Dn(o,e),o=a.avcSample=Ln(!1,r.pts,r.dts,"");break;case 12:i=!0;break;default:i=!1,o&&(o.debug+="unknown NAL "+n.type+" ")}o&&i&&o.units.push(n)})),n&&o&&(Dn(o,e),this.avcSample=null)}},{key:"getLastNalUnit",value:function(e){var t,r,n=this.avcSample;if(n&&0!==n.units.length||(n=e[e.length-1]),null!=(t=n)&&t.units){var i=n.units;r=i[i.length-1]}return r}},{key:"parseAVCNALu",value:function(e,t){var r,n,i=t.byteLength,a=e.naluState||0,s=a,o=[],l=0,u=-1,c=0;for(-1===a&&(u=0,c=31&t[0],a=0,l=1);l<i;)if(r=t[l++],a)if(1!==a)if(r)if(1===r){if(u>=0){var d={data:t.subarray(u,l-a-1),type:c};o.push(d)}else{var f=this.getLastNalUnit(e.samples);if(f&&(s&&l<=4-s&&f.state&&(f.data=f.data.subarray(0,f.data.byteLength-s)),(n=l-a-1)>0)){var h=new Uint8Array(f.data.byteLength+n);h.set(f.data,0),h.set(t.subarray(0,n),f.data.byteLength),f.data=h,f.state=0}}l<i?(u=l,c=31&t[l],a=0):a=-1}else a=0;else a=3;else a=r?0:2;else a=r?0:1;if(u>=0&&a>=0){var v={data:t.subarray(u,i),type:c,state:a};o.push(v)}if(0===o.length){var g=this.getLastNalUnit(e.samples);if(g){var p=new Uint8Array(g.data.byteLength+t.byteLength);p.set(g.data,0),p.set(t,g.data.byteLength),g.data=p}}return e.naluState=a,o}},{key:"parseAACPES",value:function(e,t){var r,n,i,a=0,s=this.aacOverFlow,o=t.data;if(s){this.aacOverFlow=null;var l=s.missing,u=s.sample.unit.byteLength;if(-1===l){var c=new Uint8Array(u+o.byteLength);c.set(s.sample.unit,0),c.set(o,u),o=c}else{var d=u-l;s.sample.unit.set(o.subarray(0,l),d),e.samples.push(s.sample),a=s.missing}}for(r=a,n=o.length;r<n-1&&!nn(o,r);r++);if(r!==a){var f,h=r<n-1;f=h?"AAC PES did not start with ADTS header,offset:".concat(r):"No ADTS header found in AAC PES";var v=new Error(f);if(G.warn("parsing error: ".concat(f)),this.observer.emit(M.ERROR,M.ERROR,{type:O.MEDIA_ERROR,details:N.FRAG_PARSING_ERROR,fatal:!1,levelRetry:h,error:v,reason:f}),!h)return}if(sn(e,this.observer,o,r,this.audioCodec),void 0!==t.pts)i=t.pts;else{if(!s)return void G.warn("[tsdemuxer]: AAC PES unknown PTS");var g=on(e.samplerate);i=s.sample.pts+g}for(var p,m=0;r<n;){if(r+=(p=ln(e,o,r,i,m)).length,p.missing){this.aacOverFlow=p;break}for(m++;r<n-1&&!nn(o,r);r++);}}},{key:"parseMPEGPES",value:function(e,t){var r=t.data,n=r.length,i=0,a=0,s=t.pts;if(void 0!==s)for(;a<n;)if(kn(r,a)){var o=mn(e,r,a,s,i);if(!o)break;a+=o.length,i++}else a++;else G.warn("[tsdemuxer]: MPEG PES unknown PTS")}},{key:"parseID3PES",value:function(e,t){if(void 0!==t.pts){var r=C({},t,{type:this._avcTrack?Nt:Ot,duration:Number.POSITIVE_INFINITY});e.samples.push(r)}else G.warn("[tsdemuxer]: ID3 PES unknown PTS")}}],[{key:"probe",value:function(t){var r=e.syncOffset(t);return r>0&&G.warn("MPEG2-TS detected but first sync word found @ offset ".concat(r)),-1!==r}},{key:"syncOffset",value:function(e){for(var t=e.length,r=Math.min(940,e.length-wn)+1,n=0;n<r;){for(var i=!1,a=-1,s=0,o=n;o<t;o+=wn){if(71!==e[o]){if(s)return-1;break}if(s++,-1===a&&0!==(a=o)&&(r=Math.min(a+18612,e.length-wn)+1),i||(i=0===Rn(e,o)),i&&s>1&&(0===a&&s>2||o+wn>r))return a}n++}return-1}},{key:"createTrack",value:function(e,t){return{container:"video"===e||"audio"===e?"video/mp2t":void 0,type:e,id:Me[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:"audio"===e?t:void 0}}}]),e}();function Ln(e,t,r,n){return{key:e,frame:!1,pts:t,dts:r,units:[],debug:n,length:0}}function Rn(e,t){return((31&e[t+1])<<8)+e[t+2]}function An(e,t){return(31&e[t+10])<<8|e[t+11]}function xn(e,t,r,n){var i={audio:-1,avc:-1,id3:-1,segmentCodec:"aac"},a=t+3+((15&e[t+1])<<8|e[t+2])-4;for(t+=12+((15&e[t+10])<<8|e[t+11]);t<a;){var s=Rn(e,t);switch(e[t]){case 207:if(!n){G.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:-1===i.audio&&(i.audio=s);break;case 21:-1===i.id3&&(i.id3=s);break;case 219:if(!n){G.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:-1===i.avc&&(i.avc=s);break;case 3:case 4:!0!==r.mpeg&&!0!==r.mp3?G.log("MPEG audio found, not supported in this browser"):-1===i.audio&&(i.audio=s,i.segmentCodec="mp3");break;case 36:G.warn("Unsupported HEVC stream type found")}t+=5+((15&e[t+3])<<8|e[t+4])}return i}function In(e){var t,r,n,i,a,s=0,o=e.data;if(!e||0===e.size)return null;for(;o[0].length<19&&o.length>1;){var l=new Uint8Array(o[0].length+o[1].length);l.set(o[0]),l.set(o[1],o[0].length),o[0]=l,o.splice(1,1)}if(1===((t=o[0])[0]<<16)+(t[1]<<8)+t[2]){if((r=(t[4]<<8)+t[5])&&r>e.size-6)return null;var u=t[7];192&u&&(i=536870912*(14&t[9])+4194304*(255&t[10])+16384*(254&t[11])+128*(255&t[12])+(254&t[13])/2,64&u?i-(a=536870912*(14&t[14])+4194304*(255&t[15])+16384*(254&t[16])+128*(255&t[17])+(254&t[18])/2)>54e5&&(G.warn("".concat(Math.round((i-a)/9e4),"s delta between PTS and DTS, align them")),i=a):a=i);var c=(n=t[8])+9;if(e.size<=c)return null;e.size-=c;for(var d=new Uint8Array(e.size),f=0,h=o.length;f<h;f++){var v=(t=o[f]).byteLength;if(c){if(c>v){c-=v;continue}t=t.subarray(c),v-=c,c=0}d.set(t,s),s+=v}return r&&(r-=n+3),{data:d,pts:i,dts:a,len:r}}return null}function Dn(e,t){if(e.units.length&&e.frame){if(void 0===e.pts){var r=t.samples,n=r.length;if(!n)return void t.dropped++;var i=r[n-1];e.pts=i.pts,e.dts=i.dts}t.samples.push(e)}e.debug.length&&G.log(e.pts+"/"+e.dts+":"+e.debug)}var Cn=function(e){(0,d.Z)(r,e);var t=k(r);function r(){return(0,g.Z)(this,r),t.apply(this,arguments)}return(0,p.Z)(r,[{key:"resetInitSegment",value:function(e,t,n,i){(0,c.Z)((0,h.Z)(r.prototype),"resetInitSegment",this).call(this,e,t,n,i),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}},{key:"canParse",value:function(e,t){return function(e,t){return bn(e,t)&&4<=e.length-t}(e,t)}},{key:"appendFrame",value:function(e,t,r){if(null!==this.basePTS)return mn(e,t,r,this.basePTS,this.frameIndex)}}],[{key:"probe",value:function(e){if(!e)return!1;for(var t=(ye(e,0)||[]).length,r=e.length;t<r;t++)if(En(e,t))return G.log("MPEG Audio sync word found !"),!0;return!1}}]),r}($r),Pn=function(){function e(){(0,g.Z)(this,e)}return(0,p.Z)(e,null,[{key:"getSilentFrame",value:function(e,t){if("mp4a.40.2"===e){if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}}}]),e}(),Mn=Math.pow(2,32)-1,On=function(){function e(){(0,g.Z)(this,e)}return(0,p.Z)(e,null,[{key:"init",value:function(){var t;for(t in e.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},e.types)e.types.hasOwnProperty(t)&&(e.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);var r=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),n=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);e.HDLR_TYPES={video:r,audio:n};var i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),a=new Uint8Array([0,0,0,0,0,0,0,0]);e.STTS=e.STSC=e.STCO=a,e.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),e.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),e.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),e.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var s=new Uint8Array([105,115,111,109]),o=new Uint8Array([97,118,99,49]),l=new Uint8Array([0,0,0,1]);e.FTYP=e.box(e.types.ftyp,s,l,s,o),e.DINF=e.box(e.types.dinf,e.box(e.types.dref,i))}},{key:"box",value:function(e){for(var t=8,r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];for(var a=n.length,s=a;a--;)t+=n[a].byteLength;var o=new Uint8Array(t);for(o[0]=t>>24&255,o[1]=t>>16&255,o[2]=t>>8&255,o[3]=255&t,o.set(e,4),a=0,t=8;a<s;a++)o.set(n[a],t),t+=n[a].byteLength;return o}},{key:"hdlr",value:function(t){return e.box(e.types.hdlr,e.HDLR_TYPES[t])}},{key:"mdat",value:function(t){return e.box(e.types.mdat,t)}},{key:"mdhd",value:function(t,r){r*=t;var n=Math.floor(r/(Mn+1)),i=Math.floor(r%(Mn+1));return e.box(e.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,n>>24,n>>16&255,n>>8&255,255&n,i>>24,i>>16&255,i>>8&255,255&i,85,196,0,0]))}},{key:"mdia",value:function(t){return e.box(e.types.mdia,e.mdhd(t.timescale,t.duration),e.hdlr(t.type),e.minf(t))}},{key:"mfhd",value:function(t){return e.box(e.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))}},{key:"minf",value:function(t){return"audio"===t.type?e.box(e.types.minf,e.box(e.types.smhd,e.SMHD),e.DINF,e.stbl(t)):e.box(e.types.minf,e.box(e.types.vmhd,e.VMHD),e.DINF,e.stbl(t))}},{key:"moof",value:function(t,r,n){return e.box(e.types.moof,e.mfhd(t),e.traf(n,r))}},{key:"moov",value:function(t){for(var r=t.length,n=[];r--;)n[r]=e.trak(t[r]);return e.box.apply(null,[e.types.moov,e.mvhd(t[0].timescale,t[0].duration)].concat(n).concat(e.mvex(t)))}},{key:"mvex",value:function(t){for(var r=t.length,n=[];r--;)n[r]=e.trex(t[r]);return e.box.apply(null,[e.types.mvex].concat(n))}},{key:"mvhd",value:function(t,r){r*=t;var n=Math.floor(r/(Mn+1)),i=Math.floor(r%(Mn+1)),a=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,n>>24,n>>16&255,n>>8&255,255&n,i>>24,i>>16&255,i>>8&255,255&i,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return e.box(e.types.mvhd,a)}},{key:"sdtp",value:function(t){var r,n,i=t.samples||[],a=new Uint8Array(4+i.length);for(r=0;r<i.length;r++)n=i[r].flags,a[r+4]=n.dependsOn<<4|n.isDependedOn<<2|n.hasRedundancy;return e.box(e.types.sdtp,a)}},{key:"stbl",value:function(t){return e.box(e.types.stbl,e.stsd(t),e.box(e.types.stts,e.STTS),e.box(e.types.stsc,e.STSC),e.box(e.types.stsz,e.STSZ),e.box(e.types.stco,e.STCO))}},{key:"avc1",value:function(t){var r,n,i,a=[],s=[];for(r=0;r<t.sps.length;r++)i=(n=t.sps[r]).byteLength,a.push(i>>>8&255),a.push(255&i),a=a.concat(Array.prototype.slice.call(n));for(r=0;r<t.pps.length;r++)i=(n=t.pps[r]).byteLength,s.push(i>>>8&255),s.push(255&i),s=s.concat(Array.prototype.slice.call(n));var o=e.box(e.types.avcC,new Uint8Array([1,a[3],a[4],a[5],255,224|t.sps.length].concat(a).concat([t.pps.length]).concat(s))),l=t.width,u=t.height,c=t.pixelRatio[0],d=t.pixelRatio[1];return e.box(e.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,255&l,u>>8&255,255&u,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,e.box(e.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),e.box(e.types.pasp,new Uint8Array([c>>24,c>>16&255,c>>8&255,255&c,d>>24,d>>16&255,d>>8&255,255&d])))}},{key:"esds",value:function(e){var t=e.config.length;return new Uint8Array([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([t]).concat(e.config).concat([6,1,2]))}},{key:"mp4a",value:function(t){var r=t.samplerate;return e.box(e.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,r>>8&255,255&r,0,0]),e.box(e.types.esds,e.esds(t)))}},{key:"mp3",value:function(t){var r=t.samplerate;return e.box(e.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,r>>8&255,255&r,0,0]))}},{key:"stsd",value:function(t){return"audio"===t.type?"mp3"===t.segmentCodec&&"mp3"===t.codec?e.box(e.types.stsd,e.STSD,e.mp3(t)):e.box(e.types.stsd,e.STSD,e.mp4a(t)):e.box(e.types.stsd,e.STSD,e.avc1(t))}},{key:"tkhd",value:function(t){var r=t.id,n=t.duration*t.timescale,i=t.width,a=t.height,s=Math.floor(n/(Mn+1)),o=Math.floor(n%(Mn+1));return e.box(e.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,r>>24&255,r>>16&255,r>>8&255,255&r,0,0,0,0,s>>24,s>>16&255,s>>8&255,255&s,o>>24,o>>16&255,o>>8&255,255&o,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,i>>8&255,255&i,0,0,a>>8&255,255&a,0,0]))}},{key:"traf",value:function(t,r){var n=e.sdtp(t),i=t.id,a=Math.floor(r/(Mn+1)),s=Math.floor(r%(Mn+1));return e.box(e.types.traf,e.box(e.types.tfhd,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i])),e.box(e.types.tfdt,new Uint8Array([1,0,0,0,a>>24,a>>16&255,a>>8&255,255&a,s>>24,s>>16&255,s>>8&255,255&s])),e.trun(t,n.length+16+20+8+16+8+8),n)}},{key:"trak",value:function(t){return t.duration=t.duration||4294967295,e.box(e.types.trak,e.tkhd(t),e.mdia(t))}},{key:"trex",value:function(t){var r=t.id;return e.box(e.types.trex,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}},{key:"trun",value:function(t,r){var n,i,a,s,o,l,u=t.samples||[],c=u.length,d=12+16*c,f=new Uint8Array(d);for(r+=8+d,f.set(["video"===t.type?1:0,0,15,1,c>>>24&255,c>>>16&255,c>>>8&255,255&c,r>>>24&255,r>>>16&255,r>>>8&255,255&r],0),n=0;n<c;n++)a=(i=u[n]).duration,s=i.size,o=i.flags,l=i.cts,f.set([a>>>24&255,a>>>16&255,a>>>8&255,255&a,s>>>24&255,s>>>16&255,s>>>8&255,255&s,o.isLeading<<2|o.dependsOn,o.isDependedOn<<6|o.hasRedundancy<<4|o.paddingValue<<1|o.isNonSync,61440&o.degradPrio,15&o.degradPrio,l>>>24&255,l>>>16&255,l>>>8&255,255&l],12+16*n);return e.box(e.types.trun,f)}},{key:"initSegment",value:function(t){e.types||e.init();var r=e.moov(t),n=new Uint8Array(e.FTYP.byteLength+r.byteLength);return n.set(e.FTYP),n.set(r,e.FTYP.byteLength),n}}]),e}();On.types=void 0,On.HDLR_TYPES=void 0,On.STTS=void 0,On.STSC=void 0,On.STCO=void 0,On.STSZ=void 0,On.VMHD=void 0,On.SMHD=void 0,On.STSD=void 0,On.FTYP=void 0,On.DINF=void 0;function Nn(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=e*t*r;return n?Math.round(i):i}function Fn(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Nn(e,1e3,11111111111111112e-21,t)}var Zn=null,Un=null,Bn=function(){function e(t,r,n){if((0,g.Z)(this,e),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=t,this.config=r,this.typeSupported=n,this.ISGenerated=!1,null===Zn){var i=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Zn=i?parseInt(i[1]):0}if(null===Un){var a=navigator.userAgent.match(/Safari\/(\d+)/i);Un=a?parseInt(a[1]):0}}return(0,p.Z)(e,[{key:"destroy",value:function(){}},{key:"resetTimeStamp",value:function(e){G.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=e}},{key:"resetNextTimestamp",value:function(){G.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}},{key:"resetInitSegment",value:function(){G.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1}},{key:"getVideoStartPts",value:function(e){var t=!1,r=e.reduce((function(e,r){var n=r.pts-e;return n<-4294967296?(t=!0,jn(e,r.pts)):n>0?e:r.pts}),e[0].pts);return t&&G.debug("PTS rollover detected"),r}},{key:"remux",value:function(e,t,r,n,i,a,s,o){var l,u,c,d,f,h,v=i,g=i,p=e.pid>-1,m=t.pid>-1,y=t.samples.length,b=e.samples.length>0,k=s&&y>0||y>1;if((!p||b)&&(!m||k)||this.ISGenerated||s){this.ISGenerated||(c=this.generateIS(e,t,i,a));var E,T=this.isVideoContiguous,_=-1;if(k&&(_=function(e){for(var t=0;t<e.length;t++)if(e[t].key)return t;return-1}(t.samples),!T&&this.config.forceKeyFrameOnDiscontinuity))if(h=!0,_>0){G.warn("[mp4-remuxer]: Dropped ".concat(_," out of ").concat(y," video samples due to a missing keyframe"));var w=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(_),t.dropped+=_,E=g+=(t.samples[0].pts-w)/t.inputTimeScale}else-1===_&&(G.warn("[mp4-remuxer]: No keyframe found out of ".concat(y," video samples")),h=!1);if(this.ISGenerated){if(b&&k){var S=this.getVideoStartPts(t.samples),L=(jn(e.samples[0].pts,S)-S)/t.inputTimeScale;v+=Math.max(0,L),g+=Math.max(0,-L)}if(b){if(e.samplerate||(G.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),c=this.generateIS(e,t,i,a)),u=this.remuxAudio(e,v,this.isAudioContiguous,a,m||k||o===Lt?g:void 0),k){var R=u?u.endPTS-u.startPTS:0;t.inputTimeScale||(G.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),c=this.generateIS(e,t,i,a)),l=this.remuxVideo(t,g,T,R)}}else k&&(l=this.remuxVideo(t,g,T,0));l&&(l.firstKeyFrame=_,l.independent=-1!==_,l.firstKeyFramePTS=E)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(r.samples.length&&(f=Gn(r,i,this._initPTS,this._initDTS)),n.samples.length&&(d=Kn(n,i,this._initPTS))),{audio:u,video:l,initSegment:c,independent:h,text:d,id3:f}}},{key:"generateIS",value:function(e,t,r,n){var i,a,s,o=e.samples,l=t.samples,u=this.typeSupported,c={},d=this._initPTS,f=!d||n,h="audio/mp4";if(f&&(i=a=1/0),e.config&&o.length&&(e.timescale=e.samplerate,"mp3"===e.segmentCodec&&(u.mpeg?(h="audio/mpeg",e.codec=""):u.mp3&&(e.codec="mp3")),c.audio={id:"audio",container:h,codec:e.codec,initSegment:"mp3"===e.segmentCodec&&u.mpeg?new Uint8Array(0):On.initSegment([e]),metadata:{channelCount:e.channelCount}},f&&(s=e.inputTimeScale,d&&s===d.timescale?f=!1:i=a=o[0].pts-Math.round(s*r))),t.sps&&t.pps&&l.length&&(t.timescale=t.inputTimeScale,c.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:On.initSegment([t]),metadata:{width:t.width,height:t.height}},f))if(s=t.inputTimeScale,d&&s===d.timescale)f=!1;else{var v=this.getVideoStartPts(l),g=Math.round(s*r);a=Math.min(a,jn(l[0].dts,v)-g),i=Math.min(i,v-g)}if(Object.keys(c).length)return this.ISGenerated=!0,f?(this._initPTS={baseTime:i,timescale:s},this._initDTS={baseTime:a,timescale:s}):i=s=void 0,{tracks:c,initPTS:i,timescale:s}}},{key:"remuxVideo",value:function(e,t,r,n){var i,a,s=e.inputTimeScale,o=e.samples,l=[],u=o.length,c=this._initPTS,d=this.nextAvcDts,f=8,h=this.videoSampleDuration,v=Number.POSITIVE_INFINITY,g=Number.NEGATIVE_INFINITY,p=!1;r&&null!==d||(d=t*s-(o[0].pts-jn(o[0].dts,o[0].pts)));for(var m=c.baseTime*s/c.timescale,y=0;y<u;y++){var b=o[y];b.pts=jn(b.pts-m,d),b.dts=jn(b.dts-m,d),b.dts<o[y>0?y-1:y].dts&&(p=!0)}p&&o.sort((function(e,t){var r=e.dts-t.dts,n=e.pts-t.pts;return r||n})),i=o[0].dts;var k=o[o.length-1].dts-i,E=k?Math.round(k/(u-1)):h||e.inputTimeScale/30;if(r){var T=i-d,_=T>E,w=T<-1;if((_||w)&&(_?G.warn("AVC: ".concat(Fn(T,!0)," ms (").concat(T,"dts) hole between fragments detected, filling it")):G.warn("AVC: ".concat(Fn(-T,!0)," ms (").concat(T,"dts) overlapping between fragments detected")),!w||d>=o[0].pts)){i=d;var S=o[0].pts-T;o[0].dts=i,o[0].pts=S,G.log("Video: First PTS/DTS adjusted: ".concat(Fn(S,!0),"/").concat(Fn(i,!0),", delta: ").concat(Fn(T,!0)," ms"))}}i=Math.max(0,i);for(var L=0,R=0,A=0;A<u;A++){for(var x=o[A],I=x.units,D=I.length,P=0,F=0;F<D;F++)P+=I[F].data.length;R+=P,L+=D,x.length=P,x.dts=Math.max(x.dts,i),v=Math.min(x.pts,v),g=Math.max(x.pts,g)}a=o[u-1].dts;var Z,U=R+4*L+8;try{Z=new Uint8Array(U)}catch(e){return void this.observer.emit(M.ERROR,M.ERROR,{type:O.MUX_ERROR,details:N.REMUX_ALLOC_ERROR,fatal:!1,error:e,bytes:U,reason:"fail allocating video mdat ".concat(U)})}var B=new DataView(Z.buffer);B.setUint32(0,U),Z.set(On.types.mdat,4);for(var j=!1,K=Number.POSITIVE_INFINITY,H=Number.POSITIVE_INFINITY,z=Number.NEGATIVE_INFINITY,V=Number.NEGATIVE_INFINITY,q=0;q<u;q++){for(var W=o[q],Y=W.units,X=0,Q=0,$=Y.length;Q<$;Q++){var J=Y[Q],ee=J.data,te=J.data.byteLength;B.setUint32(f,te),f+=4,Z.set(ee,f),f+=te,X+=4+te}var re=void 0;if(q<u-1)h=o[q+1].dts-W.dts,re=o[q+1].pts-W.pts;else{var ne=this.config,ie=q>0?W.dts-o[q-1].dts:E;if(re=q>0?W.pts-o[q-1].pts:E,ne.stretchShortVideoTrack&&null!==this.nextAudioPts){var ae=Math.floor(ne.maxBufferHole*s),se=(n?v+n*s:this.nextAudioPts)-W.pts;se>ae?((h=se-ie)<0?h=ie:j=!0,G.log("[mp4-remuxer]: It is approximately ".concat(se/90," ms to the next segment; using duration ").concat(h/90," ms for the last video frame."))):h=ie}else h=ie}var oe=Math.round(W.pts-W.dts);K=Math.min(K,h),z=Math.max(z,h),H=Math.min(H,re),V=Math.max(V,re),l.push(new zn(W.key,h,X,oe))}if(l.length)if(Zn){if(Zn<70){var le=l[0].flags;le.dependsOn=2,le.isNonSync=0}}else if(Un&&V-H<z-K&&E/z<.025&&0===l[0].cts){G.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");for(var ue=i,ce=0,de=l.length;ce<de;ce++){var fe=ue+l[ce].duration,he=ue+l[ce].cts;if(ce<de-1){var ve=fe+l[ce+1].cts;l[ce].duration=ve-he}else l[ce].duration=ce?l[ce-1].duration:E;l[ce].cts=0,ue=fe}}h=j||!h?E:h,this.nextAvcDts=d=a+h,this.videoSampleDuration=h,this.isVideoContiguous=!0;var ge={data1:On.moof(e.sequenceNumber++,i,C({},e,{samples:l})),data2:Z,startPTS:v/s,endPTS:(g+h)/s,startDTS:i/s,endDTS:d/s,type:"video",hasAudio:!1,hasVideo:!0,nb:l.length,dropped:e.dropped};return e.samples=[],e.dropped=0,ge}},{key:"remuxAudio",value:function(e,t,r,n,i){var a=e.inputTimeScale,s=a/(e.samplerate?e.samplerate:a),o="aac"===e.segmentCodec?1024:1152,l=o*s,u=this._initPTS,c="mp3"===e.segmentCodec&&this.typeSupported.mpeg,d=[],f=void 0!==i,h=e.samples,v=c?0:8,g=this.nextAudioPts||-1,p=t*a,m=u.baseTime*a/u.timescale;if(this.isAudioContiguous=r=r||h.length&&g>0&&(n&&Math.abs(p-g)<9e3||Math.abs(jn(h[0].pts-m,p)-g)<20*l),h.forEach((function(e){e.pts=jn(e.pts-m,p)})),!r||g<0){if(h=h.filter((function(e){return e.pts>=0})),!h.length)return;g=0===i?0:n&&!f?Math.max(0,p):h[0].pts}if("aac"===e.segmentCodec)for(var y=this.config.maxAudioFramesDrift,b=0,k=g;b<h.length;b++){var E=h[b],T=E.pts,_=T-k,w=Math.abs(1e3*_/a);if(_<=-y*l&&f)0===b&&(G.warn("Audio frame @ ".concat((T/a).toFixed(3),"s overlaps nextAudioPts by ").concat(Math.round(1e3*_/a)," ms.")),this.nextAudioPts=g=k=T);else if(_>=y*l&&w<1e4&&f){var S=Math.round(_/l);(k=T-S*l)<0&&(S--,k+=l),0===b&&(this.nextAudioPts=g=k),G.warn("[mp4-remuxer]: Injecting ".concat(S," audio frame @ ").concat((k/a).toFixed(3),"s due to ").concat(Math.round(1e3*_/a)," ms gap."));for(var L=0;L<S;L++){var R=Math.max(k,0),A=Pn.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);A||(G.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),A=E.unit.subarray()),h.splice(b,0,{unit:A,pts:R}),k+=l,b++}}E.pts=k,k+=l}for(var x,I=null,D=null,P=0,F=h.length;F--;)P+=h[F].unit.byteLength;for(var Z=0,U=h.length;Z<U;Z++){var B=h[Z],j=B.unit,K=B.pts;if(null!==D)d[Z-1].duration=Math.round((K-D)/s);else{if(r&&"aac"===e.segmentCodec&&(K=g),I=K,!(P>0))return;P+=v;try{x=new Uint8Array(P)}catch(e){return void this.observer.emit(M.ERROR,M.ERROR,{type:O.MUX_ERROR,details:N.REMUX_ALLOC_ERROR,fatal:!1,error:e,bytes:P,reason:"fail allocating audio mdat ".concat(P)})}c||(new DataView(x.buffer).setUint32(0,P),x.set(On.types.mdat,4))}x.set(j,v);var H=j.byteLength;v+=H,d.push(new zn(!0,o,H,0)),D=K}var z=d.length;if(z){var V=d[d.length-1];this.nextAudioPts=g=D+s*V.duration;var q=c?new Uint8Array(0):On.moof(e.sequenceNumber++,I/s,C({},e,{samples:d}));e.samples=[];var W=I/a,Y=g/a,X={data1:q,data2:x,startPTS:W,endPTS:Y,startDTS:W,endDTS:Y,type:"audio",hasAudio:!0,hasVideo:!1,nb:z};return this.isAudioContiguous=!0,X}}},{key:"remuxEmptyAudio",value:function(e,t,r,n){var i=e.inputTimeScale,a=i/(e.samplerate?e.samplerate:i),s=this.nextAudioPts,o=this._initDTS,l=9e4*o.baseTime/o.timescale,u=(null!==s?s:n.startDTS*i)+l,c=n.endDTS*i+l,d=1024*a,f=Math.ceil((c-u)/d),h=Pn.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(G.warn("[mp4-remuxer]: remux empty Audio"),h){for(var v=[],g=0;g<f;g++){var p=u+g*d;v.push({unit:h,pts:p,dts:p})}return e.samples=v,this.remuxAudio(e,t,r,!1)}G.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec")}}]),e}();function jn(e,t){var r;if(null===t)return e;for(r=t<e?-8589934592:8589934592;Math.abs(e-t)>4294967296;)e+=r;return e}function Gn(e,t,r,n){var i=e.samples.length;if(i){for(var a=e.inputTimeScale,s=0;s<i;s++){var o=e.samples[s];o.pts=jn(o.pts-r.baseTime*a/r.timescale,t*a)/a,o.dts=jn(o.dts-n.baseTime*a/n.timescale,t*a)/a}var l=e.samples;return e.samples=[],{samples:l}}}function Kn(e,t,r){var n=e.samples.length;if(n){for(var i=e.inputTimeScale,a=0;a<n;a++){var s=e.samples[a];s.pts=jn(s.pts-r.baseTime*i/r.timescale,t*i)/i}e.samples.sort((function(e,t){return e.pts-t.pts}));var o=e.samples;return e.samples=[],{samples:o}}}var Hn,zn=(0,p.Z)((function e(t,r,n,i){(0,g.Z)(this,e),this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=r,this.size=n,this.cts=i,this.flags=new Vn(t)})),Vn=(0,p.Z)((function e(t){(0,g.Z)(this,e),this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=t?2:1,this.isNonSync=t?0:1})),qn=function(){function e(){(0,g.Z)(this,e),this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null}return(0,p.Z)(e,[{key:"destroy",value:function(){}},{key:"resetTimeStamp",value:function(e){this.initPTS=e,this.lastEndTime=null}},{key:"resetNextTimestamp",value:function(){this.lastEndTime=null}},{key:"resetInitSegment",value:function(e,t,r,n){this.audioCodec=t,this.videoCodec=r,this.generateInitSegment(function(e,t){if(!e||!t)return e;var r=t.keyId;return r&&t.isCommonEncryption&&Be(e,["moov","trak"]).forEach((function(e){var t=Be(e,["mdia","minf","stbl","stsd"])[0].subarray(8),n=Be(t,["enca"]),i=n.length>0;i||(n=Be(t,["encv"])),n.forEach((function(e){Be(i?e.subarray(28):e.subarray(78),["sinf"]).forEach((function(e){var t=Ke(e);if(t){var n=t.subarray(8,24);n.some((function(e){return 0!==e}))||(G.log("[eme] Patching keyId in 'enc".concat(i?"a":"v",">sinf>>tenc' box: ").concat(De(n)," -> ").concat(De(r))),t.set(r,8))}}))}))})),e}(e,n)),this.emitInitSegment=!0}},{key:"generateInitSegment",value:function(e){var t=this.audioCodec,r=this.videoCodec;if(null==e||!e.byteLength)return this.initTracks=void 0,void(this.initData=void 0);var n=this.initData=Ge(e);t||(t=Wn(n.audio,Y)),r||(r=Wn(n.video,X));var i={};n.audio&&n.video?i.audiovideo={container:"video/mp4",codec:t+","+r,initSegment:e,id:"main"}:n.audio?i.audio={container:"audio/mp4",codec:t,initSegment:e,id:"audio"}:n.video?i.video={container:"video/mp4",codec:r,initSegment:e,id:"main"}:G.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=i}},{key:"remux",value:function(e,t,r,n,i,a){var s,o,l=this.initPTS,u=this.lastEndTime,c={audio:void 0,video:void 0,text:n,id3:r,initSegment:void 0};P(u)||(u=this.lastEndTime=i||0);var d=t.samples;if(null==d||!d.length)return c;var f={initPTS:void 0,timescale:1},h=this.initData;if(null!=(s=h)&&s.length||(this.generateInitSegment(d),h=this.initData),null==(o=h)||!o.length)return G.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),c;this.emitInitSegment&&(f.tracks=this.initTracks,this.emitInitSegment=!1);var v=function(e,t){for(var r=0,n=0,i=0,a=Be(e,["moof","traf"]),s=0;s<a.length;s++){var o=a[s],l=Be(o,["tfhd"])[0],u=t[Fe(l,4)];if(u){var c=u.default,d=Fe(l,0)|(null==c?void 0:c.flags),f=null==c?void 0:c.duration;8&d&&(f=Fe(l,2&d?12:8));for(var h=u.timescale||9e4,v=Be(o,["trun"]),g=0;g<v.length;g++)!(r=He(v[g]))&&f&&(r=f*Fe(v[g],4)),u.type===X?n+=r/h:u.type===Y&&(i+=r/h)}}if(0===n&&0===i){for(var p=0,m=Be(e,["sidx"]),y=0;y<m.length;y++){var b=je(m[y]);null!=b&&b.references&&(p+=b.references.reduce((function(e,t){return e+t.info.duration||0}),0))}return p}return n||i}(d,h),g=function(e,t){return Be(t,["moof","traf"]).reduce((function(t,r){var n=Be(r,["tfdt"])[0],i=n[0],a=Be(r,["tfhd"]).reduce((function(t,r){var a=Fe(r,4),s=e[a];if(s){var o=Fe(n,4);if(1===i){if(o===Ce)return G.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"),t;o*=Ce+1,o+=Fe(n,8)}var l=o/(s.timescale||9e4);if(isFinite(l)&&(null===t||l<t))return l}return t}),null);return null!==a&&isFinite(a)&&(null===t||a<t)?a:t}),null)}(h,d),p=null===g?i:g;(function(e,t,r,n){if(null===e)return!0;var i=Math.max(n,1),a=t-e.baseTime/e.timescale;return Math.abs(a-r)>i}(l,p,i,v)||f.timescale!==l.timescale&&a)&&(f.initPTS=p-i,l&&1===l.timescale&&G.warn("Adjusting initPTS by ".concat(f.initPTS-l.baseTime)),this.initPTS=l={baseTime:f.initPTS,timescale:1});var m=e?p-l.baseTime/l.timescale:u,y=m+v;!function(e,t,r){Be(t,["moof","traf"]).forEach((function(t){Be(t,["tfhd"]).forEach((function(n){var i=Fe(n,4),a=e[i];if(a){var s=a.timescale||9e4;Be(t,["tfdt"]).forEach((function(e){var t=e[0],n=Fe(e,4);if(0===t)n-=r*s,Ue(e,4,n=Math.max(n,0));else{n*=Math.pow(2,32),n+=Fe(e,8),n-=r*s,n=Math.max(n,0);var i=Math.floor(n/(Ce+1)),a=Math.floor(n%(Ce+1));Ue(e,4,i),Ue(e,8,a)}}))}}))}))}(h,d,l.baseTime/l.timescale),v>0?this.lastEndTime=y:(G.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var b=!!h.audio,k=!!h.video,E="";b&&(E+="audio"),k&&(E+="video");var T={data1:d,startPTS:m,startDTS:m,endPTS:y,endDTS:y,type:E,hasAudio:b,hasVideo:k,nb:1,dropped:0};return c.audio="audio"===T.type?T:void 0,c.video="audio"!==T.type?T:void 0,c.initSegment=f,c.id3=Gn(r,i,l,l),n.samples.length&&(c.text=Kn(n,i,l)),c}}]),e}();function Wn(e,t){var r=null==e?void 0:e.codec;return r&&r.length>4?r:"hvc1"===r||"hev1"===r?"hvc1.1.6.L120.90":"av01"===r?"av01.0.04M.08":"avc1"===r||t===X?"avc1.42e01e":"mp4a.40.5"}try{Hn=self.performance.now.bind(self.performance)}catch(e){G.debug("Unable to use Performance API on this environment"),Hn="undefined"!=typeof self&&self.Date.now}var Yn=[{demux:dn,remux:qn},{demux:Sn,remux:Bn},{demux:un,remux:Bn},{demux:Cn,remux:Bn}],Xn=function(){function e(t,r,n,i,a){(0,g.Z)(this,e),this.async=!1,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=t,this.typeSupported=r,this.config=n,this.vendor=i,this.id=a}return(0,p.Z)(e,[{key:"configure",value:function(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}},{key:"push",value:function(e,t,r,n){var i=this,a=r.transmuxing;a.executeStart=Hn();var s=new Uint8Array(e),o=this.currentTransmuxState,l=this.transmuxConfig;n&&(this.currentTransmuxState=n);var u=n||o,c=u.contiguous,d=u.discontinuity,f=u.trackSwitch,h=u.accurateTimeOffset,v=u.timeOffset,g=u.initSegmentChange,p=l.audioCodec,m=l.videoCodec,y=l.defaultInitPts,b=l.duration,k=l.initSegmentData,E=function(e,t){var r=null;return e.byteLength>0&&null!=t&&null!=t.key&&null!==t.iv&&null!=t.method&&(r=t),r}(s,t);if(E&&"AES-128"===E.method){var T=this.getDecrypter();if(!T.isSync())return this.decryptionPromise=T.webCryptoDecrypt(s,E.key.buffer,E.iv.buffer).then((function(e){var t=i.push(e,null,r);return i.decryptionPromise=null,t})),this.decryptionPromise;var _=T.softwareDecrypt(s,E.key.buffer,E.iv.buffer);if(r.part>-1&&(_=T.flush()),!_)return a.executeEnd=Hn(),Qn(r);s=new Uint8Array(_)}var w=this.needsProbing(d,f);if(w){var S=this.configureTransmuxer(s);if(S)return G.warn("[transmuxer] ".concat(S.message)),this.observer.emit(M.ERROR,M.ERROR,{type:O.MEDIA_ERROR,details:N.FRAG_PARSING_ERROR,fatal:!1,error:S,reason:S.message}),a.executeEnd=Hn(),Qn(r)}(d||f||g||w)&&this.resetInitSegment(k,p,m,b,t),(d||g||w)&&this.resetInitialTimestamp(y),c||this.resetContiguity();var L=this.transmux(s,E,v,h,r),R=this.currentTransmuxState;return R.contiguous=!0,R.discontinuity=!1,R.trackSwitch=!1,a.executeEnd=Hn(),L}},{key:"flush",value:function(e){var t=this,r=e.transmuxing;r.executeStart=Hn();var n=this.decrypter,i=this.currentTransmuxState,a=this.decryptionPromise;if(a)return a.then((function(){return t.flush(e)}));var s=[],o=i.timeOffset;if(n){var l=n.flush();l&&s.push(this.push(l,null,e))}var u=this.demuxer,c=this.remuxer;if(!u||!c)return r.executeEnd=Hn(),[Qn(e)];var d=u.flush(o);return $n(d)?d.then((function(r){return t.flushRemux(s,r,e),s})):(this.flushRemux(s,d,e),s)}},{key:"flushRemux",value:function(e,t,r){var n=t.audioTrack,i=t.videoTrack,a=t.id3Track,s=t.textTrack,o=this.currentTransmuxState,l=o.accurateTimeOffset,u=o.timeOffset;G.log("[transmuxer.ts]: Flushed fragment ".concat(r.sn).concat(r.part>-1?" p: "+r.part:""," of level ").concat(r.level));var c=this.remuxer.remux(n,i,a,s,u,l,!0,this.id);e.push({remuxResult:c,chunkMeta:r}),r.transmuxing.executeEnd=Hn()}},{key:"resetInitialTimestamp",value:function(e){var t=this.demuxer,r=this.remuxer;t&&r&&(t.resetTimeStamp(e),r.resetTimeStamp(e))}},{key:"resetContiguity",value:function(){var e=this.demuxer,t=this.remuxer;e&&t&&(e.resetContiguity(),t.resetNextTimestamp())}},{key:"resetInitSegment",value:function(e,t,r,n,i){var a=this.demuxer,s=this.remuxer;a&&s&&(a.resetInitSegment(e,t,r,n),s.resetInitSegment(e,t,r,i))}},{key:"destroy",value:function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}},{key:"transmux",value:function(e,t,r,n,i){return t&&"SAMPLE-AES"===t.method?this.transmuxSampleAes(e,t,r,n,i):this.transmuxUnencrypted(e,r,n,i)}},{key:"transmuxUnencrypted",value:function(e,t,r,n){var i=this.demuxer.demux(e,t,!1,!this.config.progressive),a=i.audioTrack,s=i.videoTrack,o=i.id3Track,l=i.textTrack;return{remuxResult:this.remuxer.remux(a,s,o,l,t,r,!1,this.id),chunkMeta:n}}},{key:"transmuxSampleAes",value:function(e,t,r,n,i){var a=this;return this.demuxer.demuxSampleAes(e,t,r).then((function(e){return{remuxResult:a.remuxer.remux(e.audioTrack,e.videoTrack,e.id3Track,e.textTrack,r,n,!1,a.id),chunkMeta:i}}))}},{key:"configureTransmuxer",value:function(e){for(var t,r=this.config,n=this.observer,i=this.typeSupported,a=this.vendor,s=0,o=Yn.length;s<o;s++)if(Yn[s].demux.probe(e)){t=Yn[s];break}if(!t)return new Error("Failed to find demuxer by probing fragment data");var l=this.demuxer,u=this.remuxer,c=t.remux,d=t.demux;u&&u instanceof c||(this.remuxer=new c(n,r,i,a)),l&&l instanceof d||(this.demuxer=new d(n,r,i),this.probe=d.probe)}},{key:"needsProbing",value:function(e,t){return!this.demuxer||!this.remuxer||e||t}},{key:"getDecrypter",value:function(){var e=this.decrypter;return e||(e=this.decrypter=new Nr(this.config)),e}}]),e}(),Qn=function(e){return{remuxResult:{},chunkMeta:e}};function $n(e){return"then"in e&&e.then instanceof Function}var Jn=(0,p.Z)((function e(t,r,n,i,a){(0,g.Z)(this,e),this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=t,this.videoCodec=r,this.initSegmentData=n,this.duration=i,this.defaultInitPts=a||null})),ei=(0,p.Z)((function e(t,r,n,i,a,s){(0,g.Z)(this,e),this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=t,this.contiguous=r,this.accurateTimeOffset=n,this.trackSwitch=i,this.timeOffset=a,this.initSegmentChange=s})),ti={exports:{}};!function(e){var t=Object.prototype.hasOwnProperty,r="~";function n(){}function i(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function a(e,t,n,a,s){if("function"!=typeof n)throw new TypeError("The listener must be a function");var o=new i(n,a||e,s),l=r?r+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],o]:e._events[l].push(o):(e._events[l]=o,e._eventsCount++),e}function s(e,t){0==--e._eventsCount?e._events=new n:delete e._events[t]}function o(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(r=!1)),o.prototype.eventNames=function(){var e,n,i=[];if(0===this._eventsCount)return i;for(n in e=this._events)t.call(e,n)&&i.push(r?n.slice(1):n);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},o.prototype.listeners=function(e){var t=r?r+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var i=0,a=n.length,s=new Array(a);i<a;i++)s[i]=n[i].fn;return s},o.prototype.listenerCount=function(e){var t=r?r+e:e,n=this._events[t];return n?n.fn?1:n.length:0},o.prototype.emit=function(e,t,n,i,a,s){var o=r?r+e:e;if(!this._events[o])return!1;var l,u,c=this._events[o],d=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),d){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,n),!0;case 4:return c.fn.call(c.context,t,n,i),!0;case 5:return c.fn.call(c.context,t,n,i,a),!0;case 6:return c.fn.call(c.context,t,n,i,a,s),!0}for(u=1,l=new Array(d-1);u<d;u++)l[u-1]=arguments[u];c.fn.apply(c.context,l)}else{var f,h=c.length;for(u=0;u<h;u++)switch(c[u].once&&this.removeListener(e,c[u].fn,void 0,!0),d){case 1:c[u].fn.call(c[u].context);break;case 2:c[u].fn.call(c[u].context,t);break;case 3:c[u].fn.call(c[u].context,t,n);break;case 4:c[u].fn.call(c[u].context,t,n,i);break;default:if(!l)for(f=1,l=new Array(d-1);f<d;f++)l[f-1]=arguments[f];c[u].fn.apply(c[u].context,l)}}return!0},o.prototype.on=function(e,t,r){return a(this,e,t,r,!1)},o.prototype.once=function(e,t,r){return a(this,e,t,r,!0)},o.prototype.removeListener=function(e,t,n,i){var a=r?r+e:e;if(!this._events[a])return this;if(!t)return s(this,a),this;var o=this._events[a];if(o.fn)o.fn!==t||i&&!o.once||n&&o.context!==n||s(this,a);else{for(var l=0,u=[],c=o.length;l<c;l++)(o[l].fn!==t||i&&!o[l].once||n&&o[l].context!==n)&&u.push(o[l]);u.length?this._events[a]=1===u.length?u[0]:u:s(this,a)}return this},o.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&s(this,t)):(this._events=new n,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=r,o.EventEmitter=o,e.exports=o}(ti);var ri=E(ti.exports),ni=it()||{isTypeSupported:function(){return!1}},ii=function(){function e(t,r,n,i){var a=this;(0,g.Z)(this,e),this.error=null,this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;var s=t.config;this.hls=t,this.id=r,this.useWorker=!!s.enableWorker,this.onTransmuxComplete=n,this.onFlush=i;var o=function(e,t){(t=t||{}).frag=a.frag,t.id=a.id,e===M.ERROR&&(a.error=t.error),a.hls.trigger(e,t)};this.observer=new ri,this.observer.on(M.FRAG_DECRYPTED,o),this.observer.on(M.ERROR,o);var l,u,c,d,f={mp4:ni.isTypeSupported("video/mp4"),mpeg:ni.isTypeSupported("audio/mpeg"),mp3:ni.isTypeSupported('audio/mp4; codecs="mp3"')},h=navigator.vendor;if(!this.useWorker||"undefined"==typeof Worker||!s.workerPath&&"function"!=typeof __HLS_WORKER_BUNDLE__)this.transmuxer=new Xn(this.observer,f,s,h,r);else try{s.workerPath?(G.log("loading Web Worker ".concat(s.workerPath,' for "').concat(r,'"')),this.workerContext=(c=s.workerPath,d=new self.URL(c,self.location.href).href,{worker:new self.Worker(d),scriptURL:d})):(G.log('injecting Web Worker for "'.concat(r,'"')),this.workerContext=(l=new self.Blob(["var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(".concat(__HLS_WORKER_BUNDLE__.toString(),")(true);")],{type:"text/javascript"}),u=self.URL.createObjectURL(l),{worker:new self.Worker(u),objectURL:u})),this.onwmsg=function(e){return a.onWorkerMessage(e)};var v=this.workerContext.worker;v.addEventListener("message",this.onwmsg),v.onerror=function(e){var t=new Error("".concat(e.message,"  (").concat(e.filename,":").concat(e.lineno,")"));s.enableWorker=!1,G.warn('Error in "'.concat(r,'" Web Worker, fallback to inline')),a.hls.trigger(M.ERROR,{type:O.OTHER_ERROR,details:N.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:t})},v.postMessage({cmd:"init",typeSupported:f,vendor:h,id:r,config:JSON.stringify(s)})}catch(e){G.warn('Error setting up "'.concat(r,'" Web Worker, fallback to inline'),e),this.resetWorker(),this.error=null,this.transmuxer=new Xn(this.observer,f,s,h,r)}}return(0,p.Z)(e,[{key:"resetWorker",value:function(){if(this.workerContext){var e=this.workerContext,t=e.worker,r=e.objectURL;r&&self.URL.revokeObjectURL(r),t.removeEventListener("message",this.onwmsg),t.onerror=null,t.terminate(),this.workerContext=null}}},{key:"destroy",value:function(){if(this.workerContext)this.resetWorker(),this.onwmsg=void 0;else{var e=this.transmuxer;e&&(e.destroy(),this.transmuxer=null)}var t=this.observer;t&&t.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null}},{key:"push",value:function(e,t,r,n,i,a,s,o,l,u){var c,d,f=this;l.transmuxing.start=self.performance.now();var h=this.transmuxer,v=a?a.start:i.start,g=i.decryptdata,p=this.frag,m=!(p&&i.cc===p.cc),y=!(p&&l.level===p.level),b=p?l.sn-p.sn:-1,k=this.part?l.part-this.part.index:-1,E=0===b&&l.id>1&&l.id===(null==p?void 0:p.stats.chunkCount),T=!y&&(1===b||0===b&&(1===k||E&&k<=0)),_=self.performance.now();(y||b||0===i.stats.parsing.start)&&(i.stats.parsing.start=_),!a||!k&&T||(a.stats.parsing.start=_);var w=!(p&&(null==(c=i.initSegment)?void 0:c.url)===(null==(d=p.initSegment)?void 0:d.url)),S=new ei(m,T,o,y,v,w);if(!T||m||w){G.log("[transmuxer-interface, ".concat(i.type,"]: Starting new transmux session for sn: ").concat(l.sn," p: ").concat(l.part," level: ").concat(l.level," id: ").concat(l.id,"\n        discontinuity: ").concat(m,"\n        trackSwitch: ").concat(y,"\n        contiguous: ").concat(T,"\n        accurateTimeOffset: ").concat(o,"\n        timeOffset: ").concat(v,"\n        initSegmentChange: ").concat(w));var L=new Jn(r,n,t,s,u);this.configureTransmuxer(L)}if(this.frag=i,this.part=a,this.workerContext)this.workerContext.worker.postMessage({cmd:"demux",data:e,decryptdata:g,chunkMeta:l,state:S},e instanceof ArrayBuffer?[e]:[]);else if(h){var R=h.push(e,g,l,S);$n(R)?(h.async=!0,R.then((function(e){f.handleTransmuxComplete(e)})).catch((function(e){f.transmuxerError(e,l,"transmuxer-interface push error")}))):(h.async=!1,this.handleTransmuxComplete(R))}}},{key:"flush",value:function(e){var t=this;e.transmuxing.start=self.performance.now();var r=this.transmuxer;if(this.workerContext)this.workerContext.worker.postMessage({cmd:"flush",chunkMeta:e});else if(r){var n=r.flush(e);$n(n)||r.async?($n(n)||(n=Promise.resolve(n)),n.then((function(r){t.handleFlushResult(r,e)})).catch((function(r){t.transmuxerError(r,e,"transmuxer-interface flush error")}))):this.handleFlushResult(n,e)}}},{key:"transmuxerError",value:function(e,t,r){this.hls&&(this.error=e,this.hls.trigger(M.ERROR,{type:O.MEDIA_ERROR,details:N.FRAG_PARSING_ERROR,chunkMeta:t,fatal:!1,error:e,err:e,reason:r}))}},{key:"handleFlushResult",value:function(e,t){var r=this;e.forEach((function(e){r.handleTransmuxComplete(e)})),this.onFlush(t)}},{key:"onWorkerMessage",value:function(e){var t=e.data,r=this.hls;switch(t.event){case"init":var n,i=null==(n=this.workerContext)?void 0:n.objectURL;i&&self.URL.revokeObjectURL(i);break;case"transmuxComplete":this.handleTransmuxComplete(t.data);break;case"flush":this.onFlush(t.data);break;case"workerLog":G[t.data.logType]&&G[t.data.logType](t.data.message);break;default:t.data=t.data||{},t.data.frag=this.frag,t.data.id=this.id,r.trigger(t.event,t.data)}}},{key:"configureTransmuxer",value:function(e){var t=this.transmuxer;this.workerContext?this.workerContext.worker.postMessage({cmd:"configure",config:e}):t&&t.configure(e)}},{key:"handleTransmuxComplete",value:function(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}]),e}(),ai=function(){function e(t,r,n,i){(0,g.Z)(this,e),this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=t,this.media=r,this.fragmentTracker=n,this.hls=i}return(0,p.Z)(e,[{key:"destroy",value:function(){this.media=null,this.hls=this.fragmentTracker=null}},{key:"poll",value:function(e,t){var r=this.config,n=this.media,i=this.stalled;if(null!==n){var a=n.currentTime,s=n.seeking,o=this.seeking&&!s,l=!this.seeking&&s;if(this.seeking=s,a===e){if(l||o)this.stalled=null;else if(!(n.paused&&!s||n.ended||0===n.playbackRate)&&Rr.getBuffered(n).length){var u=Rr.bufferInfo(n,a,0),c=u.len>0,d=u.nextStart||0;if(c||d){if(s){var f=u.len>2,h=!d||t&&t.start<=a||d-a>2&&!this.fragmentTracker.getPartialFragment(a);if(f||h)return;this.moved=!1}if(!this.moved&&null!==this.stalled){var v,g=Math.max(d,u.start||0)-a,p=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,m=(null==p||null==(v=p.details)?void 0:v.live)?2*p.details.targetduration:2,y=this.fragmentTracker.getPartialFragment(a);if(g>0&&(g<=m||y))return void this._trySkipBufferHole(y)}var b=self.performance.now();if(null!==i){var k=b-i;if(s||!(k>=250)||(this._reportStall(u),this.media)){var E=Rr.bufferInfo(n,a,r.maxBufferHole);this._tryFixBufferStall(E,k)}}else this.stalled=b}}}else if(this.moved=!0,null!==i){if(this.stallReported){var T=self.performance.now()-i;G.warn("playback not stuck anymore @".concat(a,", after ").concat(Math.round(T),"ms")),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}}}},{key:"_tryFixBufferStall",value:function(e,t){var r=this.config,n=this.fragmentTracker,i=this.media;if(null!==i){var a=i.currentTime,s=n.getPartialFragment(a);if(s&&(this._trySkipBufferHole(s)||!this.media))return;(e.len>r.maxBufferHole||e.nextStart&&e.nextStart-a<r.maxBufferHole)&&t>1e3*r.highBufferWatchdogPeriod&&(G.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}}},{key:"_reportStall",value:function(e){var t=this.hls,r=this.media;if(!this.stallReported&&r){this.stallReported=!0;var n=new Error("Playback stalling at @".concat(r.currentTime," due to low buffer (").concat(JSON.stringify(e),")"));G.warn(n.message),t.trigger(M.ERROR,{type:O.MEDIA_ERROR,details:N.BUFFER_STALLED_ERROR,fatal:!1,error:n,buffer:e.len})}}},{key:"_trySkipBufferHole",value:function(e){var t=this.config,r=this.hls,n=this.media;if(null===n)return 0;var i=n.currentTime,a=Rr.bufferInfo(n,i,0),s=i<a.start?a.start:a.nextStart;if(s){var o=a.len<=t.maxBufferHole,l=a.len>0&&a.len<1&&n.readyState<3,u=s-i;if(u>0&&(o||l)){if(u>t.maxBufferHole){var c=this.fragmentTracker,d=!1;if(0===i){var f=c.getAppendedFrag(0,St);f&&s<f.end&&(d=!0)}if(!d){var h=e||c.getAppendedFrag(i,St);if(h){for(var v=!1,g=h.end;g<s;){var p=c.getPartialFragment(g);if(!p){v=!0;break}g+=p.duration}if(v)return 0}}}var m=Math.max(s+.05,i+.1);if(G.warn("skipping hole, adjusting currentTime from ".concat(i," to ").concat(m)),this.moved=!0,this.stalled=null,n.currentTime=m,e&&!e.gap){var y=new Error("fragment loaded with buffer holes, seeking from ".concat(i," to ").concat(m));r.trigger(M.ERROR,{type:O.MEDIA_ERROR,details:N.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:y,reason:y.message,frag:e})}return m}}return 0}},{key:"_tryNudgeBuffer",value:function(){var e=this.config,t=this.hls,r=this.media,n=this.nudgeRetry;if(null!==r){var i=r.currentTime;if(this.nudgeRetry++,n<e.nudgeMaxRetry){var a=i+(n+1)*e.nudgeOffset,s=new Error("Nudging 'currentTime' from ".concat(i," to ").concat(a));G.warn(s.message),r.currentTime=a,t.trigger(M.ERROR,{type:O.MEDIA_ERROR,details:N.BUFFER_NUDGE_ON_STALL,error:s,fatal:!1})}else{var o=new Error("Playhead still not moving while enough data buffered @".concat(i," after ").concat(e.nudgeMaxRetry," nudges"));G.error(o.message),t.trigger(M.ERROR,{type:O.MEDIA_ERROR,details:N.BUFFER_STALLED_ERROR,error:o,fatal:!0})}}}}]),e}(),si=function(e){(0,d.Z)(r,e);var t=k(r);function r(e,n,i){var a;return(0,g.Z)(this,r),(a=t.call(this,e,n,i,"[stream-controller]",St)).audioCodecSwap=!1,a.gapController=null,a.level=-1,a._forceStartLoad=!1,a.altAudio=!1,a.audioOnly=!1,a.fragPlaying=null,a.onvplaying=null,a.onvseeked=null,a.fragLastKbps=0,a.couldBacktrack=!1,a.backtrackFragment=null,a.audioCodecSwitch=!1,a.videoBuffer=null,a._registerListeners(),a}return(0,p.Z)(r,[{key:"_registerListeners",value:function(){var e=this.hls;e.on(M.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(M.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(M.MANIFEST_LOADING,this.onManifestLoading,this),e.on(M.MANIFEST_PARSED,this.onManifestParsed,this),e.on(M.LEVEL_LOADING,this.onLevelLoading,this),e.on(M.LEVEL_LOADED,this.onLevelLoaded,this),e.on(M.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(M.ERROR,this.onError,this),e.on(M.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(M.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(M.BUFFER_CREATED,this.onBufferCreated,this),e.on(M.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(M.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(M.FRAG_BUFFERED,this.onFragBuffered,this)}},{key:"_unregisterListeners",value:function(){var e=this.hls;e.off(M.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(M.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(M.MANIFEST_LOADING,this.onManifestLoading,this),e.off(M.MANIFEST_PARSED,this.onManifestParsed,this),e.off(M.LEVEL_LOADED,this.onLevelLoaded,this),e.off(M.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(M.ERROR,this.onError,this),e.off(M.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(M.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(M.BUFFER_CREATED,this.onBufferCreated,this),e.off(M.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(M.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(M.FRAG_BUFFERED,this.onFragBuffered,this)}},{key:"onHandlerDestroying",value:function(){this._unregisterListeners(),this.onMediaDetaching()}},{key:"startLoad",value:function(e){if(this.levels){var t=this.lastCurrentTime,r=this.hls;if(this.stopLoad(),this.setInterval(100),this.level=-1,!this.startFragRequested){var n=r.startLevel;-1===n&&(r.config.testBandwidth&&this.levels.length>1?(n=0,this.bitrateTest=!0):n=r.nextAutoLevel),this.level=r.nextLoadLevel=n,this.loadedmetadata=!1}t>0&&-1===e&&(this.log("Override startPosition with lastCurrentTime @".concat(t.toFixed(3))),e=t),this.state=Zr,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}else this._forceStartLoad=!0,this.state=Fr}},{key:"stopLoad",value:function(){this._forceStartLoad=!1,(0,c.Z)((0,h.Z)(r.prototype),"stopLoad",this).call(this)}},{key:"doTick",value:function(){switch(this.state){case Wr:var e,t=this.levels,r=this.level,n=null==t||null==(e=t[r])?void 0:e.details;if(n&&(!n.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(n))break;this.state=Zr;break}if(this.hls.nextLoadLevel!==this.level){this.state=Zr;break}break;case jr:var i,a=self.performance.now(),s=this.retryDate;(!s||a>=s||null!=(i=this.media)&&i.seeking)&&(this.resetStartWhenNotLoaded(this.level),this.state=Zr)}this.state===Zr&&this.doTickIdle(),this.onTickEnd()}},{key:"onTickEnd",value:function(){(0,c.Z)((0,h.Z)(r.prototype),"onTickEnd",this).call(this),this.checkBuffer(),this.checkFragmentChanged()}},{key:"doTickIdle",value:function(){var e=this.hls,t=this.levelLastLoaded,r=this.levels,n=this.media,i=e.config,a=e.nextLoadLevel;if(null!==t&&(n||!this.startFragRequested&&i.startFragPrefetch)&&(!this.altAudio||!this.audioOnly)&&null!=r&&r[a]){var s=r[a],o=this.getMainFwdBufferInfo();if(null!==o){var l=this.getLevelDetails();if(l&&this._streamEnded(o,l)){var u={};return this.altAudio&&(u.type="video"),this.hls.trigger(M.BUFFER_EOS,u),void(this.state=zr)}e.loadLevel!==a&&-1===e.manualLevel&&this.log("Adapting to level ".concat(a," from level ").concat(this.level)),this.level=e.nextLoadLevel=a;var c=s.details;if(!c||this.state===Wr||c.live&&this.levelLastLoaded!==a)return this.level=a,void(this.state=Wr);var d=o.len,f=this.getMaxBufferLength(s.maxBitrate);if(!(d>=f)){this.backtrackFragment&&this.backtrackFragment.start>o.end&&(this.backtrackFragment=null);var h=this.backtrackFragment?this.backtrackFragment.start:o.end,v=this.getNextFragment(h,c);if(this.couldBacktrack&&!this.fragPrevious&&v&&"initSegment"!==v.sn&&this.fragmentTracker.getState(v)!==gr){var g,p=(null!=(g=this.backtrackFragment)?g:v).sn-c.startSN,m=c.fragments[p-1];m&&v.cc===m.cc&&(v=m,this.fragmentTracker.removeFragment(m))}else this.backtrackFragment&&o.len&&(this.backtrackFragment=null);if(v&&this.isLoopLoading(v,h)){if(!v.gap){var y=this.audioOnly&&!this.altAudio?Y:X,b=(y===X?this.videoBuffer:this.mediaBuffer)||this.media;b&&this.afterBufferFlushed(b,y,St)}v=this.getNextFragmentLoopLoading(v,c,o,St,f)}v&&(!v.initSegment||v.initSegment.data||this.bitrateTest||(v=v.initSegment),this.loadFragment(v,s,h))}}}}},{key:"loadFragment",value:function(e,t,n){var i=this.fragmentTracker.getState(e);this.fragCurrent=e,i===fr||i===vr?"initSegment"===e.sn?this._loadInitSegment(e,t):this.bitrateTest?(this.log("Fragment ".concat(e.sn," of level ").concat(e.level," is being downloaded to test bitrate and will not be buffered")),this._loadBitrateTestFrag(e,t)):(this.startFragRequested=!0,(0,c.Z)((0,h.Z)(r.prototype),"loadFragment",this).call(this,e,t,n)):this.clearTrackerIfNeeded(e)}},{key:"getBufferedFrag",value:function(e){return this.fragmentTracker.getBufferedFrag(e,St)}},{key:"followingBufferedFrag",value:function(e){return e?this.getBufferedFrag(e.end+.5):null}},{key:"immediateLevelSwitch",value:function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}},{key:"nextLevelSwitch",value:function(){var e=this.levels,t=this.media;if(null!=t&&t.readyState){var r,n=this.getAppendedFrag(t.currentTime);n&&n.start>1&&this.flushMainBuffer(0,n.start-1);var i=this.getLevelDetails();if(null!=i&&i.live){var a=this.getMainFwdBufferInfo();if(!a||a.len<2*i.targetduration)return}if(!t.paused&&e){var s=e[this.hls.nextLoadLevel],o=this.fragLastKbps;r=o&&this.fragCurrent?this.fragCurrent.duration*s.maxBitrate/(1e3*o)+1:0}else r=0;var l=this.getBufferedFrag(t.currentTime+r);if(l){var u=this.followingBufferedFrag(l);if(u){this.abortCurrentFrag();var c=u.maxStartPTS?u.maxStartPTS:u.start,d=u.duration,f=Math.max(l.end,c+Math.min(Math.max(d-this.config.maxFragLookUpTolerance,.5*d),.75*d));this.flushMainBuffer(f,Number.POSITIVE_INFINITY)}}}}},{key:"abortCurrentFrag",value:function(){var e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case Ur:case Br:case jr:case Kr:case Hr:this.state=Zr}this.nextLoadPosition=this.getLoadPosition()}},{key:"flushMainBuffer",value:function(e,t){(0,c.Z)((0,h.Z)(r.prototype),"flushMainBuffer",this).call(this,e,t,this.altAudio?"video":null)}},{key:"onMediaAttached",value:function(e,t){(0,c.Z)((0,h.Z)(r.prototype),"onMediaAttached",this).call(this,e,t);var n=t.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),n.addEventListener("playing",this.onvplaying),n.addEventListener("seeked",this.onvseeked),this.gapController=new ai(this.config,n,this.fragmentTracker,this.hls)}},{key:"onMediaDetaching",value:function(){var e=this.media;e&&this.onvplaying&&this.onvseeked&&(e.removeEventListener("playing",this.onvplaying),e.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),(0,c.Z)((0,h.Z)(r.prototype),"onMediaDetaching",this).call(this)}},{key:"onMediaPlaying",value:function(){this.tick()}},{key:"onMediaSeeked",value:function(){var e=this.media,t=e?e.currentTime:null;P(t)&&this.log("Media seeked to ".concat(t.toFixed(3)));var r=this.getMainFwdBufferInfo();null!==r&&0!==r.len?this.tick():this.warn('Main forward buffer length on "seeked" event '.concat(r?r.len:"empty",")"))}},{key:"onManifestLoading",value:function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(M.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=0,this.levels=this.fragPlaying=this.backtrackFragment=null,this.altAudio=this.audioOnly=!1}},{key:"onManifestParsed",value:function(e,t){var r,n,i,a=!1,s=!1;t.levels.forEach((function(e){(r=e.audioCodec)&&(-1!==r.indexOf("mp4a.40.2")&&(a=!0),-1!==r.indexOf("mp4a.40.5")&&(s=!0))})),this.audioCodecSwitch=a&&s&&!("function"==typeof(null==(i=Xr())||null==(n=i.prototype)?void 0:n.changeType)),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}},{key:"onLevelLoading",value:function(e,t){var r=this.levels;if(r&&this.state===Zr){var n=r[t.level];(!n.details||n.details.live&&this.levelLastLoaded!==t.level||this.waitForCdnTuneIn(n.details))&&(this.state=Wr)}}},{key:"onLevelLoaded",value:function(e,t){var r,n=this.levels,i=t.level,a=t.details,s=a.totalduration;if(n){this.log("Level ".concat(i," loaded [").concat(a.startSN,",").concat(a.endSN,"]").concat(a.lastPartSn?"[part-".concat(a.lastPartSn,"-").concat(a.lastPartIndex,"]"):"",", cc [").concat(a.startCC,", ").concat(a.endCC,"] duration:").concat(s));var o=n[i],l=this.fragCurrent;!l||this.state!==Br&&this.state!==jr||l.level===t.level&&l.urlId===o.urlId||!l.loader||this.abortCurrentFrag();var u=0;if(a.live||null!=(r=o.details)&&r.live){if(this.checkLiveUpdate(a),a.deltaUpdateFailed)return;u=this.alignPlaylists(a,o.details)}if(o.details=a,this.levelLastLoaded=i,this.hls.trigger(M.LEVEL_UPDATED,{details:a,level:i}),this.state===Wr){if(this.waitForCdnTuneIn(a))return;this.state=Zr}this.startFragRequested?a.live&&this.synchronizeToLiveEdge(a):this.setStartPosition(a,u),this.tick()}else this.warn("Levels were reset while loading level ".concat(i))}},{key:"_handleFragmentLoadProgress",value:function(e){var t,r=e.frag,n=e.part,i=e.payload,a=this.levels;if(a){var s=a[r.level],o=s.details;if(!o)return this.warn("Dropping fragment ".concat(r.sn," of level ").concat(r.level," after level details were reset")),void this.fragmentTracker.removeFragment(r);var l=s.videoCodec,u=o.PTSKnown||!o.live,c=null==(t=r.initSegment)?void 0:t.data,d=this._getAudioCodec(s),f=this.transmuxer=this.transmuxer||new ii(this.hls,St,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),h=n?n.index:-1,v=-1!==h,g=new Ar(r.level,r.sn,r.stats.chunkCount,i.byteLength,h,v),p=this.initPTS[r.cc];f.push(i,c,d,l,r,n,o.totalduration,u,g,p)}else this.warn("Levels were reset while fragment load was in progress. Fragment ".concat(r.sn," of level ").concat(r.level," will not be buffered"))}},{key:"onAudioTrackSwitching",value:function(e,t){var r=this.altAudio;if(!t.url){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var n=this.fragCurrent;n&&(this.log("Switching to main audio track, cancel main fragment load"),n.abortRequests(),this.fragmentTracker.removeFragment(n)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var i=this.hls;r&&(i.trigger(M.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null}),this.fragmentTracker.removeAllFragments()),i.trigger(M.AUDIO_TRACK_SWITCHED,t)}}},{key:"onAudioTrackSwitched",value:function(e,t){var r=t.id,n=!!this.hls.audioTracks[r].url;if(n){var i=this.videoBuffer;i&&this.mediaBuffer!==i&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=i)}this.altAudio=n,this.tick()}},{key:"onBufferCreated",value:function(e,t){var r,n,i=t.tracks,a=!1;for(var s in i){var o=i[s];if("main"===o.id){if(n=s,r=o,"video"===s){var l=i[s];l&&(this.videoBuffer=l.buffer)}}else a=!0}a&&r?(this.log("Alternate track found, use ".concat(n,".buffered to schedule main fragment loading")),this.mediaBuffer=r.buffer):this.mediaBuffer=this.media}},{key:"onFragBuffered",value:function(e,t){var r=t.frag,n=t.part;if(!r||r.type===St){if(this.fragContextChanged(r))return this.warn("Fragment ".concat(r.sn).concat(n?" p: "+n.index:""," of level ").concat(r.level," finished buffering, but was aborted. state: ").concat(this.state)),void(this.state===Hr&&(this.state=Zr));var i=n?n.stats:r.stats;this.fragLastKbps=Math.round(8*i.total/(i.buffering.end-i.loading.first)),"initSegment"!==r.sn&&(this.fragPrevious=r),this.fragBufferedComplete(r,n)}}},{key:"onError",value:function(e,t){var r;if(t.fatal)this.state=Vr;else switch(t.details){case N.FRAG_GAP:case N.FRAG_PARSING_ERROR:case N.FRAG_DECRYPT_ERROR:case N.FRAG_LOAD_ERROR:case N.FRAG_LOAD_TIMEOUT:case N.KEY_LOAD_ERROR:case N.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(St,t);break;case N.LEVEL_LOAD_ERROR:case N.LEVEL_LOAD_TIMEOUT:case N.LEVEL_PARSING_ERROR:t.levelRetry||this.state!==Wr||(null==(r=t.context)?void 0:r.type)!==Tt||(this.state=Zr);break;case N.BUFFER_FULL_ERROR:if(!t.parent||"main"!==t.parent)return;this.reduceLengthAndFlushBuffer(t)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case N.INTERNAL_EXCEPTION:this.recoverWorkerError(t)}}},{key:"checkBuffer",value:function(){var e=this.media,t=this.gapController;if(e&&t&&e.readyState){if(this.loadedmetadata||!Rr.getBuffered(e).length){var r=this.state!==Zr?this.fragCurrent:null;t.poll(this.lastCurrentTime,r)}this.lastCurrentTime=e.currentTime}}},{key:"onFragLoadEmergencyAborted",value:function(){this.state=Zr,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()}},{key:"onBufferFlushed",value:function(e,t){var r=t.type;if(r!==Y||this.audioOnly&&!this.altAudio){var n=(r===X?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(n,r,St)}}},{key:"onLevelsUpdated",value:function(e,t){this.levels=t.levels}},{key:"swapAudioCodec",value:function(){this.audioCodecSwap=!this.audioCodecSwap}},{key:"seekToStartPos",value:function(){var e=this.media;if(e){var t=e.currentTime,r=this.startPosition;if(r>=0&&t<r){if(e.seeking)return void this.log("could not seek to ".concat(r,", already seeking at ").concat(t));var n=Rr.getBuffered(e),i=(n.length?n.start(0):0)-r;i>0&&(i<this.config.maxBufferHole||i<this.config.maxFragLookUpTolerance)&&(this.log("adjusting start position by ".concat(i," to match buffer start")),r+=i,this.startPosition=r),this.log("seek to target start position ".concat(r," from current time ").concat(t)),e.currentTime=r}}}},{key:"_getAudioCodec",value:function(e){var t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t=-1!==t.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),t}},{key:"_loadBitrateTestFrag",value:function(e,t){var r=this;e.bitrateTest=!0,this._doFragLoad(e,t).then((function(n){var i=r.hls;if(n&&!r.fragContextChanged(e)){t.fragmentError=0,r.state=Zr,r.startFragRequested=!1,r.bitrateTest=!1;var a=e.stats;a.parsing.start=a.parsing.end=a.buffering.start=a.buffering.end=self.performance.now(),i.trigger(M.FRAG_LOADED,n),e.bitrateTest=!1}}))}},{key:"_handleTransmuxComplete",value:function(e){var t,r="main",n=this.hls,i=e.remuxResult,a=e.chunkMeta,s=this.getCurrentContext(a);if(s){var o=s.frag,l=s.part,u=s.level,c=i.video,d=i.text,f=i.id3,h=i.initSegment,v=u.details,g=this.altAudio?void 0:i.audio;if(this.fragContextChanged(o))this.fragmentTracker.removeFragment(o);else{if(this.state=Kr,h){if(null!=h&&h.tracks){var p=o.initSegment||o;this._bufferInitSegment(u,h.tracks,p,a),n.trigger(M.FRAG_PARSING_INIT_SEGMENT,{frag:p,id:r,tracks:h.tracks})}var m=h.initPTS,y=h.timescale;P(m)&&(this.initPTS[o.cc]={baseTime:m,timescale:y},n.trigger(M.INIT_PTS_FOUND,{frag:o,id:r,initPTS:m,timescale:y}))}if(c&&v&&"initSegment"!==o.sn){var b=v.fragments[o.sn-1-v.startSN],k=o.sn===v.startSN,E=!b||o.cc>b.cc;if(!1!==i.independent){var T=c.startPTS,_=c.endPTS,w=c.startDTS,S=c.endDTS;if(l)l.elementaryStreams[c.type]={startPTS:T,endPTS:_,startDTS:w,endDTS:S};else if(c.firstKeyFrame&&c.independent&&1===a.id&&!E&&(this.couldBacktrack=!0),c.dropped&&c.independent){var L=this.getMainFwdBufferInfo(),R=(L?L.end:this.getLoadPosition())+this.config.maxBufferHole,A=c.firstKeyFramePTS?c.firstKeyFramePTS:T;if(!k&&R<A-this.config.maxBufferHole&&!E)return void this.backtrack(o);E&&(o.gap=!0),o.setElementaryStreamInfo(c.type,o.start,_,o.start,S,!0)}o.setElementaryStreamInfo(c.type,T,_,w,S),this.backtrackFragment&&(this.backtrackFragment=o),this.bufferFragmentData(c,o,l,a,k||E)}else{if(!k&&!E)return void this.backtrack(o);o.gap=!0}}if(g){var x=g.startPTS,I=g.endPTS,D=g.startDTS,C=g.endDTS;l&&(l.elementaryStreams[Y]={startPTS:x,endPTS:I,startDTS:D,endDTS:C}),o.setElementaryStreamInfo(Y,x,I,D,C),this.bufferFragmentData(g,o,l,a)}if(v&&null!=f&&null!=(t=f.samples)&&t.length){var O={id:r,frag:o,details:v,samples:f.samples};n.trigger(M.FRAG_PARSING_METADATA,O)}if(v&&d){var N={id:r,frag:o,details:v,samples:d.samples};n.trigger(M.FRAG_PARSING_USERDATA,N)}}}else this.resetWhenMissingContext(a)}},{key:"_bufferInitSegment",value:function(e,t,r,n){var i=this;if(this.state===Kr){this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&delete t.audio;var a=t.audio,s=t.video,o=t.audiovideo;if(a){var l=e.audioCodec,u=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(l&&(l=-1!==l.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),1!==a.metadata.channelCount&&-1===u.indexOf("firefox")&&(l="mp4a.40.5")),-1!==u.indexOf("android")&&"audio/mpeg"!==a.container&&(l="mp4a.40.2",this.log("Android: force audio codec to ".concat(l))),e.audioCodec&&e.audioCodec!==l&&this.log('Swapping manifest audio codec "'.concat(e.audioCodec,'" for "').concat(l,'"')),a.levelCodec=l,a.id="main",this.log("Init audio buffer, container:".concat(a.container,", codecs[selected/level/parsed]=[").concat(l||"","/").concat(e.audioCodec||"","/").concat(a.codec,"]"))}s&&(s.levelCodec=e.videoCodec,s.id="main",this.log("Init video buffer, container:".concat(s.container,", codecs[level/parsed]=[").concat(e.videoCodec||"","/").concat(s.codec,"]"))),o&&this.log("Init audiovideo buffer, container:".concat(o.container,", codecs[level/parsed]=[").concat(e.attrs.CODECS||"","/").concat(o.codec,"]")),this.hls.trigger(M.BUFFER_CODECS,t),Object.keys(t).forEach((function(e){var a=t[e].initSegment;null!=a&&a.byteLength&&i.hls.trigger(M.BUFFER_APPENDING,{type:e,data:a,frag:r,part:null,chunkMeta:n,parent:r.type})})),this.tick()}}},{key:"getMainFwdBufferInfo",value:function(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,St)}},{key:"backtrack",value:function(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=Zr}},{key:"checkFragmentChanged",value:function(){var e=this.media,t=null;if(e&&e.readyState>1&&!1===e.seeking){var r=e.currentTime;if(Rr.isBuffered(e,r)?t=this.getAppendedFrag(r):Rr.isBuffered(e,r+.1)&&(t=this.getAppendedFrag(r+.1)),t){this.backtrackFragment=null;var n=this.fragPlaying,i=t.level;n&&t.sn===n.sn&&n.level===i&&t.urlId===n.urlId||(this.fragPlaying=t,this.hls.trigger(M.FRAG_CHANGED,{frag:t}),n&&n.level===i||this.hls.trigger(M.LEVEL_SWITCHED,{level:i}))}}}},{key:"nextLevel",get:function(){var e=this.nextBufferedFrag;return e?e.level:-1}},{key:"currentFrag",get:function(){var e=this.media;return e?this.fragPlaying||this.getAppendedFrag(e.currentTime):null}},{key:"currentProgramDateTime",get:function(){var e=this.media;if(e){var t=e.currentTime,r=this.currentFrag;if(r&&P(t)&&P(r.programDateTime)){var n=r.programDateTime+1e3*(t-r.start);return new Date(n)}}return null}},{key:"currentLevel",get:function(){var e=this.currentFrag;return e?e.level:-1}},{key:"nextBufferedFrag",get:function(){var e=this.currentFrag;return e?this.followingBufferedFrag(e):null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}]),r}(Yr),oi=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;(0,g.Z)(this,e),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=t,this.alpha_=t?Math.exp(Math.log(.5)/t):0,this.estimate_=r,this.totalWeight_=n}return(0,p.Z)(e,[{key:"sample",value:function(e,t){var r=Math.pow(this.alpha_,e);this.estimate_=t*(1-r)+r*this.estimate_,this.totalWeight_+=e}},{key:"getTotalWeight",value:function(){return this.totalWeight_}},{key:"getEstimate",value:function(){if(this.alpha_){var e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}]),e}(),li=function(){function e(t,r,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100;(0,g.Z)(this,e),this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=n,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new oi(t),this.fast_=new oi(r),this.defaultTTFB_=i,this.ttfb_=new oi(t)}return(0,p.Z)(e,[{key:"update",value:function(e,t){var r=this.slow_,n=this.fast_,i=this.ttfb_;r.halfLife!==e&&(this.slow_=new oi(e,r.getEstimate(),r.getTotalWeight())),n.halfLife!==t&&(this.fast_=new oi(t,n.getEstimate(),n.getTotalWeight())),i.halfLife!==e&&(this.ttfb_=new oi(e,i.getEstimate(),i.getTotalWeight()))}},{key:"sample",value:function(e,t){var r=(e=Math.max(e,this.minDelayMs_))/1e3,n=8*t/r;this.fast_.sample(r,n),this.slow_.sample(r,n)}},{key:"sampleTTFB",value:function(e){var t=e/1e3,r=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(r,Math.max(e,5))}},{key:"canEstimate",value:function(){return this.fast_.getTotalWeight()>=this.minWeight_}},{key:"getEstimate",value:function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}},{key:"getEstimateTTFB",value:function(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}},{key:"destroy",value:function(){}}]),e}(),ui=function(){function e(t){(0,g.Z)(this,e),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=-1,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=t;var r=t.config;this.bwEstimator=new li(r.abrEwmaSlowVoD,r.abrEwmaFastVoD,r.abrEwmaDefaultEstimate),this.registerListeners()}return(0,p.Z)(e,[{key:"registerListeners",value:function(){var e=this.hls;e.on(M.FRAG_LOADING,this.onFragLoading,this),e.on(M.FRAG_LOADED,this.onFragLoaded,this),e.on(M.FRAG_BUFFERED,this.onFragBuffered,this),e.on(M.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(M.LEVEL_LOADED,this.onLevelLoaded,this)}},{key:"unregisterListeners",value:function(){var e=this.hls;e.off(M.FRAG_LOADING,this.onFragLoading,this),e.off(M.FRAG_LOADED,this.onFragLoaded,this),e.off(M.FRAG_BUFFERED,this.onFragBuffered,this),e.off(M.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(M.LEVEL_LOADED,this.onLevelLoaded,this)}},{key:"destroy",value:function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null}},{key:"onFragLoading",value:function(e,t){var r,n=t.frag;this.ignoreFragment(n)||(this.fragCurrent=n,this.partCurrent=null!=(r=t.part)?r:null,this.clearTimer(),this.timer=self.setInterval(this.onCheck,100))}},{key:"onLevelSwitching",value:function(e,t){this.clearTimer()}},{key:"getTimeToLoadFrag",value:function(e,t,r,n){return e+r/t+(n?this.lastLevelLoadSec:0)}},{key:"onLevelLoaded",value:function(e,t){var r=this.hls.config,n=t.stats,i=n.total,a=n.bwEstimate;P(i)&&P(a)&&(this.lastLevelLoadSec=8*i/a),t.details.live?this.bwEstimator.update(r.abrEwmaSlowLive,r.abrEwmaFastLive):this.bwEstimator.update(r.abrEwmaSlowVoD,r.abrEwmaFastVoD)}},{key:"_abandonRulesCheck",value:function(){var e=this.fragCurrent,t=this.partCurrent,r=this.hls,n=r.autoLevelEnabled,i=r.media;if(e&&i){var a=performance.now(),s=t?t.stats:e.stats,o=t?t.duration:e.duration,l=a-s.loading.start;if(s.aborted||s.loaded&&s.loaded===s.total||0===e.level)return this.clearTimer(),void(this._nextAutoLevel=-1);if(n&&!i.paused&&i.playbackRate&&i.readyState){var u=r.mainForwardBufferInfo;if(null!==u){var c=this.bwEstimator.getEstimateTTFB(),d=Math.abs(i.playbackRate);if(!(l<=Math.max(c,o/(2*d)*1e3))){var f=u.len/d;if(!(f>=2*o/d)){var h=s.loading.first?s.loading.first-s.loading.start:-1,v=s.loaded&&h>-1,g=this.bwEstimator.getEstimate(),p=r.levels,m=r.minAutoLevel,y=p[e.level],b=s.total||Math.max(s.loaded,Math.round(o*y.maxBitrate/8)),k=l-h;k<1&&v&&(k=Math.min(l,8*s.loaded/g));var E=v?1e3*s.loaded/k:0,T=E?(b-s.loaded)/E:8*b/g+c/1e3;if(!(T<=f)){var _,w=E?8*E:g,S=Number.POSITIVE_INFINITY;for(_=e.level-1;_>m;_--){var L=p[_].maxBitrate;if((S=this.getTimeToLoadFrag(c/1e3,w,o*L,!p[_].details))<f)break}S>=T||S>10*o||(r.nextLoadLevel=_,v?this.bwEstimator.sample(l-Math.min(c,h),s.loaded):this.bwEstimator.sampleTTFB(l),this.clearTimer(),G.warn("[abr] Fragment ".concat(e.sn).concat(t?" part "+t.index:""," of level ").concat(e.level," is loading too slowly;\n      Time to underbuffer: ").concat(f.toFixed(3)," s\n      Estimated load time for current fragment: ").concat(T.toFixed(3)," s\n      Estimated load time for down switch fragment: ").concat(S.toFixed(3)," s\n      TTFB estimate: ").concat(h,"\n      Current BW estimate: ").concat(P(g)?(g/1024).toFixed(3):"Unknown"," Kb/s\n      New BW estimate: ").concat((this.bwEstimator.getEstimate()/1024).toFixed(3)," Kb/s\n      Aborting and switching to level ").concat(_)),e.loader&&(this.fragCurrent=this.partCurrent=null,e.abortRequests()),r.trigger(M.FRAG_LOAD_EMERGENCY_ABORTED,{frag:e,part:t,stats:s}))}}}}}}}},{key:"onFragLoaded",value:function(e,t){var r=t.frag,n=t.part,i=n?n.stats:r.stats;if(r.type===St&&this.bwEstimator.sampleTTFB(i.loading.first-i.loading.start),!this.ignoreFragment(r)){if(this.clearTimer(),this.lastLoadedFragLevel=r.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var a=n?n.duration:r.duration,s=this.hls.levels[r.level],o=(s.loaded?s.loaded.bytes:0)+i.loaded,l=(s.loaded?s.loaded.duration:0)+a;s.loaded={bytes:o,duration:l},s.realBitrate=Math.round(8*o/l)}if(r.bitrateTest){var u={stats:i,frag:r,part:n,id:r.type};this.onFragBuffered(M.FRAG_BUFFERED,u),r.bitrateTest=!1}}}},{key:"onFragBuffered",value:function(e,t){var r=t.frag,n=t.part,i=null!=n&&n.stats.loaded?n.stats:r.stats;if(!i.aborted&&!this.ignoreFragment(r)){var a=i.parsing.end-i.loading.start-Math.min(i.loading.first-i.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(a,i.loaded),i.bwEstimate=this.bwEstimator.getEstimate(),r.bitrateTest?this.bitrateTestDelay=a/1e3:this.bitrateTestDelay=0}}},{key:"ignoreFragment",value:function(e){return e.type!==St||"initSegment"===e.sn}},{key:"clearTimer",value:function(){self.clearInterval(this.timer)}},{key:"nextAutoLevel",get:function(){var e=this._nextAutoLevel,t=this.bwEstimator;if(-1!==e&&!t.canEstimate())return e;var r=this.getNextABRAutoLevel();if(-1!==e){var n=this.hls.levels;if(n.length>Math.max(e,r)&&n[e].loadError<=n[r].loadError)return e}return-1!==e&&(r=Math.min(e,r)),r},set:function(e){this._nextAutoLevel=e}},{key:"getNextABRAutoLevel",value:function(){var e=this.fragCurrent,t=this.partCurrent,r=this.hls,n=r.maxAutoLevel,i=r.config,a=r.minAutoLevel,s=r.media,o=t?t.duration:e?e.duration:0,l=s&&0!==s.playbackRate?Math.abs(s.playbackRate):1,u=this.bwEstimator?this.bwEstimator.getEstimate():i.abrEwmaDefaultEstimate,c=r.mainForwardBufferInfo,d=(c?c.len:0)/l,f=this.findBestLevel(u,a,n,d,i.abrBandWidthFactor,i.abrBandWidthUpFactor);if(f>=0)return f;G.trace("[abr] ".concat(d?"rebuffering expected":"buffer is empty",", finding optimal quality level"));var h=o?Math.min(o,i.maxStarvationDelay):i.maxStarvationDelay,v=i.abrBandWidthFactor,g=i.abrBandWidthUpFactor;if(!d){var p=this.bitrateTestDelay;p&&(h=(o?Math.min(o,i.maxLoadingDelay):i.maxLoadingDelay)-p,G.trace("[abr] bitrate test took ".concat(Math.round(1e3*p),"ms, set first fragment max fetchDuration to ").concat(Math.round(1e3*h)," ms")),v=g=1)}return f=this.findBestLevel(u,a,n,d+h,v,g),Math.max(f,0)}},{key:"findBestLevel",value:function(e,t,r,n,i,a){for(var s,o=this.fragCurrent,l=this.partCurrent,u=this.lastLoadedFragLevel,c=this.hls.levels,d=c[u],f=!(null==d||null==(s=d.details)||!s.live),h=null==d?void 0:d.codecSet,v=l?l.duration:o?o.duration:0,g=this.bwEstimator.getEstimateTTFB()/1e3,p=t,m=-1,y=r;y>=t;y--){var b=c[y];if(!b||h&&b.codecSet!==h)b&&(p=Math.min(y,p),m=Math.max(y,m));else{-1!==m&&G.trace("[abr] Skipped level(s) ".concat(p,"-").concat(m,' with CODECS:"').concat(c[m].attrs.CODECS,'"; not compatible with "').concat(d.attrs.CODECS,'"'));var k,E=b.details,T=(l?null==E?void 0:E.partTarget:null==E?void 0:E.averagetargetduration)||v;k=y<=u?i*e:a*e;var _=c[y].maxBitrate,w=this.getTimeToLoadFrag(g,k,_*T,void 0===E);if(G.trace("[abr] level:".concat(y," adjustedbw-bitrate:").concat(Math.round(k-_)," avgDuration:").concat(T.toFixed(1)," maxFetchDuration:").concat(n.toFixed(1)," fetchDuration:").concat(w.toFixed(1))),k>_&&(0===w||!P(w)||f&&!this.bitrateTestDelay||w<n))return y}}return-1}}]),e}(),ci=function(){function e(){(0,g.Z)(this,e),this.chunks=[],this.dataLength=0}return(0,p.Z)(e,[{key:"push",value:function(e){this.chunks.push(e),this.dataLength+=e.length}},{key:"flush",value:function(){var e,t=this.chunks,r=this.dataLength;return t.length?(e=1===t.length?t[0]:function(e,t){for(var r=new Uint8Array(t),n=0,i=0;i<e.length;i++){var a=e[i];r.set(a,n),n+=a.length}return r}(t,r),this.reset(),e):new Uint8Array(0)}},{key:"reset",value:function(){this.chunks.length=0,this.dataLength=0}}]),e}(),di=function(e){(0,d.Z)(r,e);var t=k(r);function r(e,n,i){var a;return(0,g.Z)(this,r),(a=t.call(this,e,n,i,"[audio-stream-controller]",Lt)).videoBuffer=null,a.videoTrackCC=-1,a.waitingVideoCC=-1,a.bufferedTrack=null,a.switchingTrack=null,a.trackId=-1,a.waitingData=null,a.mainDetails=null,a.bufferFlushed=!1,a.cachedTrackLoadedData=null,a._registerListeners(),a}return(0,p.Z)(r,[{key:"onHandlerDestroying",value:function(){this._unregisterListeners(),this.mainDetails=null,this.bufferedTrack=null,this.switchingTrack=null}},{key:"_registerListeners",value:function(){var e=this.hls;e.on(M.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(M.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(M.MANIFEST_LOADING,this.onManifestLoading,this),e.on(M.LEVEL_LOADED,this.onLevelLoaded,this),e.on(M.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(M.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(M.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(M.ERROR,this.onError,this),e.on(M.BUFFER_RESET,this.onBufferReset,this),e.on(M.BUFFER_CREATED,this.onBufferCreated,this),e.on(M.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(M.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(M.FRAG_BUFFERED,this.onFragBuffered,this)}},{key:"_unregisterListeners",value:function(){var e=this.hls;e.off(M.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(M.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(M.MANIFEST_LOADING,this.onManifestLoading,this),e.off(M.LEVEL_LOADED,this.onLevelLoaded,this),e.off(M.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(M.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(M.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(M.ERROR,this.onError,this),e.off(M.BUFFER_RESET,this.onBufferReset,this),e.off(M.BUFFER_CREATED,this.onBufferCreated,this),e.off(M.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(M.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(M.FRAG_BUFFERED,this.onFragBuffered,this)}},{key:"onInitPtsFound",value:function(e,t){var r=t.frag,n=t.id,i=t.initPTS,a=t.timescale;if("main"===n){var s=r.cc;this.initPTS[r.cc]={baseTime:i,timescale:a},this.log("InitPTS for cc: ".concat(s," found from main: ").concat(i)),this.videoTrackCC=s,this.state===qr&&this.tick()}}},{key:"startLoad",value:function(e){if(!this.levels)return this.startPosition=e,void(this.state=Fr);var t=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),t>0&&-1===e?(this.log("Override startPosition with lastCurrentTime @".concat(t.toFixed(3))),e=t,this.state=Zr):(this.loadedmetadata=!1,this.state=Gr),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}},{key:"doTick",value:function(){switch(this.state){case Zr:this.doTickIdle();break;case Gr:var e,t=this.levels,n=this.trackId,i=null==t||null==(e=t[n])?void 0:e.details;if(i){if(this.waitForCdnTuneIn(i))break;this.state=qr}break;case jr:var a,s=performance.now(),o=this.retryDate;(!o||s>=o||null!=(a=this.media)&&a.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.trackId),this.state=Zr);break;case qr:var l=this.waitingData;if(l){var u=l.frag,d=l.part,f=l.cache,v=l.complete;if(void 0!==this.initPTS[u.cc]){this.waitingData=null,this.waitingVideoCC=-1,this.state=Br;var g={frag:u,part:d,payload:f.flush(),networkDetails:null};this._handleFragmentLoadProgress(g),v&&(0,c.Z)((0,h.Z)(r.prototype),"_handleFragmentLoadComplete",this).call(this,g)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log("Waiting fragment cc (".concat(u.cc,") cancelled because video is at cc ").concat(this.videoTrackCC)),this.clearWaitingFragment();else{var p=this.getLoadPosition(),m=Rr.bufferInfo(this.mediaBuffer,p,this.config.maxBufferHole);ir(m.end,this.config.maxFragLookUpTolerance,u)<0&&(this.log("Waiting fragment cc (".concat(u.cc,") @ ").concat(u.start," cancelled because another fragment at ").concat(m.end," is needed")),this.clearWaitingFragment())}}else this.state=Zr}this.onTickEnd()}},{key:"clearWaitingFragment",value:function(){var e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=Zr)}},{key:"resetLoadingState",value:function(){this.clearWaitingFragment(),(0,c.Z)((0,h.Z)(r.prototype),"resetLoadingState",this).call(this)}},{key:"onTickEnd",value:function(){var e=this.media;null!=e&&e.readyState&&(this.lastCurrentTime=e.currentTime)}},{key:"doTickIdle",value:function(){var e=this.hls,t=this.levels,r=this.media,n=this.trackId,i=e.config;if(null!=t&&t[n]&&(r||!this.startFragRequested&&i.startFragPrefetch)){var a=t[n],s=a.details;if(!s||s.live&&this.levelLastLoaded!==n||this.waitForCdnTuneIn(s))this.state=Gr;else{var o=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&o&&(this.bufferFlushed=!1,this.afterBufferFlushed(o,Y,Lt));var l=this.getFwdBufferInfo(o,Lt);if(null!==l){var u=this.bufferedTrack,c=this.switchingTrack;if(!c&&this._streamEnded(l,s))return e.trigger(M.BUFFER_EOS,{type:"audio"}),void(this.state=zr);var d=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,St),f=l.len,h=this.getMaxBufferLength(null==d?void 0:d.len);if(!(f>=h)||c){var v=s.fragments[0].start,g=l.end;if(c&&r){var p=this.getLoadPosition();u&&c.attrs!==u.attrs&&(g=p),s.PTSKnown&&p<v&&(l.end>v||l.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),r.currentTime=v+.05)}var m=this.getNextFragment(g,s),y=!1;if(m&&this.isLoopLoading(m,g)&&(y=!!m.gap,m=this.getNextFragmentLoopLoading(m,s,l,St,h)),m){var b=d&&m.start>d.end+s.targetduration;if(b||(null==d||!d.len)&&l.len){var k=this.getAppendedFrag(m.start,St);if(null===k)return;if(y||(y=!!k.gap||!!b&&0===d.len),b&&!y||y&&l.nextStart&&l.nextStart<k.end)return}this.loadFragment(m,a,g)}else this.bufferFlushed=!0}}}}}},{key:"getMaxBufferLength",value:function(e){var t=(0,c.Z)((0,h.Z)(r.prototype),"getMaxBufferLength",this).call(this);return e?Math.min(Math.max(t,e),this.config.maxMaxBufferLength):t}},{key:"onMediaDetaching",value:function(){this.videoBuffer=null,(0,c.Z)((0,h.Z)(r.prototype),"onMediaDetaching",this).call(this)}},{key:"onAudioTracksUpdated",value:function(e,t){var r=t.audioTracks;this.resetTransmuxer(),this.levels=r.map((function(e){return new Ht(e)}))}},{key:"onAudioTrackSwitching",value:function(e,t){var r=!!t.url;this.trackId=t.id;var n=this.fragCurrent;n&&(n.abortRequests(),this.removeUnbufferedFrags(n.start)),this.resetLoadingState(),r?this.setInterval(100):this.resetTransmuxer(),r?(this.switchingTrack=t,this.state=Zr):(this.switchingTrack=null,this.bufferedTrack=t,this.state=Fr),this.tick()}},{key:"onManifestLoading",value:function(){this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1,this.levels=this.mainDetails=this.waitingData=this.bufferedTrack=this.cachedTrackLoadedData=this.switchingTrack=null,this.startFragRequested=!1,this.trackId=this.videoTrackCC=this.waitingVideoCC=-1}},{key:"onLevelLoaded",value:function(e,t){this.mainDetails=t.details,null!==this.cachedTrackLoadedData&&(this.hls.trigger(M.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)}},{key:"onAudioTrackLoaded",value:function(e,t){var r;if(null!=this.mainDetails){var n=this.levels,i=t.details,a=t.id;if(n){this.log("Track ".concat(a," loaded [").concat(i.startSN,",").concat(i.endSN,"]").concat(i.lastPartSn?"[part-".concat(i.lastPartSn,"-").concat(i.lastPartIndex,"]"):"",",duration:").concat(i.totalduration));var s=n[a],o=0;if(i.live||null!=(r=s.details)&&r.live){this.checkLiveUpdate(i);var l=this.mainDetails;if(i.deltaUpdateFailed||!l)return;!s.details&&i.hasProgramDateTime&&l.hasProgramDateTime?(Cr(i,l),o=i.fragments[0].start):o=this.alignPlaylists(i,s.details)}s.details=i,this.levelLastLoaded=a,this.startFragRequested||!this.mainDetails&&i.live||this.setStartPosition(s.details,o),this.state!==Gr||this.waitForCdnTuneIn(i)||(this.state=Zr),this.tick()}else this.warn("Audio tracks were reset while loading level ".concat(a))}else this.cachedTrackLoadedData=t}},{key:"_handleFragmentLoadProgress",value:function(e){var t,r=e.frag,n=e.part,i=e.payload,a=this.config,s=this.trackId,o=this.levels;if(o){var l=o[s];if(l){var u=l.details;if(!u)return this.warn("Audio track details undefined on fragment load progress"),void this.removeUnbufferedFrags(r.start);var c=a.defaultAudioCodec||l.audioCodec||"mp4a.40.2",d=this.transmuxer;d||(d=this.transmuxer=new ii(this.hls,Lt,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var f=this.initPTS[r.cc],h=null==(t=r.initSegment)?void 0:t.data;if(void 0!==f){var v=n?n.index:-1,g=-1!==v,p=new Ar(r.level,r.sn,r.stats.chunkCount,i.byteLength,v,g);d.push(i,h,c,"",r,n,u.totalduration,!1,p,f)}else this.log("Unknown video PTS for cc ".concat(r.cc,", waiting for video PTS before demuxing audio frag ").concat(r.sn," of [").concat(u.startSN," ,").concat(u.endSN,"],track ").concat(s)),(this.waitingData=this.waitingData||{frag:r,part:n,cache:new ci,complete:!1}).cache.push(new Uint8Array(i)),this.waitingVideoCC=this.videoTrackCC,this.state=qr}else this.warn("Audio track is undefined on fragment load progress")}else this.warn("Audio tracks were reset while fragment load was in progress. Fragment ".concat(r.sn," of level ").concat(r.level," will not be buffered"))}},{key:"_handleFragmentLoadComplete",value:function(e){this.waitingData?this.waitingData.complete=!0:(0,c.Z)((0,h.Z)(r.prototype),"_handleFragmentLoadComplete",this).call(this,e)}},{key:"onBufferReset",value:function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1}},{key:"onBufferCreated",value:function(e,t){var r=t.tracks.audio;r&&(this.mediaBuffer=r.buffer||null),t.tracks.video&&(this.videoBuffer=t.tracks.video.buffer||null)}},{key:"onFragBuffered",value:function(e,t){var r=t.frag,n=t.part;if(r.type===Lt)if(this.fragContextChanged(r))this.warn("Fragment ".concat(r.sn).concat(n?" p: "+n.index:""," of level ").concat(r.level," finished buffering, but was aborted. state: ").concat(this.state,", audioSwitch: ").concat(this.switchingTrack?this.switchingTrack.name:"false"));else{if("initSegment"!==r.sn){this.fragPrevious=r;var i=this.switchingTrack;i&&(this.bufferedTrack=i,this.switchingTrack=null,this.hls.trigger(M.AUDIO_TRACK_SWITCHED,I({},i)))}this.fragBufferedComplete(r,n)}else if(!this.loadedmetadata&&r.type===St){var a=this.videoBuffer||this.media;a&&Rr.getBuffered(a).length&&(this.loadedmetadata=!0)}}},{key:"onError",value:function(e,t){var n;if(t.fatal)this.state=Vr;else switch(t.details){case N.FRAG_GAP:case N.FRAG_PARSING_ERROR:case N.FRAG_DECRYPT_ERROR:case N.FRAG_LOAD_ERROR:case N.FRAG_LOAD_TIMEOUT:case N.KEY_LOAD_ERROR:case N.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Lt,t);break;case N.AUDIO_TRACK_LOAD_ERROR:case N.AUDIO_TRACK_LOAD_TIMEOUT:case N.LEVEL_PARSING_ERROR:t.levelRetry||this.state!==Gr||(null==(n=t.context)?void 0:n.type)!==_t||(this.state=Zr);break;case N.BUFFER_FULL_ERROR:if(!t.parent||"audio"!==t.parent)return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,(0,c.Z)((0,h.Z)(r.prototype),"flushMainBuffer",this).call(this,0,Number.POSITIVE_INFINITY,"audio"));break;case N.INTERNAL_EXCEPTION:this.recoverWorkerError(t)}}},{key:"onBufferFlushed",value:function(e,t){t.type===Y&&(this.bufferFlushed=!0,this.state===zr&&(this.state=Zr))}},{key:"_handleTransmuxComplete",value:function(e){var t,r="audio",n=this.hls,i=e.remuxResult,a=e.chunkMeta,s=this.getCurrentContext(a);if(s){var o=s.frag,l=s.part,u=s.level.details,c=i.audio,d=i.text,f=i.id3,h=i.initSegment;if(!this.fragContextChanged(o)&&u){if(this.state=Kr,this.switchingTrack&&c&&this.completeAudioSwitch(this.switchingTrack),null!=h&&h.tracks){var v=o.initSegment||o;this._bufferInitSegment(h.tracks,v,a),n.trigger(M.FRAG_PARSING_INIT_SEGMENT,{frag:v,id:r,tracks:h.tracks})}if(c){var g=c.startPTS,p=c.endPTS,m=c.startDTS,y=c.endDTS;l&&(l.elementaryStreams[Y]={startPTS:g,endPTS:p,startDTS:m,endDTS:y}),o.setElementaryStreamInfo(Y,g,p,m,y),this.bufferFragmentData(c,o,l,a)}if(null!=f&&null!=(t=f.samples)&&t.length){var b=C({id:r,frag:o,details:u},f);n.trigger(M.FRAG_PARSING_METADATA,b)}if(d){var k=C({id:r,frag:o,details:u},d);n.trigger(M.FRAG_PARSING_USERDATA,k)}}else this.fragmentTracker.removeFragment(o)}else this.resetWhenMissingContext(a)}},{key:"_bufferInitSegment",value:function(e,t,r){if(this.state===Kr){e.video&&delete e.video;var n=e.audio;if(n){n.levelCodec=n.codec,n.id="audio",this.log("Init audio buffer, container:".concat(n.container,", codecs[parsed]=[").concat(n.codec,"]")),this.hls.trigger(M.BUFFER_CODECS,e);var i=n.initSegment;if(null!=i&&i.byteLength){var a={type:"audio",frag:t,part:null,chunkMeta:r,parent:t.type,data:i};this.hls.trigger(M.BUFFER_APPENDING,a)}this.tick()}}}},{key:"loadFragment",value:function(e,t,n){var i,a=this.fragmentTracker.getState(e);this.fragCurrent=e,this.switchingTrack||a===fr||a===vr?"initSegment"===e.sn?this._loadInitSegment(e,t):null!=(i=t.details)&&i.live&&!this.initPTS[e.cc]?(this.log("Waiting for video PTS in continuity counter ".concat(e.cc," of live stream before loading audio fragment ").concat(e.sn," of level ").concat(this.trackId)),this.state=qr):(this.startFragRequested=!0,(0,c.Z)((0,h.Z)(r.prototype),"loadFragment",this).call(this,e,t,n)):this.clearTrackerIfNeeded(e)}},{key:"completeAudioSwitch",value:function(e){var t=this.hls,n=this.media,i=this.bufferedTrack,a=null==i?void 0:i.attrs,s=e.attrs;n&&a&&(a.CHANNELS!==s.CHANNELS||a.NAME!==s.NAME||a.LANGUAGE!==s.LANGUAGE)&&(this.log("Switching audio track : flushing all audio"),(0,c.Z)((0,h.Z)(r.prototype),"flushMainBuffer",this).call(this,0,Number.POSITIVE_INFINITY,"audio")),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(M.AUDIO_TRACK_SWITCHED,I({},e))}}]),r}(Yr),fi=function(e){(0,d.Z)(r,e);var t=k(r);function r(e){var n;return(0,g.Z)(this,r),(n=t.call(this,e,"[audio-track-controller]")).tracks=[],n.groupId=null,n.tracksInGroup=[],n.trackId=-1,n.currentTrack=null,n.selectDefaultTrack=!0,n.registerListeners(),n}return(0,p.Z)(r,[{key:"registerListeners",value:function(){var e=this.hls;e.on(M.MANIFEST_LOADING,this.onManifestLoading,this),e.on(M.MANIFEST_PARSED,this.onManifestParsed,this),e.on(M.LEVEL_LOADING,this.onLevelLoading,this),e.on(M.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(M.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(M.ERROR,this.onError,this)}},{key:"unregisterListeners",value:function(){var e=this.hls;e.off(M.MANIFEST_LOADING,this.onManifestLoading,this),e.off(M.MANIFEST_PARSED,this.onManifestParsed,this),e.off(M.LEVEL_LOADING,this.onLevelLoading,this),e.off(M.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(M.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(M.ERROR,this.onError,this)}},{key:"destroy",value:function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,(0,c.Z)((0,h.Z)(r.prototype),"destroy",this).call(this)}},{key:"onManifestLoading",value:function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}},{key:"onManifestParsed",value:function(e,t){this.tracks=t.audioTracks||[]}},{key:"onAudioTrackLoaded",value:function(e,t){var r=t.id,n=t.groupId,i=t.details,a=this.tracksInGroup[r];if(a&&a.groupId===n){var s=a.details;a.details=t.details,this.log("audio-track ".concat(r,' "').concat(a.name,'" lang:').concat(a.lang," group:").concat(n," loaded [").concat(i.startSN,"-").concat(i.endSN,"]")),r===this.trackId&&this.playlistLoaded(r,t,s)}else this.warn("Track with id:".concat(r," and group:").concat(n," not found in active group ").concat(a.groupId))}},{key:"onLevelLoading",value:function(e,t){this.switchLevel(t.level)}},{key:"onLevelSwitching",value:function(e,t){this.switchLevel(t.level)}},{key:"switchLevel",value:function(e){var t=this.hls.levels[e];if(null!=t&&t.audioGroupIds){var r=t.audioGroupIds[t.urlId];if(this.groupId!==r){this.groupId=r||null;var n=this.tracks.filter((function(e){return!r||e.groupId===r}));this.selectDefaultTrack&&!n.some((function(e){return e.default}))&&(this.selectDefaultTrack=!1),this.tracksInGroup=n;var i={audioTracks:n};this.log("Updating audio tracks, ".concat(n.length," track(s) found in group:").concat(r)),this.hls.trigger(M.AUDIO_TRACKS_UPDATED,i),this.selectInitialTrack()}else this.shouldReloadPlaylist(this.currentTrack)&&this.setAudioTrack(this.trackId)}}},{key:"onError",value:function(e,t){!t.fatal&&t.context&&t.context.type===_t&&t.context.id===this.trackId&&t.context.groupId===this.groupId&&(this.requestScheduled=-1,this.checkRetry(t))}},{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}},{key:"setAudioTrack",value:function(e){var t=this.tracksInGroup;if(e<0||e>=t.length)this.warn("Invalid id passed to audio-track controller");else{this.clearTimer();var r=this.currentTrack;t[this.trackId];var n=t[e],i=n.groupId,a=n.name;if(this.log("Switching to audio-track ".concat(e,' "').concat(a,'" lang:').concat(n.lang," group:").concat(i)),this.trackId=e,this.currentTrack=n,this.selectDefaultTrack=!1,this.hls.trigger(M.AUDIO_TRACK_SWITCHING,I({},n)),!n.details||n.details.live){var s=this.switchParams(n.url,null==r?void 0:r.details);this.loadPlaylist(s)}}}},{key:"selectInitialTrack",value:function(){var e=this.tracksInGroup,t=this.findTrackId(this.currentTrack)|this.findTrackId(null);if(-1!==t)this.setAudioTrack(t);else{var r=new Error("No track found for running audio group-ID: ".concat(this.groupId," track count: ").concat(e.length));this.warn(r.message),this.hls.trigger(M.ERROR,{type:O.MEDIA_ERROR,details:N.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:r})}}},{key:"findTrackId",value:function(e){for(var t=this.tracksInGroup,r=0;r<t.length;r++){var n=t[r];if(!this.selectDefaultTrack||n.default){if(!e||void 0!==e.attrs["STABLE-RENDITION-ID"]&&e.attrs["STABLE-RENDITION-ID"]===n.attrs["STABLE-RENDITION-ID"])return n.id;if(e.name===n.name&&e.lang===n.lang)return n.id}}return-1}},{key:"loadPlaylist",value:function(e){(0,c.Z)((0,h.Z)(r.prototype),"loadPlaylist",this).call(this);var t=this.tracksInGroup[this.trackId];if(this.shouldLoadPlaylist(t)){var n=t.id,i=t.groupId,a=t.url;if(e)try{a=e.addDirectives(a)}catch(e){this.warn("Could not construct new URL with HLS Delivery Directives: ".concat(e))}this.log("loading audio-track playlist ".concat(n,' "').concat(t.name,'" lang:').concat(t.lang," group:").concat(i)),this.clearTimer(),this.hls.trigger(M.AUDIO_TRACK_LOADING,{url:a,id:n,groupId:i,deliveryDirectives:e||null})}}}]),r}(lr);function hi(e,t){if(e.length!==t.length)return!1;for(var r=0;r<e.length;r++)if(!vi(e[r].attrs,t[r].attrs))return!1;return!0}function vi(e,t){var r=e["STABLE-RENDITION-ID"];return r?r===t["STABLE-RENDITION-ID"]:!["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED"].some((function(r){return e[r]!==t[r]}))}var gi=function(e){(0,d.Z)(r,e);var t=k(r);function r(e,n,i){var a;return(0,g.Z)(this,r),(a=t.call(this,e,n,i,"[subtitle-stream-controller]",Rt)).levels=[],a.currentTrackId=-1,a.tracksBuffered=[],a.mainDetails=null,a._registerListeners(),a}return(0,p.Z)(r,[{key:"onHandlerDestroying",value:function(){this._unregisterListeners(),this.mainDetails=null}},{key:"_registerListeners",value:function(){var e=this.hls;e.on(M.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(M.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(M.MANIFEST_LOADING,this.onManifestLoading,this),e.on(M.LEVEL_LOADED,this.onLevelLoaded,this),e.on(M.ERROR,this.onError,this),e.on(M.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(M.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(M.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(M.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(M.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(M.FRAG_BUFFERED,this.onFragBuffered,this)}},{key:"_unregisterListeners",value:function(){var e=this.hls;e.off(M.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(M.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(M.MANIFEST_LOADING,this.onManifestLoading,this),e.off(M.LEVEL_LOADED,this.onLevelLoaded,this),e.off(M.ERROR,this.onError,this),e.off(M.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(M.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(M.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(M.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(M.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(M.FRAG_BUFFERED,this.onFragBuffered,this)}},{key:"startLoad",value:function(e){this.stopLoad(),this.state=Zr,this.setInterval(500),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}},{key:"onManifestLoading",value:function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()}},{key:"onMediaDetaching",value:function(){this.tracksBuffered=[],(0,c.Z)((0,h.Z)(r.prototype),"onMediaDetaching",this).call(this)}},{key:"onLevelLoaded",value:function(e,t){this.mainDetails=t.details}},{key:"onSubtitleFragProcessed",value:function(e,t){var r=t.frag,n=t.success;if(this.fragPrevious=r,this.state=Zr,n){var i=this.tracksBuffered[this.currentTrackId];if(i){for(var a,s=r.start,o=0;o<i.length;o++)if(s>=i[o].start&&s<=i[o].end){a=i[o];break}var l=r.start+r.duration;a?a.end=l:(a={start:s,end:l},i.push(a)),this.fragmentTracker.fragBuffered(r)}}}},{key:"onBufferFlushing",value:function(e,t){var r=t.startOffset,n=t.endOffset;if(0===r&&n!==Number.POSITIVE_INFINITY){var i=n-1;if(i<=0)return;t.endOffsetSubtitles=Math.max(0,i),this.tracksBuffered.forEach((function(e){for(var t=0;t<e.length;)if(e[t].end<=i)e.shift();else{if(!(e[t].start<i))break;e[t].start=i,t++}})),this.fragmentTracker.removeFragmentsInRange(r,i,Rt)}}},{key:"onFragBuffered",value:function(e,t){var r;this.loadedmetadata||t.frag.type!==St||null!=(r=this.media)&&r.buffered.length&&(this.loadedmetadata=!0)}},{key:"onError",value:function(e,t){var r=t.frag;(null==r?void 0:r.type)===Rt&&(this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==Fr&&(this.state=Zr))}},{key:"onSubtitleTracksUpdated",value:function(e,t){var r=this,n=t.subtitleTracks;hi(this.levels,n)?this.levels=n.map((function(e){return new Ht(e)})):(this.tracksBuffered=[],this.levels=n.map((function(e){var t=new Ht(e);return r.tracksBuffered[t.id]=[],t})),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,Rt),this.fragPrevious=null,this.mediaBuffer=null)}},{key:"onSubtitleTrackSwitch",value:function(e,t){if(this.currentTrackId=t.id,this.levels.length&&-1!==this.currentTrackId){var r=this.levels[this.currentTrackId];null!=r&&r.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,r&&this.setInterval(500)}else this.clearInterval()}},{key:"onSubtitleTrackLoaded",value:function(e,t){var r,n=t.details,i=t.id,a=this.currentTrackId,s=this.levels;if(s.length){var o=s[a];if(!(i>=s.length||i!==a)&&o){this.mediaBuffer=this.mediaBufferTimeRanges;var l=0;if(n.live||null!=(r=o.details)&&r.live){var u=this.mainDetails;if(n.deltaUpdateFailed||!u)return;var c=u.fragments[0];o.details?0===(l=this.alignPlaylists(n,o.details))&&c&&Wt(n,l=c.start):n.hasProgramDateTime&&u.hasProgramDateTime?(Cr(n,u),l=n.fragments[0].start):c&&Wt(n,l=c.start)}o.details=n,this.levelLastLoaded=i,this.startFragRequested||!this.mainDetails&&n.live||this.setStartPosition(o.details,l),this.tick(),n.live&&!this.fragCurrent&&this.media&&this.state===Zr&&(nr(null,n.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),o.details=void 0))}}}},{key:"_handleFragmentLoadComplete",value:function(e){var t=this,r=e.frag,n=e.payload,i=r.decryptdata,a=this.hls;if(!this.fragContextChanged(r)&&n&&n.byteLength>0&&i&&i.key&&i.iv&&"AES-128"===i.method){var s=performance.now();this.decrypter.decrypt(new Uint8Array(n),i.key.buffer,i.iv.buffer).catch((function(e){throw a.trigger(M.ERROR,{type:O.MEDIA_ERROR,details:N.FRAG_DECRYPT_ERROR,fatal:!1,error:e,reason:e.message,frag:r}),e})).then((function(e){var t=performance.now();a.trigger(M.FRAG_DECRYPTED,{frag:r,payload:e,stats:{tstart:s,tdecrypt:t}})})).catch((function(e){t.warn("".concat(e.name,": ").concat(e.message)),t.state=Zr}))}}},{key:"doTick",value:function(){if(this.media){if(this.state===Zr){var e=this.currentTrackId,t=this.levels,r=t[e];if(!t.length||!r||!r.details)return;var n=this.config,i=this.getLoadPosition(),a=Rr.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],i,n.maxBufferHole),s=a.end,o=a.len,l=this.getFwdBufferInfo(this.media,St),u=r.details;if(o>this.getMaxBufferLength(null==l?void 0:l.len)+u.levelTargetDuration)return;var c=u.fragments,d=c.length,f=u.edge,h=null,v=this.fragPrevious;if(s<f){var g=n.maxFragLookUpTolerance,p=s>f-g?0:g;!(h=nr(v,c,Math.max(c[0].start,s),p))&&v&&v.start<c[0].start&&(h=c[0])}else h=c[d-1];if(!h)return;if("initSegment"!==(h=this.mapToInitFragWhenRequired(h)).sn){var m=c[h.sn-u.startSN-1];m&&m.cc===h.cc&&this.fragmentTracker.getState(m)===fr&&(h=m)}this.fragmentTracker.getState(h)===fr&&this.loadFragment(h,r,s)}}else this.state=Zr}},{key:"getMaxBufferLength",value:function(e){var t=(0,c.Z)((0,h.Z)(r.prototype),"getMaxBufferLength",this).call(this);return e?Math.max(t,e):t}},{key:"loadFragment",value:function(e,t,n){this.fragCurrent=e,"initSegment"===e.sn?this._loadInitSegment(e,t):(this.startFragRequested=!0,(0,c.Z)((0,h.Z)(r.prototype),"loadFragment",this).call(this,e,t,n))}},{key:"mediaBufferTimeRanges",get:function(){return new pi(this.tracksBuffered[this.currentTrackId]||[])}}]),r}(Yr),pi=(0,p.Z)((function e(t){(0,g.Z)(this,e),this.buffered=void 0;var r=function(e,r,n){if((r>>>=0)>n-1)throw new DOMException("Failed to execute '".concat(e,"' on 'TimeRanges': The index provided (").concat(r,") is greater than the maximum bound (").concat(n,")"));return t[r][e]};this.buffered={get length(){return t.length},end:function(e){return r("end",e,t.length)},start:function(e){return r("start",e,t.length)}}})),mi=function(e){(0,d.Z)(r,e);var t=k(r);function r(e){var n;return(0,g.Z)(this,r),(n=t.call(this,e,"[subtitle-track-controller]")).media=null,n.tracks=[],n.groupId=null,n.tracksInGroup=[],n.trackId=-1,n.selectDefaultTrack=!0,n.queuedDefaultTrack=-1,n.trackChangeListener=function(){return n.onTextTracksChanged()},n.asyncPollTrackChange=function(){return n.pollTrackChange(0)},n.useTextTrackPolling=!1,n.subtitlePollingInterval=-1,n._subtitleDisplay=!0,n.registerListeners(),n}return(0,p.Z)(r,[{key:"destroy",value:function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,(0,c.Z)((0,h.Z)(r.prototype),"destroy",this).call(this)}},{key:"subtitleDisplay",get:function(){return this._subtitleDisplay},set:function(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes(this.trackId)}},{key:"registerListeners",value:function(){var e=this.hls;e.on(M.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(M.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(M.MANIFEST_LOADING,this.onManifestLoading,this),e.on(M.MANIFEST_PARSED,this.onManifestParsed,this),e.on(M.LEVEL_LOADING,this.onLevelLoading,this),e.on(M.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(M.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(M.ERROR,this.onError,this)}},{key:"unregisterListeners",value:function(){var e=this.hls;e.off(M.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(M.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(M.MANIFEST_LOADING,this.onManifestLoading,this),e.off(M.MANIFEST_PARSED,this.onManifestParsed,this),e.off(M.LEVEL_LOADING,this.onLevelLoading,this),e.off(M.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(M.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(M.ERROR,this.onError,this)}},{key:"onMediaAttached",value:function(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}},{key:"pollTrackChange",value:function(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,e)}},{key:"onMediaDetaching",value:function(){this.media&&(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),yi(this.media.textTracks).forEach((function(e){Pt(e)})),this.subtitleTrack=-1,this.media=null)}},{key:"onManifestLoading",value:function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0}},{key:"onManifestParsed",value:function(e,t){this.tracks=t.subtitleTracks}},{key:"onSubtitleTrackLoaded",value:function(e,t){var r=t.id,n=t.details,i=this.trackId,a=this.tracksInGroup[i];if(a){var s=a.details;a.details=t.details,this.log("subtitle track ".concat(r," loaded [").concat(n.startSN,"-").concat(n.endSN,"]")),r===this.trackId&&this.playlistLoaded(r,t,s)}else this.warn("Invalid subtitle track id ".concat(r))}},{key:"onLevelLoading",value:function(e,t){this.switchLevel(t.level)}},{key:"onLevelSwitching",value:function(e,t){this.switchLevel(t.level)}},{key:"switchLevel",value:function(e){var t=this.hls.levels[e];if(null!=t&&t.textGroupIds){var r=t.textGroupIds[t.urlId],n=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;if(this.groupId!==r){var i=this.tracks.filter((function(e){return!r||e.groupId===r}));this.tracksInGroup=i;var a=this.findTrackId(null==n?void 0:n.name)||this.findTrackId();this.groupId=r||null;var s={subtitleTracks:i};this.log("Updating subtitle tracks, ".concat(i.length,' track(s) found in "').concat(r,'" group-id')),this.hls.trigger(M.SUBTITLE_TRACKS_UPDATED,s),-1!==a&&this.setSubtitleTrack(a,n)}else this.shouldReloadPlaylist(n)&&this.setSubtitleTrack(this.trackId,n)}}},{key:"findTrackId",value:function(e){for(var t=this.tracksInGroup,r=0;r<t.length;r++){var n=t[r];if((!this.selectDefaultTrack||n.default)&&(!e||e===n.name))return n.id}return-1}},{key:"onError",value:function(e,t){!t.fatal&&t.context&&t.context.type===wt&&t.context.id===this.trackId&&t.context.groupId===this.groupId&&this.checkRetry(t)}},{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(e){this.selectDefaultTrack=!1;var t=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(e,t)}},{key:"loadPlaylist",value:function(e){(0,c.Z)((0,h.Z)(r.prototype),"loadPlaylist",this).call(this);var t=this.tracksInGroup[this.trackId];if(this.shouldLoadPlaylist(t)){var n=t.id,i=t.groupId,a=t.url;if(e)try{a=e.addDirectives(a)}catch(e){this.warn("Could not construct new URL with HLS Delivery Directives: ".concat(e))}this.log("Loading subtitle playlist for id ".concat(n)),this.hls.trigger(M.SUBTITLE_TRACK_LOADING,{url:a,id:n,groupId:i,deliveryDirectives:e||null})}}},{key:"toggleTrackModes",value:function(e){var t=this,r=this.media,n=this.trackId;if(r){var i=yi(r.textTracks),a=i.filter((function(e){return e.groupId===t.groupId}));if(-1===e)[].slice.call(i).forEach((function(e){e.mode="disabled"}));else{var s=a[n];s&&(s.mode="disabled")}var o=a[e];o&&(o.mode=this.subtitleDisplay?"showing":"hidden")}}},{key:"setSubtitleTrack",value:function(e,t){var r,n=this.tracksInGroup;if(this.media){if(this.trackId!==e&&this.toggleTrackModes(e),!(this.trackId===e&&(-1===e||null!=(r=n[e])&&r.details)||e<-1||e>=n.length)){this.clearTimer();var i=n[e];if(this.log("Switching to subtitle-track ".concat(e)+(i?' "'.concat(i.name,'" lang:').concat(i.lang," group:").concat(i.groupId):"")),this.trackId=e,i){var a=i.id,s=i.groupId,o=void 0===s?"":s,l=i.name,u=i.type,c=i.url;this.hls.trigger(M.SUBTITLE_TRACK_SWITCH,{id:a,groupId:o,name:l,type:u,url:c});var d=this.switchParams(i.url,null==t?void 0:t.details);this.loadPlaylist(d)}else this.hls.trigger(M.SUBTITLE_TRACK_SWITCH,{id:e})}}else this.queuedDefaultTrack=e}},{key:"onTextTracksChanged",value:function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),this.media&&this.hls.config.renderTextTracksNatively){for(var e=-1,t=yi(this.media.textTracks),r=0;r<t.length;r++)if("hidden"===t[r].mode)e=r;else if("showing"===t[r].mode){e=r;break}this.subtitleTrack!==e&&(this.subtitleTrack=e)}}}]),r}(lr);function yi(e){for(var t=[],r=0;r<e.length;r++){var n=e[r];"subtitles"!==n.kind&&"captions"!==n.kind||!n.label||t.push(e[r])}return t}var bi=function(){function e(t){(0,g.Z)(this,e),this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=t}return(0,p.Z)(e,[{key:"append",value:function(e,t){var r=this.queues[t];r.push(e),1===r.length&&this.buffers[t]&&this.executeNext(t)}},{key:"insertAbort",value:function(e,t){this.queues[t].unshift(e),this.executeNext(t)}},{key:"appendBlocker",value:function(e){var t,r=new Promise((function(e){t=e})),n={execute:t,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(n,e),r}},{key:"executeNext",value:function(e){var t=this.buffers,r=this.queues,n=t[e],i=r[e];if(i.length){var a=i[0];try{a.execute()}catch(t){G.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),a.onError(t),null!=n&&n.updating||(i.shift(),this.executeNext(e))}}}},{key:"shiftAndExecuteNext",value:function(e){this.queues[e].shift(),this.executeNext(e)}},{key:"current",value:function(e){return this.queues[e][0]}}]),e}(),ki=it(),Ei=/([ha]vc.)(?:\.[^.,]+)+/,Ti=function(){function e(t){var r=this;(0,g.Z)(this,e),this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var e=r.media,t=r.mediaSource;G.log("[buffer-controller]: Media source opened"),e&&(e.removeEventListener("emptied",r._onMediaEmptied),r.updateMediaElementDuration(),r.hls.trigger(M.MEDIA_ATTACHED,{media:e})),t&&t.removeEventListener("sourceopen",r._onMediaSourceOpen),r.checkPendingTracks()},this._onMediaSourceClose=function(){G.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){G.log("[buffer-controller]: Media source ended")},this._onMediaEmptied=function(){var e=r.media,t=r._objectUrl;e&&e.src!==t&&G.error("Media element src was set while attaching MediaSource (".concat(t," > ").concat(e.src,")"))},this.hls=t,this._initSourceBuffer(),this.registerListeners()}return(0,p.Z)(e,[{key:"hasSourceTypes",value:function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0}},{key:"destroy",value:function(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=null}},{key:"registerListeners",value:function(){var e=this.hls;e.on(M.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(M.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(M.MANIFEST_LOADING,this.onManifestLoading,this),e.on(M.MANIFEST_PARSED,this.onManifestParsed,this),e.on(M.BUFFER_RESET,this.onBufferReset,this),e.on(M.BUFFER_APPENDING,this.onBufferAppending,this),e.on(M.BUFFER_CODECS,this.onBufferCodecs,this),e.on(M.BUFFER_EOS,this.onBufferEos,this),e.on(M.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(M.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(M.FRAG_PARSED,this.onFragParsed,this),e.on(M.FRAG_CHANGED,this.onFragChanged,this)}},{key:"unregisterListeners",value:function(){var e=this.hls;e.off(M.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(M.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(M.MANIFEST_LOADING,this.onManifestLoading,this),e.off(M.MANIFEST_PARSED,this.onManifestParsed,this),e.off(M.BUFFER_RESET,this.onBufferReset,this),e.off(M.BUFFER_APPENDING,this.onBufferAppending,this),e.off(M.BUFFER_CODECS,this.onBufferCodecs,this),e.off(M.BUFFER_EOS,this.onBufferEos,this),e.off(M.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(M.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(M.FRAG_PARSED,this.onFragParsed,this),e.off(M.FRAG_CHANGED,this.onFragChanged,this)}},{key:"_initSourceBuffer",value:function(){this.sourceBuffer={},this.operationQueue=new bi(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]},this.lastMpegAudioChunk=null}},{key:"onManifestLoading",value:function(){this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=0,this.details=null}},{key:"onManifestParsed",value:function(e,t){var r=2;(t.audio&&!t.video||!t.altAudio)&&(r=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=r,G.log("".concat(this.bufferCodecEventsExpected," bufferCodec event(s) expected"))}},{key:"onMediaAttaching",value:function(e,t){var r=this.media=t.media;if(r&&ki){var n=this.mediaSource=new ki;n.addEventListener("sourceopen",this._onMediaSourceOpen),n.addEventListener("sourceended",this._onMediaSourceEnded),n.addEventListener("sourceclose",this._onMediaSourceClose),r.src=self.URL.createObjectURL(n),this._objectUrl=r.src,r.addEventListener("emptied",this._onMediaEmptied)}}},{key:"onMediaDetaching",value:function(){var e=this.media,t=this.mediaSource,r=this._objectUrl;if(t){if(G.log("[buffer-controller]: media source detaching"),"open"===t.readyState)try{t.endOfStream()}catch(e){G.warn("[buffer-controller]: onMediaDetaching: ".concat(e.message," while calling endOfStream"))}this.onBufferReset(),t.removeEventListener("sourceopen",this._onMediaSourceOpen),t.removeEventListener("sourceended",this._onMediaSourceEnded),t.removeEventListener("sourceclose",this._onMediaSourceClose),e&&(e.removeEventListener("emptied",this._onMediaEmptied),r&&self.URL.revokeObjectURL(r),e.src===r?(e.removeAttribute("src"),e.load()):G.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(M.MEDIA_DETACHED,void 0)}},{key:"onBufferReset",value:function(){var e=this;this.getSourceBufferTypes().forEach((function(t){var r=e.sourceBuffer[t];try{r&&(e.removeBufferListeners(t),e.mediaSource&&e.mediaSource.removeSourceBuffer(r),e.sourceBuffer[t]=void 0)}catch(e){G.warn("[buffer-controller]: Failed to reset the ".concat(t," buffer"),e)}})),this._initSourceBuffer()}},{key:"onBufferCodecs",value:function(e,t){var r=this,n=this.getSourceBufferTypes().length;Object.keys(t).forEach((function(e){if(n){var i=r.tracks[e];if(i&&"function"==typeof i.buffer.changeType){var a=t[e],s=a.id,o=a.codec,l=a.levelCodec,u=a.container,c=a.metadata,d=(i.levelCodec||i.codec).replace(Ei,"$1"),f=(l||o).replace(Ei,"$1");if(d!==f){var h="".concat(u,";codecs=").concat(l||o);r.appendChangeType(e,h),G.log("[buffer-controller]: switching codec ".concat(d," to ").concat(f)),r.tracks[e]={buffer:i.buffer,codec:o,container:u,levelCodec:l,metadata:c,id:s}}}}else r.pendingTracks[e]=t[e]})),n||(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&"open"===this.mediaSource.readyState&&this.checkPendingTracks())}},{key:"appendChangeType",value:function(e,t){var r=this,n=this.operationQueue,i={execute:function(){var i=r.sourceBuffer[e];i&&(G.log("[buffer-controller]: changing ".concat(e," sourceBuffer type to ").concat(t)),i.changeType(t)),n.shiftAndExecuteNext(e)},onStart:function(){},onComplete:function(){},onError:function(t){G.warn("[buffer-controller]: Failed to change ".concat(e," SourceBuffer type"),t)}};n.append(i,e)}},{key:"onBufferAppending",value:function(e,t){var r=this,n=this.hls,i=this.operationQueue,a=this.tracks,s=t.data,o=t.type,l=t.frag,u=t.part,c=t.chunkMeta,d=c.buffering[o],f=self.performance.now();d.start=f;var h=l.stats.buffering,v=u?u.stats.buffering:null;0===h.start&&(h.start=f),v&&0===v.start&&(v.start=f);var g=a.audio,p=!1;"audio"===o&&"audio/mpeg"===(null==g?void 0:g.container)&&(p=!this.lastMpegAudioChunk||1===c.id||this.lastMpegAudioChunk.sn!==c.sn,this.lastMpegAudioChunk=c);var m=l.start,y={execute:function(){if(d.executeStart=self.performance.now(),p){var e=r.sourceBuffer[o];if(e){var t=m-e.timestampOffset;Math.abs(t)>=.1&&(G.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to ".concat(m," (delta: ").concat(t,") sn: ").concat(l.sn,")")),e.timestampOffset=m)}}r.appendExecutor(s,o)},onStart:function(){},onComplete:function(){var e=self.performance.now();d.executeEnd=d.end=e,0===h.first&&(h.first=e),v&&0===v.first&&(v.first=e);var t=r.sourceBuffer,n={};for(var i in t)n[i]=Rr.getBuffered(t[i]);r.appendError=0,r.hls.trigger(M.BUFFER_APPENDED,{type:o,frag:l,part:u,chunkMeta:c,parent:l.type,timeRanges:n})},onError:function(e){G.error("[buffer-controller]: Error encountered while trying to append to the ".concat(o," SourceBuffer"),e);var t={type:O.MEDIA_ERROR,parent:l.type,details:N.BUFFER_APPEND_ERROR,frag:l,part:u,chunkMeta:c,error:e,err:e,fatal:!1};e.code===DOMException.QUOTA_EXCEEDED_ERR?t.details=N.BUFFER_FULL_ERROR:(r.appendError++,t.details=N.BUFFER_APPEND_ERROR,r.appendError>n.config.appendErrorMaxRetry&&(G.error("[buffer-controller]: Failed ".concat(n.config.appendErrorMaxRetry," times to append segment in sourceBuffer")),t.fatal=!0)),n.trigger(M.ERROR,t)}};i.append(y,o)}},{key:"onBufferFlushing",value:function(e,t){var r=this,n=this.operationQueue,i=function(e){return{execute:r.removeExecutor.bind(r,e,t.startOffset,t.endOffset),onStart:function(){},onComplete:function(){r.hls.trigger(M.BUFFER_FLUSHED,{type:e})},onError:function(t){G.warn("[buffer-controller]: Failed to remove from ".concat(e," SourceBuffer"),t)}}};t.type?n.append(i(t.type),t.type):this.getSourceBufferTypes().forEach((function(e){n.append(i(e),e)}))}},{key:"onFragParsed",value:function(e,t){var r=this,n=t.frag,i=t.part,a=[],s=i?i.elementaryStreams:n.elementaryStreams;s[Q]?a.push("audiovideo"):(s[Y]&&a.push("audio"),s[X]&&a.push("video")),0===a.length&&G.warn("Fragments must have at least one ElementaryStreamType set. type: ".concat(n.type," level: ").concat(n.level," sn: ").concat(n.sn)),this.blockBuffers((function(){var e=self.performance.now();n.stats.buffering.end=e,i&&(i.stats.buffering.end=e);var t=i?i.stats:n.stats;r.hls.trigger(M.FRAG_BUFFERED,{frag:n,part:i,stats:t,id:n.type})}),a)}},{key:"onFragChanged",value:function(e,t){this.flushBackBuffer()}},{key:"onBufferEos",value:function(e,t){var r=this;this.getSourceBufferTypes().reduce((function(e,n){var i=r.sourceBuffer[n];return!i||t.type&&t.type!==n||(i.ending=!0,i.ended||(i.ended=!0,G.log("[buffer-controller]: ".concat(n," sourceBuffer now EOS")))),e&&!(i&&!i.ended)}),!0)&&(G.log("[buffer-controller]: Queueing mediaSource.endOfStream()"),this.blockBuffers((function(){r.getSourceBufferTypes().forEach((function(e){var t=r.sourceBuffer[e];t&&(t.ending=!1)}));var e=r.mediaSource;e&&"open"===e.readyState?(G.log("[buffer-controller]: Calling mediaSource.endOfStream()"),e.endOfStream()):e&&G.info("[buffer-controller]: Could not call mediaSource.endOfStream(). mediaSource.readyState: ".concat(e.readyState))})))}},{key:"onLevelUpdated",value:function(e,t){var r=t.details;r.fragments.length&&(this.details=r,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())}},{key:"flushBackBuffer",value:function(){var e=this.hls,t=this.details,r=this.media,n=this.sourceBuffer;if(r&&null!==t){var i=this.getSourceBufferTypes();if(i.length){var a=t.live&&null!==e.config.liveBackBufferLength?e.config.liveBackBufferLength:e.config.backBufferLength;if(P(a)&&!(a<0)){var s=r.currentTime,o=t.levelTargetDuration,l=Math.max(a,o),u=Math.floor(s/o)*o-l;i.forEach((function(r){var i=n[r];if(i){var a=Rr.getBuffered(i);if(a.length>0&&u>a.start(0)){if(e.trigger(M.BACK_BUFFER_REACHED,{bufferEnd:u}),t.live)e.trigger(M.LIVE_BACK_BUFFER_REACHED,{bufferEnd:u});else if(i.ended&&a.end(a.length-1)-s<2*o)return void G.info("[buffer-controller]: Cannot flush ".concat(r," back buffer while SourceBuffer is in ended state"));e.trigger(M.BUFFER_FLUSHING,{startOffset:0,endOffset:u,type:r})}}}))}}}}},{key:"updateMediaElementDuration",value:function(){if(this.details&&this.media&&this.mediaSource&&"open"===this.mediaSource.readyState){var e=this.details,t=this.hls,r=this.media,n=this.mediaSource,i=e.fragments[0].start+e.totalduration,a=r.duration,s=P(n.duration)?n.duration:0;e.live&&t.config.liveDurationInfinity?(G.log("[buffer-controller]: Media Source duration is set to Infinity"),n.duration=1/0,this.updateSeekableRange(e)):(i>s&&i>a||!P(a))&&(G.log("[buffer-controller]: Updating Media Source duration to ".concat(i.toFixed(3))),n.duration=i)}}},{key:"updateSeekableRange",value:function(e){var t=this.mediaSource,r=e.fragments;if(r.length&&e.live&&null!=t&&t.setLiveSeekableRange){var n=Math.max(0,r[0].start),i=Math.max(n,n+e.totalduration);t.setLiveSeekableRange(n,i)}}},{key:"checkPendingTracks",value:function(){var e=this.bufferCodecEventsExpected,t=this.operationQueue,r=this.pendingTracks,n=Object.keys(r).length;if(n&&!e||2===n){this.createSourceBuffers(r),this.pendingTracks={};var i=this.getSourceBufferTypes();if(i.length)this.hls.trigger(M.BUFFER_CREATED,{tracks:this.tracks}),i.forEach((function(e){t.executeNext(e)}));else{var a=new Error("could not create source buffer for media codec(s)");this.hls.trigger(M.ERROR,{type:O.MEDIA_ERROR,details:N.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:a,reason:a.message})}}}},{key:"createSourceBuffers",value:function(e){var t=this.sourceBuffer,r=this.mediaSource;if(!r)throw Error("createSourceBuffers called when mediaSource was null");for(var n in e)if(!t[n]){var i=e[n];if(!i)throw Error("source buffer exists for track ".concat(n,", however track does not"));var a=i.levelCodec||i.codec,s="".concat(i.container,";codecs=").concat(a);G.log("[buffer-controller]: creating sourceBuffer(".concat(s,")"));try{var o=t[n]=r.addSourceBuffer(s),l=n;this.addBufferListener(l,"updatestart",this._onSBUpdateStart),this.addBufferListener(l,"updateend",this._onSBUpdateEnd),this.addBufferListener(l,"error",this._onSBUpdateError),this.tracks[n]={buffer:o,codec:a,container:i.container,levelCodec:i.levelCodec,metadata:i.metadata,id:i.id}}catch(e){G.error("[buffer-controller]: error while trying to add sourceBuffer: ".concat(e.message)),this.hls.trigger(M.ERROR,{type:O.MEDIA_ERROR,details:N.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:e,mimeType:s})}}}},{key:"_onSBUpdateStart",value:function(e){this.operationQueue.current(e).onStart()}},{key:"_onSBUpdateEnd",value:function(e){var t=this.operationQueue;t.current(e).onComplete(),t.shiftAndExecuteNext(e)}},{key:"_onSBUpdateError",value:function(e,t){var r=new Error("".concat(e," SourceBuffer error"));G.error("[buffer-controller]: ".concat(r),t),this.hls.trigger(M.ERROR,{type:O.MEDIA_ERROR,details:N.BUFFER_APPENDING_ERROR,error:r,fatal:!1});var n=this.operationQueue.current(e);n&&n.onError(t)}},{key:"removeExecutor",value:function(e,t,r){var n=this.media,i=this.mediaSource,a=this.operationQueue,s=this.sourceBuffer[e];if(!n||!i||!s)return G.warn("[buffer-controller]: Attempting to remove from the ".concat(e," SourceBuffer, but it does not exist")),void a.shiftAndExecuteNext(e);var o=P(n.duration)?n.duration:1/0,l=P(i.duration)?i.duration:1/0,u=Math.max(0,t),c=Math.min(r,o,l);c>u&&!s.ending?(s.ended=!1,G.log("[buffer-controller]: Removing [".concat(u,",").concat(c,"] from the ").concat(e," SourceBuffer")),s.remove(u,c)):a.shiftAndExecuteNext(e)}},{key:"appendExecutor",value:function(e,t){var r=this.operationQueue,n=this.sourceBuffer[t];if(!n)return G.warn("[buffer-controller]: Attempting to append to the ".concat(t," SourceBuffer, but it does not exist")),void r.shiftAndExecuteNext(t);n.ended=!1,n.appendBuffer(e)}},{key:"blockBuffers",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.getSourceBufferTypes();if(!r.length)return G.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),void Promise.resolve().then(e);var n=this.operationQueue,i=r.map((function(e){return n.appendBlocker(e)}));Promise.all(i).then((function(){e(),r.forEach((function(e){var r=t.sourceBuffer[e];null!=r&&r.updating||n.shiftAndExecuteNext(e)}))}))}},{key:"getSourceBufferTypes",value:function(){return Object.keys(this.sourceBuffer)}},{key:"addBufferListener",value:function(e,t,r){var n=this.sourceBuffer[e];if(n){var i=r.bind(this,e);this.listeners[e].push({event:t,listener:i}),n.addEventListener(t,i)}}},{key:"removeBufferListeners",value:function(e){var t=this.sourceBuffer[e];t&&this.listeners[e].forEach((function(e){t.removeEventListener(e.event,e.listener)}))}}]),e}(),_i={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},wi=function(e){var t=e;return _i.hasOwnProperty(e)&&(t=_i[e]),String.fromCharCode(t)},Si=15,Li=100,Ri={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},Ai={17:2,18:4,21:6,22:8,23:10,19:13,20:15},xi={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},Ii={25:2,26:4,29:6,30:8,31:10,27:13,28:15},Di=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],Ci=function(){function e(){(0,g.Z)(this,e),this.time=null,this.verboseLevel=0}return(0,p.Z)(e,[{key:"log",value:function(e,t){if(this.verboseLevel>=e){var r="function"==typeof t?t():t;G.log("".concat(this.time," [").concat(e,"] ").concat(r))}}}]),e}(),Pi=function(e){for(var t=[],r=0;r<e.length;r++)t.push(e[r].toString(16));return t},Mi=function(){function e(t,r,n,i,a){(0,g.Z)(this,e),this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=t||"white",this.underline=r||!1,this.italics=n||!1,this.background=i||"black",this.flash=a||!1}return(0,p.Z)(e,[{key:"reset",value:function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}},{key:"setStyles",value:function(e){for(var t=["foreground","underline","italics","background","flash"],r=0;r<t.length;r++){var n=t[r];e.hasOwnProperty(n)&&(this[n]=e[n])}}},{key:"isDefault",value:function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash}},{key:"equals",value:function(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}},{key:"copy",value:function(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}},{key:"toString",value:function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}]),e}(),Oi=function(){function e(t,r,n,i,a,s){(0,g.Z)(this,e),this.uchar=void 0,this.penState=void 0,this.uchar=t||" ",this.penState=new Mi(r,n,i,a,s)}return(0,p.Z)(e,[{key:"reset",value:function(){this.uchar=" ",this.penState.reset()}},{key:"setChar",value:function(e,t){this.uchar=e,this.penState.copy(t)}},{key:"setPenState",value:function(e){this.penState.copy(e)}},{key:"equals",value:function(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}},{key:"copy",value:function(e){this.uchar=e.uchar,this.penState.copy(e.penState)}},{key:"isEmpty",value:function(){return" "===this.uchar&&this.penState.isDefault()}}]),e}(),Ni=function(){function e(t){(0,g.Z)(this,e),this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var r=0;r<Li;r++)this.chars.push(new Oi);this.logger=t,this.pos=0,this.currPenState=new Mi}return(0,p.Z)(e,[{key:"equals",value:function(e){for(var t=!0,r=0;r<Li;r++)if(!this.chars[r].equals(e.chars[r])){t=!1;break}return t}},{key:"copy",value:function(e){for(var t=0;t<Li;t++)this.chars[t].copy(e.chars[t])}},{key:"isEmpty",value:function(){for(var e=!0,t=0;t<Li;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}},{key:"setCursor",value:function(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>Li&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=Li)}},{key:"moveCursor",value:function(e){var t=this.pos+e;if(e>1)for(var r=this.pos+1;r<t+1;r++)this.chars[r].setPenState(this.currPenState);this.setCursor(t)}},{key:"backSpace",value:function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}},{key:"insertChar",value:function(e){var t=this;e>=144&&this.backSpace();var r=wi(e);this.pos>=Li?this.logger.log(0,(function(){return"Cannot insert "+e.toString(16)+" ("+r+") at position "+t.pos+". Skipping it!"})):(this.chars[this.pos].setChar(r,this.currPenState),this.moveCursor(1))}},{key:"clearFromPos",value:function(e){var t;for(t=e;t<Li;t++)this.chars[t].reset()}},{key:"clear",value:function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}},{key:"clearToEndOfRow",value:function(){this.clearFromPos(this.pos)}},{key:"getTextString",value:function(){for(var e=[],t=!0,r=0;r<Li;r++){var n=this.chars[r].uchar;" "!==n&&(t=!1),e.push(n)}return t?"":e.join("")}},{key:"setPenStyles",value:function(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}]),e}(),Fi=function(){function e(t){(0,g.Z)(this,e),this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var r=0;r<Si;r++)this.rows.push(new Ni(t));this.logger=t,this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}return(0,p.Z)(e,[{key:"reset",value:function(){for(var e=0;e<Si;e++)this.rows[e].clear();this.currRow=14}},{key:"equals",value:function(e){for(var t=!0,r=0;r<Si;r++)if(!this.rows[r].equals(e.rows[r])){t=!1;break}return t}},{key:"copy",value:function(e){for(var t=0;t<Si;t++)this.rows[t].copy(e.rows[t])}},{key:"isEmpty",value:function(){for(var e=!0,t=0;t<Si;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}},{key:"backSpace",value:function(){this.rows[this.currRow].backSpace()}},{key:"clearToEndOfRow",value:function(){this.rows[this.currRow].clearToEndOfRow()}},{key:"insertChar",value:function(e){this.rows[this.currRow].insertChar(e)}},{key:"setPen",value:function(e){this.rows[this.currRow].setPenStyles(e)}},{key:"moveCursor",value:function(e){this.rows[this.currRow].moveCursor(e)}},{key:"setCursor",value:function(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}},{key:"setPAC",value:function(e){this.logger.log(2,(function(){return"pacData = "+JSON.stringify(e)}));var t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(var r=0;r<Si;r++)this.rows[r].clear();var n=this.currRow+1-this.nrRollUpRows,i=this.lastOutputScreen;if(i){var a=i.rows[n].cueStartTime,s=this.logger.time;if(a&&null!==s&&a<s)for(var o=0;o<this.nrRollUpRows;o++)this.rows[t-this.nrRollUpRows+o+1].copy(i.rows[n+o])}}this.currRow=t;var l=this.rows[this.currRow];if(null!==e.indent){var u=e.indent,c=Math.max(u-1,0);l.setCursor(e.indent),e.color=l.chars[c].penState.foreground}var d={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(d)}},{key:"setBkgData",value:function(e){this.logger.log(2,(function(){return"bkgData = "+JSON.stringify(e)})),this.backSpace(),this.setPen(e),this.insertChar(32)}},{key:"setRollUpRows",value:function(e){this.nrRollUpRows=e}},{key:"rollUp",value:function(){var e=this;if(null!==this.nrRollUpRows){this.logger.log(1,(function(){return e.getDisplayText()}));var t=this.currRow+1-this.nrRollUpRows,r=this.rows.splice(t,1)[0];r.clear(),this.rows.splice(this.currRow,0,r),this.logger.log(2,"Rolling up")}else this.logger.log(3,"roll_up but nrRollUpRows not set yet")}},{key:"getDisplayText",value:function(e){e=e||!1;for(var t=[],r="",n=-1,i=0;i<Si;i++){var a=this.rows[i].getTextString();a&&(n=i+1,e?t.push("Row "+n+": '"+a+"'"):t.push(a.trim()))}return t.length>0&&(r=e?"["+t.join(" | ")+"]":t.join("\n")),r}},{key:"getTextAndFormat",value:function(){return this.rows}}]),e}(),Zi=function(){function e(t,r,n){(0,g.Z)(this,e),this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=t,this.outputFilter=r,this.mode=null,this.verbose=0,this.displayedMemory=new Fi(n),this.nonDisplayedMemory=new Fi(n),this.lastOutputScreen=new Fi(n),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=n}return(0,p.Z)(e,[{key:"reset",value:function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}},{key:"getHandler",value:function(){return this.outputFilter}},{key:"setHandler",value:function(e){this.outputFilter=e}},{key:"setPAC",value:function(e){this.writeScreen.setPAC(e)}},{key:"setBkgData",value:function(e){this.writeScreen.setBkgData(e)}},{key:"setMode",value:function(e){e!==this.mode&&(this.mode=e,this.logger.log(2,(function(){return"MODE="+e})),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}},{key:"insertChars",value:function(e){for(var t=this,r=0;r<e.length;r++)this.writeScreen.insertChar(e[r]);var n=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,(function(){return n+": "+t.writeScreen.getDisplayText(!0)})),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(this.logger.log(1,(function(){return"DISPLAYED: "+t.displayedMemory.getDisplayText(!0)})),this.outputDataUpdate())}},{key:"ccRCL",value:function(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}},{key:"ccBS",value:function(){this.logger.log(2,"BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}},{key:"ccAOF",value:function(){}},{key:"ccAON",value:function(){}},{key:"ccDER",value:function(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}},{key:"ccRU",value:function(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}},{key:"ccFON",value:function(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}},{key:"ccRDC",value:function(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}},{key:"ccTR",value:function(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}},{key:"ccRTD",value:function(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}},{key:"ccEDM",value:function(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}},{key:"ccCR",value:function(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}},{key:"ccENM",value:function(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}},{key:"ccEOC",value:function(){var e=this;if(this.logger.log(2,"EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var t=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=t,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,(function(){return"DISP: "+e.displayedMemory.getDisplayText()}))}this.outputDataUpdate(!0)}},{key:"ccTO",value:function(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}},{key:"ccMIDROW",value:function(e){var t={flash:!1};if(t.underline=e%2==1,t.italics=e>=46,t.italics)t.foreground="white";else{var r=Math.floor(e/2)-16;t.foreground=["white","green","blue","cyan","red","yellow","magenta"][r]}this.logger.log(2,"MIDROW: "+JSON.stringify(t)),this.writeScreen.setPen(t)}},{key:"outputDataUpdate",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.logger.time;null!==t&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t):this.cueStartTime=t,this.lastOutputScreen.copy(this.displayedMemory))}},{key:"cueSplitAtTime",value:function(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}]),e}(),Ui=function(){function e(t,r,n){(0,g.Z)(this,e),this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var i=new Ci;this.channels=[null,new Zi(t,r,i),new Zi(t+1,n,i)],this.cmdHistory={a:null,b:null},this.logger=i}return(0,p.Z)(e,[{key:"getHandler",value:function(e){return this.channels[e].getHandler()}},{key:"setHandler",value:function(e,t){this.channels[e].setHandler(t)}},{key:"addData",value:function(e,t){var r,n,i,a=!1;this.logger.time=e;for(var s=0;s<t.length;s+=2)if(n=127&t[s],i=127&t[s+1],0!==n||0!==i){if(this.logger.log(3,"["+Pi([t[s],t[s+1]])+"] -> ("+Pi([n,i])+")"),(r=this.parseCmd(n,i))||(r=this.parseMidrow(n,i)),r||(r=this.parsePAC(n,i)),r||(r=this.parseBackgroundAttributes(n,i)),!r&&(a=this.parseChars(n,i))){var o=this.currentChannel;o&&o>0?this.channels[o].insertChars(a):this.logger.log(2,"No channel found yet. TEXT-MODE?")}r||a||this.logger.log(2,"Couldn't parse cleaned data "+Pi([n,i])+" orig: "+Pi([t[s],t[s+1]]))}}},{key:"parseCmd",value:function(e,t){var r=this.cmdHistory;if(!((20===e||28===e||21===e||29===e)&&t>=32&&t<=47||(23===e||31===e)&&t>=33&&t<=35))return!1;if(ji(e,t,r))return Bi(null,null,r),this.logger.log(3,"Repeated command ("+Pi([e,t])+") is dropped"),!0;var n=20===e||21===e||23===e?1:2,i=this.channels[n];return 20===e||21===e||28===e||29===e?32===t?i.ccRCL():33===t?i.ccBS():34===t?i.ccAOF():35===t?i.ccAON():36===t?i.ccDER():37===t?i.ccRU(2):38===t?i.ccRU(3):39===t?i.ccRU(4):40===t?i.ccFON():41===t?i.ccRDC():42===t?i.ccTR():43===t?i.ccRTD():44===t?i.ccEDM():45===t?i.ccCR():46===t?i.ccENM():47===t&&i.ccEOC():i.ccTO(t-32),Bi(e,t,r),this.currentChannel=n,!0}},{key:"parseMidrow",value:function(e,t){var r=0;if((17===e||25===e)&&t>=32&&t<=47){if((r=17===e?1:2)!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;var n=this.channels[r];return!!n&&(n.ccMIDROW(t),this.logger.log(3,"MIDROW ("+Pi([e,t])+")"),!0)}return!1}},{key:"parsePAC",value:function(e,t){var r,n=this.cmdHistory;if(!((e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127||(16===e||24===e)&&t>=64&&t<=95))return!1;if(ji(e,t,n))return Bi(null,null,n),!0;var i=e<=23?1:2;r=t>=64&&t<=95?1===i?Ri[e]:xi[e]:1===i?Ai[e]:Ii[e];var a=this.channels[i];return!!a&&(a.setPAC(this.interpretPAC(r,t)),Bi(e,t,n),this.currentChannel=i,!0)}},{key:"interpretPAC",value:function(e,t){var r,n={color:null,italics:!1,indent:null,underline:!1,row:e};return r=t>95?t-96:t-64,n.underline=1==(1&r),r<=13?n.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(r/2)]:r<=15?(n.italics=!0,n.color="white"):n.indent=4*Math.floor((r-16)/2),n}},{key:"parseChars",value:function(e,t){var r,n,i=null,a=null;if(e>=25?(r=2,a=e-8):(r=1,a=e),a>=17&&a<=19?(n=17===a?t+80:18===a?t+112:t+144,this.logger.log(2,"Special char '"+wi(n)+"' in channel "+r),i=[n]):e>=32&&e<=127&&(i=0===t?[e]:[e,t]),i){var s=Pi(i);this.logger.log(3,"Char codes =  "+s.join(",")),Bi(e,t,this.cmdHistory)}return i}},{key:"parseBackgroundAttributes",value:function(e,t){var r;if(!((16===e||24===e)&&t>=32&&t<=47||(23===e||31===e)&&t>=45&&t<=47))return!1;var n={};16===e||24===e?(r=Math.floor((t-32)/2),n.background=Di[r],t%2==1&&(n.background=n.background+"_semi")):45===t?n.background="transparent":(n.foreground="black",47===t&&(n.underline=!0));var i=e<=23?1:2;return this.channels[i].setBkgData(n),Bi(e,t,this.cmdHistory),!0}},{key:"reset",value:function(){for(var e=0;e<Object.keys(this.channels).length;e++){var t=this.channels[e];t&&t.reset()}this.cmdHistory={a:null,b:null}}},{key:"cueSplitAtTime",value:function(e){for(var t=0;t<this.channels.length;t++){var r=this.channels[t];r&&r.cueSplitAtTime(e)}}}]),e}();function Bi(e,t,r){r.a=e,r.b=t}function ji(e,t,r){return r.a===e&&r.b===t}var Gi=function(){function e(t,r){(0,g.Z)(this,e),this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=t,this.trackName=r}return(0,p.Z)(e,[{key:"dispatchCue",value:function(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}},{key:"newCue",value:function(e,t,r){(null===this.startTime||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=r,this.timelineController.createCaptionsTrack(this.trackName)}},{key:"reset",value:function(){this.cueRanges=[],this.startTime=null}}]),e}(),Ki=function(){if("undefined"!=typeof self&&self.VTTCue)return self.VTTCue;var e=["","lr","rl"],t=["start","middle","end","left","right"];function r(e,t){if("string"!=typeof t)return!1;if(!Array.isArray(e))return!1;var r=t.toLowerCase();return!!~e.indexOf(r)&&r}function n(e){return r(t,e)}function i(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];for(var i=1;i<arguments.length;i++){var a=arguments[i];for(var s in a)e[s]=a[s]}return e}function a(t,a,s){var o=this,l={enumerable:!0};o.hasBeenReset=!1;var u="",c=!1,d=t,f=a,h=s,v=null,g="",p=!0,m="auto",y="start",b=50,k="middle",E=50,T="middle";Object.defineProperty(o,"id",i({},l,{get:function(){return u},set:function(e){u=""+e}})),Object.defineProperty(o,"pauseOnExit",i({},l,{get:function(){return c},set:function(e){c=!!e}})),Object.defineProperty(o,"startTime",i({},l,{get:function(){return d},set:function(e){if("number"!=typeof e)throw new TypeError("Start time must be set to a number.");d=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"endTime",i({},l,{get:function(){return f},set:function(e){if("number"!=typeof e)throw new TypeError("End time must be set to a number.");f=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"text",i({},l,{get:function(){return h},set:function(e){h=""+e,this.hasBeenReset=!0}})),Object.defineProperty(o,"region",i({},l,{get:function(){return v},set:function(e){v=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"vertical",i({},l,{get:function(){return g},set:function(t){var n=function(t){return r(e,t)}(t);if(!1===n)throw new SyntaxError("An invalid or illegal string was specified.");g=n,this.hasBeenReset=!0}})),Object.defineProperty(o,"snapToLines",i({},l,{get:function(){return p},set:function(e){p=!!e,this.hasBeenReset=!0}})),Object.defineProperty(o,"line",i({},l,{get:function(){return m},set:function(e){if("number"!=typeof e&&"auto"!==e)throw new SyntaxError("An invalid number or illegal string was specified.");m=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"lineAlign",i({},l,{get:function(){return y},set:function(e){var t=n(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");y=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"position",i({},l,{get:function(){return b},set:function(e){if(e<0||e>100)throw new Error("Position must be between 0 and 100.");b=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"positionAlign",i({},l,{get:function(){return k},set:function(e){var t=n(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");k=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"size",i({},l,{get:function(){return E},set:function(e){if(e<0||e>100)throw new Error("Size must be between 0 and 100.");E=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"align",i({},l,{get:function(){return T},set:function(e){var t=n(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");T=t,this.hasBeenReset=!0}})),o.displayState=void 0}return a.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},a}(),Hi=function(){function e(){(0,g.Z)(this,e)}return(0,p.Z)(e,[{key:"decode",value:function(e,t){if(!e)return"";if("string"!=typeof e)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}]),e}();function zi(e){function t(e,t,r,n){return 3600*(0|e)+60*(0|t)+(0|r)+parseFloat(n||0)}var r=e.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return r?parseFloat(r[2])>59?t(r[2],r[3],0,r[4]):t(r[1],r[2],r[3],r[4]):null}var Vi=function(){function e(){(0,g.Z)(this,e),this.values=Object.create(null)}return(0,p.Z)(e,[{key:"set",value:function(e,t){this.get(e)||""===t||(this.values[e]=t)}},{key:"get",value:function(e,t,r){return r?this.has(e)?this.values[e]:t[r]:this.has(e)?this.values[e]:t}},{key:"has",value:function(e){return e in this.values}},{key:"alt",value:function(e,t,r){for(var n=0;n<r.length;++n)if(t===r[n]){this.set(e,t);break}}},{key:"integer",value:function(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}},{key:"percent",value:function(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){var r=parseFloat(t);if(r>=0&&r<=100)return this.set(e,r),!0}return!1}}]),e}();function qi(e,t,r,n){var i=n?e.split(n):[e];for(var a in i)if("string"==typeof i[a]){var s=i[a].split(r);2===s.length&&t(s[0],s[1])}}var Wi=new Ki(0,0,""),Yi="middle"===Wi.align?"middle":"center";function Xi(e,t,r){var n=e;function i(){var t=zi(e);if(null===t)throw new Error("Malformed timestamp: "+n);return e=e.replace(/^[^\sa-zA-Z-]+/,""),t}function a(){e=e.replace(/^\s+/,"")}if(a(),t.startTime=i(),a(),"--\x3e"!==e.slice(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+n);e=e.slice(3),a(),t.endTime=i(),a(),function(e,t){var n=new Vi;qi(e,(function(e,t){var i;switch(e){case"region":for(var a=r.length-1;a>=0;a--)if(r[a].id===t){n.set(e,r[a].region);break}break;case"vertical":n.alt(e,t,["rl","lr"]);break;case"line":i=t.split(","),n.integer(e,i[0]),n.percent(e,i[0])&&n.set("snapToLines",!1),n.alt(e,i[0],["auto"]),2===i.length&&n.alt("lineAlign",i[1],["start",Yi,"end"]);break;case"position":i=t.split(","),n.percent(e,i[0]),2===i.length&&n.alt("positionAlign",i[1],["start",Yi,"end","line-left","line-right","auto"]);break;case"size":n.percent(e,t);break;case"align":n.alt(e,t,["start",Yi,"end","left","right"])}}),/:/,/\s/),t.region=n.get("region",null),t.vertical=n.get("vertical","");var i=n.get("line","auto");"auto"===i&&-1===Wi.line&&(i=-1),t.line=i,t.lineAlign=n.get("lineAlign","start"),t.snapToLines=n.get("snapToLines",!0),t.size=n.get("size",100),t.align=n.get("align",Yi);var a=n.get("position","auto");"auto"===a&&50===Wi.position&&(a="start"===t.align||"left"===t.align?0:"end"===t.align||"right"===t.align?100:50),t.position=a}(e,t)}function Qi(e){return e.replace(/<br(?: \/)?>/gi,"\n")}var $i=function(){function e(){(0,g.Z)(this,e),this.state="INITIAL",this.buffer="",this.decoder=new Hi,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}return(0,p.Z)(e,[{key:"parse",value:function(e){var t=this;function r(){var e=t.buffer,r=0;for(e=Qi(e);r<e.length&&"\r"!==e[r]&&"\n"!==e[r];)++r;var n=e.slice(0,r);return"\r"===e[r]&&++r,"\n"===e[r]&&++r,t.buffer=e.slice(r),n}e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));try{var n="";if("INITIAL"===t.state){if(!/\r\n|\n/.test(t.buffer))return this;var i=(n=r()).match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(null==i||!i[0])throw new Error("Malformed WebVTT signature.");t.state="HEADER"}for(var a=!1;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(a?a=!1:n=r(),t.state){case"HEADER":/:/.test(n)?qi(n,(function(e,t){}),/:/):n||(t.state="ID");continue;case"NOTE":n||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(n)){t.state="NOTE";break}if(!n)continue;if(t.cue=new Ki(0,0,""),t.state="CUE",-1===n.indexOf("--\x3e")){t.cue.id=n;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{Xi(n,t.cue,t.regionList)}catch(e){t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":var s=-1!==n.indexOf("--\x3e");if(!n||s&&(a=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(null===t.cue)continue;t.cue.text&&(t.cue.text+="\n"),t.cue.text+=n;continue;case"BADCUE":n||(t.state="ID")}}}catch(e){"CUETEXT"===t.state&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state="INITIAL"===t.state?"BADWEBVTT":"BADCUE"}return this}},{key:"flush",value:function(){var e=this;try{if((e.cue||"HEADER"===e.state)&&(e.buffer+="\n\n",e.parse()),"INITIAL"===e.state||"BADWEBVTT"===e.state)throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}]),e}(),Ji=/\r\n|\n\r|\n|\r/g,ea=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return e.slice(r,r+t.length)===t},ta=function(e){for(var t=5381,r=e.length;r;)t=33*t^e.charCodeAt(--r);return(t>>>0).toString()};function ra(e,t,r){return ta(e.toString())+ta(t.toString())+ta(r)}var na="stpp.ttml.im1t",ia=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,aa=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,sa={left:"start",center:"center",right:"end",start:"start",end:"end"};function oa(e,t,r,n){var i=Be(new Uint8Array(e),["mdat"]);if(0!==i.length){var a=i.map((function(e){return xe(e)})),s=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return Nn(e,t,1/r,n)}(t.baseTime,1,t.timescale);try{a.forEach((function(e){return r(function(e,t){var r=(new DOMParser).parseFromString(e,"text/xml").getElementsByTagName("tt")[0];if(!r)throw new Error("Invalid ttml");var n={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},i=Object.keys(n).reduce((function(e,t){return e[t]=r.getAttribute("ttp:".concat(t))||n[t],e}),{}),a="preserve"!==r.getAttribute("xml:space"),s=ua(la(r,"styling","style")),o=ua(la(r,"layout","region")),l=la(r,"body","[begin]");return[].map.call(l,(function(e){var r=ca(e,a);if(!r||!e.hasAttribute("begin"))return null;var n=ha(e.getAttribute("begin"),i),l=ha(e.getAttribute("dur"),i),u=ha(e.getAttribute("end"),i);if(null===n)throw fa(e);if(null===u){if(null===l)throw fa(e);u=n+l}var c=new Ki(n-t,u-t,r);c.id=ra(c.startTime,c.endTime,c.text);var d=function(e,t,r){var n="http://www.w3.org/ns/ttml#styling",i=null,a=null!=e&&e.hasAttribute("style")?e.getAttribute("style"):null;return a&&r.hasOwnProperty(a)&&(i=r[a]),["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"].reduce((function(r,a){var s=da(t,n,a)||da(e,n,a)||da(i,n,a);return s&&(r[a]=s),r}),{})}(o[e.getAttribute("region")],s[e.getAttribute("style")],s),f=d.textAlign;if(f){var h=sa[f];h&&(c.lineAlign=h),c.align=f}return C(c,d),c})).filter((function(e){return null!==e}))}(e,s))}))}catch(e){n(e)}}else n(new Error("Could not parse IMSC1 mdat"))}function la(e,t,r){var n=e.getElementsByTagName(t)[0];return n?[].slice.call(n.querySelectorAll(r)):[]}function ua(e){return e.reduce((function(e,t){var r=t.getAttribute("xml:id");return r&&(e[r]=t),e}),{})}function ca(e,t){return[].slice.call(e.childNodes).reduce((function(e,r,n){var i;return"br"===r.nodeName&&n?e+"\n":null!=(i=r.childNodes)&&i.length?ca(r,t):t?e+r.textContent.trim().replace(/\s+/g," "):e+r.textContent}),"")}function da(e,t,r){return e&&e.hasAttributeNS(t,r)?e.getAttributeNS(t,r):null}function fa(e){return new Error("Could not parse ttml timestamp ".concat(e))}function ha(e,t){if(!e)return null;var r=zi(e);return null===r&&(ia.test(e)?r=function(e,t){var r=ia.exec(e),n=(0|r[4])+(0|r[5])/t.subFrameRate;return 3600*(0|r[1])+60*(0|r[2])+(0|r[3])+n/t.frameRate}(e,t):aa.test(e)&&(r=function(e,t){var r=aa.exec(e),n=Number(r[1]);switch(r[2]){case"h":return 3600*n;case"m":return 60*n;case"ms":return 1e3*n;case"f":return n/t.frameRate;case"t":return n/t.tickRate}return n}(e,t))),r}var va=function(){function e(t){if((0,g.Z)(this,e),this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this.captionsProperties=void 0,this.hls=t,this.config=t.config,this.Cues=t.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var r=new Gi(this,"textTrack1"),n=new Gi(this,"textTrack2"),i=new Gi(this,"textTrack3"),a=new Gi(this,"textTrack4");this.cea608Parser1=new Ui(1,r,n),this.cea608Parser2=new Ui(3,i,a)}t.on(M.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(M.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(M.MANIFEST_LOADING,this.onManifestLoading,this),t.on(M.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(M.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.on(M.FRAG_LOADING,this.onFragLoading,this),t.on(M.FRAG_LOADED,this.onFragLoaded,this),t.on(M.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),t.on(M.FRAG_DECRYPTED,this.onFragDecrypted,this),t.on(M.INIT_PTS_FOUND,this.onInitPtsFound,this),t.on(M.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),t.on(M.BUFFER_FLUSHING,this.onBufferFlushing,this)}return(0,p.Z)(e,[{key:"destroy",value:function(){var e=this.hls;e.off(M.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(M.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(M.MANIFEST_LOADING,this.onManifestLoading,this),e.off(M.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(M.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(M.FRAG_LOADING,this.onFragLoading,this),e.off(M.FRAG_LOADED,this.onFragLoaded,this),e.off(M.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(M.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(M.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(M.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(M.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null}},{key:"addCues",value:function(e,t,r,n,i){for(var a,s,o,l,u=!1,c=i.length;c--;){var d=i[c],f=(a=d[0],s=d[1],o=t,l=r,Math.min(s,l)-Math.max(a,o));if(f>=0&&(d[0]=Math.min(d[0],t),d[1]=Math.max(d[1],r),u=!0,f/(r-t)>.5))return}if(u||i.push([t,r]),this.config.renderTextTracksNatively){var h=this.captionsTracks[e];this.Cues.newCue(h,t,r,n)}else{var v=this.Cues.newCue(null,t,r,n);this.hls.trigger(M.CUES_PARSED,{type:"captions",cues:v,track:e})}}},{key:"onInitPtsFound",value:function(e,t){var r=this,n=t.frag,i=t.id,a=t.initPTS,s=t.timescale,o=this.unparsedVttFrags;"main"===i&&(this.initPTS[n.cc]={baseTime:a,timescale:s}),o.length&&(this.unparsedVttFrags=[],o.forEach((function(e){r.onFragLoaded(M.FRAG_LOADED,e)})))}},{key:"getExistingTrack",value:function(e){var t=this.media;if(t)for(var r=0;r<t.textTracks.length;r++){var n=t.textTracks[r];if(n[e])return n}return null}},{key:"createCaptionsTrack",value:function(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}},{key:"createNativeTrack",value:function(e){if(!this.captionsTracks[e]){var t=this.captionsProperties,r=this.captionsTracks,n=this.media,i=t[e],a=i.label,s=i.languageCode,o=this.getExistingTrack(e);if(o)r[e]=o,Pt(r[e]),Dt(r[e],n);else{var l=this.createTextTrack("captions",a,s);l&&(l[e]=!0,r[e]=l)}}}},{key:"createNonNativeTrack",value:function(e){if(!this.nonNativeCaptionsTracks[e]){var t=this.captionsProperties[e];if(t){var r={_id:e,label:t.label,kind:"captions",default:!!t.media&&!!t.media.default,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=r,this.hls.trigger(M.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[r]})}}}},{key:"createTextTrack",value:function(e,t,r){var n=this.media;if(n)return n.addTextTrack(e,t,r)}},{key:"onMediaAttaching",value:function(e,t){this.media=t.media,this._cleanTracks()}},{key:"onMediaDetaching",value:function(){var e=this.captionsTracks;Object.keys(e).forEach((function(t){Pt(e[t]),delete e[t]})),this.nonNativeCaptionsTracks={}}},{key:"onManifestLoading",value:function(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}},{key:"_cleanTracks",value:function(){var e=this.media;if(e){var t=e.textTracks;if(t)for(var r=0;r<t.length;r++)Pt(t[r])}}},{key:"onSubtitleTracksUpdated",value:function(e,t){var r=this,n=t.subtitleTracks||[],i=n.some((function(e){return e.textCodec===na}));if(this.config.enableWebVTT||i&&this.config.enableIMSC1){if(hi(this.tracks,n))return void(this.tracks=n);if(this.textTracks=[],this.tracks=n,this.config.renderTextTracksNatively){var a=this.media?this.media.textTracks:null;this.tracks.forEach((function(e,t){var n;if(a&&t<a.length){for(var i=null,s=0;s<a.length;s++)if(ga(a[s],e)){i=a[s];break}i&&(n=i)}if(n)Pt(n);else{var o=r._captionsOrSubtitlesFromCharacteristics(e);(n=r.createTextTrack(o,e.name,e.lang))&&(n.mode="disabled")}n&&(n.groupId=e.groupId,r.textTracks.push(n))}))}else if(this.tracks.length){var s=this.tracks.map((function(e){return{label:e.name,kind:e.type.toLowerCase(),default:e.default,subtitleTrack:e}}));this.hls.trigger(M.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:s})}}}},{key:"_captionsOrSubtitlesFromCharacteristics",value:function(e){if(e.attrs.CHARACTERISTICS){var t=/transcribes-spoken-dialog/gi.test(e.attrs.CHARACTERISTICS),r=/describes-music-and-sound/gi.test(e.attrs.CHARACTERISTICS);if(t&&r)return"captions"}return"subtitles"}},{key:"onManifestLoaded",value:function(e,t){var r=this;this.config.enableCEA708Captions&&t.captions&&t.captions.forEach((function(e){var t=/(?:CC|SERVICE)([1-4])/.exec(e.instreamId);if(t){var n="textTrack".concat(t[1]),i=r.captionsProperties[n];i&&(i.label=e.name,e.lang&&(i.languageCode=e.lang),i.media=e)}}))}},{key:"closedCaptionsForLevel",value:function(e){var t=this.hls.levels[e.level];return null==t?void 0:t.attrs["CLOSED-CAPTIONS"]}},{key:"onFragLoading",value:function(e,t){var r=this.cea608Parser1,n=this.cea608Parser2,i=this.lastSn,a=this.lastPartIndex;if(this.enabled&&r&&n&&t.frag.type===St){var s,o,l=t.frag.sn,u=null!=(s=null==t||null==(o=t.part)?void 0:o.index)?s:-1;l===i+1||l===i&&u===a+1||(r.reset(),n.reset()),this.lastSn=l,this.lastPartIndex=u}}},{key:"onFragLoaded",value:function(e,t){var r=t.frag,n=t.payload;if(r.type===Rt)if(n.byteLength){var i=r.decryptdata,a="stats"in t;if(null==i||!i.encrypted||a){var s=this.tracks[r.level],o=this.vttCCs;o[r.cc]||(o[r.cc]={start:r.start,prevCC:this.prevCC,new:!0},this.prevCC=r.cc),s&&s.textCodec===na?this._parseIMSC1(r,n):this._parseVTTs(t)}}else this.hls.trigger(M.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:new Error("Empty subtitle payload")})}},{key:"_parseIMSC1",value:function(e,t){var r=this,n=this.hls;oa(t,this.initPTS[e.cc],(function(t){r._appendCues(t,e.level),n.trigger(M.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})}),(function(t){G.log("Failed to parse IMSC1: ".concat(t)),n.trigger(M.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:t})}))}},{key:"_parseVTTs",value:function(e){var t,r=this,n=e.frag,i=e.payload,a=this.initPTS,s=this.unparsedVttFrags,o=a.length-1;if(a[n.cc]||-1!==o){var l=this.hls;!function(e,t,r,n,i,a,s){var o,l=new $i,u=xe(new Uint8Array(e)).trim().replace(Ji,"\n").split("\n"),c=[],d=t?function(e){return Nn(e,9e4,1/(arguments.length>1&&void 0!==arguments[1]?arguments[1]:1))}(t.baseTime,t.timescale):0,f="00:00.000",h=0,v=0,g=!0;l.oncue=function(e){var a=r[n],s=r.ccOffset,l=(h-d)/9e4;if(null!=a&&a.new&&(void 0!==v?s=r.ccOffset=a.start:function(e,t,r){var n=e[t],i=e[n.prevCC];if(!i||!i.new&&n.new)return e.ccOffset=e.presentationOffset=n.start,void(n.new=!1);for(;null!=(a=i)&&a.new;){var a;e.ccOffset+=n.start-i.start,n.new=!1,i=e[(n=i).prevCC]}e.presentationOffset=r}(r,n,l)),l){if(!t)return void(o=new Error("Missing initPTS for VTT MPEGTS"));s=l-r.presentationOffset}var u=e.endTime-e.startTime,f=jn(9e4*(e.startTime+s-v),9e4*i)/9e4;e.startTime=Math.max(f,0),e.endTime=Math.max(f+u,0);var g=e.text.trim();e.text=decodeURIComponent(encodeURIComponent(g)),e.id||(e.id=ra(e.startTime,e.endTime,g)),e.endTime>0&&c.push(e)},l.onparsingerror=function(e){o=e},l.onflush=function(){o?s(o):a(c)},u.forEach((function(e){if(g){if(ea(e,"X-TIMESTAMP-MAP=")){g=!1,e.slice(16).split(",").forEach((function(e){ea(e,"LOCAL:")?f=e.slice(6):ea(e,"MPEGTS:")&&(h=parseInt(e.slice(7)))}));try{v=function(e){var t=parseInt(e.slice(-3)),r=parseInt(e.slice(-6,-4)),n=parseInt(e.slice(-9,-7)),i=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!(P(t)&&P(r)&&P(n)&&P(i)))throw Error("Malformed X-TIMESTAMP-MAP: Local:".concat(e));return t+=1e3*r,(t+=6e4*n)+36e5*i}(f)/1e3}catch(e){o=e}return}""===e&&(g=!1)}l.parse(e+"\n")})),l.flush()}(null!=(t=n.initSegment)&&t.data?ze(n.initSegment.data,new Uint8Array(i)):i,this.initPTS[n.cc],this.vttCCs,n.cc,n.start,(function(e){r._appendCues(e,n.level),l.trigger(M.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:n})}),(function(t){var a="Missing initPTS for VTT MPEGTS"===t.message;a?s.push(e):r._fallbackToIMSC1(n,i),G.log("Failed to parse VTT cue: ".concat(t)),a&&o>n.cc||l.trigger(M.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:t})}))}else s.push(e)}},{key:"_fallbackToIMSC1",value:function(e,t){var r=this,n=this.tracks[e.level];n.textCodec||oa(t,this.initPTS[e.cc],(function(){n.textCodec=na,r._parseIMSC1(e,t)}),(function(){n.textCodec="wvtt"}))}},{key:"_appendCues",value:function(e,t){var r=this.hls;if(this.config.renderTextTracksNatively){var n=this.textTracks[t];if(!n||"disabled"===n.mode)return;e.forEach((function(e){return Ct(n,e)}))}else{var i=this.tracks[t];if(!i)return;var a=i.default?"default":"subtitles"+t;r.trigger(M.CUES_PARSED,{type:"subtitles",cues:e,track:a})}}},{key:"onFragDecrypted",value:function(e,t){t.frag.type===Rt&&this.onFragLoaded(M.FRAG_LOADED,t)}},{key:"onSubtitleTracksCleared",value:function(){this.tracks=[],this.captionsTracks={}}},{key:"onFragParsingUserdata",value:function(e,t){var r=this.cea608Parser1,n=this.cea608Parser2;if(this.enabled&&r&&n){var i=t.frag,a=t.samples;if(i.type!==St||"NONE"!==this.closedCaptionsForLevel(i))for(var s=0;s<a.length;s++){var o=a[s].bytes;if(o){var l=this.extractCea608Data(o);r.addData(a[s].pts,l[0]),n.addData(a[s].pts,l[1])}}}}},{key:"onBufferFlushing",value:function(e,t){var r=t.startOffset,n=t.endOffset,i=t.endOffsetSubtitles,a=t.type,s=this.media;if(s&&!(s.currentTime<n)){if(!a||"video"===a){var o=this.captionsTracks;Object.keys(o).forEach((function(e){return Mt(o[e],r,n)}))}if(this.config.renderTextTracksNatively&&0===r&&void 0!==i){var l=this.textTracks;Object.keys(l).forEach((function(e){return Mt(l[e],r,i)}))}}}},{key:"extractCea608Data",value:function(e){for(var t=[[],[]],r=31&e[0],n=2,i=0;i<r;i++){var a=e[n++],s=127&e[n++],o=127&e[n++];if((0!==s||0!==o)&&0!=(4&a)){var l=3&a;0!==l&&1!==l||(t[l].push(s),t[l].push(o))}}return t}}]),e}();function ga(e,t){return!!e&&e.label===t.name&&!(e.textTrack1||e.textTrack2)}var pa=function(){function e(t){(0,g.Z)(this,e),this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=t,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}return(0,p.Z)(e,[{key:"setStreamController",value:function(e){this.streamController=e}},{key:"destroy",value:function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}},{key:"registerListeners",value:function(){var e=this.hls;e.on(M.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(M.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(M.MANIFEST_PARSED,this.onManifestParsed,this),e.on(M.BUFFER_CODECS,this.onBufferCodecs,this),e.on(M.MEDIA_DETACHING,this.onMediaDetaching,this)}},{key:"unregisterListener",value:function(){var e=this.hls;e.off(M.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(M.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(M.MANIFEST_PARSED,this.onManifestParsed,this),e.off(M.BUFFER_CODECS,this.onBufferCodecs,this),e.off(M.MEDIA_DETACHING,this.onMediaDetaching,this)}},{key:"onFpsDropLevelCapping",value:function(e,t){var r=this.hls.levels[t.droppedLevel];this.isLevelAllowed(r)&&this.restrictedLevels.push({bitrate:r.bitrate,height:r.height,width:r.width})}},{key:"onMediaAttaching",value:function(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null}},{key:"onManifestParsed",value:function(e,t){var r=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,r.config.capLevelToPlayerSize&&t.video&&this.startCapping()}},{key:"onBufferCodecs",value:function(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}},{key:"onMediaDetaching",value:function(){this.stopCapping()}},{key:"detectPlayerSize",value:function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var e=this.hls.levels;if(e.length){var t=this.hls;t.autoLevelCapping=this.getMaxLevel(e.length-1),t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}},{key:"getMaxLevel",value:function(t){var r=this,n=this.hls.levels;if(!n.length)return-1;var i=n.filter((function(e,n){return r.isLevelAllowed(e)&&n<=t}));return this.clientRect=null,e.getMaxLevelByMediaSize(i,this.mediaWidth,this.mediaHeight)}},{key:"startCapping",value:function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}},{key:"stopCapping",value:function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}},{key:"getDimensions",value:function(){if(this.clientRect)return this.clientRect;var e=this.media,t={width:0,height:0};if(e){var r=e.getBoundingClientRect();t.width=r.width,t.height=r.height,t.width||t.height||(t.width=r.right-r.left||e.width||0,t.height=r.bottom-r.top||e.height||0)}return this.clientRect=t,t}},{key:"mediaWidth",get:function(){return this.getDimensions().width*this.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*this.contentScaleFactor}},{key:"contentScaleFactor",get:function(){var e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch(e){}return e}},{key:"isLevelAllowed",value:function(e){return!this.restrictedLevels.some((function(t){return e.bitrate===t.bitrate&&e.width===t.width&&e.height===t.height}))}}],[{key:"getMaxLevelByMediaSize",value:function(e,t,r){if(null==e||!e.length)return-1;for(var n,i,a=e.length-1,s=0;s<e.length;s+=1){var o=e[s];if((o.width>=t||o.height>=r)&&(n=o,!(i=e[s+1])||n.width!==i.width||n.height!==i.height)){a=s;break}}return a}}]),e}(),ma=function(){function e(t){(0,g.Z)(this,e),this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=t,this.registerListeners()}return(0,p.Z)(e,[{key:"setStreamController",value:function(e){this.streamController=e}},{key:"registerListeners",value:function(){this.hls.on(M.MEDIA_ATTACHING,this.onMediaAttaching,this)}},{key:"unregisterListeners",value:function(){this.hls.off(M.MEDIA_ATTACHING,this.onMediaAttaching,this)}},{key:"destroy",value:function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}},{key:"onMediaAttaching",value:function(e,t){var r=this.hls.config;if(r.capLevelOnFPSDrop){var n=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=n,n&&"function"==typeof n.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),r.fpsDroppedMonitoringPeriod)}}},{key:"checkFPS",value:function(e,t,r){var n=performance.now();if(t){if(this.lastTime){var i=n-this.lastTime,a=r-this.lastDroppedFrames,s=t-this.lastDecodedFrames,o=1e3*a/i,l=this.hls;if(l.trigger(M.FPS_DROP,{currentDropped:a,currentDecoded:s,totalDroppedFrames:r}),o>0&&a>l.config.fpsDroppedMonitoringThreshold*s){var u=l.currentLevel;G.warn("drop FPS ratio greater than max allowed value for currentLevel: "+u),u>0&&(-1===l.autoLevelCapping||l.autoLevelCapping>=u)&&(u-=1,l.trigger(M.FPS_DROP_LEVEL_CAPPING,{level:u,droppedLevel:l.currentLevel}),l.autoLevelCapping=u,this.streamController.nextLevelSwitch())}}this.lastTime=n,this.lastDroppedFrames=r,this.lastDecodedFrames=t}}},{key:"checkFPSInterval",value:function(){var e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){var t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}]),e}(),ya="[eme]",ba=function(){function e(t){(0,g.Z)(this,e),this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.setMediaKeysQueue=e.CDMCleanupPromise?[e.CDMCleanupPromise]:[],this.onMediaEncrypted=this._onMediaEncrypted.bind(this),this.onWaitingForKey=this._onWaitingForKey.bind(this),this.debug=G.debug.bind(G,ya),this.log=G.log.bind(G,ya),this.warn=G.warn.bind(G,ya),this.error=G.error.bind(G,ya),this.hls=t,this.config=t.config,this.registerListeners()}return(0,p.Z)(e,[{key:"destroy",value:function(){this.unregisterListeners(),this.onMediaDetached();var e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.onMediaEncrypted=this.onWaitingForKey=this.keyIdToKeySessionPromise=null,this.config=null}},{key:"registerListeners",value:function(){this.hls.on(M.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(M.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(M.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(M.MANIFEST_LOADED,this.onManifestLoaded,this)}},{key:"unregisterListeners",value:function(){this.hls.off(M.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(M.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(M.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(M.MANIFEST_LOADED,this.onManifestLoaded,this)}},{key:"getLicenseServerUrl",value:function(e){var t=this.config,r=t.drmSystems,n=t.widevineLicenseUrl,i=r[e];if(i)return i.licenseUrl;if(e===ie.WIDEVINE&&n)return n;throw new Error('no license server URL configured for key-system "'.concat(e,'"'))}},{key:"getServerCertificateUrl",value:function(e){var t=this.config.drmSystems[e];if(t)return t.serverCertificateUrl;this.log('No Server Certificate in config.drmSystems["'.concat(e,'"]'))}},{key:"attemptKeySystemAccess",value:function(e){var t=this,r=this.hls.levels,n=function(e,t,r){return!!e&&r.indexOf(e)===t},i=r.map((function(e){return e.audioCodec})).filter(n),a=r.map((function(e){return e.videoCodec})).filter(n);return i.length+a.length===0&&a.push("avc1.42e01e"),new Promise((function(r,n){!function e(s){var o=s.shift();t.getMediaKeysPromise(o,i,a).then((function(e){return r({keySystem:o,mediaKeys:e})})).catch((function(t){s.length?e(s):n(t instanceof ka?t:new ka({type:O.KEY_SYSTEM_ERROR,details:N.KEY_SYSTEM_NO_ACCESS,error:t,fatal:!0},t.message))}))}(e)}))}},{key:"requestMediaKeySystemAccess",value:function(e,t){var r=this.config.requestMediaKeySystemAccessFunc;if("function"!=typeof r){var n="Configured requestMediaKeySystemAccess is not a function ".concat(r);return null===he&&"http:"===self.location.protocol&&(n="navigator.requestMediaKeySystemAccess is not available over insecure protocol ".concat(location.protocol)),Promise.reject(new Error(n))}return r(e,t)}},{key:"getMediaKeysPromise",value:function(e,t,r){var n=this,i=function(e,t,r,n){var i;switch(e){case ie.FAIRPLAY:i=["cenc","sinf"];break;case ie.WIDEVINE:case ie.PLAYREADY:i=["cenc"];break;case ie.CLEARKEY:i=["cenc","keyids"];break;default:throw new Error("Unknown key-system: ".concat(e))}return function(e,t,r,n){return[{initDataTypes:e,persistentState:n.persistentState||"not-allowed",distinctiveIdentifier:n.distinctiveIdentifier||"not-allowed",sessionTypes:n.sessionTypes||[n.sessionType||"temporary"],audioCapabilities:t.map((function(e){return{contentType:'audio/mp4; codecs="'.concat(e,'"'),robustness:n.audioRobustness||"",encryptionScheme:n.audioEncryptionScheme||null}})),videoCapabilities:r.map((function(e){return{contentType:'video/mp4; codecs="'.concat(e,'"'),robustness:n.videoRobustness||"",encryptionScheme:n.videoEncryptionScheme||null}}))}]}(i,t,r,n)}(e,t,r,this.config.drmSystemOptions),a=this.keySystemAccessPromises[e],s=null==a?void 0:a.keySystemAccess;if(!s){this.log('Requesting encrypted media "'.concat(e,'" key-system access with config: ').concat(JSON.stringify(i))),s=this.requestMediaKeySystemAccess(e,i);var o=this.keySystemAccessPromises[e]={keySystemAccess:s};return s.catch((function(t){n.log('Failed to obtain access to key-system "'.concat(e,'": ').concat(t))})),s.then((function(t){n.log('Access for key-system "'.concat(t.keySystem,'" obtained'));var r=n.fetchServerCertificate(e);return n.log('Create media-keys for "'.concat(e,'"')),o.mediaKeys=t.createMediaKeys().then((function(t){return n.log('Media-keys created for "'.concat(e,'"')),r.then((function(r){return r?n.setMediaKeysServerCertificate(t,e,r):t}))})),o.mediaKeys.catch((function(t){n.error('Failed to create media-keys for "'.concat(e,'"}: ').concat(t))})),o.mediaKeys}))}return s.then((function(){return a.mediaKeys}))}},{key:"createMediaKeySessionContext",value:function(e){var t=e.decryptdata,r=e.keySystem,n=e.mediaKeys;this.log('Creating key-system session "'.concat(r,'" keyId: ').concat(De(t.keyId||[])));var i=n.createSession(),a={decryptdata:t,keySystem:r,mediaKeys:n,mediaKeysSession:i,keyStatus:"status-pending"};return this.mediaKeySessions.push(a),a}},{key:"renewKeySession",value:function(e){var t=e.decryptdata;if(t.pssh){var r=this.createMediaKeySessionContext(e),n=this.getKeyIdString(t);this.keyIdToKeySessionPromise[n]=this.generateRequestWithPreferredKeySession(r,"cenc",t.pssh,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}},{key:"getKeyIdString",value:function(e){if(!e)throw new Error("Could not read keyId of undefined decryptdata");if(null===e.keyId)throw new Error("keyId is null");return De(e.keyId)}},{key:"updateKeySession",value:function(e,t){var r,n=e.mediaKeysSession;return this.log('Updating key-session "'.concat(n.sessionId,'" for keyID ').concat(De((null==(r=e.decryptdata)?void 0:r.keyId)||[]),"\n      } (data length: ").concat(t?t.byteLength:t,")")),n.update(t)}},{key:"selectKeySystemFormat",value:function(e){var t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log("Selecting key-system from fragment (sn: ".concat(e.sn," ").concat(e.type,": ").concat(e.level,") key formats ").concat(t.join(", "))),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}},{key:"getKeyFormatPromise",value:function(e){var t=this;return new Promise((function(r,n){var i=fe(t.config),a=e.map(ue).filter((function(e){return!!e&&-1!==i.indexOf(e)}));return t.getKeySystemSelectionPromise(a).then((function(e){var t=e.keySystem,i=de(t);i?r(i):n(new Error('Unable to find format for key-system "'.concat(t,'"')))})).catch(n)}))}},{key:"loadKey",value:function(e){var t=this,r=e.keyInfo.decryptdata,n=this.getKeyIdString(r),i="(keyId: ".concat(n,' format: "').concat(r.keyFormat,'" method: ').concat(r.method," uri: ").concat(r.uri,")");this.log("Starting session for key ".concat(i));var a=this.keyIdToKeySessionPromise[n];return a||(a=this.keyIdToKeySessionPromise[n]=this.getKeySystemForKeyPromise(r).then((function(n){var a=n.keySystem,s=n.mediaKeys;return t.throwIfDestroyed(),t.log("Handle encrypted media sn: ".concat(e.frag.sn," ").concat(e.frag.type,": ").concat(e.frag.level," using key ").concat(i)),t.attemptSetMediaKeys(a,s).then((function(){t.throwIfDestroyed();var e=t.createMediaKeySessionContext({keySystem:a,mediaKeys:s,decryptdata:r});return t.generateRequestWithPreferredKeySession(e,"cenc",r.pssh,"playlist-key")}))}))).catch((function(e){return t.handleError(e)})),a}},{key:"throwIfDestroyed",value:function(){if(!this.hls)throw new Error("invalid state")}},{key:"handleError",value:function(e){this.hls&&(this.error(e.message),e instanceof ka?this.hls.trigger(M.ERROR,e.data):this.hls.trigger(M.ERROR,{type:O.KEY_SYSTEM_ERROR,details:N.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0}))}},{key:"getKeySystemForKeyPromise",value:function(e){var t=this.getKeyIdString(e),r=this.keyIdToKeySessionPromise[t];if(!r){var n=ue(e.keyFormat),i=n?[n]:fe(this.config);return this.attemptKeySystemAccess(i)}return r}},{key:"getKeySystemSelectionPromise",value:function(e){if(e.length||(e=fe(this.config)),0===e.length)throw new ka({type:O.KEY_SYSTEM_ERROR,details:N.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},"Missing key-system license configuration options ".concat(JSON.stringify({drmSystems:this.config.drmSystems})));return this.attemptKeySystemAccess(e)}},{key:"_onMediaEncrypted",value:function(e){var t=this,r=e.initDataType,n=e.initData;if(this.debug('"'.concat(e.type,'" event: init data type: "').concat(r,'"')),null!==n){var i,a;if("sinf"===r&&this.config.drmSystems[ie.FAIRPLAY]){var s=Oe(new Uint8Array(n));try{var o=re(JSON.parse(s).sinf),l=Ke(new Uint8Array(o));if(!l)return;i=l.subarray(8,24),a=ie.FAIRPLAY}catch(e){return void this.warn('Failed to parse sinf "encrypted" event message initData')}}else{var u=function(e){if(!(e instanceof ArrayBuffer)||e.byteLength<32)return null;var t={version:0,systemId:"",kids:null,data:null},r=new DataView(e),n=r.getUint32(0);if(e.byteLength!==n&&n>44)return null;if(1886614376!==r.getUint32(4))return null;if(t.version=r.getUint32(8)>>>24,t.version>1)return null;t.systemId=De(new Uint8Array(e,12,16));var i=r.getUint32(28);if(0===t.version){if(n-32<i)return null;t.data=new Uint8Array(e,32,i)}else if(1===t.version){t.kids=[];for(var a=0;a<i;a++)t.kids.push(new Uint8Array(e,32+16*a,16))}return t}(n);if(null===u)return;0===u.version&&u.systemId===ce&&u.data&&(i=u.data.subarray(8,24)),a=function(e){if(e===ce)return ie.WIDEVINE}(u.systemId)}if(a&&i){for(var c=De(i),d=this.keyIdToKeySessionPromise,f=this.mediaKeySessions,h=d[c],v=function(){var e=f[g],a=e.decryptdata;if(a.pssh||!a.keyId)return"continue";var s=De(a.keyId);return c===s||-1!==a.uri.replace(/-/g,"").indexOf(c)?(h=d[s],delete d[s],a.pssh=new Uint8Array(n),a.keyId=i,h=d[c]=h.then((function(){return t.generateRequestWithPreferredKeySession(e,r,n,"encrypted-event-key-match")})),"break"):void 0},g=0;g<f.length;g++){var p=v();if("continue"!==p&&"break"===p)break}h||(h=d[c]=this.getKeySystemSelectionPromise([a]).then((function(e){var a,s=e.keySystem,o=e.mediaKeys;t.throwIfDestroyed();var l=new Qe("ISO-23001-7",c,null!=(a=de(s))?a:"");return l.pssh=new Uint8Array(n),l.keyId=i,t.attemptSetMediaKeys(s,o).then((function(){t.throwIfDestroyed();var e=t.createMediaKeySessionContext({decryptdata:l,keySystem:s,mediaKeys:o});return t.generateRequestWithPreferredKeySession(e,r,n,"encrypted-event-no-match")}))}))),h.catch((function(e){return t.handleError(e)}))}}}},{key:"_onWaitingForKey",value:function(e){this.log('"'.concat(e.type,'" event'))}},{key:"attemptSetMediaKeys",value:function(e,t){var r=this,n=this.setMediaKeysQueue.slice();this.log('Setting media-keys for "'.concat(e,'"'));var i=Promise.all(n).then((function(){if(!r.media)throw new Error("Attempted to set mediaKeys without media element attached");return r.media.setMediaKeys(t)}));return this.setMediaKeysQueue.push(i),i.then((function(){r.log('Media-keys set for "'.concat(e,'"')),n.push(i),r.setMediaKeysQueue=r.setMediaKeysQueue.filter((function(e){return-1===n.indexOf(e)}))}))}},{key:"generateRequestWithPreferredKeySession",value:function(e,t,r,n){var i,a,s=this,o=null==(i=this.config.drmSystems)||null==(a=i[e.keySystem])?void 0:a.generateRequest;if(o)try{var l=o.call(this.hls,t,r,e);if(!l)throw new Error("Invalid response from configured generateRequest filter");t=l.initDataType,r=e.decryptdata.pssh=l.initData?new Uint8Array(l.initData):null}catch(e){var u;if(this.warn(e.message),null!=(u=this.hls)&&u.config.debug)throw e}if(null===r)return this.log('Skipping key-session request for "'.concat(n,'" (no initData)')),Promise.resolve(e);var c=this.getKeyIdString(e.decryptdata);this.log('Generating key-session request for "'.concat(n,'": ').concat(c," (init data type: ").concat(t," length: ").concat(r?r.byteLength:null,")"));var d=new ri;e.mediaKeysSession.onmessage=function(t){var r=e.mediaKeysSession;if(r){var n=t.messageType,i=t.message;s.log('"'.concat(n,'" message event for session "').concat(r.sessionId,'" message size: ').concat(i.byteLength)),"license-request"===n||"license-renewal"===n?s.renewLicense(e,i).catch((function(e){s.handleError(e),d.emit("error",e)})):"license-release"===n?e.keySystem===ie.FAIRPLAY&&(s.updateKeySession(e,ne("acknowledged")),s.removeSession(e)):s.warn('unhandled media key message type "'.concat(n,'"'))}else d.emit("error",new Error("invalid state"))},e.mediaKeysSession.onkeystatuseschange=function(t){if(e.mediaKeysSession){s.onKeyStatusChange(e);var r=e.keyStatus;d.emit("keyStatus",r),"expired"===r&&(s.warn("".concat(e.keySystem," expired for key ").concat(c)),s.renewKeySession(e))}else d.emit("error",new Error("invalid state"))};var f=new Promise((function(e,t){d.on("error",t),d.on("keyStatus",(function(r){r.startsWith("usable")?e():"output-restricted"===r?t(new ka({type:O.KEY_SYSTEM_ERROR,details:N.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):"internal-error"===r?t(new ka({type:O.KEY_SYSTEM_ERROR,details:N.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},'key status changed to "'.concat(r,'"'))):"expired"===r?t(new Error("key expired while generating request")):s.warn('unhandled key status change "'.concat(r,'"'))}))}));return e.mediaKeysSession.generateRequest(t,r).then((function(){var t;s.log('Request generated for key-session "'.concat(null==(t=e.mediaKeysSession)?void 0:t.sessionId,'" keyId: ').concat(c))})).catch((function(e){throw new ka({type:O.KEY_SYSTEM_ERROR,details:N.KEY_SYSTEM_NO_SESSION,error:e,fatal:!1},"Error generating key-session request: ".concat(e))})).then((function(){return f})).catch((function(t){throw d.removeAllListeners(),s.removeSession(e),t})).then((function(){return d.removeAllListeners(),e}))}},{key:"onKeyStatusChange",value:function(e){var t=this;e.mediaKeysSession.keyStatuses.forEach((function(r,n){t.log('key status change "'.concat(r,'" for keyStatuses keyId: ').concat(De("buffer"in n?new Uint8Array(n.buffer,n.byteOffset,n.byteLength):new Uint8Array(n))," session keyId: ").concat(De(new Uint8Array(e.decryptdata.keyId||[]))," uri: ").concat(e.decryptdata.uri)),e.keyStatus=r}))}},{key:"fetchServerCertificate",value:function(e){var t=this.config,r=new(0,t.loader)(t),n=this.getServerCertificateUrl(e);return n?(this.log('Fetching serverCertificate for "'.concat(e,'"')),new Promise((function(i,a){var s={responseType:"arraybuffer",url:n},o=t.certLoadPolicy.default,l={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},u={onSuccess:function(e,t,r,n){i(e.data)},onError:function(t,r,i,o){a(new ka({type:O.KEY_SYSTEM_ERROR,details:N.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:i,response:I({url:s.url,data:void 0},t)},'"'.concat(e,'" certificate request failed (').concat(n,"). Status: ").concat(t.code," (").concat(t.text,")")))},onTimeout:function(t,r,i){a(new ka({type:O.KEY_SYSTEM_ERROR,details:N.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:i,response:{url:s.url,data:void 0}},'"'.concat(e,'" certificate request timed out (').concat(n,")")))},onAbort:function(e,t,r){a(new Error("aborted"))}};r.load(s,l,u)}))):Promise.resolve()}},{key:"setMediaKeysServerCertificate",value:function(e,t,r){var n=this;return new Promise((function(i,a){e.setServerCertificate(r).then((function(a){n.log("setServerCertificate ".concat(a?"success":"not supported by CDM"," (").concat(null==r?void 0:r.byteLength,') on "').concat(t,'"')),i(e)})).catch((function(e){a(new ka({type:O.KEY_SYSTEM_ERROR,details:N.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:e,fatal:!0},e.message))}))}))}},{key:"renewLicense",value:function(e,t){var r=this;return this.requestLicense(e,new Uint8Array(t)).then((function(t){return r.updateKeySession(e,new Uint8Array(t)).catch((function(e){throw new ka({type:O.KEY_SYSTEM_ERROR,details:N.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:e,fatal:!0},e.message)}))}))}},{key:"setupLicenseXHR",value:function(e,t,r,n){var i=this,a=this.config.licenseXhrSetup;return a?Promise.resolve().then((function(){if(!r.decryptdata)throw new Error("Key removed");return a.call(i.hls,e,t,r,n)})).catch((function(s){if(!r.decryptdata)throw s;return e.open("POST",t,!0),a.call(i.hls,e,t,r,n)})).then((function(r){return e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:r||n}})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:n}))}},{key:"requestLicense",value:function(e,t){var r=this,n=this.config.keyLoadPolicy.default;return new Promise((function(i,a){var s=r.getLicenseServerUrl(e.keySystem);r.log("Sending license request to URL: ".concat(s));var o=new XMLHttpRequest;o.responseType="arraybuffer",o.onreadystatechange=function(){if(!r.hls||!e.mediaKeysSession)return a(new Error("invalid state"));if(4===o.readyState)if(200===o.status){r._requestLicenseFailureCount=0;var l=o.response;r.log("License received ".concat(l instanceof ArrayBuffer?l.byteLength:l));var u=r.config.licenseResponseCallback;if(u)try{l=u.call(r.hls,o,s,e)}catch(e){r.error(e)}i(l)}else{var c=n.errorRetry,d=c?c.maxNumRetry:0;if(r._requestLicenseFailureCount++,r._requestLicenseFailureCount>d||o.status>=400&&o.status<500)a(new ka({type:O.KEY_SYSTEM_ERROR,details:N.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:o,response:{url:s,data:void 0,code:o.status,text:o.statusText}},"License Request XHR failed (".concat(s,"). Status: ").concat(o.status," (").concat(o.statusText,")")));else{var f=d-r._requestLicenseFailureCount+1;r.warn("Retrying license request, ".concat(f," attempts left")),r.requestLicense(e,t).then(i,a)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=o,r.setupLicenseXHR(o,s,e,t).then((function(e){var t=e.xhr,r=e.licenseChallenge;t.send(r)}))}))}},{key:"onMediaAttached",value:function(e,t){if(this.config.emeEnabled){var r=t.media;this.media=r,r.addEventListener("encrypted",this.onMediaEncrypted),r.addEventListener("waitingforkey",this.onWaitingForKey)}}},{key:"onMediaDetached",value:function(){var t=this,r=this.media,n=this.mediaKeySessions;r&&(r.removeEventListener("encrypted",this.onMediaEncrypted),r.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null),this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},Qe.clearKeyUriToKeyIdMap();var i=n.length;e.CDMCleanupPromise=Promise.all(n.map((function(e){return t.removeSession(e)})).concat(null==r?void 0:r.setMediaKeys(null).catch((function(e){t.log("Could not clear media keys: ".concat(e,". media.src: ").concat(null==r?void 0:r.src))})))).then((function(){i&&(t.log("finished closing key sessions and clearing media keys"),n.length=0)})).catch((function(e){t.log("Could not close sessions and clear media keys: ".concat(e,". media.src: ").concat(null==r?void 0:r.src))}))}},{key:"onManifestLoading",value:function(){this.keyFormatPromise=null}},{key:"onManifestLoaded",value:function(e,t){var r=t.sessionKeys;if(r&&this.config.emeEnabled&&!this.keyFormatPromise){var n=r.reduce((function(e,t){return-1===e.indexOf(t.keyFormat)&&e.push(t.keyFormat),e}),[]);this.log("Selecting key-system from session-keys ".concat(n.join(", "))),this.keyFormatPromise=this.getKeyFormatPromise(n)}}},{key:"removeSession",value:function(e){var t=this,r=e.mediaKeysSession,n=e.licenseXhr;if(r){this.log("Remove licenses and keys and close session ".concat(r.sessionId)),r.onmessage=null,r.onkeystatuseschange=null,n&&n.readyState!==XMLHttpRequest.DONE&&n.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;var i=this.mediaKeySessions.indexOf(e);return i>-1&&this.mediaKeySessions.splice(i,1),r.remove().catch((function(e){t.log("Could not remove session: ".concat(e))})).then((function(){return r.close()})).catch((function(e){t.log("Could not close session: ".concat(e))}))}}}]),e}();ba.CDMCleanupPromise=void 0;var ka=function(e){(0,d.Z)(r,e);var t=k(r);function r(e,n){var i;return(0,g.Z)(this,r),(i=t.call(this,n)).data=void 0,e.error||(e.error=new Error(n)),i.data=e,e.err=e.error,i}return(0,p.Z)(r)}((0,u.Z)(Error)),Ea="a",Ta="v",_a="av",wa=function(){function e(t){var r=this;(0,g.Z)(this,e),this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=function(){r.initialized&&(r.starved=!0),r.buffering=!0},this.onPlaying=function(){r.initialized||(r.initialized=!0),r.buffering=!1},this.applyPlaylistData=function(e){try{r.apply(e,{ot:"m",su:!r.initialized})}catch(e){G.warn("Could not generate manifest CMCD data.",e)}},this.applyFragmentData=function(e){try{var t=e.frag,n=r.hls.levels[t.level],i=r.getObjectType(t),a={d:1e3*t.duration,ot:i};i!==Ta&&i!==Ea&&i!=_a||(a.br=n.bitrate/1e3,a.tb=r.getTopBandwidth(i)/1e3,a.bl=r.getBufferLength(i)),r.apply(e,a)}catch(e){G.warn("Could not generate segment CMCD data.",e)}},this.hls=t;var n=this.config=t.config,i=n.cmcd;null!=i&&(n.pLoader=this.createPlaylistLoader(),n.fLoader=this.createFragmentLoader(),this.sid=i.sessionId||e.uuid(),this.cid=i.contentId,this.useHeaders=!0===i.useHeaders,this.registerListeners())}return(0,p.Z)(e,[{key:"registerListeners",value:function(){var e=this.hls;e.on(M.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(M.MEDIA_DETACHED,this.onMediaDetached,this),e.on(M.BUFFER_CREATED,this.onBufferCreated,this)}},{key:"unregisterListeners",value:function(){var e=this.hls;e.off(M.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(M.MEDIA_DETACHED,this.onMediaDetached,this),e.off(M.BUFFER_CREATED,this.onBufferCreated,this)}},{key:"destroy",value:function(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null}},{key:"onMediaAttached",value:function(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}},{key:"onMediaDetached",value:function(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}},{key:"onBufferCreated",value:function(e,t){var r,n;this.audioBuffer=null==(r=t.tracks.audio)?void 0:r.buffer,this.videoBuffer=null==(n=t.tracks.video)?void 0:n.buffer}},{key:"createData",value:function(){var e;return{v:1,sf:"h",sid:this.sid,cid:this.cid,pr:null==(e=this.media)?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}},{key:"apply",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};C(r,this.createData());var n="i"===r.ot||r.ot===Ta||r.ot===_a;if(this.starved&&n&&(r.bs=!0,r.su=!0,this.starved=!1),null==r.su&&(r.su=this.buffering),this.useHeaders){var i=e.toHeaders(r);if(!Object.keys(i).length)return;t.headers||(t.headers={}),C(t.headers,i)}else{var a=e.toQuery(r);if(!a)return;t.url=e.appendQueryToUri(t.url,a)}}},{key:"getObjectType",value:function(e){var t=e.type;return"subtitle"===t?"tt":"initSegment"===e.sn?"i":"audio"===t?Ea:"main"===t?this.hls.audioTracks.length?Ta:_a:void 0}},{key:"getTopBandwidth",value:function(e){var t,r=0,n=this.hls;if(e===Ea)t=n.audioTracks;else{var i=n.maxAutoLevel,a=i>-1?i+1:n.levels.length;t=n.levels.slice(0,a)}var s,o=y(t);try{for(o.s();!(s=o.n()).done;){var l=s.value;l.bitrate>r&&(r=l.bitrate)}}catch(e){o.e(e)}finally{o.f()}return r>0?r:NaN}},{key:"getBufferLength",value:function(e){var t=this.hls.media,r=e===Ea?this.audioBuffer:this.videoBuffer;return r&&t?1e3*Rr.bufferInfo(r,t.currentTime,this.config.maxBufferHole).len:NaN}},{key:"createPlaylistLoader",value:function(){var e=this.config.pLoader,t=this.applyPlaylistData,r=e||this.config.loader;return function(){function e(t){(0,g.Z)(this,e),this.loader=void 0,this.loader=new r(t)}return(0,p.Z)(e,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}},{key:"destroy",value:function(){this.loader.destroy()}},{key:"abort",value:function(){this.loader.abort()}},{key:"load",value:function(e,r,n){t(e),this.loader.load(e,r,n)}}]),e}()}},{key:"createFragmentLoader",value:function(){var e=this.config.fLoader,t=this.applyFragmentData,r=e||this.config.loader;return function(){function e(t){(0,g.Z)(this,e),this.loader=void 0,this.loader=new r(t)}return(0,p.Z)(e,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}},{key:"destroy",value:function(){this.loader.destroy()}},{key:"abort",value:function(){this.loader.abort()}},{key:"load",value:function(e,r,n){t(e),this.loader.load(e,r,n)}}]),e}()}}],[{key:"uuid",value:function(){var e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}},{key:"serialize",value:function(e){var t,r=[],n=function(e){return!Number.isNaN(e)&&null!=e&&""!==e&&!1!==e},i=function(e){return Math.round(e)},a=function(e){return 100*i(e/100)},s={br:i,d:i,bl:a,dl:a,mtp:a,nor:function(e){return encodeURIComponent(e)},rtp:a,tb:i},o=y(Object.keys(e||{}).sort());try{for(o.s();!(t=o.n()).done;){var l=t.value,u=e[l];if(n(u)&&!("v"===l&&1===u||"pr"==l&&1===u)){var c=s[l];c&&(u=c(u));var d,f=(0,m.Z)(u);d="ot"===l||"sf"===l||"st"===l?"".concat(l,"=").concat(u):"boolean"===f?l:"number"===f?"".concat(l,"=").concat(u):"".concat(l,"=").concat(JSON.stringify(u)),r.push(d)}}}catch(e){o.e(e)}finally{o.f()}return r.join(",")}},{key:"toHeaders",value:function(t){for(var r={},n=["Object","Request","Session","Status"],i=[{},{},{},{}],a={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3},s=0,o=Object.keys(t);s<o.length;s++){var l=o[s];i[null!=a[l]?a[l]:1][l]=t[l]}for(var u=0;u<i.length;u++){var c=e.serialize(i[u]);c&&(r["CMCD-".concat(n[u])]=c)}return r}},{key:"toQuery",value:function(t){return"CMCD=".concat(encodeURIComponent(e.serialize(t)))}},{key:"appendQueryToUri",value:function(e,t){if(!t)return e;var r=e.includes("?")?"&":"?";return"".concat(e).concat(r).concat(t)}}]),e}(),Sa=function(){function e(t){(0,g.Z)(this,e),this.hls=void 0,this.log=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this.pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=t,this.log=G.log.bind(G,"[content-steering]:"),this.registerListeners()}return(0,p.Z)(e,[{key:"registerListeners",value:function(){var e=this.hls;e.on(M.MANIFEST_LOADING,this.onManifestLoading,this),e.on(M.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(M.MANIFEST_PARSED,this.onManifestParsed,this),e.on(M.ERROR,this.onError,this)}},{key:"unregisterListeners",value:function(){var e=this.hls;e&&(e.off(M.MANIFEST_LOADING,this.onManifestLoading,this),e.off(M.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(M.MANIFEST_PARSED,this.onManifestParsed,this),e.off(M.ERROR,this.onError,this))}},{key:"startLoad",value:function(){if(this.started=!0,self.clearTimeout(this.reloadTimer),this.enabled&&this.uri)if(this.updated){var e=Math.max(1e3*this.timeToLoad-(performance.now()-this.updated),0);this.scheduleRefresh(this.uri,e)}else this.loadSteeringManifest(this.uri)}},{key:"stopLoad",value:function(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),self.clearTimeout(this.reloadTimer)}},{key:"destroy",value:function(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}},{key:"removeLevel",value:function(e){var t=this.levels;t&&(this.levels=t.filter((function(t){return t!==e})))}},{key:"onManifestLoading",value:function(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}},{key:"onManifestLoaded",value:function(e,t){var r=t.contentSteering;null!==r&&(this.pathwayId=r.pathwayId,this.uri=r.uri,this.started&&this.startLoad())}},{key:"onManifestParsed",value:function(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}},{key:"onError",value:function(e,t){var r=t.errorAction;if(2===(null==r?void 0:r.action)&&1===r.flags){var n=this.pathwayPriority,i=this.pathwayId;this.penalizedPathways[i]||(this.penalizedPathways[i]=performance.now()),!n&&this.levels&&(n=this.levels.reduce((function(e,t){return-1===e.indexOf(t.pathwayId)&&e.push(t.pathwayId),e}),[])),n&&n.length>1&&(this.updatePathwayPriority(n),r.resolved=this.pathwayId!==i)}}},{key:"filterParsedLevels",value:function(e){this.levels=e;var t=this.getLevelsForPathway(this.pathwayId);if(0===t.length){var r=e[0].pathwayId;this.log("No levels found in Pathway ".concat(this.pathwayId,'. Setting initial Pathway to "').concat(r,'"')),t=this.getLevelsForPathway(r),this.pathwayId=r}return t.length!==e.length?(this.log("Found ".concat(t.length,"/").concat(e.length,' levels in Pathway "').concat(this.pathwayId,'"')),t):e}},{key:"getLevelsForPathway",value:function(e){return null===this.levels?[]:this.levels.filter((function(t){return e===t.pathwayId}))}},{key:"updatePathwayPriority",value:function(e){var t;this.pathwayPriority=e;var r=this.penalizedPathways,n=performance.now();Object.keys(r).forEach((function(e){n-r[e]>3e5&&delete r[e]}));for(var i=0;i<e.length;i++){var a=e[i];if(!r[a]){if(a===this.pathwayId)return;var s=this.hls.nextLoadLevel,o=this.hls.levels[s];if((t=this.getLevelsForPathway(a)).length>0){this.log('Setting Pathway to "'.concat(a,'"')),this.pathwayId=a,this.hls.trigger(M.LEVELS_UPDATED,{levels:t});var l=this.hls.levels[s];o&&l&&this.levels&&(l.attrs["STABLE-VARIANT-ID"]!==o.attrs["STABLE-VARIANT-ID"]&&l.bitrate!==o.bitrate&&this.log("Unstable Pathways change from bitrate ".concat(o.bitrate," to ").concat(l.bitrate)),this.hls.nextLoadLevel=s);break}}}}},{key:"clonePathways",value:function(e){var t=this,r=this.levels;if(r){var n={},i={};e.forEach((function(e){var a=e.ID,s=e["BASE-ID"],l=e["URI-REPLACEMENT"];if(!r.some((function(e){return e.pathwayId===a}))){var u=t.getLevelsForPathway(s).map((function(e){var t=C({},e);t.details=void 0,t.url=Ra(e.uri,e.attrs["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",l);var r=new z(e.attrs);r["PATHWAY-ID"]=a;var s=r.AUDIO&&"".concat(r.AUDIO,"_clone_").concat(a),o=r.SUBTITLES&&"".concat(r.SUBTITLES,"_clone_").concat(a);s&&(n[r.AUDIO]=s,r.AUDIO=s),o&&(i[r.SUBTITLES]=o,r.SUBTITLES=o),t.attrs=r;var u=new Ht(t);return cr(u,"audio",s),cr(u,"text",o),u}));r.push.apply(r,(0,o.Z)(u)),La(t.audioTracks,n,l,a),La(t.subtitleTracks,i,l,a)}}))}}},{key:"loadSteeringManifest",value:function(e){var t,r=this,n=this.hls.config,i=n.loader;this.loader&&this.loader.destroy(),this.loader=new i(n);try{t=new self.URL(e)}catch(t){return this.enabled=!1,void this.log("Failed to parse Steering Manifest URI: ".concat(e))}if("data:"!==t.protocol){var a=0|(this.hls.bandwidthEstimate||n.abrEwmaDefaultEstimate);t.searchParams.set("_HLS_pathway",this.pathwayId),t.searchParams.set("_HLS_throughput",""+a)}var s={responseType:"json",url:t.href},o=n.steeringManifestLoadPolicy.default,l=o.errorRetry||o.timeoutRetry||{},u={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:l.maxNumRetry||0,retryDelay:l.retryDelayMs||0,maxRetryDelay:l.maxRetryDelayMs||0},c={onSuccess:function(e,n,i,a){r.log('Loaded steering manifest: "'.concat(t,'"'));var s=e.data;if(1===s.VERSION){r.updated=performance.now(),r.timeToLoad=s.TTL;var o=s["RELOAD-URI"],l=s["PATHWAY-CLONES"],u=s["PATHWAY-PRIORITY"];if(o)try{r.uri=new self.URL(o,t).href}catch(e){return r.enabled=!1,void r.log("Failed to parse Steering Manifest RELOAD-URI: ".concat(o))}r.scheduleRefresh(r.uri||i.url),l&&r.clonePathways(l),u&&r.updatePathwayPriority(u)}else r.log("Steering VERSION ".concat(s.VERSION," not supported!"))},onError:function(e,t,n,i){if(r.log("Error loading steering manifest: ".concat(e.code," ").concat(e.text," (").concat(t.url,")")),r.stopLoad(),410===e.code)return r.enabled=!1,void r.log("Steering manifest ".concat(t.url," no longer available"));var a=1e3*r.timeToLoad;if(429!==e.code)r.scheduleRefresh(r.uri||t.url,a);else{var s=r.loader;if("function"==typeof(null==s?void 0:s.getResponseHeader)){var o=s.getResponseHeader("Retry-After");o&&(a=1e3*parseFloat(o))}r.log("Steering manifest ".concat(t.url," rate limited"))}},onTimeout:function(e,t,n){r.log("Timeout loading steering manifest (".concat(t.url,")")),r.scheduleRefresh(r.uri||t.url)}};this.log("Requesting steering manifest: ".concat(t)),this.loader.load(s,u,c)}},{key:"scheduleRefresh",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3*this.timeToLoad;self.clearTimeout(this.reloadTimer),this.reloadTimer=self.setTimeout((function(){t.loadSteeringManifest(e)}),r)}}]),e}();function La(e,t,r,n){e&&Object.keys(t).forEach((function(i){var a=e.filter((function(e){return e.groupId===i})).map((function(e){var a=C({},e);return a.details=void 0,a.attrs=new z(a.attrs),a.url=a.attrs.URI=Ra(e.url,e.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",r),a.groupId=a.attrs["GROUP-ID"]=t[i],a.attrs["PATHWAY-ID"]=n,a}));e.push.apply(e,(0,o.Z)(a))}))}function Ra(e,t,r,n){var i,a=n.HOST,s=n.PARAMS,o=n[r];t&&(i=null==o?void 0:o[t])&&(e=i);var l=new self.URL(e);return a&&!i&&(l.host=a),s&&Object.keys(s).sort().forEach((function(e){e&&l.searchParams.set(e,s[e])})),l.href}var Aa=/^age:\s*[\d.]+\s*$/im,xa=function(){function e(t){(0,g.Z)(this,e),this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=t&&t.xhrSetup||null,this.stats=new W,this.retryDelay=0}return(0,p.Z)(e,[{key:"destroy",value:function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null}},{key:"abortInternal",value:function(){var e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,4!==e.readyState&&(this.stats.aborted=!0,e.abort()))}},{key:"abort",value:function(){var e;this.abortInternal(),null!=(e=this.callbacks)&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}},{key:"load",value:function(e,t,r){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=r,this.loadInternal()}},{key:"loadInternal",value:function(){var e=this,t=this.config,r=this.context;if(t){var n=this.loader=new self.XMLHttpRequest,i=this.stats;i.loading.first=0,i.loaded=0,i.aborted=!1;var a=this.xhrSetup;a?Promise.resolve().then((function(){if(!e.stats.aborted)return a(n,r.url)})).catch((function(e){return n.open("GET",r.url,!0),a(n,r.url)})).then((function(){e.stats.aborted||e.openAndSendXhr(n,r,t)})).catch((function(t){e.callbacks.onError({code:n.status,text:t.message},r,n,i)})):this.openAndSendXhr(n,r,t)}}},{key:"openAndSendXhr",value:function(e,t,r){e.readyState||e.open("GET",t.url,!0);var n=this.context.headers,i=r.loadPolicy,a=i.maxTimeToFirstByteMs,s=i.maxLoadTimeMs;if(n)for(var o in n)e.setRequestHeader(o,n[o]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),r.timeout=a&&P(a)?a:s,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),r.timeout),e.send()}},{key:"readystatechange",value:function(){var e=this.context,t=this.loader,r=this.stats;if(e&&t){var n=t.readyState,i=this.config;if(!r.aborted&&n>=2&&(0===r.loading.first&&(r.loading.first=Math.max(self.performance.now(),r.loading.start),i.timeout!==i.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),i.timeout=i.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),i.loadPolicy.maxLoadTimeMs-(r.loading.first-r.loading.start)))),4===n)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;var a=t.status,s="text"!==t.responseType;if(a>=200&&a<300&&(s&&t.response||null!==t.responseText)){r.loading.end=Math.max(self.performance.now(),r.loading.first);var o=s?t.response:t.responseText,l="arraybuffer"===t.responseType?o.byteLength:o.length;if(r.loaded=r.total=l,r.bwEstimate=8e3*r.total/(r.loading.end-r.loading.first),!this.callbacks)return;var u=this.callbacks.onProgress;if(u&&u(r,e,o,t),!this.callbacks)return;var c={url:t.responseURL,data:o,code:a};this.callbacks.onSuccess(c,r,e,t)}else{var d=i.loadPolicy.errorRetry;tr(d,r.retry,!1,a)?this.retry(d):(G.error("".concat(a," while loading ").concat(e.url)),this.callbacks.onError({code:a,text:t.statusText},e,t,r))}}}}},{key:"loadtimeout",value:function(){var e,t=null==(e=this.config)?void 0:e.loadPolicy.timeoutRetry;if(tr(t,this.stats.retry,!0))this.retry(t);else{G.warn("timeout while loading ".concat(this.context.url));var r=this.callbacks;r&&(this.abortInternal(),r.onTimeout(this.stats,this.context,this.loader))}}},{key:"retry",value:function(e){var t=this.context,r=this.stats;this.retryDelay=Jt(e,r.retry),r.retry++,G.warn("".concat(status?"HTTP Status "+status:"Timeout"," while loading ").concat(t.url,", retrying ").concat(r.retry,"/").concat(e.maxNumRetry," in ").concat(this.retryDelay,"ms")),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}},{key:"loadprogress",value:function(e){var t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}},{key:"getCacheAge",value:function(){var e=null;if(this.loader&&Aa.test(this.loader.getAllResponseHeaders())){var t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}},{key:"getResponseHeader",value:function(e){return this.loader&&new RegExp("^".concat(e,":\\s*[\\d.]+\\s*$"),"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}]),e}(),Ia=/(\d+)-(\d+)\/(\d+)/,Da=function(){function e(t){(0,g.Z)(this,e),this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=t.fetchSetup||Ca,this.controller=new self.AbortController,this.stats=new W}return(0,p.Z)(e,[{key:"destroy",value:function(){this.loader=this.callbacks=null,this.abortInternal()}},{key:"abortInternal",value:function(){var e=this.response;null!=e&&e.ok||(this.stats.aborted=!0,this.controller.abort())}},{key:"abort",value:function(){var e;this.abortInternal(),null!=(e=this.callbacks)&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}},{key:"load",value:function(e,t,r){var n=this,i=this.stats;if(i.loading.start)throw new Error("Loader can only be used once.");i.loading.start=self.performance.now();var a=function(e,t){var r={method:"GET",mode:"cors",credentials:"same-origin",signal:t,headers:new self.Headers(C({},e.headers))};return e.rangeEnd&&r.headers.set("Range","bytes="+e.rangeStart+"-"+String(e.rangeEnd-1)),r}(e,this.controller.signal),s=r.onProgress,o="arraybuffer"===e.responseType,l=o?"byteLength":"length",u=t.loadPolicy,c=u.maxTimeToFirstByteMs,d=u.maxLoadTimeMs;this.context=e,this.config=t,this.callbacks=r,this.request=this.fetchSetup(e,a),self.clearTimeout(this.requestTimeout),t.timeout=c&&P(c)?c:d,this.requestTimeout=self.setTimeout((function(){n.abortInternal(),r.onTimeout(i,e,n.response)}),t.timeout),self.fetch(this.request).then((function(a){n.response=n.loader=a;var l=Math.max(self.performance.now(),i.loading.start);if(self.clearTimeout(n.requestTimeout),t.timeout=d,n.requestTimeout=self.setTimeout((function(){n.abortInternal(),r.onTimeout(i,e,n.response)}),d-(l-i.loading.start)),!a.ok){var u=a.status,c=a.statusText;throw new Pa(c||"fetch, bad network response",u,a)}return i.loading.first=l,i.total=function(e){var t=e.get("Content-Range");if(t){var r=function(e){var t=Ia.exec(e);if(t)return parseInt(t[2])-parseInt(t[1])+1}(t);if(P(r))return r}var n=e.get("Content-Length");if(n)return parseInt(n)}(a.headers)||i.total,s&&P(t.highWaterMark)?n.loadProgressively(a,i,e,t.highWaterMark,s):o?a.arrayBuffer():"json"===e.responseType?a.json():a.text()})).then((function(a){var o=n.response;self.clearTimeout(n.requestTimeout),i.loading.end=Math.max(self.performance.now(),i.loading.first);var u=a[l];u&&(i.loaded=i.total=u);var c={url:o.url,data:a,code:o.status};s&&!P(t.highWaterMark)&&s(i,e,a,o),r.onSuccess(c,i,e,o)})).catch((function(t){if(self.clearTimeout(n.requestTimeout),!i.aborted){var a=t&&t.code||0,s=t?t.message:null;r.onError({code:a,text:s},e,t?t.details:null,i)}}))}},{key:"getCacheAge",value:function(){var e=null;if(this.response){var t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}},{key:"getResponseHeader",value:function(e){return this.response?this.response.headers.get(e):null}},{key:"loadProgressively",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4?arguments[4]:void 0,a=new ci,s=e.body.getReader(),o=function o(){return s.read().then((function(s){if(s.done)return a.dataLength&&i(t,r,a.flush(),e),Promise.resolve(new ArrayBuffer(0));var l=s.value,u=l.length;return t.loaded+=u,u<n||a.dataLength?(a.push(l),a.dataLength>=n&&i(t,r,a.flush(),e)):i(t,r,l,e),o()})).catch((function(){return Promise.reject()}))};return o()}}]),e}();function Ca(e,t){return new self.Request(e.url,t)}var Pa=function(e){(0,d.Z)(r,e);var t=k(r);function r(e,n,i){var a;return(0,g.Z)(this,r),(a=t.call(this,e)).code=void 0,a.details=void 0,a.code=n,a.details=i,a}return(0,p.Z)(r)}((0,u.Z)(Error)),Ma=/\s/,Oa=I(I({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:6e7,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:xa,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:ui,bufferController:Ti,capLevelController:pa,errorController:or,fpsController:ma,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:he,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0,certLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null}},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},{cueHandler:{newCue:function(e,t,r,n){for(var i,a,s,o,l,u=[],c=self.VTTCue||self.TextTrackCue,d=0;d<n.rows.length;d++)if(s=!0,o=0,l="",!(i=n.rows[d]).isEmpty()){for(var f,h=0;h<i.chars.length;h++)Ma.test(i.chars[h].uchar)&&s?o++:(l+=i.chars[h].uchar,s=!1);i.cueStartTime=t,t===r&&(r+=1e-4),o>=16?o--:o++;var v=Qi(l.trim()),g=ra(t,r,v);null!=e&&null!=(f=e.cues)&&f.getCueById(g)||((a=new c(t,r,v)).id=g,a.line=d+1,a.align="left",a.position=10+Math.min(80,10*Math.floor(8*o/32)),u.push(a))}return e&&u.length&&(u.sort((function(e,t){return"auto"===e.line||"auto"===t.line?0:e.line>8&&t.line>8?t.line-e.line:e.line-t.line})),u.forEach((function(t){return Ct(e,t)}))),u}},enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:gi,subtitleTrackController:mi,timelineController:va,audioStreamController:di,audioTrackController:fi,emeController:ba,cmcdController:wa,contentSteeringController:Sa});function Na(e,t){if((t.liveSyncDurationCount||t.liveMaxLatencyDurationCount)&&(t.liveSyncDuration||t.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(void 0!==t.liveMaxLatencyDurationCount&&(void 0===t.liveSyncDurationCount||t.liveMaxLatencyDurationCount<=t.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(void 0!==t.liveMaxLatencyDuration&&(void 0===t.liveSyncDuration||t.liveMaxLatencyDuration<=t.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');var r=Fa(e),n=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return["manifest","level","frag"].forEach((function(e){var i="".concat("level"===e?"playlist":e,"LoadPolicy"),a=void 0===t[i],s=[];n.forEach((function(n){var o="".concat(e,"Loading").concat(n),l=t[o];if(void 0!==l&&a){s.push(o);var u=r[i].default;switch(t[i]={default:u},n){case"TimeOut":u.maxLoadTimeMs=l,u.maxTimeToFirstByteMs=l;break;case"MaxRetry":u.errorRetry.maxNumRetry=l,u.timeoutRetry.maxNumRetry=l;break;case"RetryDelay":u.errorRetry.retryDelayMs=l,u.timeoutRetry.retryDelayMs=l;break;case"MaxRetryTimeout":u.errorRetry.maxRetryDelayMs=l,u.timeoutRetry.maxRetryDelayMs=l}}})),s.length&&G.warn('hls.js config: "'.concat(s.join('", "'),'" setting(s) are deprecated, use "').concat(i,'": ').concat(JSON.stringify(t[i])))})),I(I({},r),t)}function Fa(e){return e&&"object"===(0,m.Z)(e)?Array.isArray(e)?e.map(Fa):Object.keys(e).reduce((function(t,r){return t[r]=Fa(e[r]),t}),{}):e}function Za(e){var t=e.loader;t!==Da&&t!==xa?(G.log("[config]: Custom loader detected, cannot enable progressive streaming"),e.progressive=!1):function(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch(e){}return!1}()&&(e.loader=Da,e.progressive=!0,e.enableSoftwareAES=!0,G.log("[config]: Progressive streaming enabled, using FetchLoader"))}var Ua=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,g.Z)(this,e),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new ri,this._autoLevelCapping=void 0,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null,j(t.debug||!1,"Hls instance");var r=this.config=Na(e.DefaultConfig,t);this.userConfig=t,this._autoLevelCapping=-1,r.progressive&&Za(r);var n=r.abrController,i=r.bufferController,a=r.capLevelController,s=r.errorController,o=r.fpsController,l=new s(this),u=this.abrController=new n(this),c=this.bufferController=new i(this),d=this.capLevelController=new a(this),f=new o(this),h=new It(this),v=new Bt(this),p=r.contentSteeringController,m=p?new p(this):null,y=this.levelController=new ur(this,m),b=new pr(this),k=new wr(this.config),E=this.streamController=new si(this,b,k);d.setStreamController(E),f.setStreamController(E);var T=[h,y,E];m&&T.splice(1,0,m),this.networkControllers=T;var _=[u,c,d,f,v,b];this.audioTrackController=this.createController(r.audioTrackController,T);var w=r.audioStreamController;w&&T.push(new w(this,b,k)),this.subtitleTrackController=this.createController(r.subtitleTrackController,T);var S=r.subtitleStreamController;S&&T.push(new S(this,b,k)),this.createController(r.timelineController,_),k.emeController=this.emeController=this.createController(r.emeController,_),this.cmcdController=this.createController(r.cmcdController,_),this.latencyController=this.createController(jt,_),this.coreComponents=_,T.push(l);var L=l.onErrorOut;"function"==typeof L&&this.on(M.ERROR,L,l)}return(0,p.Z)(e,[{key:"createController",value:function(e,t){if(e){var r=new e(this);return t&&t.push(r),r}return null}},{key:"on",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;this._emitter.on(e,t,r)}},{key:"once",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;this._emitter.once(e,t,r)}},{key:"removeAllListeners",value:function(e){this._emitter.removeAllListeners(e)}},{key:"off",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,n=arguments.length>3?arguments[3]:void 0;this._emitter.off(e,t,r,n)}},{key:"listeners",value:function(e){return this._emitter.listeners(e)}},{key:"emit",value:function(e,t,r){return this._emitter.emit(e,t,r)}},{key:"trigger",value:function(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(t){G.error("An internal error happened while handling event "+e+'. Error message: "'+t.message+'". Here is a stacktrace:',t),this.trigger(M.ERROR,{type:O.OTHER_ERROR,details:N.INTERNAL_EXCEPTION,fatal:!1,event:e,error:t})}return!1}},{key:"listenerCount",value:function(e){return this._emitter.listenerCount(e)}},{key:"destroy",value:function(){G.log("destroy"),this.trigger(M.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach((function(e){return e.destroy()})),this.networkControllers.length=0,this.coreComponents.forEach((function(e){return e.destroy()})),this.coreComponents.length=0;var e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}},{key:"attachMedia",value:function(e){G.log("attachMedia"),this._media=e,this.trigger(M.MEDIA_ATTACHING,{media:e})}},{key:"detachMedia",value:function(){G.log("detachMedia"),this.trigger(M.MEDIA_DETACHING,void 0),this._media=null}},{key:"loadSource",value:function(e){this.stopLoad();var t=this.media,r=this.url,n=this.url=A.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});G.log("loadSource:".concat(n)),t&&r&&(r!==n||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(M.MANIFEST_LOADING,{url:e})}},{key:"startLoad",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;G.log("startLoad(".concat(e,")")),this.networkControllers.forEach((function(t){t.startLoad(e)}))}},{key:"stopLoad",value:function(){G.log("stopLoad"),this.networkControllers.forEach((function(e){e.stopLoad()}))}},{key:"swapAudioCodec",value:function(){G.log("swapAudioCodec"),this.streamController.swapAudioCodec()}},{key:"recoverMediaError",value:function(){G.log("recoverMediaError");var e=this._media;this.detachMedia(),e&&this.attachMedia(e)}},{key:"removeLevel",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.levelController.removeLevel(e,t)}},{key:"levels",get:function(){return this.levelController.levels||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(e){G.log("set currentLevel:".concat(e)),this.loadLevel=e,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(e){G.log("set nextLevel:".concat(e)),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(e){G.log("set loadLevel:".concat(e)),this.levelController.manualLevel=e}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(e){this.levelController.nextLoadLevel=e}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(e){G.log("set firstLevel:".concat(e)),this.levelController.firstLevel=e}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(e){G.log("set startLevel:".concat(e)),-1!==e&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(e){var t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(e){this._autoLevelCapping!==e&&(G.log("set autoLevelCapping:".concat(e)),this._autoLevelCapping=e)}},{key:"bandwidthEstimate",get:function(){var e=this.abrController.bwEstimator;return e?e.getEstimate():NaN}},{key:"ttfbEstimate",get:function(){var e=this.abrController.bwEstimator;return e?e.getEstimateTTFB():NaN}},{key:"maxHdcpLevel",get:function(){return this._maxHdcpLevel},set:function(e){Gt.indexOf(e)>-1&&(this._maxHdcpLevel=e)}},{key:"autoLevelEnabled",get:function(){return-1===this.levelController.manualLevel}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var e=this.levels,t=this.config.minAutoBitrate;if(!e)return 0;for(var r=e.length,n=0;n<r;n++)if(e[n].maxBitrate>=t)return n;return 0}},{key:"maxAutoLevel",get:function(){var e,t=this.levels,r=this.autoLevelCapping,n=this.maxHdcpLevel;if(e=-1===r&&t&&t.length?t.length-1:r,n)for(var i=e;i--;){var a=t[i].attrs["HDCP-LEVEL"];if(a&&a<=n)return i}return e}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(e){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,e)}},{key:"playingDate",get:function(){return this.streamController.currentProgramDateTime}},{key:"mainForwardBufferInfo",get:function(){return this.streamController.getMainFwdBufferInfo()}},{key:"audioTracks",get:function(){var e=this.audioTrackController;return e?e.audioTracks:[]}},{key:"audioTrack",get:function(){var e=this.audioTrackController;return e?e.audioTrack:-1},set:function(e){var t=this.audioTrackController;t&&(t.audioTrack=e)}},{key:"subtitleTracks",get:function(){var e=this.subtitleTrackController;return e?e.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var e=this.subtitleTrackController;return e?e.subtitleTrack:-1},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var e=this.subtitleTrackController;return!!e&&e.subtitleDisplay},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(e){this.config.lowLatencyMode=e}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}],[{key:"version",get:function(){return"1.4.12"}},{key:"isSupported",value:function(){return function(){var e=it();if(!e)return!1;var t=Xr(),r=e&&"function"==typeof e.isTypeSupported&&e.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),n=!t||t.prototype&&"function"==typeof t.prototype.appendBuffer&&"function"==typeof t.prototype.remove;return!!r&&!!n}()}},{key:"Events",get:function(){return M}},{key:"ErrorTypes",get:function(){return O}},{key:"ErrorDetails",get:function(){return N}},{key:"DefaultConfig",get:function(){return e.defaultConfig?e.defaultConfig:Oa},set:function(t){e.defaultConfig=t}}]),e}();Ua.defaultConfig=void 0;var Ba=r(1),ja=r(193),Ga=r(1054),Ka=r(724),Ha=r(1579),za=r(1546),Va=r(3),qa=r(1580),Wa=function(e){var t=e.status,o=t.media_attachments[0],l=o.tv.channel_id,u=(0,Ga.B)(),c=u.channelId,d=u.hls,f=u.setDelay,h=u.handleChangeLivePip,v=u.setHls,g=(0,Ka.U)().isPip,p=g&&c===l,m=(0,Ba.useRef)(null),y=(0,Ba.useRef)(null),b=(0,Ba.useRef)(null),k=new URLSearchParams(window.location.search).get("autoplay")===t.id,E=(0,Ba.useState)(!1),T=(0,a.Z)(E,2),_=T[0],w=T[1],S=(0,Ba.useState)(!1),L=(0,a.Z)(S,2),R=L[0],A=L[1],x=(0,Ba.useState)(0),I=(0,a.Z)(x,2),D=I[0],C=I[1],P=(0,Ba.useState)(0),M=(0,a.Z)(P,2),O=M[0],N=M[1],F=new Date(o.tv.start_time),Z=new Date(o.tv.end_time),U=(0,Ba.useMemo)((function(){return Z.getTime()-F.getTime()}),[F,Z]),B=(0,Ba.useMemo)((function(){return U/1e3}),[U]),j=new Date,G=j<new Date(F.getTime()+U),K=(0,Ba.useMemo)((function(){return G?0:Math.floor(Math.abs(j.getTime()-(F.getTime()+1e3*D)))}),[D,R]),H=K>o.tv.pltv_timespan,z=(0,ja.p_)(t.id,l,{enabled:_||p,delay:K}),V=z.data,q=z.fetchStatus,W=z.refetch,Y=z.dataUpdatedAt,X=z.remove,Q="fetching"===q;(0,ja.XJ)(l,{isEnabled:R,delay:K}),(0,Ba.useEffect)((function(){f(K)}),[K]);var $=(0,Ha.gr)(o.meta.original.width/o.meta.original.height);function J(){return(J=(0,i.Z)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(w(!0),R||!(0,za._)(Y)){e.next=4;break}return e.next=4,W();case 4:A(!0);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ee(){w(!0)}function te(){b.current!==(null==V?void 0:V.url)&&(y.current&&y.current.destroy(),y.current=new Ua,null!==m.current&&y.current.attachMedia(m.current),y.current.on(Ua.Events.MEDIA_ATTACHED,(function(){y.current.loadSource(null==V?void 0:V.url),b.current=null==V?void 0:V.url,y.current.on(Ua.Events.MANIFEST_PARSED,(function(){var e,t;p?null===(t=m.current)||void 0===t||t.addEventListener("loadeddata",(function(){null==d||d.destroy(),v(y.current)}),{once:!0}):g||null==m||null===(e=m.current)||void 0===e||e.play().catch((function(){return console.log("Unable to autoplay prior to user interaction with the dom.")}))}))})),y.current.on(Ua.Events.ERROR,(function(e,t){if(t.fatal)switch(t.type){case Ua.ErrorTypes.NETWORK_ERROR:y.current.startLoad();break;case Ua.ErrorTypes.MEDIA_ERROR:y.current.recoverMediaError();break;default:te()}})))}return(0,Ba.useEffect)((function(){D>0&&R&&W().then((function(){N(D),m.current.load()})).catch((function(){}))}),[D,R]),(0,Ba.useEffect)((function(){return function(){X()}}),[]),(0,Ba.useEffect)((function(){return null!=V&&V.url&&Ua.isSupported()&&te(),function(){p||y.current&&(y.current.destroy(),y.current=null)}}),[null==V?void 0:V.url,p]),(0,Ba.useEffect)((function(){k&&y.current&&ee()}),[k,y.current]),H?(0,n.Z)("div",{className:"relative"},void 0,(0,n.Z)("video",{poster:o.preview_url,className:(0,s.Z)("rounded-lg object-cover opacity-0",{"aspect-square":$,"aspect-video":!$})}),(0,n.Z)("div",{className:"absolute inset-0 flex items-center justify-center rounded-lg bg-gray-200 dark:bg-primary-900"},void 0,(0,n.Z)(Va.Kq,{space:3,justifyContent:"center",alignItems:"center"},void 0,(0,n.Z)(Va.xv,{theme:"muted",align:"center"},void 0,"This live stream has ended."),(0,n.Z)(Va.zx,{theme:"transparent",to:"/@".concat(t.account.acct)},void 0,"View Channel Profile")))):V?Ba.createElement(qa.Z,{ref:m,poster:o.preview_url,assets:[{type:"application/x-mpegURL",url:null==V?void 0:V.url}],blurhash:o.blurhash,title:o.tv.name,aspectRatio:o.meta.original.width/o.meta.original.height,onPlay:function(){return J.apply(this,arguments)},onPause:function(e){var t;w(!1),A(!1),C(e),null===(t=y.current)||void 0===t||t.stopLoad()},onScrub:function(e){C(e)},onPip:function(e){m.current&&h(e,y.current,l)},height:285,isLive:!0,isRecorded:!G,duration:B,isLiveLoading:Q,timeToAdd:O,embedded:G,shouldAutoPlayVideo:!0,channelId:l}):(0,n.Z)("div",{className:"relative"},void 0,(0,n.Z)("video",{poster:o.preview_url,className:(0,s.Z)("w-full rounded-lg object-cover",{"aspect-square":$,"aspect-video":!$})}),(0,n.Z)("button",{type:"button",className:"absolute inset-0 z-[2] m-auto flex size-20 items-center justify-center rounded-full bg-gray-900/25 p-4 backdrop-blur-sm transition-all hover:scale-105 hover:bg-gray-900/50",onClick:ee},void 0,(0,n.Z)(Va.JO,{src:r(463),className:"size-12 text-white"})),G&&(0,n.Z)(Va.Ct,{className:"absolute bottom-2 left-2 uppercase"},void 0,"Live"))}},1580:function(e,t,r){"use strict";r.d(t,{Z:function(){return T}});var n=r(1519),i=r(1483),a=r(1474),s=(r(30),r(9),r(0),r(6),r(50),r(66),r(11),r(36),r(12),r(2),r(1520)),o=r(1),l=r(1508),u=r(1509),c=r(1477),d=r(3),f=r(169),h=r(1054),v=r(724),g=r(576),p=r(725),m=r(780),y=r(311),b=r(353),k=(0,l.vU)({channel_guide:{id:"video_player.channel_guide",defaultMessage:"Channel Guide"}}),E=[.25,.5,.75,.9,1,1.1,1.25,1.5,2],T=(0,o.forwardRef)((function(e,t){var l,T,_=(0,c.k6)(),w=(0,u.Z)(),S=(0,f.z$)().track,L=e.aspectRatio,R=void 0===L?16/9:L,A=e.assets,x=e.blurhash,I=e.channelId,D=e.className,C=void 0===D?"":D,P=e.duration,M=e.embedded,O=void 0!==M&&M,N=e.isLive,F=void 0!==N&&N,Z=e.isLiveLoading,U=void 0!==Z&&Z,B=e.isRecorded,j=void 0!==B&&B,G=e.isSensitive,K=void 0!==G&&G,H=e.onPlay,z=e.onPause,V=e.onPip,q=e.onScrub,W=e.poster,Y=e.shouldAutoPlayVideo,X=void 0!==Y&&Y,Q=e.startTime,$=e.timeToAdd,J=void 0===$?0:$,ee=e.title,te=(0,h.B)().channelId,re=(0,v.U)(),ne=re.videoElement,ie=re.isPip,ae=re.handleIsPip,se=re.handleStartPip,oe=(0,o.useRef)(!1),le=(0,o.useRef)(null),ue=(0,o.useMemo)((function(){var e;return!!ie&&(I&&te?I===te:(null===(e=le.current)||void 0===e?void 0:e.currentSrc)===(null==ne?void 0:ne.currentSrc))}),[null===(l=le.current)||void 0===l?void 0:l.currentSrc,null==ne?void 0:ne.currentSrc,ie,te,I]);(0,o.useImperativeHandle)(t,(function(){return le.current}),[]);var ce=A.filter((function(e){return!!e.url})),de=(0,o.useRef)(null),fe=(0,o.useRef)(null),he=(0,o.useRef)(null),ve=(0,o.useRef)(null),ge=(0,o.useRef)("0"),pe=(0,o.useRef)(null),me=!!document.createElement("video").canPlayType,ye=R<=1,be=(0,p.a)(de),ke=(0,o.useState)(!1),Ee=(0,a.Z)(ke,2),Te=Ee[0],_e=Ee[1],we=(0,o.useState)(!1),Se=(0,a.Z)(we,2),Le=Se[0],Re=Se[1],Ae=(0,o.useState)(!1),xe=(0,a.Z)(Ae,2),Ie=xe[0],De=xe[1],Ce=(0,o.useState)(!1),Pe=(0,a.Z)(Ce,2),Me=Pe[0],Oe=Pe[1],Ne=(0,o.useState)(P||0),Fe=(0,a.Z)(Ne,2),Ze=Fe[0],Ue=Fe[1],Be=(0,o.useState)(0),je=(0,a.Z)(Be,2),Ge=je[0],Ke=je[1],He=(0,o.useState)(0),ze=(0,a.Z)(He,2),Ve=ze[0],qe=ze[1],We=(0,o.useState)(50),Ye=(0,a.Z)(We,2),Xe=Ye[0],Qe=Ye[1],$e=(0,o.useState)(!1),Je=(0,a.Z)($e,2),et=Je[0],tt=Je[1],rt=(0,o.useState)(1),nt=(0,a.Z)(rt,2),it=nt[0],at=nt[1],st=(0,o.useState)(),ot=(0,a.Z)(st,2),lt=ot[0],ut=ot[1],ct=(0,o.useState)(!1),dt=(0,a.Z)(ct,2),ft=dt[0],ht=dt[1],vt=(0,o.useRef)(!1),gt=vt.current&&(Ie&&Te||!Ie)||ue,pt=!(Ie||gt||F||ue),mt=pt&&Ge>0||(F||!ue)&&!Ie&&!gt&&!U&&!X,yt=!F&&0===Ge||F&&(U||!ft),bt=F&&!j||j&&!O&&(U||!ft),kt=function(e){var t={};ue?(t.screen_type="PiP",t.pip_session_total=Ze):Le?(t.screen_type="Fullscreen",t.fullscreen_session_total=Ze):(t.screen_type="Inline",t.inline_session_total=Ze),F&&S("play"===e?"StartedViewingLiveTV":"StoppedViewingLiveTV",t)},Et=(0,o.useMemo)((function(){return F?"live-video":"video-".concat(A.length)}),[A.length,null===(T=A[0])||void 0===T?void 0:T.url,j]);function Tt(){le.current&&(0===Ve&&Q&&(le.current.currentTime=Q),le.current.play())}function _t(){le.current&&le.current.pause()}function wt(){le.current&&(document.fullscreenElement?document.exitFullscreen():le.current.parentElement.requestFullscreen().then((function(){var e;Re(!0),null===(e=le.current)||void 0===e||e.parentElement.addEventListener("fullscreenchange",(function(){document.fullscreenElement||Re(!1)}))})).catch((function(e){console.error("An error occurred while trying to switch into fullscreen mode: ".concat(e.message," (").concat(e.name,")"))})))}function St(){return(St=(0,i.Z)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:ae({playerRef:le,pictureInPictureButton:pe,initializedPip:oe,onPip:V});case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Lt=(0,o.useMemo)((function(){return(0,g.formatTime)(Math.floor(Ze))}),[Ze]),Rt=(0,o.useMemo)((function(){return(0,g.formatTime)(Math.floor(Ve+J))}),[Ve,J]),At=(0,o.useMemo)((function(){return(Ve+J)/Ze*100<50}),[Ve,J,Ze]),xt=(0,o.useMemo)((function(){if(0===A.length)return[];var e=A.find((function(e){return e.url===lt})),t=[{key:"playback-rate",text:"Playback Rate",items:E.map((function(e){return{key:String(e),text:String(e),isSelected:e===it,onSelect:function(){return function(e){le.current&&(at(e),le.current.playbackRate=e)}(e)}}}))}];return A.every((function(e){return!!e.quality}))&&t.push({key:"quality",text:"Quality",items:A.map((function(t){return{key:t.url,text:String(t.quality),isSelected:(null==e?void 0:e.url)===t.url,onSelect:function(){return e=t.url,void(le.current&&(le.current.pause(),le.current.src=e,le.current.load(),le.current.currentTime=Ve,null===(r=le.current)||void 0===r||r.play()));var e,r}}}))}),t}),[A,it,Ve,lt]),It=[{text:w.formatMessage(k.channel_guide),action:function(e){_.push("/tv/".concat(I))}}];return(0,o.useEffect)((function(){ue&&!oe.current&&se(le.current)}),[ue,oe.current]),(0,o.useEffect)((function(){ue&&V&&!oe.current&&V(ie)}),[ie,ue,oe.current]),(0,o.useEffect)((function(){K&&_t()}),[K]),(0,o.useEffect)((function(){!Ie||be||ue||oe.current||_t()}),[be,Ie,ue,oe.current]),o.createElement("div",{ref:de,className:(0,s.Z)(C,"relative",{rounded:!O,"rounded-t":O,"aspect-video":!ye,"aspect-square":ye}),onMouseEnter:function(){_e(!0)},onMouseLeave:function(){_e(!1)},"data-testid":"video-container"},!Le&&x&&(0,n.Z)(y.Z,{hash:x,className:(0,s.Z)({"absolute inset-0 z-0 h-full w-full bg-gray-200 object-cover dark:bg-gray-900":!0,"rounded-md":!O,"rounded-t-md":O})}),o.createElement("video",{key:Et,ref:le,"aria-label":ee,title:ee,autoPlay:X,playsInline:!0,className:(0,s.Z)({"relative z-[1] w-full bg-black":!0,"rounded-md":!O,"rounded-t-md":O,"aspect-video object-cover":!ye,"aspect-square object-contain":ye}),controls:!me,poster:W,role:"button",tabIndex:0,onClick:function(){le.current&&(Ie?_t():Tt())},onEnded:function(){tt(!0)},onLoadedMetadata:function(e){F||Ue(e.target.duration)},onLoadedData:function(e){e.target.readyState>=2&&ht(!0)},onPause:function(){De(!1),z&&z(Ve+J),kt("pause")},onPlay:function(){var e;document.querySelectorAll("video").forEach((function(e){var t;de.current&&(null!==(t=e.parentElement)&&void 0!==t&&t.contains(le.current)||e.pause())})),De(!0),ut(null===(e=le.current)||void 0===e?void 0:e.currentSrc),vt.current=!0,H&&H(),kt("play")},onProgress:function(){F&&!j||le.current&&(le.current.buffered.length>0?Ke(le.current.buffered.end(0)/Ze*100):Ke(100))},onTimeUpdate:function(e){if(!(F&&!j||isNaN(e.target.duration))){j||Ue(e.target.duration),qe(e.target.currentTime);var t=Ze||e.target.duration;Math.floor(t)===Math.floor(e.target.currentTime)?tt(!0):tt(!1)}},onVolumeChange:function(){le.current&&ve.current&&(le.current.muted||0===le.current.volume?Oe(!0):Oe(!1))},"data-testid":"video"},ce.map((function(e){return(0,n.Z)("source",{src:e.url,type:e.type,"data-quality":e.quality},e.url)}))),pt&&(0,n.Z)("div",{className:(0,s.Z)("absolute bottom-2 left-2 z-[2] transition-all")},void 0,(0,n.Z)("div",{className:"rounded-md bg-gray-900/25 px-1 py-0.5"},void 0,(0,n.Z)(d.xv,{weight:"medium",theme:"white",size:"sm"},void 0,Lt))),(0,n.Z)("div",{className:(0,s.Z)("absolute inset-0 z-[2] m-auto flex size-8 items-center justify-center rounded-full bg-gray-900/25 p-1 backdrop-blur-sm transition-all",{hidden:!yt})},void 0,(0,n.Z)(d.$j,{withText:!1,size:20,theme:"white"})),mt&&(0,n.Z)("button",{type:"button",className:"absolute inset-0 z-[2] m-auto flex size-20 items-center justify-center rounded-full bg-gray-900/25 p-4 backdrop-blur-sm transition-all hover:scale-105 hover:bg-gray-900/50",onClick:Tt},void 0,(0,n.Z)(d.JO,{src:r(463),className:"size-12 text-white"})),et&&(0,n.Z)("div",{className:"absolute inset-0 z-[2] flex items-center justify-center"},void 0,(0,n.Z)("button",{type:"button",className:"m-auto flex items-center justify-center space-x-1 rounded-full bg-gray-900/25 p-2 backdrop-blur-sm transition-all hover:scale-105 hover:bg-gray-900/50",onClick:function(){le.current&&(le.current.currentTime=0,Tt(),tt(!1))}},void 0,(0,n.Z)(d.JO,{src:r(1199),className:"size-5 text-white"}),(0,n.Z)(d.xv,{transform:"uppercase",tag:"span",theme:"white",weight:"bold",size:"sm"},void 0,"Replay"))),F&&yt&&(0,n.Z)("div",{className:(0,s.Z)({"absolute inset-0 z-[8] bg-black h-full w-full":!0,"rounded-md":!O,"rounded-t-md":O,hidden:0===J})}),o.createElement("div",{ref:fe,className:(0,s.Z)({hidden:!me,"absolute pt-5 bottom-0 z-[9] w-full transition-opacity ease-in bg-gradient-to-b from-transparent via-black/50 to-black/75":!0,"opacity-0":!gt,"opacity-100":gt,"h-[80px] rounded-b-md":!O,"h-[70px]":O})},(0,n.Z)(d.Kq,{space:2,justifyContent:"between",className:"relative z-20 h-full p-2"},void 0,(!F||j)&&(0,n.Z)("div",{className:"group relative h-1 w-full transition-all hover:-mt-px hover:h-1.5"},void 0,!F&&(0,n.Z)("progress",{className:(0,s.Z)({"appearance-none transition-all rounded-full w-full h-full pointer-events-none absolute top-0":!0,"[&::-webkit-progress-bar]:bg-white/10 [&::-webkit-progress-bar]:rounded-full":!0,"[&::-webkit-progress-value]:bg-white/25 [&::-webkit-progress-value]:rounded-full":!0}),value:Ge,max:100,"aria-readonly":!0}),yt?(0,n.Z)("div",{className:(0,s.Z)({"w-full h-full rounded-full bg-white/25":!0,"bg-[linear-gradient(-45deg,rgba(255,255,255,.15)_25%,transparent_25%,transparent_50%,rgba(255,255,255,.15)_50%,rgba(255,255,255,.15)_75%,transparent_75%,transparent)]":!0,"bg-[length:0.5rem_0.5rem]":!0,"animate-progress-bar":!0})}):(0,n.Z)("progress",{className:(0,s.Z)({"appearance-none transition-all rounded-full w-full h-full pointer-events-none absolute top-0":!0,"[&::-webkit-progress-bar]:bg-white/25 [&::-webkit-progress-bar]:rounded-full":!0,"[&::-webkit-progress-value]:bg-white [&::-webkit-progress-value]:rounded-full":!0,hidden:yt}),value:Ve+J,max:Ze}),(0,n.Z)("input",{className:(0,s.Z)({"appearance-none transition-all h-full bg-transparent focus:outline-none":!0,"absolute inset-x-0 top-0 m-0 w-full cursor-pointer":!0,"[&::-webkit-slider-runnable-track]:w-full [&::-webkit-slider-runnable-track]:cursor-pointer":!0,"[&::-webkit-slider-runnable-track]:rounded-full [&::-webkit-slider-runnable-track]:appearance-none":!0,"[&::-webkit-slider-runnable-track]:transition":!0,"[&::-webkit-slider-thumb]:w-4 [&::-webkit-slider-thumb]:h-4":!0,"[&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:cursor-pointer":!0,"[&::-webkit-slider-thumb]:bg-white [&::-webkit-slider-thumb]:appearance-none":!0,"[&::-webkit-slider-thumb]:ring-[5px] [&::-webkit-slider-thumb]:ring-transparent group-hover:[&::-webkit-slider-thumb]:ring-gray-900/25":!0,"[&::-webkit-slider-thumb]:transition-all":!0,"group-hover:[&::-webkit-slider-thumb]:w-5 group-hover:[&::-webkit-slider-thumb]:h-5":!0,"[&::-webkit-slider-thumb]:-ml-[2px]":At,"opacity-0":yt}),onInput:function(e){var t=e.target.dataset.seek?e.target.dataset.seek:e.target.value;le.current&&(le.current.currentTime=Number(t)-J,F&&(qe(le.current.currentTime),q?q(Number(t)):_t()))},onMouseMove:function(e){var t=e.nativeEvent,r=Math.round(t.offsetX/e.currentTarget.clientWidth*parseInt(e.currentTarget.getAttribute("max"),10));if(he.current&&le.current){he.current.textContent=(0,m.h)(r);var n=le.current.getBoundingClientRect();he.current.style.left="".concat(e.pageX-n.left-he.current.clientWidth/2,"px")}},value:Ve+J,min:"0",max:Ze,type:"range",step:"0.01"}),o.createElement("div",{ref:he,className:(0,s.Z)({"absolute -top-9 px-1 py-0.5 -ml-2 text-sm font-medium text-white bg-black/75 rounded":!0,"hidden group-hover:block pointer-events-none":!0})})),(0,n.Z)(d.Ug,{alignItems:"center",justifyContent:"between"},void 0,(0,n.Z)(d.Ug,{alignItems:"center",space:2},void 0,Ie?(0,n.Z)(d.hU,{theme:"video",src:r(1200),iconClassName:"h-5 w-5",onClick:_t}):(0,n.Z)(d.hU,{theme:"video",src:r(463),iconClassName:"h-5 w-5",onClick:Tt}),(0,n.Z)(d.Ug,{alignItems:"center",className:"group w-7 overflow-hidden rounded-full hover:w-auto hover:bg-gray-900/25"},void 0,(0,n.Z)(d.hU,{theme:"video",src:r(Me?314:315),iconClassName:"h-5 w-5",className:"group-hover:bg-gray-900/25",onClick:function(){le.current&&ve.current&&(le.current.muted=!le.current.muted,le.current.muted?(ge.current=ve.current.value,Qe(0)):Qe(100*Number(ge.current)))}}),o.createElement("input",{ref:ve,type:"range",max:"1",min:"0",step:"0.01",className:(0,s.Z)({"mx-2 h-1 appearance-none rounded-full bg-white/25":!0,"w-0 group-hover:w-full":!0,"[&::-webkit-slider-thumb]:w-0 [&::-webkit-slider-thumb]:h-0 group-hover:[&::-webkit-slider-thumb]:w-3 group-hover:[&::-webkit-slider-thumb]:h-3":!0,"[&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:cursor-pointer":!0,"[&::-webkit-slider-thumb]:bg-white [&::-webkit-slider-thumb]:appearance-none":!0}),onInput:function(e){le.current&&ve.current&&(Qe(100*Number(e.target.value)),le.current.muted&&(le.current.muted=!1),le.current.volume=Number(ve.current.value))},value:Xe/100,style:{background:"linear-gradient(to right, #fff 0%, #fff ".concat(Xe,"%, rgba(255, 255, 255, 0.25) ").concat(Xe,"%, rgba(255, 255, 255, 0.25) 100%)")}})),!bt&&(0,n.Z)(d.Ug,{alignItems:"center",space:.5},void 0,(0,n.Z)(d.xv,{size:"sm",theme:"white",weight:"medium"},void 0,Rt),(0,n.Z)(d.xv,{size:"sm",theme:"white",weight:"medium"},void 0,"/"),(0,n.Z)(d.xv,{size:"sm",theme:"white",weight:"medium"},void 0,Lt)),F&&!j&&(0,n.Z)(d.Ct,{className:"uppercase"},void 0,"Live")),(0,n.Z)(d.Ug,{alignItems:"center",space:2},void 0,I&&(0,n.Z)(b.Z,{items:It,isPortal:!Le},void 0,(0,n.Z)(d.hU,{theme:"video",src:r(570),iconClassName:"h-5 w-5"})),!F&&(0,n.Z)(b.Z,{items:xt,isPortal:!Le},void 0,(0,n.Z)(d.hU,{theme:"video",src:r(409),iconClassName:"h-5 w-5"})),document.pictureInPictureEnabled&&o.createElement(d.hU,{theme:"video",src:r(1201),iconClassName:"h-5 w-5",onClick:function(){return St.apply(this,arguments)},ref:pe}),document.fullscreenEnabled&&o.createElement(o.Fragment,null,Le?(0,n.Z)(d.hU,{theme:"video",src:r(1067),iconClassName:"h-5 w-5",onClick:wt}):(0,n.Z)(d.hU,{theme:"video",src:r(717),iconClassName:"h-5 w-5",onClick:wt})))))))}))},238:function(e,t,r){"use strict";var n=r(1521),i=r(1491),a=r(1),s=r(75),o=r(558),l=["id"];t.Z=function(e){var t=e.id,r=(0,i.Z)(e,l),u=(0,s.$z)(t),c=u.status,d=u.isInitialLoading;return c&&!d?a.createElement(o.Z,(0,n.Z)({status:c},r)):null}},462:function(e,t,r){"use strict";r.d(t,{I:function(){return l},i:function(){return u}});var n=r(1519),i=r(1474),a=r(1),s=r(7),o=(0,a.createContext)({isSortButtonVisible:!0,sort:"trending"}),l=function(e){var t=e.children,r=e.value.offset,l=(0,s.RO)(r,100,!0),u=(0,i.Z)(l,2),c=u[0],d=u[1],f=(0,a.useState)("trending"),h=(0,i.Z)(f,2),v=h[0],g=h[1],p=(0,a.useMemo)((function(){return{isSortButtonVisible:c,currentElement:d,sort:v,setSort:g}}),[c,d,v]);return(0,n.Z)(o.Provider,{value:p},void 0,t)},u=function(){return(0,a.useContext)(o)}},666:function(e,t,r){"use strict";var n=r(1521),i=r(1519),a=r(1474),s=(r(32),r(4),r(24),r(27),r(112),r(17),r(1520)),o=r(1),l=r(311),u=r(154),c=r(208),d=r(7),f=r(374);t.Z=function(e){var t,h=e.attachment,v=e.onOpenMedia,g=(0,d.rV)(),p=g.get("autoPlayGif"),m=g.get("displayMedia"),y=(0,o.useState)("hide_all"!==m&&!h.sensitive||"show_all"===m),b=(0,a.Z)(y,2),k=b[0],E=b[1],T=function(){return!p&&["gifv","video"].includes(h.type)},_="";if("unknown"===h.type);else if("image"===h.type)_=(0,i.Z)(c.Z,{src:h.preview_url,alt:h.description,className:"size-full overflow-hidden object-center"});else if(-1!==["gifv","video"].indexOf(h.type)){var w={};(0,f.gn)()&&(w.playsInline=!0),p&&(w.autoPlay=!0),_=(0,i.Z)("div",{className:(0,s.Z)("media-gallery__gifv",{autoplay:p})},void 0,o.createElement("video",(0,n.Z)({className:"relative top-0 z-[1] size-full transform-none cursor-zoom-in object-cover","aria-label":h.description,title:h.description,role:"application",src:h.url,onMouseEnter:function(e){var t=e.target;T()&&t.play()},onMouseLeave:function(e){var t=e.target;T()&&(t.pause(),t.currentTime=0)},loop:!0,muted:!0},w)),(0,i.Z)("span",{className:(0,s.Z)("pointer-events-none absolute bottom-1.5 left-1.5 z-[1] block rounded-md bg-black/50 px-1 py-0.5 text-xs font-semibold text-white opacity-90",{hidden:p})},void 0,"GIF"))}else if("audio"===h.type){var S=h.remote_url||"",L=S.lastIndexOf("."),R=S.slice(L+1).toUpperCase();_=(0,i.Z)("div",{className:"media-gallery__item-thumbnail"},void 0,(0,i.Z)("span",{className:"media-gallery__item__icons"},void 0,(0,i.Z)(u.Z,{src:r(315)})),(0,i.Z)("span",{className:"media-gallery__file-extension__label"},void 0,R))}return k||(t=(0,i.Z)("span",{className:"media-gallery__item__icons"},void 0,(0,i.Z)(u.Z,{src:r(354)}))),(0,i.Z)("div",{className:"col-span-1 aspect-square"},void 0,(0,i.Z)("button",{className:"relative z-[1] block aspect-square size-full cursor-zoom-in text-gray-400",onClick:function(e){0!==e.button||e.ctrlKey||e.metaKey||(e.preventDefault(),k?v(h):E(!0))},type:"button"},void 0,(0,i.Z)(l.Z,{hash:h.blurhash,className:(0,s.Z)("media-gallery__preview",{"media-gallery__preview--hidden":k})}),k&&_,!k&&t))}},1035:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return k}});var n=r(1519),i=r(1474),a=r(1520),s=r(140),o=r.n(s),l=r(229),u=r.n(l),c=r(1),d=r(1508),f=r(1509),h=r(154),v=r(576),g=r(1479),p=r(1480),m=r(1468),y=(r(12),r(10),r(38),r(66),r(11),r(2),r(16),r(0),r(144),r(114),r(115),r(116),r(117),r(118),r(119),r(120),r(121),r(122),r(123),r(124),r(125),r(126),r(127),r(128),r(129),r(130),r(131),r(132),r(133),r(134),r(135),r(136),r(137),r(138),r(6),r(35),function(){function e(t){(0,g.Z)(this,e),(0,m.Z)(this,"tickSize",void 0),(0,m.Z)(this,"canvas",void 0),(0,m.Z)(this,"context",void 0),(0,m.Z)(this,"analyser",void 0),this.tickSize=t}return(0,p.Z)(e,[{key:"setCanvas",value:function(e){this.canvas=e,e&&(this.context=e.getContext("2d"))}},{key:"setAudioContext",value:function(e,t){var r=e.createAnalyser();r.smoothingTimeConstant=.6,r.fftSize=2048,t.connect(r),this.analyser=r}},{key:"getTickPoints",value:function(e){for(var t=[],r=0;r<e;r++){var n=2*Math.PI*r/e;t.push({x:Math.cos(n),y:-Math.sin(n)})}return t}},{key:"drawTick",value:function(e,t,r,n,a,s,o){var l=Math.ceil(e+n),u=Math.ceil(t+a),c=Math.ceil(e+s),d=Math.ceil(t+o),f=this.context.createLinearGradient(l,u,c,d),h=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=e.match(/\w\w/g).map((function(e){return parseInt(e,16)})),n=(0,i.Z)(r,3),a=n[0],s=n[1],o=n[2];return"rgba(".concat(a,", ").concat(s,", ").concat(o,", ").concat(t,")")}(r,0);f.addColorStop(0,r),f.addColorStop(.6,r),f.addColorStop(1,h),this.context.beginPath(),this.context.strokeStyle=f,this.context.lineWidth=2,this.context.moveTo(l,u),this.context.lineTo(c,d),this.context.stroke()}},{key:"getTicks",value:function(e,t,r,n){var i=this.getTickPoints(e),a=[],s=this.analyser?this.analyser.frequencyBinCount:0,o=new Uint8Array(s),l=[];this.analyser&&this.analyser.getByteFrequencyData(o),i.forEach((function(e,s){var u=1-s/(2.5*i.length),c=((o[s]||0)-200*u)*n;c<0&&(c=0);var d=r/(r-(t+c)),f=e.x*(r-t),h=e.y*(r-t),v=f*d,g=h*d;if(a.push({x1:f,y1:h,x2:v,y2:g}),s<20){var p=c/(200*n);p=p<1?1:p,l.push(p)}}));var u=l.reduce((function(e,t){return e+t}),0)/l.length;return a.map((function(e){var t=e.x1,r=e.y1,n=e.x2,i=e.y2;return{x1:t,y1:r,x2:n*u,y2:i*u}}))}},{key:"clear",value:function(e,t){this.context.clearRect(0,0,e,t)}},{key:"draw",value:function(e,t,r,n,i){var a=this;this.context.save(),this.getTicks(parseInt(360*i),this.tickSize,n,i).forEach((function(n){a.drawTick(e,t,r,n.x1,n.y1,n.x2,n.y2)})),this.context.restore()}}]),e}()),b=(0,d.vU)({play:{id:"video.play",defaultMessage:"Play"},pause:{id:"video.pause",defaultMessage:"Pause"},mute:{id:"video.mute",defaultMessage:"Mute sound"},unmute:{id:"video.unmute",defaultMessage:"Unmute sound"},download:{id:"video.download",defaultMessage:"Download file"}}),k=function(e){var t=e.src,s=e.alt,l=void 0===s?"":s,d=e.poster,g=e.accentColor,p=e.backgroundColor,m=e.foregroundColor,k=e.cacheWidth,E=e.fullscreen,T=e.autoPlay,_=e.editable,w=e.deployPictureInPicture,S=void 0!==w&&w,L=(0,f.Z)(),R=(0,c.useState)(e.width),A=(0,i.Z)(R,2),x=A[0],I=A[1],D=(0,c.useState)(e.height),C=(0,i.Z)(D,2),P=C[0],M=C[1],O=(0,c.useState)(0),N=(0,i.Z)(O,2),F=N[0],Z=N[1],U=(0,c.useState)(0),B=(0,i.Z)(U,2),j=B[0],G=B[1],K=(0,c.useState)(void 0),H=(0,i.Z)(K,2),z=H[0],V=H[1],q=(0,c.useState)(!0),W=(0,i.Z)(q,2),Y=W[0],X=W[1],Q=(0,c.useState)(!1),$=(0,i.Z)(Q,2),J=$[0],ee=$[1],te=(0,c.useState)(.5),re=(0,i.Z)(te,2),ne=re[0],ie=re[1],ae=(0,c.useState)(!1),se=(0,i.Z)(ae,2),oe=se[0],le=se[1],ue=(0,c.useState)(!1),ce=(0,i.Z)(ue,2),de=ce[0],fe=ce[1],he=(0,c.useRef)(new y(10)),ve=(0,c.useRef)(null),ge=(0,c.useRef)(null),pe=(0,c.useRef)(null),me=(0,c.useRef)(null),ye=(0,c.useRef)(null),be=(0,c.useRef)(null),ke=function(){var t,r,n;return{src:e.src,volume:null===(t=pe.current)||void 0===t?void 0:t.volume,muted:null===(r=pe.current)||void 0===r?void 0:r.muted,currentTime:null===(n=pe.current)||void 0===n?void 0:n.currentTime,poster:e.poster,backgroundColor:e.backgroundColor,foregroundColor:e.foregroundColor,accentColor:e.accentColor}},Ee=function(){if(ge.current){var e=ge.current.offsetWidth,t=E?ge.current.offsetHeight:e/(16/9);k&&k(e),I(e),M(t)}},Te=function(){var e,t;ve.current||Ie(),Y?null===(e=pe.current)||void 0===e||e.play():null===(t=pe.current)||void 0===t||t.pause(),X(!Y)},_e=o()((function(){ge.current&&Ee()}),250,{trailing:!0}),we=function(){var e=!J;ee(e),pe.current&&(pe.current.muted=e)},Se=function e(){document.removeEventListener("mousemove",Ae,!0),document.removeEventListener("mouseup",e,!0),document.removeEventListener("touchmove",Ae,!0),document.removeEventListener("touchend",e,!0)},Le=function e(){var t;document.removeEventListener("mousemove",Re,!0),document.removeEventListener("mouseup",e,!0),document.removeEventListener("touchmove",Re,!0),document.removeEventListener("touchend",e,!0),le(!1),null===(t=pe.current)||void 0===t||t.play()},Re=u()((function(e){if(pe.current&&me.current){var t=(0,v.getPointerPosition)(me.current,e).x,r=pe.current.duration*t;isNaN(r)||(Z(r),pe.current.currentTime=r)}}),15),Ae=u()((function(e){if(pe.current&&ye.current){var t=(0,v.getPointerPosition)(ye.current,e).x;isNaN(t)||(ie(t),pe.current.volume=t)}}),15),xe=u()((function(){if(be.current&&pe.current){var e=be.current.getBoundingClientRect(),t=e.top,r=e.height,n=t<=(window.innerHeight||document.documentElement.clientHeight)&&t+r>=0;Y||n||(pe.current.pause(),S&&S("audio",ke()),X(!0))}}),150,{trailing:!0}),Ie=function(){if(pe.current){var e=new(window.AudioContext||window.webkitAudioContext),t=e.createMediaElementSource(pe.current);he.current.setAudioContext(e,t),t.connect(e.destination),ve.current=e}},De=function e(){requestAnimationFrame((function(){pe.current&&(pe.current&&(Z(pe.current.currentTime),V(pe.current.duration)),Ce(),Pe(),Y||e())}))},Ce=function(){var e;null===(e=he.current)||void 0===e||e.clear(x||0,P||0)},Pe=function(){var e;null===(e=he.current)||void 0===e||e.draw(Ne(),Fe(),Ze(),Me(),Oe())},Me=function(){return((P||e.height||0)-180*Oe()*2)/2},Oe=function(){return(P||e.height||0)/982},Ne=function(){return Math.floor((x||0)/2)},Fe=function(){return Math.floor(Me()+180*Oe())},Ze=function(){return g||"#ffffff"},Ue=function(e){if(pe.current){var t=pe.current.currentTime+e;isNaN(t)||(Z(t),pe.current.currentTime=t)}},Be=function(e){" "===e.key&&(e.preventDefault(),e.stopPropagation(),Te())},je=function(){return z||e.duration||0},Ge=Math.min(F/je()*100,100);return(0,c.useLayoutEffect)((function(){ge.current&&Ee()}),[ge.current]),(0,c.useEffect)((function(){pe.current&&(ie(pe.current.volume),ee(pe.current.muted))}),[pe.current]),(0,c.useEffect)((function(){be.current&&he.current&&he.current.setCanvas(be.current)}),[be.current,he.current]),(0,c.useEffect)((function(){return window.addEventListener("scroll",xe),window.addEventListener("resize",_e,{passive:!0}),function(){window.removeEventListener("scroll",xe),window.removeEventListener("resize",_e),!Y&&pe.current&&S&&S("audio",ke())}}),[]),(0,c.useEffect)((function(){Ce(),Pe()}),[t,x,P,g]),c.createElement("div",{className:(0,a.Z)("audio-player",{editable:_}),ref:ge,style:{backgroundColor:p||"#000000",color:m||"#ffffff",width:"100%",height:E?"100%":P||e.height},onMouseEnter:function(){fe(!0)},onMouseLeave:function(){fe(!1)},tabIndex:0,onKeyDown:function(e){switch(e.key){case"k":e.preventDefault(),e.stopPropagation(),Te();break;case"m":e.preventDefault(),e.stopPropagation(),we();break;case"j":e.preventDefault(),e.stopPropagation(),Ue(-10);break;case"l":e.preventDefault(),e.stopPropagation(),Ue(10)}},onClick:function(e){return e.stopPropagation()}},c.createElement("audio",{src:t,ref:pe,preload:"auto",onPlay:function(){var e,t;X(!1),"suspended"===(null===(e=ve.current)||void 0===e?void 0:e.state)&&(null===(t=ve.current)||void 0===t||t.resume()),De()},onPause:function(){var e;X(!0),null===(e=ve.current)||void 0===e||e.suspend()},onProgress:function(){if(pe.current){var e=pe.current.buffered.length-1;e>-1&&G(Math.ceil(pe.current.buffered.end(e)/pe.current.duration*100))}},onLoadedData:function(){pe.current&&(V(pe.current.duration),F&&(pe.current.currentTime=F),void 0!==ne&&(pe.current.volume=ne),void 0!==J&&(pe.current.muted=J),T&&Te())},crossOrigin:"anonymous"}),c.createElement("canvas",{role:"button",tabIndex:0,className:"audio-player__canvas",width:x,height:P,style:{width:"100%",position:"absolute",top:0,left:0},ref:be,onClick:Te,onKeyDown:Be,title:l,"aria-label":l}),d&&(0,n.Z)("img",{src:d,alt:"",width:2*(Me()-10),height:2*(Me()-10),style:{position:"absolute",left:Ne(),top:Fe(),transform:"translate(-50%, -50%)",borderRadius:"50%",pointerEvents:"none"}}),c.createElement("div",{className:"video-player__seek",onMouseDown:function(e){var t;document.addEventListener("mousemove",Re,!0),document.addEventListener("mouseup",Le,!0),document.addEventListener("touchmove",Re,!0),document.addEventListener("touchend",Le,!0),le(!0),null===(t=pe.current)||void 0===t||t.pause(),Re(e),e.preventDefault(),e.stopPropagation()},ref:me},(0,n.Z)("div",{className:"video-player__seek__buffer",style:{width:"".concat(j,"%")}}),(0,n.Z)("div",{className:"video-player__seek__progress",style:{width:"".concat(Ge,"%"),backgroundColor:g}}),(0,n.Z)("span",{className:(0,a.Z)("video-player__seek__handle",{active:oe}),tabIndex:0,style:{left:"".concat(Ge,"%"),backgroundColor:g},onKeyDown:Be})),(0,n.Z)("div",{className:"video-player__controls active"},void 0,(0,n.Z)("div",{className:"video-player__buttons-bar"},void 0,(0,n.Z)("div",{className:"video-player__buttons left"},void 0,(0,n.Z)("button",{type:"button",title:L.formatMessage(Y?b.play:b.pause),"aria-label":L.formatMessage(Y?b.play:b.pause),className:"player-button",onClick:Te},void 0,(0,n.Z)(h.Z,{src:r(Y?705:1066)})),(0,n.Z)("button",{type:"button",title:L.formatMessage(J?b.unmute:b.mute),"aria-label":L.formatMessage(J?b.unmute:b.mute),className:"player-button",onClick:we},void 0,(0,n.Z)(h.Z,{src:r(J?314:315)})),c.createElement("div",{className:(0,a.Z)("video-player__volume",{active:de}),ref:ye,onMouseDown:function(e){document.addEventListener("mousemove",Ae,!0),document.addEventListener("mouseup",Se,!0),document.addEventListener("touchmove",Ae,!0),document.addEventListener("touchend",Se,!0),Ae(e),e.preventDefault(),e.stopPropagation()}},(0,n.Z)("div",{className:"video-player__volume__current",style:{width:"".concat(100*ne,"%"),backgroundColor:Ze()}}),(0,n.Z)("span",{className:"video-player__volume__handle",tabIndex:0,style:{left:"".concat(100*ne,"%"),backgroundColor:Ze()}})),(0,n.Z)("span",{className:"video-player__time"},void 0,(0,n.Z)("span",{className:"video-player__time-current"},void 0,(0,v.formatTime)(Math.floor(F))),je()&&c.createElement(c.Fragment,null,(0,n.Z)("span",{className:"video-player__time-sep"},void 0,"/"),(0,n.Z)("span",{className:"video-player__time-total"},void 0,(0,v.formatTime)(Math.floor(je())))))),(0,n.Z)("div",{className:"video-player__buttons right"},void 0,(0,n.Z)("a",{title:L.formatMessage(b.download),"aria-label":L.formatMessage(b.download),className:"video-player__download__icon player-button",href:t,download:!0,target:"_blank"},void 0,(0,n.Z)(h.Z,{src:r(1073)}))))))}},1070:function(e,t,r){"use strict";r.d(t,{Z:function(){return ie}});var n=r(1519),i=r(1474),a=(r(2),r(1)),s=r(1508),o=r(1509),l=r(1477),u=r(3),c=r(95),d=r(1520),f=r(1541),h=r(183),v=r(573),g=r(212),p=r(574),m=function(){return(0,n.Z)("div",{className:"flex w-full animate-pulse flex-col px-4 py-2"},void 0,(0,n.Z)(u.Ug,{alignItems:"center",space:2},void 0,(0,n.Z)(g.Z,{size:40}),(0,n.Z)(u.Kq,{alignItems:"start"},void 0,(0,n.Z)(p.Z,{minLength:3,maxLength:15}))))},y=r(1534),b=r(170),k=r(196),E=r(299),T=r(192),_=r(7),w=(0,s.vU)({blockedYou:{id:"chat_list_item.blocked_you",defaultMessage:"This user has blocked you"},blocking:{id:"chat_list_item.blocking",defaultMessage:"You have blocked this user"},leaveMessage:{id:"chat_settings.leave.message",defaultMessage:"Are you sure you want to leave this chat? Messages will be deleted for you and this chat will be removed from your inbox."},leaveHeading:{id:"chat_settings.leave.heading",defaultMessage:"Leave Chat"},leaveConfirm:{id:"chat_settings.leave.confirm",defaultMessage:"Leave Chat"},leaveChat:{id:"chat_settings.options.leave_chat",defaultMessage:"Leave Chat"}}),S=function(e){var t,i,s,d,f,v=e.chat,g=e.onClick,p=(0,_.TL)(),m=(0,o.Z)(),S=(0,_.hz)(),L=(0,l.k6)(),R=(0,c.mx)().isUsingMainChatPage,A=(0,h.Ln)(),x=(0,b.I)(v.account.id,{enabled:!0}).relationship,I=!(null==x||!x.blocked_by),D=!(null==x||!x.blocking),C=v.unread>0,P=(0,a.useMemo)((function(){return[{text:m.formatMessage(w.leaveChat),action:function(e){e.stopPropagation(),p((0,y.h7)("CONFIRM",{heading:m.formatMessage(w.leaveHeading),message:m.formatMessage(w.leaveMessage),confirm:m.formatMessage(w.leaveConfirm),confirmationTheme:"primary",onConfirm:function(){A.mutate({chatId:v.id},{onSuccess:function(){R&&L.push("/chats")}})}}))},icon:r(410)}]}),[]);return(0,n.Z)("div",{role:"button",onClick:function(){return g(v)},className:"group flex w-full flex-col rounded-lg px-2 py-3 hover:bg-gray-100 focus:shadow-inset-ring dark:hover:bg-gray-800","data-testid":"chat-list-item"},v.id,(0,n.Z)(u.Ug,{alignItems:"center",justifyContent:"between",space:2,className:"w-full"},void 0,(0,n.Z)(u.Ug,{alignItems:"center",space:2,className:"overflow-hidden"},void 0,(0,n.Z)(u.qE,{src:null===(t=v.account)||void 0===t?void 0:t.avatar,size:40,className:"flex-none"}),(0,n.Z)(u.Kq,{alignItems:"start",className:"overflow-hidden"},void 0,(0,n.Z)("div",{className:"flex w-full grow items-center space-x-1"},void 0,(0,n.Z)(u.xv,{weight:"bold",size:"sm",align:"left",truncate:!0},void 0,(null===(i=v.account)||void 0===i?void 0:i.display_name)||"@".concat(v.account.username)),(null===(s=v.account)||void 0===s?void 0:s.verified)&&(0,n.Z)(T.Z,{})),I||D?(0,n.Z)(u.xv,{align:"left",size:"sm",weight:"medium",theme:"muted",truncate:!0,className:"pointer-events-none h-5 w-full italic","data-testid":"chat-last-message"},void 0,m.formatMessage(I?w.blockedYou:w.blocking)):a.createElement(a.Fragment,null,(null===(d=v.last_message)||void 0===d?void 0:d.content)&&(0,n.Z)(u.xv,{align:"left",size:"sm",weight:"medium",theme:C?"default":"muted",truncate:!0,className:"truncate-child pointer-events-none h-5 w-full","data-testid":"chat-last-message",dangerouslySetInnerHTML:{__html:null===(f=v.last_message)||void 0===f?void 0:f.content}})))),(0,n.Z)(u.Ug,{alignItems:"center",space:2},void 0,S.chatsDelete&&(0,n.Z)("div",{className:"hidden text-gray-600 hover:text-gray-100 group-hover:block"},void 0,(0,n.Z)(k.Z,{items:P},void 0,(0,n.Z)(u.hU,{src:r(197),title:"Settings",iconClassName:"h-4 w-4"}))),v.last_message&&a.createElement(a.Fragment,null,C&&(0,n.Z)("div",{className:"size-2 rounded-full bg-secondary-500","data-testid":"chat-unread-indicator"}),(0,n.Z)(E.Z,{timestamp:v.last_message.created_at,align:"right",size:"xs",theme:C?"default":"muted",truncate:!0})))))},L=(0,s.vU)({title:{id:"chat_search.blankslate.title",defaultMessage:"Start a chat"},body:{id:"chat_search.blankslate.body",defaultMessage:"Search for someone to chat with."}}),R=function(){var e=(0,o.Z)();return(0,n.Z)(u.Kq,{"data-testid":"chat-search-blankslate",space:2,alignItems:"center",justifyContent:"center",className:"mx-auto h-full w-3/4"},void 0,(0,n.Z)(u.xv,{weight:"bold",size:"xl",align:"center"},void 0,e.formatMessage(L.title)),(0,n.Z)(u.xv,{theme:"muted",align:"center"},void 0,e.formatMessage(L.body)))},A=function(e){var t=e.onClickChat,r=e.useWindowScroll,s=void 0!==r&&r,o=e.isMainPage,l=(0,a.useRef)(null),c=(0,h.PD)(),g=c.entities,p=c.isFetching,y=c.hasNextPage,b=c.fetchNextPage,k=c.refetch,E=(0,a.useState)(!1),T=(0,i.Z)(E,2),_=T[0],w=T[1],L=(0,a.useState)(!0),A=(0,i.Z)(L,2),x=A[0],I=A[1];return(0,n.Z)("div",{className:"relative h-full"},void 0,(0,n.Z)(v.Z,{onRefresh:function(){return k()}},void 0,a.createElement(f.OO,{ref:l,atTopStateChange:function(e){return I(e)},atBottomStateChange:function(e){return w(e)},useWindowScroll:s,data:g,endReached:function(){y&&!p&&b()},itemContent:function(e,r){return(0,n.Z)("div",{className:"px-2"},void 0,(0,n.Z)(S,{chat:r,onClick:t}))},components:{ScrollSeekPlaceholder:function(){return(0,n.Z)(m,{})},Footer:function(){return y?(0,n.Z)(u.$j,{withText:!1}):null},EmptyPlaceholder:function(){return p?(0,n.Z)(u.Kq,{space:2},void 0,(0,n.Z)(m,{}),(0,n.Z)(m,{}),(0,n.Z)(m,{})):o?null:(0,n.Z)(R,{})}}})),a.createElement(a.Fragment,null,(0,n.Z)("div",{className:(0,d.Z)("pointer-events-none absolute inset-x-0 top-0 flex justify-center rounded-t-lg bg-gradient-to-b from-white to-transparent pb-12 pt-8 transition-opacity duration-500 dark:from-gray-900",{"opacity-0":x,"opacity-100":!x})}),(0,n.Z)("div",{className:(0,d.Z)("pointer-events-none absolute inset-x-0 bottom-0 flex justify-center rounded-b-lg bg-gradient-to-t from-white to-transparent pb-8 pt-12 transition-opacity duration-500 dark:from-gray-900",{"opacity-0":_,"opacity-100":!_})})))},x=(r(8),r(4),r(9),r(0),r(13),r(6),r(14),r(15),r(5),r(1468)),I=r(1483),D=(r(30),r(1536)),C=r(1492),P=r(81),M=r(63);function O(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function N(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?O(Object(r),!0).forEach((function(t){(0,x.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):O(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var F=["chats","search","previews"],Z=function(e,t,r){var n=(0,_.h_)(),i=(0,_.hz)(),a=function(){var t=(0,I.Z)(regeneratorRuntime.mark((function t(i){var a,s,o,l,u,c;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=null==i?void 0:i.link,s=a||e,t.next=4,n.get(s,{params:r?{q:r}:void 0});case 4:return o=t.sent,l=o.data,u=(0,P.J2)(o),c=!!u,t.abrupt("return",{result:l,hasMore:c,link:u});case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),s=(0,D.N)(t,(function(e){var t=e.pageParam;return a(t)}),{keepPreviousData:!0,enabled:i.chats&&!!r,getNextPageParam:function(e){if(e.hasMore)return{link:e.link}}}),o=(0,M.MH)(s.data);return N(N({},s),{},{data:o||[]})},U=r(406),B=r(645),j=(r(12),function(e){var t=e.size,r=e.withText,i=void 0!==r&&r,s=a.useMemo((function(){return t?{width:"".concat(t,"px"),height:"".concat(t,"px")}:{}}),[t]);return(0,n.Z)(u.Kq,{space:1,className:"animate-pulse text-center"},void 0,(0,n.Z)("div",{className:"mx-auto block rounded-full bg-primary-100 dark:bg-gray-800",style:s}),i&&(0,n.Z)("div",{style:{width:t,height:15},className:"mx-auto rounded-full bg-primary-100 dark:bg-gray-800"}))}),G=function(e){var t=e.title,r=e.actionText,i=e.action;return(0,n.Z)(u.Ug,{alignItems:"center",justifyContent:"between",className:"px-4 py-2"},void 0,(0,n.Z)(u.xv,{theme:"muted",weight:"semibold",size:"sm"},void 0,t),i?(0,n.Z)("button",{onClick:i},void 0,(0,n.Z)(u.xv,{theme:"primary",size:"sm",className:"hover:underline"},void 0,r)):null)},K=(0,s.vU)({people:{id:"chat_search.results.people",defaultMessage:"People"}}),H=function(e){var t,r,i,s=e.onSelect,l=(0,o.Z)(),c=(t=(0,_.h_)(),r=function(){var e=(0,I.Z)(regeneratorRuntime.mark((function e(){var r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.get("/api/v1/pleroma/chats/search/previews");case 2:return r=e.sent,n=r.data,e.abrupt("return",n||[]);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),N(N({},i=(0,C.a)(F,r,{placeholderData:[]})),{},{data:i.data||[]})),d=c.data,f=c.isFetching;return(0,n.Z)(u.Kq,{space:2},void 0,(0,n.Z)(G,{title:l.formatMessage(K.people)}),(0,n.Z)("div",{className:"grid grid-cols-4 px-4"},void 0,f?a.createElement(a.Fragment,null,(0,n.Z)(j,{size:44,withText:!0}),(0,n.Z)(j,{size:44,withText:!0}),(0,n.Z)(j,{size:44,withText:!0}),(0,n.Z)(j,{size:44,withText:!0})):a.createElement(a.Fragment,null,d.map((function(e){return(0,n.Z)("button",{className:"col-span-1 flex flex-col items-center space-y-1",onClick:function(){return s(e.id)}},e.id,(0,n.Z)(u.qE,{src:e.avatar,size:44,className:"mx-auto"}),(0,n.Z)(u.xv,{truncate:!0,size:"sm",weight:"medium",align:"center",className:"max-w-full"},void 0,e.display_name.length>0?e.display_name:e.username))})))))},z=(0,s.vU)({title:{id:"chat_search.empty_results_blankslate.title",defaultMessage:"No matches found"},body:{id:"chat_search.empty_results_blankslate.body",defaultMessage:"Try searching for another name."}}),V=function(){var e=(0,o.Z)();return(0,n.Z)(u.Kq,{space:2,className:"px-4 py-2"},void 0,(0,n.Z)(u.xv,{weight:"bold",size:"lg","data-testid":"no-results"},void 0,e.formatMessage(z.title)),(0,n.Z)(u.xv,{theme:"muted"},void 0,e.formatMessage(z.body)))},q=r(1470),W=(r(17),r(11),r(1523));function Y(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function X(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Y(Object(r),!0).forEach((function(t){(0,x.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Y(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Q,$=(0,s.vU)({all:{id:"chat_search.results.all",defaultMessage:"All"},people:{id:"chat_search.results.people",defaultMessage:"People"},chats:{id:"chat_search.results.chats",defaultMessage:"Chats"},showMore:{id:"chat_search.results.show_more",defaultMessage:"Show more"}});!function(e){e.ALL="ALL",e.ACCOUNTS="ACCOUNTS",e.CHATS="CHATS"}(Q||(Q={}));var J=function(e){var t=e.searchValue;return(0,n.Z)(u.Kq,{space:2,className:"px-4 py-2"},void 0,(0,n.Z)(u.xv,{weight:"bold",size:"lg","data-testid":"no-results"},void 0,(0,n.Z)(W.Z,{id:"chat_search.results.blankslate.title",defaultMessage:'No results for "{searchValue}"',values:{searchValue:t}})),(0,n.Z)(u.xv,{theme:"muted"},void 0,(0,n.Z)(W.Z,{id:"chat_search.results.blankslate.subtitle",defaultMessage:"The word you entered did not return any results."})))},ee=function(e){var t=e.accountSearchResult,r=e.messageSearchResult,s=e.onSelect,l=e.searchValue,c=(0,o.Z)(),h=t.data,v=t.isFetching,g=t.hasNextPage,p=t.fetchNextPage,m=r.data,y=r.fetchNextPage,b=(0,a.useState)(Q.ALL),k=(0,i.Z)(b,2),E=k[0],_=k[1],w=(0,a.useState)(!1),S=(0,i.Z)(w,2),L=S[0],R=S[1],A=(0,a.useState)(!0),x=(0,i.Z)(A,2),I=x[0],D=x[1],C=function(){if(g&&!v)switch(E){case Q.ACCOUNTS:p();break;case Q.CHATS:y()}},P=(0,a.useCallback)((function(e,t){return(0,n.Z)("button",{type:"button",className:"flex w-full flex-col rounded-lg px-2 py-3 hover:bg-gray-100 dark:hover:bg-gray-800",onClick:function(){return s(t.id)},"data-testid":"account"},t.id,(0,n.Z)(u.Ug,{alignItems:"center",space:2},void 0,(0,n.Z)(u.qE,{src:t.avatar,size:40}),(0,n.Z)(u.Kq,{alignItems:"start"},void 0,(0,n.Z)("div",{className:"flex grow items-center space-x-1"},void 0,(0,n.Z)(u.xv,{weight:"bold",size:"sm",truncate:!0},void 0,t.display_name),t.verified&&(0,n.Z)(T.Z,{})),(0,n.Z)(u.xv,{size:"sm",weight:"medium",theme:"muted",truncate:!0},void 0,"@",t.acct))))}),[]),M=(0,a.useCallback)((function(e,t){return(0,n.Z)("button",{type:"button",className:"flex w-full flex-col rounded-lg px-2 py-3 hover:bg-gray-100 dark:hover:bg-gray-800",onClick:function(){return s(t.account.id)},"data-testid":"chat-message"},t.message_id,(0,n.Z)(u.Ug,{alignItems:"center",space:2,className:"w-full overflow-hidden"},void 0,(0,n.Z)(u.qE,{src:t.account.avatar,size:40,className:"flex-none"}),(0,n.Z)(u.Kq,{alignItems:"start",className:"overflow-hidden"},void 0,(0,n.Z)("div",{className:"flex grow items-center space-x-1"},void 0,(0,n.Z)(u.xv,{weight:"bold",size:"sm",truncate:!0},void 0,t.account.display_name),t.account.verified&&(0,n.Z)(T.Z,{})),(0,n.Z)(u.xv,{size:"sm",weight:"medium",theme:"muted",truncate:!0,dangerouslySetInnerHTML:{__html:t.matches},className:"w-full"}))))}),[]),O=[{text:c.formatMessage($.all),name:Q.ALL,action:function(){return _(Q.ALL)}},{text:c.formatMessage($.people),name:Q.ACCOUNTS,action:function(){return _(Q.ACCOUNTS)}},{text:c.formatMessage($.chats),name:Q.CHATS,action:function(){return _(Q.CHATS)}}];return(0,n.Z)(u.Kq,{space:2,className:"grow"},void 0,(0,n.Z)(u.mQ,{items:O,activeItem:E}),(0,n.Z)("div",{className:"relative grow overflow-scroll"},void 0,function(){var e=[h.slice(0,5).length,m.slice(0,5).length].filter((function(e){return e>0})),t=[{text:c.formatMessage($.people),action:function(){return _(Q.ACCOUNTS)},count:h.slice(0,5).length},{text:c.formatMessage($.chats),action:function(){return _(Q.CHATS)},count:m.slice(0,5).length}].filter((function(e){return e.count>0})),r=[].concat((0,q.Z)(h.slice(0,5).map((function(e){return X(X({},e),{},{renderType:"account"})}))),(0,q.Z)(m.slice(0,5).map((function(e){return X(X({},e),{},{renderType:"message"})}))));switch(E){case Q.ALL:return(0,n.Z)(f.Px,{groupCounts:e,groupContent:function(e){return(0,n.Z)(G,{title:t[e].text,actionText:c.formatMessage($.showMore),action:t[e].action})},itemContent:function(e){return(0,n.Z)("div",{className:"px-2"},void 0,"account"===r[e].renderType?P(e,r[e]):M(e,r[e]))},atTopStateChange:function(e){return D(e)},atBottomStateChange:function(e){return R(e)}});case Q.ACCOUNTS:return a.createElement(a.Fragment,null,h&&h.length>0?(0,n.Z)(f.OO,{data:h,itemContent:function(e,t){return(0,n.Z)("div",{className:"px-2"},void 0,P(e,t))},endReached:C,atTopStateChange:function(e){return D(e)},atBottomStateChange:function(e){return R(e)}}):(0,n.Z)(J,{searchValue:l}));case Q.CHATS:return a.createElement(a.Fragment,null,m.length>0?(0,n.Z)(f.OO,{data:m,itemContent:function(e,t){return(0,n.Z)("div",{className:"px-2"},void 0,M(e,t))},endReached:C,atTopStateChange:function(e){return D(e)},atBottomStateChange:function(e){return R(e)}}):(0,n.Z)(J,{searchValue:l}));default:return null}}(),a.createElement(a.Fragment,null,(0,n.Z)("div",{className:(0,d.Z)("pointer-events-none absolute inset-x-0 top-0 flex justify-center rounded-t-lg bg-gradient-to-b from-white to-transparent pb-12 pt-8 transition-opacity duration-500 dark:from-gray-900",{"opacity-0":I,"opacity-100":!I})}),(0,n.Z)("div",{className:(0,d.Z)("pointer-events-none absolute inset-x-0 bottom-0 flex justify-center rounded-b-lg bg-gradient-to-t from-white to-transparent pb-8 pt-12 transition-opacity duration-500 dark:from-gray-900",{"opacity-0":L,"opacity-100":!L})}))))},te=(0,s.vU)({recentSearches:{id:"chat_search.recent_searches.title",defaultMessage:"Recent searches"},clearAll:{id:"chat_search.clear_all",defaultMessage:"Clear all"},blankslateTitle:{id:"chat_search.recent_searches.empty.title",defaultMessage:"No recent searches"},blankslateSubtitle:{id:"chat_search.recent_searches.empty.subtitle",defaultMessage:"Search people, topics or keywords"}}),re=function(e){var t,s,d=e.isMainPage,v=void 0!==d&&d,g=e.onFinish,p=e.onSelect,y=e.searchValue,b=(0,_.Tr)().account,k=_.Nr,E=(0,o.Z)(),T=(0,l.k6)(),w=k(y,300),S=k(y,1e3),L=(0,c.mx)().changeScreen,R=(0,h.AY)(),A=(0,a.useState)(U.l2.get(null==b?void 0:b.id)||[]),x=(0,i.Z)(A,2),I=x[0],D=x[1],C=Z("/api/v1/pleroma/chats/search",(s=t=w)?["chats","search","accounts",s]:["chats","search","accounts"],t),P=function(e){return Z("/api/v1/pleroma/chats/search/messages",function(e){return e?["chats","search","messages",e]:["chats","search","messages"]}(e),e)}(w),M=C.data,O=C.isFetching,N=C.isFetched,F=P.data,j=P.isFetching,K=P.isFetched,z=O||j,q=N||K,W=q&&(M.length>0||F.length>0),Y=q&&0===M.length&&0===F.length,X=function(e,t){R.mutate(e,{onSuccess:function(e){v?T.push("/chats/".concat(e.data.id)):L(c.fB.CHAT,e.data.id),t&&t()}})};return(0,a.useEffect)((function(){if(S&&S.length>=1){var e=(0,B.ok)(null==b?void 0:b.id,S);D(e)}}),[S]),z?(0,n.Z)(u.Kq,{},void 0,(0,n.Z)(m,{}),(0,n.Z)(m,{}),(0,n.Z)(m,{})):Y?(0,n.Z)(V,{}):W?(0,n.Z)(ee,{accountSearchResult:C,messageSearchResult:P,searchValue:y,onSelect:function(e){return X(e,(function(){return g()}))}}):(0,n.Z)(u.Kq,{className:"h-full",space:4},void 0,(0,n.Z)(H,{onSelect:function(e){return X(e)}}),I.length>0?(0,n.Z)(u.Kq,{space:2,className:"grow"},void 0,(0,n.Z)(G,{title:E.formatMessage(te.recentSearches),actionText:E.formatMessage(te.clearAll),action:function(){(0,B.lU)(null==b?void 0:b.id),D([])}}),(0,n.Z)(f.OO,{data:I,itemContent:function(e,t){return(0,n.Z)("div",{className:"px-2"},t,(0,n.Z)("button",{onClick:function(){return p(t)},className:"group flex w-full flex-col rounded-lg p-2 hover:bg-gray-100 dark:hover:bg-gray-800"},void 0,(0,n.Z)(u.Ug,{alignItems:"center",space:2},void 0,(0,n.Z)("div",{className:"flex size-10 items-center justify-center rounded-full bg-gray-200 p-2 dark:bg-gray-800 dark:group-hover:bg-gray-700/20"},void 0,(0,n.Z)(u.JO,{src:r(156),className:"size-5 text-gray-600"})),(0,n.Z)(u.xv,{weight:"bold",size:"sm",align:"left"},void 0,t))))}})):(0,n.Z)(u.Kq,{space:2,className:"px-4 py-2"},void 0,(0,n.Z)(u.xv,{weight:"bold",size:"lg","data-testid":"no-results"},void 0,E.formatMessage(te.blankslateTitle)),(0,n.Z)(u.xv,{theme:"muted"},void 0,E.formatMessage(te.blankslateSubtitle))))},ne=(0,s.vU)({placeholder:{id:"chat_search.placeholder",defaultMessage:"Type a name"}}),ie=function(e){var t=e.isMainPage,s=void 0!==t&&t,d=(0,o.Z)(),f=(0,l.k6)(),h=(0,c.mx)(),v=h.changeScreen,g=h.searchInput,p=(0,a.useState)(!1),m=(0,i.Z)(p,2),y=m[0],b=m[1],k=(0,a.useState)(""),E=(0,i.Z)(k,2),T=E[0],_=E[1],w=T&&T.length>0,S=function(){L(),b(!1)},L=function(){return _("")};return(0,n.Z)(u.Kq,{space:4,className:"h-full"},void 0,(0,n.Z)(u.Kq,{className:"px-4"},void 0,(0,n.Z)(u.Ug,{alignItems:"center",space:2},void 0,y?(0,n.Z)(u.hU,{src:r(106),iconClassName:"h-5 w-5",onClick:S}):null,a.createElement(u.II,{ref:g,"data-testid":"search",type:"text",placeholder:d.formatMessage(ne.placeholder),value:T,onChange:function(e){return _(e.target.value)},onFocus:function(){return b(!0)},outerClassName:"mt-0 flex-grow",theme:"search",append:(0,n.Z)("button",{onClick:L},void 0,(0,n.Z)(u.JO,{src:r(w?90:156),className:"size-4 text-gray-700 dark:text-gray-600","aria-hidden":"true"}))}))),y?(0,n.Z)(re,{searchValue:T,onSelect:function(e){return _(e)},onFinish:S,isMainPage:s}):(0,n.Z)(A,{isMainPage:s,onClickChat:function(e){s?f.push("/chats/".concat(e.id)):v(c.fB.CHAT,e.id),S()}}))}},1069:function(e,t,r){"use strict";r.d(t,{Z:function(){return Re}});var n=r(1519),i=r(1470),a=r(1474),s=(r(13),r(12),r(52),r(31),r(20),r(11),r(16),r(0),r(34),r(18),r(1520)),o=r(1),l=r(1508),u=r(1509),c=r(21),d=r(170),f=r(23);r(8),r(4),r(9),r(2),r(6),r(14),r(15),r(5);var h=r(1468),v=r(1483),g=(r(30),r(50),r(48)),p=r(95),m=r(7),y=r(645),b=r(63);function k(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function E(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?k(Object(r),!0).forEach((function(t){(0,h.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):k(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var T=r(183),_=r(640),w=r(3),S=r(29),L=(r(17),r(10),r(26),r(1534)),R=r(79),A=r(1016),x=r(1013),I=r(1010),D=r(1521),C=r(1491),P=function(){return(0,n.Z)("div",{className:"relative isolate inline-flex size-24 items-center justify-center overflow-hidden rounded-lg bg-gray-200 p-4 ring-2 ring-inset ring-gray-200 dark:bg-primary-900 dark:ring-gray-800"},void 0,(0,n.Z)(w.$j,{withText:!1}))},M=r(767),O=r(311),N=r(1065),F=r(713),Z=function(e){e.className;var t,r=e.attachment,i=null===(t=r.pleroma)||void 0===t?void 0:t.mime_type;switch(r.type){case"image":case"gifv":return(0,n.Z)("img",{className:"pointer-events-none size-full object-cover",src:r.preview_url,alt:""});case"video":return(0,n.Z)("video",{className:"pointer-events-none size-full object-cover",src:r.preview_url,autoPlay:!0,playsInline:!0,controls:!1,muted:!0,loop:!0});default:return(0,n.Z)("div",{className:"pointer-events-none flex size-full items-center justify-center"},void 0,(0,n.Z)(w.JO,{className:"mx-auto my-12 size-16 text-gray-800 dark:text-gray-200",src:N.Z[i||""]||F}))}},U=function(e){var t=e.onClick;return(0,n.Z)("button",{type:"button",onClick:t,className:"flex size-5 items-center justify-center rounded-full bg-secondary-500 p-1"},void 0,(0,n.Z)(w.JO,{className:"size-3 text-white",src:r(90)}))},B=function(e){var t=e.attachment,r=e.onDelete,i=(0,m.TL)(),a="unknown"!==t.type;return(0,n.Z)("div",{className:"relative isolate inline-block size-24 overflow-hidden rounded-lg bg-gray-200 dark:bg-primary-900"},void 0,(0,n.Z)(O.Z,{hash:t.blurhash,className:"absolute inset-0 -z-10 size-full"}),(0,n.Z)("div",{className:"absolute right-[6px] top-[6px]"},void 0,(0,n.Z)(U,{onClick:r})),(0,n.Z)("button",{onClick:a?function(){i((0,L.h7)("MEDIA",{media:M.List.of(t),index:0}))}:void 0,className:(0,s.Z)("size-full",{"cursor-zoom-in":a,"cursor-default":!a})},void 0,(0,n.Z)(Z,{attachment:t})))},j=["attachments","onDeleteAttachment","uploadCount","uploadProgress"],G=o.forwardRef((function(e,t){var r=e.attachments,i=e.onDeleteAttachment,a=e.uploadCount,s=void 0===a?0:a,l=(e.uploadProgress,(0,C.Z)(e,j)),u=s>0,c=function(e){return function(){i&&i(e)}};return(0,n.Z)("div",{className:"\n        block\n        w-full\n        rounded-md border border-gray-400\n        bg-white text-gray-900\n        shadow-sm placeholder:text-gray-600\n        focus-within:border-primary-500\n        focus-within:ring-1 focus-within:ring-primary-500 dark:border-gray-800 dark:bg-gray-900\n        dark:text-gray-100 dark:ring-1 dark:ring-gray-800 dark:placeholder:text-gray-600 dark:focus-within:border-primary-500\n        dark:focus-within:ring-primary-500 sm:text-sm\n      "},void 0,(!(null==r||!r.length)||u)&&(0,n.Z)(w.Ug,{className:"-ml-2 -mt-2 p-3",wrap:!0},void 0,null==r?void 0:r.map((function(e,t){return(0,n.Z)("div",{className:"ml-2 mt-2 flex"},void 0,(0,n.Z)(B,{attachment:e,onDelete:c(t)},e.id))})),Array.from(Array(s)).map((function(){return(0,n.Z)("div",{className:"ml-2 mt-2 flex"},void 0,(0,n.Z)(P,{}))}))),o.createElement(w.gx,(0,D.Z)({ref:t,theme:"default",className:"!border-0 !ring-0"},l)))})),K=(0,l.vU)({placeholder:{id:"chat.input.placeholder",defaultMessage:"Type a message"},send:{id:"chat.actions.send",defaultMessage:"Send"},retry:{id:"chat.retry",defaultMessage:"Retry?"},blocked:{id:"chat_message_list.blocked",defaultMessage:"You blocked this user"},unblock:{id:"chat_composer.unblock",defaultMessage:"Unblock"},unblockMessage:{id:"chat_settings.unblock.message",defaultMessage:"Unblocking will allow this profile to direct message you and view your content."},unblockHeading:{id:"chat_settings.unblock.heading",defaultMessage:"Unblock @{acct}"},unblockConfirm:{id:"chat_settings.unblock.confirm",defaultMessage:"Unblock"}}),H={list:[],tokenStart:0,token:""},z=o.forwardRef((function(e,t){var i,s=e.onKeyDown,l=e.onChange,c=e.value,f=e.onSubmit,h=e.errorMessage,v=void 0!==h&&h,g=e.disabled,y=void 0!==g&&g,b=e.onSelectFile,k=e.resetFileKey,E=e.resetContentKey,T=e.onPaste,_=e.attachments,S=void 0===_?[]:_,D=e.onDeleteAttachment,C=e.uploadCount,P=void 0===C?0:C,M=e.uploadProgress,O=(0,u.Z)(),N=(0,m.TL)(),F=(0,m.hz)(),Z=(0,R.f_)(),U=(0,p.mx)().chat,B=(0,d.I)(null==U||null===(i=U.account)||void 0===i?void 0:i.id,{enabled:!0}).relationship,j=!(null==B||!B.blocked_by),z=!(null==B||!B.blocking),V=(0,m.CG)((function(e){return e.instance.getIn(["configuration","chats","max_characters"])})),q=(0,m.CG)((function(e){return e.instance.configuration.getIn(["chats","max_media_attachments"])})),W=(0,o.useState)(H),Y=(0,a.Z)(W,2),X=Y[0],Q=Y[1],$=X.list.length>0,J=P>0,ee=S.length>0,te=V&&(null==c?void 0:c.length)>V,re=y||J||te||0===c.length&&!ee,ne=V?V-(null==c?void 0:c.length):"";return z?(0,n.Z)("div",{className:"mt-auto p-6 shadow-3xl dark:border-t-2 dark:border-solid dark:border-gray-800"},void 0,(0,n.Z)(w.Kq,{space:3,alignItems:"center"},void 0,(0,n.Z)(w.xv,{align:"center",theme:"muted"},void 0,O.formatMessage(K.blocked)),(0,n.Z)(w.zx,{theme:"secondary",onClick:function(){U&&N((0,L.h7)("CONFIRM",{heading:O.formatMessage(K.unblockHeading,{acct:U.account.acct}),message:O.formatMessage(K.unblockMessage),confirm:O.formatMessage(K.unblockConfirm),confirmationTheme:"primary",onConfirm:function(){return Z.mutate({account:U.account})}}))}},void 0,O.formatMessage(K.unblock)))):j?null:(0,n.Z)("div",{className:"mt-auto px-4"},void 0,(0,n.Z)("div",{className:"h-5"}),(0,n.Z)(w.Ug,{alignItems:"stretch",justifyContent:"between",space:4},void 0,F.chatsMedia&&(0,n.Z)(w.Kq,{justifyContent:"end",alignItems:"center",className:"mb-1.5 w-10"},void 0,(0,n.Z)(A.Z,{onSelectFile:b,resetFileKey:k,iconClassName:"h-5 w-5",className:"text-primary-500",disabled:J||S.length>=q})),(0,n.Z)(w.Kq,{grow:!0},void 0,(0,n.Z)(w.hQ,{onSelect:function(e){l&&(l({target:{value:e}}),Q(H))}},void 0,o.createElement(w.gA,{key:E,as:G,autoFocus:!0,ref:t,placeholder:O.formatMessage(K.placeholder),onKeyDown:function(e){"Enter"===e.key&&!e.shiftKey&&$||s&&s(e)},value:c,onChange:function(e){var t=(0,I.q)(e.target.value,e.target.selectionStart,[":"]),r=(0,a.Z)(t,2),n=r[0],i=r[1];if(i&&n){var s=(0,x.Z)(i.replace(":",""),{maxResults:5});Q({list:s,token:i,tokenStart:n-1})}else Q(H);l&&l(e)},onPaste:T,isResizeable:!1,autoGrow:!0,maxRows:5,disabled:y,attachments:S,onDeleteAttachment:D,uploadCount:P,uploadProgress:M}),$?(0,n.Z)(w.SF,{},void 0,(0,n.Z)(w.Gk,{},void 0,X.list.map((function(e){return(0,n.Z)(w.O2,{value:(t=e,"".concat(c.slice(0,X.tokenStart)).concat(t.native," ").concat(c.slice(X.tokenStart+X.token.length)))},e.colons,(0,n.Z)("span",{},void 0,e.native),(0,n.Z)("span",{className:"ml-1"},void 0,e.colons));var t})))):null)),(0,n.Z)(w.Kq,{space:2,justifyContent:"end",alignItems:"center",className:"mb-1.5 w-10"},void 0,te?(0,n.Z)(w.xv,{size:"sm",theme:"danger"},void 0,ne):null,(0,n.Z)(w.hU,{src:r(1003),iconClassName:"h-5 w-5",className:"!text-primary-500",disabled:re,onClick:f}))),(0,n.Z)(w.Ug,{alignItems:"center",className:"h-5",space:1},void 0,v&&o.createElement(o.Fragment,null,(0,n.Z)(w.xv,{theme:"danger",size:"xs"},void 0,v),(0,n.Z)("button",{onClick:f,className:"flex hover:underline"},void 0,(0,n.Z)(w.xv,{theme:"primary",size:"xs",tag:"span"},void 0,O.formatMessage(K.retry))))))})),V=z,q=(r(36),r(35),r(1541)),W=r(1542),Y=r(212),X=function(e){var t=e.isMyMessage,r=void 0!==t&&t,i=(0,W.lv)(160,220);return(0,n.Z)(w.Kq,{"data-testid":"placeholder-chat-message",space:1,className:(0,s.Z)({"max-w-[85%] animate-pulse":!0,"ml-auto":r})},void 0,(0,n.Z)(w.Ug,{alignItems:"center",justifyContent:r?"end":"start"},void 0,(0,n.Z)("div",{className:(0,s.Z)({"text-ellipsis break-words relative rounded-md p-2":!0,"mr-2":r,"order-2 ml-2":!r})},void 0,(0,n.Z)("div",{style:{width:i,height:20},className:"rounded-full bg-primary-100 dark:bg-gray-800"})),(0,n.Z)("div",{className:(0,s.Z)({"order-1":!r})},void 0,(0,n.Z)(Y.Z,{size:34}))),(0,n.Z)(w.Ug,{alignItems:"center",space:2,className:(0,s.Z)({"ml-auto":r})},void 0,(0,n.Z)(w.xv,{theme:"muted",size:"xs",className:(0,s.Z)({"text-right":r,"order-2":!r})},void 0,(0,n.Z)("span",{style:{width:50,height:12},className:"block rounded-full bg-primary-100 dark:bg-gray-800"})),(0,n.Z)("div",{className:(0,s.Z)({"order-1":!r})},void 0,(0,n.Z)("div",{className:"ml-2 w-[34px]"}))))},Q=r(142),$=r(196),J=r(236),ee=r(456),te=r(172),re=r(227),ne=r(1008),ie=function(e){var t=e.emojiReaction,r=e.onAddReaction,i=e.onRemoveReaction,a=t.me;return(0,n.Z)("button",{type:"button",onClick:function(){a?i(t.name):r(t.name)},className:(0,s.Z)({"w-12 rounded-lg flex justify-between text-sm border items-center border-solid text-gray-700 dark:text-gray-600 px-2 py-1 space-x-1.5 transition-colors hover:bg-gray-200 dark:hover:bg-gray-800 whitespace-nowrap":!0,"border-primary-500 dark:border-primary-400":t.me,"border-gray-300 dark:border-gray-800":!t.me})},void 0,(0,n.Z)("span",{role:"img","aria-label":t.name},void 0,t.name),(0,n.Z)(w.xv,{tag:"span",weight:"medium",size:"sm"},void 0,t.count))},ae=r(902),se=function(e){var t=e.onOpen,r=e.onSelect,i=e.children,s=e.placement,l=(0,o.useState)(!1),u=(0,a.Z)(l,2),c=u[0],d=u[1],f=(0,o.useState)(null),h=(0,a.Z)(f,2),v=h[0],g=h[1];return(0,o.useEffect)((function(){t(c)}),[c]),(0,n.Z)(o.Fragment,{},void 0,o.cloneElement(i,{ref:g,onClick:function(){return d((function(e){return!e}))}}),c&&(0,n.Z)(w.h_,{},void 0,(0,n.Z)(ae.Z,{visible:c,referenceElement:v,onReact:function(e){r(e),d(!1)},onClose:function(){return d(!1)},offsetOptions:{mainAxis:12,crossAxis:-10},placement:s})))},oe=(0,l.vU)({copy:{id:"chats.actions.copy",defaultMessage:"Copy"},delete:{id:"chats.actions.delete",defaultMessage:"Delete for both"},deleteForMe:{id:"chats.actions.deleteForMe",defaultMessage:"Delete for me"},more:{id:"chats.actions.more",defaultMessage:"More"},report:{id:"chats.actions.report",defaultMessage:"Report"}}),le=function(e){var t,i,l,d,h=e.chat,v=e.chatMessage,g=(0,m.TL)(),p=(0,m.hz)(),y=(0,u.Z)(),b=(d=(0,m.h_)(),(0,c.Ap)({globalQueryKey:c.iP.chatMessages.global,action:c.bS.DELETE,schema:f.Fj,mutationFn:function(e){return d.delete("/api/v1/pleroma/chats/".concat(e.chatId,"/messages/").concat(e.id))}})),k=function(){var e=(0,m.h_)();return(0,c.Ap)({globalQueryKey:c.iP.chatMessages.global,action:c.bS.UPDATE,schema:f.jg,mutationFn:function(t){return e.post("/api/v1/pleroma/chats/".concat(t.chatId,"/messages/").concat(t.id,"/reactions"),{emoji:t.emoji})}})}(),E=function(){var e=(0,m.h_)();return(0,c.Ap)({globalQueryKey:c.iP.chatMessages.global,action:c.bS.DELETE,skipOnSuccess:!0,mutationFn:function(t){return e.delete("/api/v1/pleroma/chats/".concat(t.chatId,"/messages/").concat(t.id,"/reactions/").concat(t.emoji))},onSuccess:function(e,t){c.Eh.invalidateQueries(c.iP.chatMessages.forChat(t.chatId))}})}(),T=(0,m.CG)((function(e){return e.me})),_=(0,o.useState)(!1),S=(0,a.Z)(_,2),R=S[0],A=S[1],x=(0,o.useState)(!1),I=(0,a.Z)(x,2),D=I[0],C=I[1],P=function(){return b.mutate({id:v.id,chatId:h.id})},M=function(e){var t=e.content||"",r=e.pending,n=e.deleting;return r&&!n?function(e){return(0,Q.escape)(e).replace(/(?:\r\n|\r|\n)/g,"<br>")}(t):t}(v),O=null===(t=h.latest_read_message_by_account)||void 0===t||null===(i=t.find((function(e){return e.id===h.account.id})))||void 0===i?void 0:i.date,N=O?new Date(O):null,F=v.account_id===T,Z=F&&N&&N>=new Date(v.created_at),U=(0,o.useMemo)((function(){var e=document.createElement("div");return e.innerHTML=M,(0,ne.j)(e,3,!1)}),[]),B=(0,o.useMemo)((function(){return v.emoji_reactions?v.emoji_reactions.reduce((function(e,t,r){return(r%4==0?e.push([t]):e[e.length-1].push(t))&&e}),[]):[]}),[v.emoji_reactions]),j=function(e,t){g((0,L.h7)("MEDIA",{media:e,index:t}))},G=(0,o.useMemo)((function(){var e=[];return navigator.clipboard&&v.content&&e.push({text:y.formatMessage(oe.copy),action:function(){return function(e){if(navigator.clipboard){var t=(0,re.Cb)(e.content);navigator.clipboard.writeText(t)}}(v)},icon:r(1391)}),F?e.push({text:y.formatMessage(oe.delete),action:P,icon:r(162),destructive:!0}):(p.reportChats&&e.push({text:y.formatMessage(oe.report),action:function(){g((0,L.h7)("REPORT",{entityType:J.JG.CHAT_MESSAGE,account:h.account,chatMessage:v}))},icon:r(568)}),e.push({text:y.formatMessage(oe.deleteForMe),action:P,icon:r(162),destructive:!0})),e}),[v,h]);return(0,n.Z)("div",{className:(0,s.Z)({"group flex relative px-4 py-2 hover:bg-gray-200/40 dark:hover:bg-gray-800/40":!0,"bg-gray-200/40 dark:bg-gray-800/40":D||R,"justify-end":F,"flex-row-reverse":!F}),"data-testid":"chat-message"},void 0,(0,n.Z)("div",{className:(0,s.Z)({"p-1 flex items-start opacity-0 space-x-0.5 z-10 transition-opacity group-hover:opacity-100 focus:opacity-100 rounded-md":!0,"!opacity-100":D||R,"mr-auto":!F,"flex-row-reverse":F})},void 0,p.chatEmojiReactions&&(0,n.Z)(se,{onOpen:A,onSelect:function(e){return k.mutate({emoji:e,id:v.id,chatId:h.id})},placement:F?"top-start":"top-end"},void 0,(0,n.Z)("button",{title:y.formatMessage(oe.more),className:(0,s.Z)({"p-1.5 hover:bg-gray-200 dark:hover:bg-gray-800 rounded-md text-gray-600 dark:text-gray-600 hover:text-gray-700 dark:hover:text-gray-500 focus:text-gray-700 dark:focus:text-gray-500 focus:ring-0":!0,"!text-gray-700 dark:!text-gray-500":R})},void 0,(0,n.Z)(w.JO,{src:r(1392),className:"size-4.5"}))),G.length>0&&(0,n.Z)($.Z,{items:G,onOpen:function(){return C(!0)},onClose:function(){return C(!1)}},void 0,(0,n.Z)("button",{title:y.formatMessage(oe.more),className:(0,s.Z)({"p-1.5 hover:bg-gray-200 dark:hover:bg-gray-800 rounded-md text-gray-600 dark:text-gray-600 hover:text-gray-700 dark:hover:text-gray-500 focus:text-gray-700 dark:focus:text-gray-500 focus:ring-0":!0,"!text-gray-700 dark:!text-gray-500":D}),"data-testid":"chat-message-menu"},void 0,(0,n.Z)(w.JO,{src:r(197),className:"size-4"})))),(0,n.Z)(w.Kq,{space:1.5},void 0,(0,n.Z)(w.Ug,{alignItems:"center",justifyContent:F?"end":"start",className:(0,s.Z)({"opacity-50":v.pending})},void 0,(0,n.Z)(w.Kq,{space:.5,className:(0,s.Z)({"flex-1":!!v.media_attachments.length}),alignItems:F?"end":"start"},void 0,function(e){return e.media_attachments.length?(0,n.Z)(ee.Z,{fetchComponent:te.ew},void 0,(function(t){return(0,n.Z)(t,{className:(0,s.Z)({"rounded-br-sm":F&&M,"rounded-bl-sm":!F&&M}),media:e.media_attachments,onOpenMedia:j,visible:!0})})):null}(v),M&&(0,n.Z)(w.Ug,{alignItems:"bottom",className:"max-w-full"},void 0,o.createElement("div",{title:function(e){return y.formatDate(new Date(e.created_at),{hour12:!1,year:"numeric",month:"short",day:"2-digit",hour:"2-digit",minute:"2-digit"})}(v),className:(0,s.Z)({"text-ellipsis break-words relative rounded-md py-2 px-3 max-w-full space-y-2 [&_.mention]:underline [&_a]:underline":!0,"rounded-tr-sm":!!v.media_attachments.length&&F,"rounded-tl-sm":!!v.media_attachments.length&&!F,"[&_.mention]:text-primary-600 dark:[&_.mention]:text-accent-blue":!F,"[&_.mention]:text-white dark:[&_.mention]:text-white":F,"bg-primary-500 text-white":F,"bg-gray-200 dark:bg-gray-800 text-gray-900 dark:text-gray-100":!F,"!bg-transparent !p-0 emoji-lg":U,"[&_a]:text-primary-600 dark:[&_a]:text-accent-blue":!F}),ref:function(e){e&&e.querySelectorAll('a[rel="ugc"]').forEach((function(e){e.classList.add("chat-link"),e.setAttribute("rel","ugc nofollow noopener"),e.setAttribute("target","_blank")}))},tabIndex:0},(0,n.Z)(w.xv,{size:"sm",theme:"inherit",className:"break-word-nested [&_p+_p]:mt-2",dangerouslySetInnerHTML:{__html:M}}))))),null!==(l=v.emoji_reactions)&&void 0!==l&&l.length?(0,n.Z)("div",{className:(0,s.Z)({"space-y-1":!0,"ml-auto":F,"mr-auto":!F})},void 0,null==B?void 0:B.map((function(e,t){return(0,n.Z)(w.Ug,{className:(0,s.Z)({"flex items-center gap-1":!0,"flex-row-reverse":F})},t,e.map((function(e,t){return(0,n.Z)(ie,{emojiReaction:e,onAddReaction:function(e){return k.mutate({emoji:e,id:v.id,chatId:h.id})},onRemoveReaction:function(e){return E.mutate({emoji:e,id:v.id,chatId:h.id})}},t)})))}))):null,(0,n.Z)(w.Ug,{alignItems:"center",space:2,className:(0,s.Z)({"ml-auto":F})},void 0,(0,n.Z)("div",{className:(0,s.Z)({"text-right":F,"order-2":!F})},void 0,(0,n.Z)("span",{className:"flex items-center space-x-1.5"},void 0,(0,n.Z)(w.xv,{theme:"muted",size:"xs"},void 0,y.formatTime(v.created_at)),F&&p.chatsReadReceipts?o.createElement(o.Fragment,null,Z?(0,n.Z)("span",{className:"flex flex-col items-center justify-center rounded-full border border-solid border-primary-500 bg-primary-500 p-0.5 text-white dark:border-primary-400 dark:bg-primary-400 dark:text-primary-900"},void 0,(0,n.Z)(w.JO,{src:r(189),strokeWidth:3,className:"size-2.5"})):(0,n.Z)("span",{className:"flex flex-col items-center justify-center rounded-full border border-solid border-primary-500 bg-transparent p-0.5 text-primary-500 dark:border-primary-400 dark:text-primary-400"},void 0,(0,n.Z)(w.JO,{src:r(189),strokeWidth:3,className:"size-2.5"}))):null)))))},ue=r(1523),ce=r(1477),de=r(301),fe=r(561),he=r(192),ve=r(735),ge=(0,l.vU)({leaveChatHeading:{id:"chat_message_list_intro.leave_chat.heading",defaultMessage:"Leave Chat"},leaveChatMessage:{id:"chat_message_list_intro.leave_chat.message",defaultMessage:"Are you sure you want to leave this chat? Messages will be deleted for you and this chat will be removed from your inbox."},leaveChatConfirm:{id:"chat_message_list_intro.leave_chat.confirm",defaultMessage:"Leave Chat"},intro:{id:"chat_message_list_intro.intro",defaultMessage:"@{username} wants to {br} start a conversation with you."},accept:{id:"chat_message_list_intro.actions.accept",defaultMessage:"Accept"},leaveChat:{id:"chat_message_list_intro.actions.leave_chat",defaultMessage:"Leave chat"},report:{id:"chat_message_list_intro.actions.report",defaultMessage:"Report"},messageLifespan:{id:"chat_message_list_intro.actions.message_lifespan",defaultMessage:"Messages older than {day, plural, one {# day} other {# days}} are deleted."}}),pe=function(){var e,t=(0,m.TL)(),i=(0,u.Z)(),a=(0,m.hz)(),o=(0,ce.k6)(),l=(0,T.xt)(),c=(0,T.Ln)(),d=(0,p.mx)(),f=d.chat,h=d.isUsingMainChatPage,v=d.needsAcceptance;if(!f||!a.chatAcceptance)return null;var g=(null===(e=f.account.note)||void 0===e?void 0:e.replace("<p></p>",""))||"";return(0,n.Z)(w.Kq,{"data-testid":"chat-message-list-intro",justifyContent:"center",alignItems:"center",space:4,className:(0,s.Z)({"w-3/4 mx-auto":v,"py-6":!0})},void 0,(0,n.Z)(w.Kq,{alignItems:"center",space:4},void 0,(0,n.Z)(de.Z,{to:"/@".concat(f.account.acct)},void 0,(0,n.Z)("div",{className:"relative size-[75px]"},void 0,(0,n.Z)(w.qE,{src:f.account.avatar_static,size:75}),f.account.verified&&(0,n.Z)("div",{className:"absolute bottom-0 right-0"},void 0,(0,n.Z)(he.Z,{className:"!size-5 rounded-full bg-white ring-2 ring-white dark:bg-primary-900 dark:ring-gray-900"})))),(0,n.Z)(w.Kq,{alignItems:"center"},void 0,v?(0,n.Z)(w.xv,{align:"center"},void 0,i.formatMessage(ge.intro,{username:(0,n.Z)(w.xv,{tag:"span",weight:"semibold"},void 0,f.account.acct),br:(0,n.Z)("br",{})})):(0,n.Z)(w.Kq,{alignItems:"center",space:1,className:"mx-auto w-5/6"},void 0,(0,n.Z)(w.Kq,{alignItems:"center"},void 0,(0,n.Z)(de.Z,{to:"/@".concat(f.account.acct)},void 0,(0,n.Z)(w.xv,{tag:"span",weight:"bold",dangerouslySetInnerHTML:{__html:f.account.display_name}})),(0,n.Z)(de.Z,{to:"/@".concat(f.account.acct),theme:"muted",weight:"medium",size:"sm"},void 0,"@",f.account.acct)),(0,n.Z)(ve.Z,{account:f.account,textSize:"sm"}),g.length>0&&(0,n.Z)(fe.Z,{dangerouslySetInnerHTML:{__html:g},className:"mx-auto line-clamp-2 max-w-md text-center"}),(0,n.Z)(w.Ug,{alignItems:"center",space:1,className:"whitespace-nowrap"},void 0,(0,n.Z)(w.JO,{src:r(570),className:"size-4 text-gray-600 dark:text-gray-600"}),(0,n.Z)(w.xv,{size:"sm",theme:"muted",weight:"medium"},void 0,(0,n.Z)(ue.Z,{id:"account.member_since",defaultMessage:"Joined {date}",values:{date:i.formatDate(f.account.created_at,{month:"long",year:"numeric"})}})))))),v&&(0,n.Z)(w.Kq,{alignItems:"center",space:2,className:"mx-auto w-full max-w-xs"},void 0,(0,n.Z)(w.zx,{theme:"primary",block:!0,onClick:function(){return l.mutate({chatId:f.id})},disabled:l.isLoading},void 0,i.formatMessage(ge.accept)),(0,n.Z)(w.zx,{theme:"transparent",block:!0,onClick:function(){t((0,L.h7)("CONFIRM",{heading:i.formatMessage(ge.leaveChatHeading),message:i.formatMessage(ge.leaveChatMessage),confirm:i.formatMessage(ge.leaveChatConfirm),confirmationTheme:"primary",onConfirm:function(){c.mutate({chatId:f.id},{onSuccess:function(){h&&o.push("/chats")}})}}))},className:"!text-danger-600 dark:!text-accent-500"},void 0,i.formatMessage(ge.leaveChat))))},me=["context"],ye=["style","context"];function be(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ke(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?be(Object(r),!0).forEach((function(t){(0,h.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):be(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Ee=(0,l.vU)({today:{id:"chats.dividers.today",defaultMessage:"Today"},more:{id:"chats.actions.more",defaultMessage:"More"},delete:{id:"chats.actions.delete",defaultMessage:"Delete for both"},copy:{id:"chats.actions.copy",defaultMessage:"Copy"},report:{id:"chats.actions.report",defaultMessage:"Report"},deleteForMe:{id:"chats.actions.deleteForMe",defaultMessage:"Delete for me"},blockedBy:{id:"chat_message_list.blockedBy",defaultMessage:"You are blocked by"},networkFailureTitle:{id:"chat_message_list.network_failure.title",defaultMessage:"Whoops!"},networkFailureSubtitle:{id:"chat_message_list.network_failure.subtitle",defaultMessage:"We encountered a network failure."},networkFailureAction:{id:"chat_message_list.network_failure.action",defaultMessage:"Try again"}}),Te=o.forwardRef((function(e,t){e.context;var r=(0,C.Z)(e,me);return o.createElement("div",(0,D.Z)({ref:t},r,{className:"mb-2"}))})),_e=o.forwardRef((function(e,t){var r=e.style,n=(e.context,(0,C.Z)(e,ye));return o.createElement("div",(0,D.Z)({},n,{ref:t,style:ke(ke({},r),{},{scrollbarGutter:"stable"})}))})),we=function(e){var t,r,i=e.chat,s=(0,u.Z)(),l=(0,m.Tr)().account,h=null===(t=i.latest_read_message_by_account)||void 0===t||null===(r=t.find((function(e){return e.id===(null==l?void 0:l.id)})))||void 0===r?void 0:r.date,v=h?new Date(h):null,g=(0,o.useRef)(null),p=(0,o.useState)(9980),y=(0,a.Z)(p,2),b=y[0],k=y[1],E=(0,T.lv)(),_=function(e){var t=(0,d.I)(e.account.id,{enabled:!0}),r=t.relationship,n=t.isLoading,i=!(null==r||!r.blocked_by);return(0,c.lN)({queryKey:c.iP.chatMessages.forChat(e.id),endpoint:"/api/v1/pleroma/chats/".concat(e.id,"/messages"),schema:f.jg,staleTime:0,cacheTime:0,enabled:!n&&!i,formatResult:function(e){return e.reverse()}})}(i),S=_.entities,L=_.fetchNextPage,R=_.hasNextPage,A=_.isError,x=_.isFetching,I=_.isFetchingNextPage,C=_.isLoading,P=_.refetch,M=S||[],O=(0,m.CG)((function(e){return e.getIn(["relationships",i.account.id,"blocked_by"])})),N=S?S[S.length-1]:null;(0,o.useEffect)((function(){if(S){var e=1e4-S.length;k(e)}}),[N]);var F=S?S.reduce((function(e,t,r){var n=M[r-1];if(n)switch(function(e,t){var r=new Date(e.created_at).getDate(),n=new Date(t.created_at).getDate(),i=(new Date).getDate();return r!==n?n===i?"today":"date":null}(n,t)){case"today":e.push({type:"divider",text:s.formatMessage(Ee.today)});break;case"date":e.push({type:"divider",text:s.formatDate(new Date(t.created_at),{weekday:"short",hour:"numeric",minute:"2-digit",month:"short",day:"numeric"})})}return e.push(t),e}),[]):[],Z=(0,o.useMemo)((function(){return{initialTopMostItemIndex:F.length-1,firstItemIndex:Math.max(0,b)}}),[F.length,b]),U=(0,o.useCallback)((function(){return R&&!x&&L(),!1}),[b,R,x]);return(0,o.useEffect)((function(){var e=M[M.length-1];if(e){var t=e.id,r=e.pending,n=!!v&&v>=new Date(e.created_at);r||n||E.mutate({chatId:i.id,lastReadMessageId:t})}}),[M.length]),O?(0,n.Z)(w.Kq,{alignItems:"center",justifyContent:"center",className:"h-full grow"},void 0,(0,n.Z)(w.Kq,{alignItems:"center",space:2},void 0,(0,n.Z)(w.qE,{src:i.account.avatar,size:75}),(0,n.Z)(w.xv,{align:"center"},void 0,o.createElement(o.Fragment,null,(0,n.Z)(w.xv,{tag:"span"},void 0,s.formatMessage(Ee.blockedBy))," ",(0,n.Z)(w.xv,{tag:"span",theme:"primary"},void 0,"@",i.account.acct))))):A?(0,n.Z)(w.Kq,{alignItems:"center",justifyContent:"center",className:"h-full grow"},void 0,(0,n.Z)(w.Kq,{space:4},void 0,(0,n.Z)(w.Kq,{space:1},void 0,(0,n.Z)(w.xv,{size:"lg",weight:"bold",align:"center"},void 0,s.formatMessage(Ee.networkFailureTitle)),(0,n.Z)(w.xv,{theme:"muted",align:"center"},void 0,s.formatMessage(Ee.networkFailureSubtitle))),(0,n.Z)("div",{className:"mx-auto"},void 0,(0,n.Z)(w.zx,{theme:"primary",onClick:function(){return P()}},void 0,s.formatMessage(Ee.networkFailureAction))))):C?(0,n.Z)("div",{className:"flex grow flex-col justify-end pb-4"},void 0,(0,n.Z)("div",{className:"px-4"},void 0,(0,n.Z)(X,{isMyMessage:!0}),(0,n.Z)(X,{}),(0,n.Z)(X,{isMyMessage:!0}),(0,n.Z)(X,{isMyMessage:!0}),(0,n.Z)(X,{}))):(0,n.Z)("div",{className:"flex h-full grow flex-col space-y-6"},void 0,(0,n.Z)("div",{className:"flex grow flex-col justify-end"},void 0,o.createElement(q.OO,(0,D.Z)({ref:g,alignToBottom:!0},Z,{data:F,startReached:U,followOutput:"auto",itemContent:function(e,t){return"divider"===t.type?(r=e,a=t.text,(0,n.Z)(w.iz,{text:a,textSize:"xs"},r)):(0,n.Z)(le,{chat:i,chatMessage:t});var r,a},components:{List:Te,Scroller:_e,Header:function(){return R||I?(0,n.Z)(w.$j,{withText:!1}):R||C?null:(0,n.Z)(pe,{})}}}))))},Se=function(){return Math.floor(65536*Math.random())},Le=(0,l.vU)({failedToSend:{id:"chat.failed_to_send",defaultMessage:"Message failed to send."},uploadErrorLimit:{id:"upload_error.limit",defaultMessage:"File upload limit exceeded."}}),Re=function(e){var t=e.chat,r=e.inputRef,l=e.className,d=(0,u.Z)(),h=(0,T.xt)(),k=function(){var e=(0,m.h_)(),t=(0,g.GU)().me,r=(0,p.mx)().chat;return(0,c.Ap)({globalQueryKey:c.iP.chatMessages.global,action:c.bS.CREATE,retry:!1,mutationFn:function(t){return e.post("/api/v1/pleroma/chats/".concat(t.chatId,"/messages"),{content:t.content,media_ids:t.mediaIds})},onMutate:function(e){return(0,v.Z)(regeneratorRuntime.mark((function r(){var n,a,s;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,c.Eh.cancelQueries(c.iP.chatMessages.forChat(e.chatId));case 2:return n=e.content,a=c.Eh.getQueryData(c.iP.chatMessages.forChat(e.chatId)),s=String(Number(new Date)),c.Eh.setQueryData(c.iP.chatMessages.forChat(e.chatId),(function(r){var n=E({},r);return n.pages=n.pages.map((function(r,n){return 0===n?E(E({},r),{},{result:[].concat((0,i.Z)(r.result),[f.jg.parse({content:e.content,id:s,created_at:new Date,account_id:t.id,pending:!0,unread:!0,chat_id:e.chatId})])}):r})),n})),r.abrupt("return",{prevChatMessages:a,prevContent:n,pendingId:s});case 7:case"end":return r.stop()}}),r)})))()},onError:function(e,t,r){c.Eh.setQueryData(c.iP.chatMessages.forChat(t.chatId),r.prevChatMessages)},onSuccess:function(e,t,n){var i=E(E({},r),{},{last_message:e.data});(0,b.uH)(c.iP.chats.list(),i,(function(e,t){return e.id===t.id})),(0,b.uH)(c.iP.chatMessages.forChat(t.chatId),f.jg.parse(e.data),(function(e){return e.id===n.pendingId})),(0,y.vD)()}})}(),L=(0,m.CG)((function(e){return e.instance.configuration.getIn(["chats","max_media_attachments"])})),R=(0,_.g)(),A=(0,o.useState)(""),x=(0,a.Z)(A,2),I=x[0],D=x[1],C=(0,o.useState)([]),P=(0,a.Z)(C,2),M=P[0],O=P[1],N=(0,o.useState)(0),F=(0,a.Z)(N,2),Z=F[0],U=F[1],B=(0,o.useState)(0),j=(0,a.Z)(B,2),G=j[0],K=j[1],H=(0,o.useState)(Se()),z=(0,a.Z)(H,2),q=z[0],W=z[1],Y=(0,o.useState)(Se()),X=(0,a.Z)(Y,2),Q=X[0],$=X[1],J=(0,o.useState)(),ee=(0,a.Z)(J,2),te=ee[0],re=ee[1],ne=0===I.length&&0===M.length,ie=function(){ne||k.isLoading||(k.mutate({chatId:t.id,content:I,mediaIds:M.map((function(e){return e.id}))},{onSuccess:function(){re(void 0)},onError:function(e,t,r){var n,i,a=null===(n=e.response)||void 0===n||null===(i=n.data)||void 0===i?void 0:i.error;re(a||d.formatMessage(Le.failedToSend)),D(r.prevContent)}}),null!=r&&r.current&&function(e){var t,r=null===(t=Object.getOwnPropertyDescriptor(window.HTMLTextAreaElement.prototype,"value"))||void 0===t?void 0:t.set;if(r){r.call(e,"");var n=new Event("input",{bubbles:!0});e.dispatchEvent(n)}}(r.current),D(""),O([]),U(0),K(0),$(Se()),W(Se()),t.accepted||h.mutate({chatId:t.id}))},ae=function(e){var t=e.loaded,r=e.total;K(t/(void 0===r?0:r))},se=function(e){if(e.length+M.length>L)S.Z.error(Le.uploadErrorLimit);else{U(e.length);var t=Array.from(e).map((function(e,t){var r=new FormData;return r.append("file",e),R.mutateAsync({file:r,id:t,onSuccess:function(e){K(0),O((function(t){return[].concat((0,i.Z)(t),[e.data])}))},onUploadProgress:ae})}));Promise.all(t).then((function(){U(0)})).catch((function(){U(0)}))}};return(0,o.useEffect)((function(){null!=r&&r.current&&r.current.focus()}),[t.id,null==r?void 0:r.current]),(0,n.Z)(w.Kq,{className:(0,s.Z)("flex grow overflow-hidden",l)},void 0,(0,n.Z)("div",{className:"flex h-full grow justify-center overflow-hidden"},void 0,(0,n.Z)(we,{chat:t})),"channel"!==t.chat_type&&o.createElement(V,{ref:r,onKeyDown:function(e){"Enter"!==e.key||e.shiftKey||(e.preventDefault(),ie())},value:I,onChange:function(e){D(e.target.value)},onSubmit:ie,errorMessage:te,onSelectFile:se,resetFileKey:Q,resetContentKey:q,onPaste:function(e){ne&&e.clipboardData&&1===e.clipboardData.files.length&&se(e.clipboardData.files)},attachments:M,onDeleteAttachment:function(e){var t=(0,i.Z)(M);t.splice(e,1),O(t),$(Se())},uploadCount:Z,uploadProgress:G}))}},1174:function(e,t,r){"use strict";var n=r(1519),i=(r(12),r(17),r(1508)),a=r(1509),s=r(1522),o=r(79),l=r(405),u=r(192),c=r(3),d=r(403),f=(0,i.vU)({heading:{id:"feed_suggestions.heading",defaultMessage:"Suggested Profiles"},viewAll:{id:"feed_suggestions.view_all",defaultMessage:"View all"}}),h=function(e){var t=e.accountId,r=(0,o.mA)(t,{refetch:!0}).account;return r?(0,n.Z)(c.Kq,{space:3,className:"w-52 shrink-0 rounded-md border border-solid border-gray-300 p-4 dark:border-gray-800 md:w-full md:shrink md:border-transparent md:p-0 dark:md:border-transparent"},void 0,(0,n.Z)(s.rU,{to:"/@".concat(r.acct),title:r.acct},void 0,(0,n.Z)(c.Kq,{space:3,className:"mx-auto w-40 md:w-24"},void 0,(0,n.Z)("img",{src:r.avatar,className:"mx-auto block size-16 min-w-[56px] rounded-full object-cover",alt:r.acct}),(0,n.Z)(c.Kq,{},void 0,(0,n.Z)(c.Ug,{alignItems:"center",justifyContent:"center",space:1},void 0,(0,n.Z)(c.xv,{weight:"semibold",dangerouslySetInnerHTML:{__html:r.display_name_html},truncate:!0,align:"center",size:"sm",className:"max-w-[95%]"}),r.verified&&(0,n.Z)(u.Z,{})),(0,n.Z)(c.xv,{theme:"muted",align:"center",size:"sm",truncate:!0},void 0,"@",r.acct)))),(0,n.Z)("div",{className:"text-center"},void 0,(0,n.Z)(d.Z,{account:r,buttonSize:"sm"}))):null};t.Z=function(){var e=(0,a.Z)(),t=(0,l.fB)(),r=t.suggestions;return t.isLoading||0!==r.length?(0,n.Z)("div",{className:"space-y-6 p-4"},void 0,(0,n.Z)(c.Ug,{justifyContent:"between",alignItems:"center"},void 0,(0,n.Z)(c.ll,{title:e.formatMessage(f.heading)}),(0,n.Z)(s.rU,{to:"/suggestions",className:"whitespace-nowrap text-primary-600 hover:underline dark:text-accent-blue"},void 0,e.formatMessage(f.viewAll))),(0,n.Z)(c.eW,{},void 0,(0,n.Z)(c.Ug,{space:4,alignItems:"center",className:"overflow-x-auto md:space-x-0 lg:overflow-x-hidden"},void 0,r.slice(0,4).map((function(e){return(0,n.Z)(h,{accountId:e.account_id},e.account_id)}))))):null}},267:function(e,t,r){"use strict";var n=r(1519),i=r(1),a=r(1523),s=r(1522),o=r(235),l=r(3),u=r(723),c=r(105);t.Z=function(e){var t=e.group,d=e.withJoinAction,f=void 0===d||d;return(0,n.Z)(l.Ug,{alignItems:"center",justifyContent:"between","data-testid":"group-list-item"},void 0,(0,n.Z)(s.rU,{to:"/group/".concat(t.slug),className:"overflow-hidden"},t.id,(0,n.Z)(l.Ug,{alignItems:"center",space:3},void 0,(0,n.Z)(o.Z,{group:t,size:42}),(0,n.Z)(l.Kq,{className:"overflow-hidden",space:.5},void 0,(0,n.Z)(l.xv,{weight:"semibold",size:"sm",dangerouslySetInnerHTML:{__html:t.display_name_html},truncate:!0}),(0,n.Z)(l.Ug,{className:"text-gray-700 dark:text-gray-600",space:1,alignItems:"center"},void 0,(0,n.Z)(l.JO,{className:"size-4.5",src:t.locked?r(262):r(708)}),(0,n.Z)(l.xv,{theme:"inherit",tag:"span",size:"sm"},void 0,t.locked?(0,n.Z)(a.Z,{id:"group.privacy.locked",defaultMessage:"Private"}):(0,n.Z)(a.Z,{id:"group.privacy.public",defaultMessage:"Public"})),void 0!==t.members_count&&i.createElement(i.Fragment,null,(0,n.Z)("span",{},void 0,"•"),(0,n.Z)(l.xv,{theme:"inherit",tag:"span",size:"sm"},void 0,(0,c.w8)(t.members_count)," ",(0,n.Z)(a.Z,{id:"groups.discover.search.results.member_count",defaultMessage:"{members, plural, one {member} other {members}}",values:{members:t.members_count}}))))))),f&&(0,n.Z)(u.Z,{group:t,size:"sm"}))}},316:function(e,t,r){"use strict";var n=r(1519),i=r(1),a=r(3),s=r(212),o=r(574),l=function(){return(0,n.Z)(a.Ug,{space:3,alignItems:"center"},void 0,(0,n.Z)("div",{className:"shrink-0"},void 0,(0,n.Z)(s.Z,{size:42})),(0,n.Z)("div",{className:"min-w-0 flex-1"},void 0,(0,n.Z)(o.Z,{minLength:3,maxLength:25})))};t.Z=i.memo(l)},212:function(e,t,r){"use strict";var n=r(1519),i=r(1520),a=r(1),s=r(3);t.Z=function(e){var t=e.size,r=e.withText,o=void 0!==r&&r,l=e.className,u=a.useMemo((function(){return t?{width:"".concat(t,"px"),height:"".concat(t,"px")}:{}}),[t]);return(0,n.Z)(s.Kq,{space:2,className:(0,i.Z)("animate-pulse text-center",l)},void 0,(0,n.Z)("div",{className:"mx-auto block rounded-full bg-primary-100 dark:bg-gray-800",style:u}),o&&(0,n.Z)("div",{style:{width:t,height:15},className:"mx-auto rounded-full bg-primary-100 dark:bg-gray-800"}))}},574:function(e,t,r){"use strict";var n=r(1519),i=r(1),a=r(1542),s=function(e){var t=e.minLength,r=e.maxLength,i=e.withSuffix,s=void 0===i||i,o=(0,a.lv)(r,t),l=(0,a.lv)(r,t);return(0,n.Z)("div",{className:"flex flex-col text-primary-100 dark:text-gray-800"},void 0,(0,n.Z)("p",{},void 0,(0,a._4)(o)),s&&(0,n.Z)("p",{},void 0,(0,a._4)(l)))};t.Z=i.memo(s)},464:function(e,t,r){"use strict";var n=r(1519),i=r(3),a=r(1542);t.Z=function(e){var t=e.withJoinAction,r=void 0===t||t,s=(0,a.lv)(12,20);return(0,n.Z)(i.Ug,{alignItems:"center",justifyContent:"between",className:"animate-pulse"},void 0,(0,n.Z)(i.Ug,{alignItems:"center",space:2,className:"overflow-hidden"},void 0,(0,n.Z)("div",{className:"size-11 shrink-0 rounded-full bg-primary-100 dark:bg-gray-800 dark:ring-primary-900"}),(0,n.Z)(i.Kq,{className:"text-primary-100 dark:text-gray-800"},void 0,(0,n.Z)(i.xv,{theme:"inherit",weight:"bold"},void 0,(0,a._4)(s)),(0,n.Z)(i.Ug,{space:1,alignItems:"center"},void 0,(0,n.Z)(i.xv,{theme:"inherit",tag:"span",size:"sm",weight:"medium"},void 0,(0,a._4)(6)),(0,n.Z)("span",{},void 0,"•"),(0,n.Z)(i.xv,{theme:"inherit",tag:"span",size:"sm",weight:"medium"},void 0,(0,a._4)(6))))),r&&(0,n.Z)("div",{className:"h-10 w-36 rounded-full bg-primary-100 dark:bg-gray-800"}))}},1578:function(e,t,r){"use strict";var n=r(1519),i=r(1542);t.Z=function(e){var t=e.minLength,r=e.maxLength,a=(0,i.lv)(r,t);return(0,n.Z)("div",{className:"flex flex-col text-primary-100 dark:text-gray-800"},void 0,(0,n.Z)("p",{className:"break-words"},void 0,(0,i._4)(a)))}},266:function(e,t,r){"use strict";var n=r(1519),i=r(1520),a=r(1),s=r(3),o=r(212),l=r(574),u=r(1578),c=function(e){var t=e.variant;return(0,n.Z)("div",{className:(0,i.Z)({"status-placeholder":!0,"p-4":"slim"!==t,"py-4":"slim"===t})},void 0,(0,n.Z)("div",{className:"w-full animate-pulse overflow-hidden"},void 0,(0,n.Z)("div",{},void 0,(0,n.Z)(s.Ug,{space:3,alignItems:"center"},void 0,(0,n.Z)("div",{className:"shrink-0"},void 0,(0,n.Z)(o.Z,{size:42})),(0,n.Z)("div",{className:"min-w-0 flex-1"},void 0,(0,n.Z)(l.Z,{minLength:3,maxLength:25})))),(0,n.Z)("div",{className:"status__content-wrapper mt-4"},void 0,(0,n.Z)(u.Z,{minLength:5,maxLength:120}))))};t.Z=a.memo(c)},401:function(e,t,r){"use strict";var n=r(1519),i=r(1520),a=r(3);t.Z=function(e){var t=e.title,r=e.hideArrow,s=e.backHref,o=void 0===s?"/settings":s;return(0,n.Z)(a.Kq,{space:6,className:"p-4 lg:pt-7"},void 0,(0,n.Z)(a.Ol,{backHref:o,className:(0,i.Z)({"[&>a]:lg:hidden [&>h1]:lg:!m-0":r})},void 0,(0,n.Z)(a.ll,{title:t})))}},1064:function(e,t,r){"use strict";r.d(t,{K:function(){return l}});var n=r(1519),i=(r(54),r(1)),a=r(1509),s=r(353),o=r(3),l=i.forwardRef((function(e,t){var l=e.sort,u=e.onChange,c=e.placement,d=(0,a.Z)(),f={trending:r(1189),newest:r(1190),oldest:r(1191),controversial:r(1192)},h={trending:{id:"sort.trending",defaultMessage:"Trending"},newest:{id:"sort.newest",defaultMessage:"Newest"},oldest:{id:"sort.oldest",defaultMessage:"Oldest"},controversial:{id:"sort.controversial",defaultMessage:"Controversial"}},v=[{text:d.formatMessage(h.trending),icon:f.trending,action:function(){return u("trending")}},{text:d.formatMessage(h.newest),icon:f.newest,action:function(){return u("newest")}},{text:d.formatMessage(h.oldest),icon:f.oldest,action:function(){return u("oldest")}},{text:d.formatMessage(h.controversial),icon:f.controversial,action:function(){return u("controversial")}}];return i.createElement("div",{ref:t},(0,n.Z)(s.Z,{items:v,placement:c},void 0,(0,n.Z)(o.zx,{size:"sm",theme:"tertiary",icon:f[l],iconClassName:"h-4 w-4 text-primary-500 dark:text-primary-400"},void 0,(0,n.Z)(o.Ug,{space:1.5,alignItems:"center"},void 0,(0,n.Z)("span",{},void 0,d.formatMessage(h[l])),(0,n.Z)(o.JO,{className:"size-4",src:r(230)})))))}))},1068:function(e,t,r){"use strict";r.d(t,{Z:function(){return te}});var n=r(1470),i=r(1469),a=r(1519),s=r(1474),o=(r(54),r(12),r(2),r(27),r(35),r(0),r(86),r(818),r(1520)),l=r(767),u=r(140),c=r.n(u),d=r(1),f=r(373),h=r(1509),v=r(1523),g=r(1477),p=r(1534),m=r(145),y=r(310),b=r(75),k=r(650),E=r(76),T=r(643),_=r(1216),w=r(3),S=r(167),L=r(55),R=r(462),A=r(266),x=r(177),I=r(7),D=r(233),C=r(312),P=r(1508),M=r(1522),O=r(155),N=r(359),F=r(560),Z=r(636),U=r(707),B=r(709),j=r(1021),G=r(1049),K=r(1042),H=(r(11),r(105)),z=function(e){var t=e.count,r=e.onClick,n=e.children,i=(0,I.hz)();return(0,a.Z)("button",{type:"button",onClick:r,className:(0,o.Z)({"text-gray-600 dark:text-gray-700":!0,"hover:underline":i.exposableReactions,"cursor-default":!i.exposableReactions})},void 0,(0,a.Z)(w.Ug,{space:1,alignItems:"center"},void 0,(0,a.Z)(w.xv,{weight:"bold"},void 0,(0,H.w8)(t)),(0,a.Z)(w.xv,{tag:"div",theme:"muted"},void 0,n)))},V=function(e){var t=e.status,r=(0,g.k6)(),n=(0,I.CG)((function(e){return e.me})),s=(0,I.TL)(),o=(0,I.hz)(),l=t.account;if(!l||"object"!==(0,i.Z)(l))return null;var u=function(){s((0,p.h7)("UNAUTHORIZED"))};return(0,a.Z)(w.Ug,{space:3},void 0,t.reblogs_count?(0,a.Z)(z,{count:t.reblogs_count,onClick:function(e){var r,i;e.preventDefault(),n?(r=l.acct,i=t.id,s((0,p.h7)("REBLOGS",{username:r,statusId:i}))):u()}},void 0,(0,a.Z)(v.Z,{id:"status.interactions.reblogs",defaultMessage:"{count, plural, one {Repost} other {Reposts}}",values:{count:t.reblogs_count}})):null,t.quotes_count?(0,a.Z)(z,{count:t.quotes_count,onClick:function(e){e.preventDefault(),r.push("/@".concat(t.account.acct,"/posts/").concat(t.id,"/quotes"))}},void 0,(0,a.Z)(v.Z,{id:"status.interactions.quotes",defaultMessage:"{count, plural, one {Quote} other {Quotes}}",values:{count:t.quotes_count}})):null,t.favourites_count?(0,a.Z)(z,{count:t.favourites_count,onClick:o.exposableReactions?function(e){var r,i;e.preventDefault(),n?(r=l.acct,i=t.id,s((0,p.h7)("FAVOURITES",{username:r,statusId:i}))):u()}:void 0},void 0,(0,a.Z)(v.Z,{id:"status.interactions.favourites",defaultMessage:"{count, plural, one {Like} other {Likes}}",values:{count:t.favourites_count}})):null)},q=function(e){var t=e.status,n=e.onToggleMediaVisibility,o=e.showMedia,l=e.withMedia,u=void 0===l||l,c=(0,d.useRef)(null),f=(0,d.useRef)(null),h=(0,d.useState)(208),g=(0,s.Z)(h,2),p=g[0],m=g[1];(0,d.useEffect)((function(){f.current&&m(f.current.getBoundingClientRect().height)}),[f.current]);var y=(0,C.d4)(t);if(!y)return null;var b=y.account;if(!b||"object"!==(0,i.Z)(b))return null;var k,E="self"===y.visibility,T=y.sensitive,_=null;if(y.quote){var S,L,R="string"==typeof y.quote?y.quote:null===(S=y.quote)||void 0===S?void 0:S.id;k=!1===(null===(L=y.pleroma)||void 0===L?void 0:L.quote_visible)?(0,a.Z)("div",{className:"quoted-actualStatus-tombstone"},void 0,(0,a.Z)("p",{},void 0,(0,a.Z)(v.Z,{id:"actualStatuses.quote_tombstone",defaultMessage:"Post is unavailable."}))):(0,a.Z)(K.Z,{statusId:R})}return"direct"===y.visibility?_=(0,a.Z)(w.JO,{className:"size-4 text-gray-700 dark:text-gray-600",src:r(1047)}):"private"===y.visibility&&(_=(0,a.Z)(w.JO,{className:"size-4 text-gray-700 dark:text-gray-600",src:r(262)})),d.createElement(w.Kq,{space:2,ref:c,className:"detailed-actualStatus",tabIndex:-1},function(){if(t.group)return(0,a.Z)("div",{className:"mb-4"},void 0,(0,a.Z)(G.Z,{avatarSize:42,icon:(0,a.Z)(w.JO,{src:r(408),className:"size-4 text-gray-700 dark:text-gray-600"}),text:(0,a.Z)(v.Z,{id:"status.group",defaultMessage:"Posted in {group}",values:{group:(0,a.Z)(M.rU,{to:"/group/".concat(t.group.slug),className:"text-gray-700 hover:text-primary-600 hover:underline dark:text-gray-600 dark:hover:text-accent-blue"},void 0,(0,a.Z)("bdi",{className:"truncate"},void 0,(0,a.Z)("span",{dangerouslySetInnerHTML:{__html:t.group.display_name_html}})))}})}))}(),(0,a.Z)("div",{},void 0,t.group?(0,a.Z)(U.Z,{status:y,group:y.group,account:y.account,avatarSize:42}):(0,a.Z)(O.Z,{account:b,avatarSize:42,hideActions:!0,approvalStatus:y.approval_status},b.id)),(0,a.Z)(Z.Z,{status:y}),(0,a.Z)(w.Kq,{className:"relative z-0",style:{minHeight:E||T?Math.max(p,208)+12:void 0}},void 0,(E||T)&&d.createElement(B.Z,{status:t,visible:o,onToggleVisibility:n,ref:f}),(0,a.Z)(w.Kq,{space:4},void 0,(0,a.Z)(N.Z,{status:y,textSize:"lg"}),(k||y.card||y.media_attachments.length>0&&u)&&(0,a.Z)(w.Kq,{space:4},void 0,u&&(0,a.Z)(F.Z,{status:y,showMedia:o,onToggleVisibility:n}),k),y.game&&(0,a.Z)(j.Z,{game:y.game}))),(0,a.Z)(w.Ug,{justifyContent:"between",alignItems:"center",wrap:!0},void 0,(0,a.Z)(V,{status:y}),(0,a.Z)(w.Ug,{space:1,alignItems:"center"},void 0,_,(0,a.Z)("span",{},void 0,(0,a.Z)("a",{href:y.url,target:"_blank",rel:"noopener",className:"hover:underline"},void 0,(0,a.Z)(w.xv,{tag:"span",theme:"muted",size:"sm"},void 0,(0,a.Z)(P.Ji,{value:new Date(y.created_at),hour12:!0,year:"numeric",month:"short",day:"2-digit",hour:"numeric",minute:"2-digit"})))))))},W=r(1064),Y=r(569),X=r(457),Q=function(){var e=(0,I.fz)(),t=(0,I.Dn)().displayCta,r=(0,I.pO)().isOpen,n=(0,L.v)().openModal;return t?(0,a.Z)(w.Zb,{className:"space-y-6 px-6 py-12 text-center",variant:"rounded"},void 0,(0,a.Z)(w.Kq,{},void 0,(0,a.Z)(w.ll,{title:(0,a.Z)(v.Z,{id:"thread_login.title",defaultMessage:"Continue the conversation"})}),(0,a.Z)(w.xv,{},void 0,(0,a.Z)(v.Z,{id:"thread_login.message",defaultMessage:"Join {siteTitle} to get the full story and details.",values:{siteTitle:e.title}}))),(0,a.Z)(w.Kq,{space:4,className:"mx-auto max-w-xs"},void 0,(0,a.Z)(w.zx,{theme:"tertiary",onClick:function(){return n((0,a.Z)(X.Z,{}))},block:!0},void 0,(0,a.Z)(v.Z,{id:"thread_login.login",defaultMessage:"Log in"})),r&&(0,a.Z)(w.zx,{onClick:function(){return n((0,a.Z)(Y.Z,{}))},block:!0},void 0,(0,a.Z)(v.Z,{id:"thread_login.signup",defaultMessage:"Sign up"})))):null},$=r(1521),J=r(238),ee=function(e){var t=e.id,r=e.isConnectedBottom,n=void 0!==r&&r,i=(0,b.$z)(t).isLoading;return(0,a.Z)("div",{className:"thread__status"},void 0,n?(0,a.Z)("div",{className:(0,o.Z)("absolute left-5 z-[1] hidden w-0.5 bg-gray-200 dark:bg-gray-800 rtl:left-auto rtl:right-5",{"!block top-[calc(12px+42px)] h-[calc(100%-42px-8px-1rem)]":n})}):null,i?(0,a.Z)(A.Z,{variant:"default"}):d.createElement(J.Z,(0,$.Z)({},e,{showGroup:!1})))},te=function(e){var t,r=e.itemClassName,u=e.status,P=e.useWindowScroll,M=void 0===P||P,O=e.withMedia,N=void 0===O||O,F=(0,I.TL)(),Z=(0,g.k6)(),U=(0,h.Z)(),B=(0,I.Tr)().account,j=(0,I.rV)(),G=(0,L.v)().openModal,K=(0,S.x)(u.id).updateComposer,H=j.get("displayMedia"),z="self"===(null==u?void 0:u.visibility),V=(0,R.i)(),Y=V.sort,X=V.setSort,$=V.currentElement,J=V.isSortButtonVisible,te=(0,y.N)().entities,re=(0,b.CW)(),ne=(0,b.$R)(),ie=(0,b.dj)(),ae=(0,b.QR)(),se=(0,b.ws)(u.id),oe=se.entities,le=se.isFetching,ue=se.fetchPreviousPage,ce=(0,b.e4)(u.id,Y),de=ce.entities,fe=ce.isFetching,he=ce.hasNextPage,ve=ce.fetchNextPage,ge=oe.map((function(e){return e.id})),pe=de.map((function(e){return e.id})),me=(0,d.useRef)(0),ye=(0,d.useState)(!(null===(t=u.tombstone)||void 0===t||!t.reason)),be=(0,s.Z)(ye,2),ke=be[0],Ee=be[1],Te=(0,d.useState)("self"!==(null==u?void 0:u.visibility)&&(0,C.qI)(u,H)),_e=(0,s.Z)(Te,2),we=_e[0],Se=_e[1],Le=(0,d.useRef)(null),Re=(0,d.useRef)(null),Ae=(0,d.useRef)(null),xe=(0,d.useCallback)(c()((function(){le||ue()}),300,{leading:!0}),[le]),Ie=(0,d.useCallback)(c()((function(){fe||ve()}),300,{leading:!0}),[fe]),De=function(){Se(!we)},Ce=function(e){return ie.mutate({id:e.id})},Pe=function(){Oe(u.id)},Me=function(){Ne(u.id)},Oe=function(e){if(e===(null==u?void 0:u.id))Fe(ge.length-1);else{var t=(0,l.List)(ge).indexOf(e);-1===t?(t=(0,l.List)(pe).indexOf(e),Fe(ge.length+t)):Fe(t-1)}},Ne=function(e){if(e===(null==u?void 0:u.id))Fe(ge.length+1);else{var t=(0,l.List)(ge).indexOf(e);-1===t?(t=(0,l.List)(pe).indexOf(e),Fe(ge.length+t+2)):Fe(t+1)}},Fe=function(e){var t;null===(t=Ae.current)||void 0===t||t.scrollIntoView({index:e,behavior:"smooth",done:function(){var t=document.querySelector('#thread [data-index="'.concat(e,'"] .focusable'));t&&t.focus()}})},Ze=function(e,t){return(0,a.Z)(ee,{id:e.id,focusedStatusId:u.id,onMoveUp:Oe,onMoveDown:Ne,contextType:"thread",isConnectedBottom:(null==t?void 0:t.in_reply_to_id)===e.id||(null==u?void 0:u.in_reply_to_id)===e.id},e.id)},Ue=function(e){return e.reduce((function(t,r,n){var i=r.id;if(i.endsWith("-ad")){if(!te||0===te.length)return t;var s=te[me.current%te.length];t.push(function(e,t){return(0,a.Z)("div",{"data-type":"ad"},"ad-".concat(t),(0,a.Z)(k.Z,{ad:e,isThreadStatus:!0}))}(s,n)),me.current++}else i.endsWith("-tombstone")?t.push(function(e){return(0,a.Z)("div",{className:"py-4 pb-8"},void 0,(0,a.Z)(_.Z,{id:e,onMoveUp:Oe,onMoveDown:Ne},e))}(i)):t.push(Ze(r,e[n+1]));return t}),[])};(0,d.useEffect)((function(){Se("self"!==(null==u?void 0:u.visibility)&&(0,C.qI)(u,H))}),[u.id]),(0,d.useEffect)((function(){var e;null===(e=Ae.current)||void 0===e||e.scrollToIndex({index:ge.length,offset:-146}),setImmediate((function(){var e,t;return null===(e=Re.current)||void 0===e||null===(t=e.querySelector(".detailed-actualStatus"))||void 0===t?void 0:t.focus()}))}),[u.id,ge.length]);var Be,je=ge.length>0,Ge=pe.length>0,Ke={moveUp:Pe,moveDown:Me,reply:function(e){null==e||e.preventDefault(),K({inReplyTo:u.mentions,inReplyToStatusId:u.id}),G((0,a.Z)(x.default,{}))},favourite:function(){!function(e){e.favourited?ne.mutate({id:e.id}):re.mutate({id:e.id})}(u)},boost:function(){!function(e,t){F((function(t,r){var n=(0,m.Gw)(r()).get("boostModal");e.reblogged?ae.mutate({id:e.id}):n?F((0,p.h7)("BOOST",{status:e,onReblog:Ce})):Ce(e)}))}(u)},mention:function(e){null==e||e.preventDefault();var t=u.account;t&&"object"===(0,i.Z)(t)&&(G((0,a.Z)(x.default,{})),K({text:"@".concat(t.username," ")}))},openProfile:function(){Z.push("/@".concat(u.account.acct))},toggleSensitive:function(){De()},openMedia:function(e){var t;null==e||e.preventDefault();var r=null==u?void 0:u.media_attachments,n=null==u||null===(t=u.media_attachments)||void 0===t?void 0:t[0];n&&("video"===n.type?F((0,p.h7)("VIDEO",{media:n,status:u})):F((0,p.h7)("MEDIA",{media:r,index:0,status:u})))},react:function(){if(Re.current){var e=Re.current.querySelector(".emoji-react-selector .emoji-react-selector__emoji");null==e||e.focus()}}},He=(0,a.Z)(w.Kq,{space:4,className:(0,o.Z)({"pb-4":Ge})},u.id,ke?(0,a.Z)(_.Z,{id:u.id,onMoveUp:function(){return Pe?Pe():null},onMoveDown:function(){return Me?Me():null},type:u.tombstone.reason,action:"muted"===u.tombstone.reason?(0,a.Z)(w.zx,{type:"button",theme:"link",className:"!p-0",onClick:function(){return Ee(!1)}},void 0,(0,a.Z)(v.Z,{id:"common.view",defaultMessage:"View"})):void 0}):(0,a.Z)(f.HotKeys,{handlers:Ke},void 0,d.createElement("div",{ref:Re,className:"focusable relative space-y-4",tabIndex:0,"aria-label":(0,C.XA)(U,(0,D.fb)(u))},(0,a.Z)(q,{status:u,showMedia:we,withMedia:N,onToggleMediaVisibility:De}),z?null:(0,a.Z)(w.Kq,{space:2},void 0,(0,a.Z)("hr",{className:"-mx-4 max-w-[100vw] border-t border-gray-300 dark:border-gray-800"}),(0,a.Z)(T.Z,{status:u,expandable:!1,space:"lg",withLabels:!0})))),Ge&&d.createElement(d.Fragment,null,(0,a.Z)("hr",{className:"-mx-4 max-w-[100vw] border-t border-gray-300 dark:border-gray-800"}),(0,a.Z)("div",{className:"flex justify-center"},void 0,d.createElement(W.K,{ref:$,sort:Y,onChange:X})))),ze=(0,d.useMemo)((function(){return Ue(oe)}),[ge.length,Y]),Ve=(0,d.useMemo)((function(){return Ue(de)}),[pe.length,Y,null==te?void 0:te.length]);return(0,a.Z)(w.Kq,{space:2,className:(0,o.Z)({"h-full":!M,"mt-2":M})},void 0,d.createElement("div",{ref:Le,className:(0,o.Z)("thread",{"h-full":!M})},(0,a.Z)("div",{className:(0,o.Z)("fixed z-10 flex h-14 w-96 items-center justify-center transition-all duration-200",{"-top-14":J,"top-0":!J})},void 0,d.createElement(W.K,{ref:$,sort:Y,onChange:X})),d.createElement(E.Z,{id:"thread",ref:Ae,hasMore:he,onLoadMore:Ie,placeholderComponent:function(){return(0,a.Z)(A.Z,{variant:"slim"})},initialTopMostItemIndex:ge.length,atTopStateChange:function(e){return e&&xe()},atTopThreshold:200,useWindowScroll:M,itemClassName:r,className:(0,o.Z)({"h-full":!M})},(Be=[],M||Be.push((0,a.Z)("div",{className:"h-4"},"spacer")),je&&Be.push.apply(Be,(0,n.Z)(ze)),Be.push(He),Ge&&Be.push.apply(Be,(0,n.Z)(Ve)),Be))),!B&&(0,a.Z)(Q,{}))}},735:function(e,t,r){"use strict";var n=r(1519),i=r(1508),a=r(1509),s=r(1522),o=r(3),l=r(105),u=(0,i.vU)({followers:{id:"account.followers",defaultMessage:"Followers"},follows:{id:"account.follows",defaultMessage:"Follows"}});t.Z=function(e){var t=e.account,r=e.onClickHandler,i=e.textSize,c=void 0===i?"md":i,d=(0,a.Z)();return t?(0,n.Z)(o.Ug,{alignItems:"center",space:3},void 0,(0,n.Z)(s.OL,{to:"/@".concat(t.acct,"/followers"),onClick:r,title:d.formatNumber(t.followers_count),className:"hover:underline"},void 0,(0,n.Z)(o.Ug,{alignItems:"center",space:1},void 0,(0,n.Z)(o.xv,{weight:"bold",size:c},void 0,(0,l.w8)(t.followers_count)),(0,n.Z)(o.xv,{theme:"muted",size:c},void 0,d.formatMessage(u.followers)))),(0,n.Z)(s.OL,{to:"/@".concat(t.acct,"/following"),onClick:r,title:d.formatNumber(t.following_count),className:"hover:underline"},void 0,(0,n.Z)(o.Ug,{alignItems:"center",space:1},void 0,(0,n.Z)(o.xv,{weight:"bold",size:c},void 0,(0,l.w8)(t.following_count)),(0,n.Z)(o.xv,{theme:"muted",size:c},void 0,d.formatMessage(u.follows))))):null}},1071:function(e,t,r){"use strict";var n=r(1519),i=r(3);t.Z=function(e){var t=e.size,a=void 0===t?5:t;return(0,n.Z)("div",{className:"relative"},void 0,(0,n.Z)(i.JO,{src:r(1074),className:"size-".concat(a+1," z-[2] text-accent-500")}),(0,n.Z)("div",{className:"absolute left-1/2 top-1/2 z-[1] -ml-2.5 -mt-2.5 size-5"},void 0,(0,n.Z)(i.JO,{src:r(1074),className:"size-".concat(a," animate-ping text-accent-500/70")})))}},576:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return _},fileNameFromURL:function(){return T},findElementPosition:function(){return k},formatTime:function(){return b},getPointerPosition:function(){return E}});var n=r(1519),i=r(1474),a=(r(11),r(16),r(0),r(20),r(18),r(74),r(51),r(112),r(1520)),s=r(140),o=r.n(s),l=r(229),u=r.n(l),c=r(1),d=r(1508),f=r(1509),h=r(311),v=r(154),g=r(1579),p=function(){return Boolean(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement)},m=function(){document.exitFullscreen?document.exitFullscreen():"webkitExitFullscreen"in document?document.webkitExitFullscreen():"mozCancelFullScreen"in document&&document.mozCancelFullScreen()},y=(0,d.vU)({play:{id:"video.play",defaultMessage:"Play"},pause:{id:"video.pause",defaultMessage:"Pause"},mute:{id:"video.mute",defaultMessage:"Mute sound"},unmute:{id:"video.unmute",defaultMessage:"Unmute sound"},hide:{id:"video.hide",defaultMessage:"Hide video"},expand:{id:"video.expand",defaultMessage:"Expand video"},close:{id:"video.close",defaultMessage:"Close video"},fullscreen:{id:"video.fullscreen",defaultMessage:"Full screen"},exit_fullscreen:{id:"video.exit_fullscreen",defaultMessage:"Exit full screen"}}),b=function(e){var t=Math.floor(e/3600),r=Math.floor((e-3600*t)/60),n=e-3600*t-60*r;return t<10&&(t="0"+t),r<10&&(r="0"+r),n<10&&(n="0"+n),("00"===t?"":"".concat(t,":"))+"".concat(r,":").concat(n)},k=function(e){var t;if(e.getBoundingClientRect&&e.parentNode&&(t=e.getBoundingClientRect()),!t)return{left:0,top:0};var r=document.documentElement,n=document.body,i=r.clientLeft||n.clientLeft||0,a=window.pageXOffset||n.scrollLeft,s=t.left+a-i,o=r.clientTop||n.clientTop||0,l=window.pageYOffset||n.scrollTop,u=t.top+l-o;return{left:Math.round(s),top:Math.round(u)}},E=function(e,t){var r=k(e),n=e.offsetWidth,i=e.offsetHeight,a=r.top,s=r.left,o=t.pageY,l=t.pageX;return t.changedTouches&&(l=t.changedTouches[0].pageX,o=t.changedTouches[0].pageY),{y:Math.max(0,Math.min(1,(o-a)/i)),x:Math.max(0,Math.min(1,(l-s)/n))}},T=function(e){var t=new URL(e).pathname,r=t.lastIndexOf("/");return t.substring(r+1)},_=function(e){var t=e.width,s=e.visible,l=void 0!==s&&s,d=e.detailed,k=void 0!==d&&d,T=e.autoFocus,_=void 0!==T&&T,w=e.cacheWidth,S=e.startTime,L=e.src,R=e.height,A=e.alt,x=e.inline,I=e.aspectRatio,D=void 0===I?16/9:I,C=e.link,P=e.blurhash,M=(0,f.Z)(),O=(0,c.useRef)(null),N=(0,c.useRef)(null),F=(0,c.useRef)(null),Z=(0,c.useRef)(null),U=(0,c.useState)(0),B=(0,i.Z)(U,2),j=B[0],G=B[1],K=(0,c.useState)(0),H=(0,i.Z)(K,2),z=H[0],V=H[1],q=(0,c.useState)(.5),W=(0,i.Z)(q,2),Y=W[0],X=W[1],Q=(0,c.useState)(!0),$=(0,i.Z)(Q,2),J=$[0],ee=$[1],te=(0,c.useState)(!1),re=(0,i.Z)(te,2),ne=re[0],ie=re[1],ae=(0,c.useState)(t),se=(0,i.Z)(ae,2),oe=se[0],le=se[1],ue=(0,c.useState)(!1),ce=(0,i.Z)(ue,2),de=ce[0],fe=ce[1],he=(0,c.useState)(!1),ve=(0,i.Z)(he,2),ge=ve[0],pe=ve[1],me=(0,c.useState)(!1),ye=(0,i.Z)(me,2),be=ye[0],ke=ye[1],Ee=(0,c.useState)(0),Te=(0,i.Z)(Ee,2),_e=Te[0],we=Te[1],Se=function(){if(O.current){var e=O.current.offsetWidth;w&&w(e),le(e)}};(0,c.useLayoutEffect)((function(){Se()}),[O.current]),(0,c.useEffect)((function(){N.current&&(X(N.current.volume),ke(N.current.muted))}),[N.current]);var Le=function e(){document.removeEventListener("mousemove",Re,!0),document.removeEventListener("mouseup",e,!0),document.removeEventListener("touchmove",Re,!0),document.removeEventListener("touchend",e,!0)},Re=u()((function(e){if(Z.current){var t=E(Z.current,e).x;if(!isNaN(t)){var r=t;t>1?r=1:t<0&&(r=0),N.current&&(N.current.volume=r),X(r)}}}),60),Ae=function e(){var t;document.removeEventListener("mousemove",xe,!0),document.removeEventListener("mouseup",e,!0),document.removeEventListener("touchmove",xe,!0),document.removeEventListener("touchend",e,!0),ie(!1),null===(t=N.current)||void 0===t||t.play()},xe=u()((function(e){if(F.current&&N.current){var t=E(F.current,e).x,r=Math.floor(N.current.duration*t);isNaN(r)||(N.current.currentTime=r,G(r))}}),60),Ie=function(e){if(N.current){var t=N.current.currentTime+e;isNaN(t)||(G(t),N.current.currentTime=t)}},De=function(e){" "===e.key&&(e.preventDefault(),e.stopPropagation(),Ce())},Ce=function(e){var t,r;null==e||e.stopPropagation(),ee(!J),J?null===(t=N.current)||void 0===t||t.play():null===(r=N.current)||void 0===r||r.pause()},Pe=function(){var e;p()?m():O.current&&((e=O.current).requestFullscreen?e.requestFullscreen():"webkitRequestFullscreen"in e?e.webkitRequestFullscreen():"mozRequestFullScreen"in e&&e.mozRequestFullScreen())},Me=(0,c.useCallback)(o()((function(){Se()}),250,{trailing:!0}),[O.current,w]),Oe=(0,c.useCallback)(u()((function(){if(N.current){var e=N.current.getBoundingClientRect(),t=e.top,r=e.height,n=t<=(window.innerHeight||document.documentElement.clientHeight)&&t+r>=0;J||n||(ee(!0),N.current.pause())}}),150,{trailing:!0}),[N.current,J]),Ne=(0,c.useCallback)((function(){fe(p())}),[]),Fe=function(){if(N.current){var e=!N.current.muted;ke(!e),N.current.muted=e}},Ze=j/z*100,Ue={};if(x&&oe){t=oe;var Be=oe/(16/9);R=(0,g.gn)(D)?Math.max(Math.floor(oe/g.q3),Be):(0,g.gr)(D)?Math.max(Math.floor(oe/g.Mr),Be):Math.floor(oe/D),Ue.height=R||300}return(0,c.useEffect)((function(){return document.addEventListener("fullscreenchange",Ne,!0),document.addEventListener("webkitfullscreenchange",Ne,!0),document.addEventListener("mozfullscreenchange",Ne,!0),document.addEventListener("MSFullscreenChange",Ne,!0),window.addEventListener("scroll",Oe),window.addEventListener("resize",Me,{passive:!0}),function(){window.removeEventListener("scroll",Oe),window.removeEventListener("resize",Me),document.removeEventListener("fullscreenchange",Ne,!0),document.removeEventListener("webkitfullscreenchange",Ne,!0),document.removeEventListener("mozfullscreenchange",Ne,!0),document.removeEventListener("MSFullscreenChange",Ne,!0)}}),[]),(0,c.useEffect)((function(){var e;l||null===(e=N.current)||void 0===e||e.pause()}),[l]),c.createElement("div",{role:"menuitem",className:(0,a.Z)("video-player",{detailed:k,"video-player--inline":x&&!de,fullscreen:de}),style:Ue,ref:O,onMouseEnter:function(){pe(!0)},onMouseLeave:function(){pe(!1)},onClick:function(e){return e.stopPropagation()},onKeyDown:function(e){switch(e.key){case"k":e.preventDefault(),e.stopPropagation(),Ce();break;case"m":e.preventDefault(),e.stopPropagation(),Fe();break;case"f":e.preventDefault(),e.stopPropagation(),Pe();break;case"j":e.preventDefault(),e.stopPropagation(),Ie(-10);break;case"l":e.preventDefault(),e.stopPropagation(),Ie(10);break;case",":e.preventDefault(),e.stopPropagation(),Ie(-.04);break;case".":e.preventDefault(),e.stopPropagation(),Ie(.04)}de&&(e.preventDefault(),e.stopPropagation(),"Escape"===e.key&&m())},tabIndex:0},!de&&(0,n.Z)(h.Z,{hash:P,className:"media-gallery__preview"}),c.createElement("video",{ref:N,src:L,loop:!0,role:"button",tabIndex:0,"aria-label":A,title:A,width:t,height:R||300,onClick:Ce,onKeyDown:De,onPlay:function(){ee(!1)},onPause:function(){ee(!0)},onTimeUpdate:function(){N.current&&(G(Math.floor(N.current.currentTime)),V(Math.floor(N.current.duration)))},onLoadedData:function(){N.current&&S&&(N.current.currentTime=S,N.current.play())},onProgress:function(){N.current&&N.current.buffered.length>0&&we(N.current.buffered.end(0)/N.current.duration*100)},onVolumeChange:function(){N.current&&(X(N.current.volume),ke(N.current.muted))}}),(0,n.Z)("div",{className:(0,a.Z)("video-player__controls",{active:J||ge})},void 0,c.createElement("div",{className:"video-player__seek",onMouseDown:function(e){var t;document.addEventListener("mousemove",xe,!0),document.addEventListener("mouseup",Ae,!0),document.addEventListener("touchmove",xe,!0),document.addEventListener("touchend",Ae,!0),ie(!0),null===(t=N.current)||void 0===t||t.pause(),xe(e),e.preventDefault(),e.stopPropagation()},ref:F},(0,n.Z)("div",{className:"video-player__seek__buffer",style:{width:"".concat(_e,"%")}}),(0,n.Z)("div",{className:"video-player__seek__progress",style:{width:"".concat(Ze,"%")}}),(0,n.Z)("span",{className:(0,a.Z)("video-player__seek__handle",{active:ne}),tabIndex:0,style:{left:"".concat(Ze,"%")},onKeyDown:De})),(0,n.Z)("div",{className:"video-player__buttons-bar"},void 0,(0,n.Z)("div",{className:"video-player__buttons left"},void 0,(0,n.Z)("button",{type:"button",title:M.formatMessage(J?y.play:y.pause),"aria-label":M.formatMessage(J?y.play:y.pause),className:"player-button",onClick:Ce,autoFocus:_},void 0,(0,n.Z)(v.Z,{src:r(J?705:1066)})),(0,n.Z)("button",{type:"button",title:M.formatMessage(be?y.unmute:y.mute),"aria-label":M.formatMessage(be?y.unmute:y.mute),className:"player-button",onClick:Fe},void 0,(0,n.Z)(v.Z,{src:r(be?314:315)})),c.createElement("div",{className:(0,a.Z)("video-player__volume",{active:ge}),onMouseDown:function(e){document.addEventListener("mousemove",Re,!0),document.addEventListener("mouseup",Le,!0),document.addEventListener("touchmove",Re,!0),document.addEventListener("touchend",Le,!0),Re(e),e.preventDefault(),e.stopPropagation()},ref:Z},(0,n.Z)("div",{className:"video-player__volume__current",style:{width:"".concat(100*Y,"%")}}),(0,n.Z)("span",{className:(0,a.Z)("video-player__volume__handle"),tabIndex:0,style:{left:"".concat(100*Y,"%")}})),(k||de)&&(0,n.Z)("span",{},void 0,(0,n.Z)("span",{className:"video-player__time-current"},void 0,b(j)),(0,n.Z)("span",{className:"video-player__time-sep"},void 0,"/"),(0,n.Z)("span",{className:"video-player__time-total"},void 0,b(z))),C&&(0,n.Z)("span",{className:"video-player__link"},void 0,C)),(0,n.Z)("div",{className:"video-player__buttons right"},void 0,(0,n.Z)("button",{type:"button",title:M.formatMessage(de?y.exit_fullscreen:y.fullscreen),"aria-label":M.formatMessage(de?y.exit_fullscreen:y.fullscreen),className:"player-button",onClick:Pe},void 0,(0,n.Z)(v.Z,{src:r(de?1067:717)}))))))}},734:function(e,t,r){"use strict";r.d(t,{i:function(){return i}});var n=r(1474);function i(e){var t=e.split("@"),r=(0,n.Z)(t,2),i=r[0],a=r[1].split("."),s=a[a.length-1],o=a.slice(0,a.length-1).join("."),l="".concat(i[0]).concat("*".repeat(i.length-1)),u="".concat(o[0]).concat("*".repeat(o.length-1));return"".concat(l,"@").concat(u,".").concat(s)}r(17),r(11),r(205)},1579:function(e,t,r){"use strict";r.d(t,{Mr:function(){return n},gn:function(){return a},gr:function(){return s},q3:function(){return i},x$:function(){return o}});var n=9/16,i=10,a=function(e){return!isNaN(e)&&e>=i},s=function(e){return!isNaN(e)&&e<=n},o=function(e){return!isNaN(e)&&!a(e)&&!s(e)}},1065:function(e,t,r){"use strict";r.d(t,{Z:function(){return u}});var n=r(1193),i=r(1194),a=r(1195),s=r(1196),o=r(1197),l=r(1198),u={"application/x-freearc":o,"application/x-bzip":o,"application/x-bzip2":o,"application/gzip":o,"application/vnd.rar":o,"application/x-tar":o,"application/zip":o,"application/x-7z-compressed":o,"application/x-csh":i,"application/html":i,"text/javascript":i,"application/json":i,"application/ld+json":i,"application/x-httpd-php":i,"application/x-sh":i,"application/xhtml+xml":i,"application/xml":i,"application/epub+zip":n,"application/vnd.oasis.opendocument.spreadsheet":a,"application/vnd.ms-excel":a,"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":a,"application/pdf":s,"application/vnd.oasis.opendocument.presentation":l,"application/vnd.ms-powerpoint":l,"application/vnd.openxmlformats-officedocument.presentationml.presentation":l,"text/plain":s,"application/rtf":s,"application/msword":s,"application/x-abiword":s,"application/vnd.openxmlformats-officedocument.wordprocessingml.document":s,"application/vnd.oasis.opendocument.text":s}},780:function(e,t,r){"use strict";function n(e){var t="",r=Number(e.toFixed()),n=Math.floor(r/3600),i=Math.floor(r%3600/60),a=r%60;return n>0&&(t+=n.toString().padStart(2,"0")+":"),t+(i.toString().padStart(2,"0")+":")+a.toString().padStart(2,"0")}function i(e,t){var r=e,n=t,i=new Date;return i<new Date(r.getTime()+(n.getTime()-r.getTime()))&&i>new Date(r.getTime())}r.d(t,{A:function(){return i},h:function(){return n}}),r(50),r(687),r(0),r(25)},1200:function(e,t,r){"use strict";e.exports=r.p+"packs/icons/player-pause-3218336d.svg"},463:function(e,t,r){"use strict";e.exports=r.p+"packs/icons/player-play-3356eb06.svg"},1192:function(e,t,r){"use strict";e.exports=r.p+"packs/icons/bolt-70cd2365.svg"},1392:function(e,t,r){"use strict";e.exports=r.p+"packs/icons/emoji-plus-a0c09283.svg"},1189:function(e,t,r){"use strict";e.exports=r.p+"packs/icons/fire-f9d6f759.svg"},1201:function(e,t,r){"use strict";e.exports=r.p+"packs/icons/picture-in-picture-e8361d2f.svg"},1074:function(e,t,r){"use strict";e.exports=r.p+"packs/icons/signal-21538c2a.svg"},1191:function(e,t,r){"use strict";e.exports=r.p+"packs/icons/sort-ascending-de34aea6.svg"},1190:function(e,t,r){"use strict";e.exports=r.p+"packs/icons/sort-descending-e044ce4d.svg"},411:function(e,t,r){"use strict";e.exports=r.p+"packs/icons/pin-811f6ee9.svg"},1187:function(e,t,r){"use strict";e.exports=r.p+"packs/icons/arrow-bar-to-up-96f38e4a.svg"},1067:function(e,t,r){"use strict";e.exports=r.p+"packs/icons/arrows-minimize-0435e811.svg"},1193:function(e,t,r){"use strict";e.exports=r.p+"packs/icons/book-92672e4c.svg"},1391:function(e,t,r){"use strict";e.exports=r.p+"packs/icons/copy-e19bd060.svg"},1073:function(e,t,r){"use strict";e.exports=r.p+"packs/icons/download-fb37ce70.svg"},1194:function(e,t,r){"use strict";e.exports=r.p+"packs/icons/file-code-f8e3e2fe.svg"},1195:function(e,t,r){"use strict";e.exports=r.p+"packs/icons/file-spreadsheet-b26144aa.svg"},1196:function(e,t,r){"use strict";e.exports=r.p+"packs/icons/file-text-e8066f88.svg"},1197:function(e,t,r){"use strict";e.exports=r.p+"packs/icons/file-zip-ec0bf8b2.svg"},1066:function(e,t,r){"use strict";e.exports=r.p+"packs/icons/player-pause-aa4a9344.svg"},1198:function(e,t,r){"use strict";e.exports=r.p+"packs/icons/presentation-c2e662dd.svg"},1199:function(e,t,r){"use strict";e.exports=r.p+"packs/icons/reload-6b8983f0.svg"}},s={};function o(e){var t=s[e];if(void 0!==t)return t.exports;var r=s[e]={id:e,loaded:!1,exports:{}};return a[e].call(r.exports,r,r.exports,o),r.loaded=!0,r.exports}o.m=a,o.amdO={},e=[],o.O=function(t,r,n,i){if(!r){var a=1/0;for(c=0;c<e.length;c++){r=e[c][0],n=e[c][1],i=e[c][2];for(var s=!0,l=0;l<r.length;l++)(!1&i||a>=i)&&Object.keys(o.O).every((function(e){return o.O[e](r[l])}))?r.splice(l--,1):(s=!1,i<a&&(a=i));if(s){e.splice(c--,1);var u=n();void 0!==u&&(t=u)}}return t}i=i||0;for(var c=e.length;c>0&&e[c-1][2]>i;c--)e[c]=e[c-1];e[c]=[r,n,i]},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,{a:t}),t},r=Object.getPrototypeOf?function(e){return Object.getPrototypeOf(e)}:function(e){return e.__proto__},o.t=function(e,n){if(1&n&&(e=this(e)),8&n)return e;if("object"==typeof e&&e){if(4&n&&e.__esModule)return e;if(16&n&&"function"==typeof e.then)return e}var i=Object.create(null);o.r(i);var a={};t=t||[null,r({}),r([]),r(r)];for(var s=2&n&&e;"object"==typeof s&&!~t.indexOf(s);s=r(s))Object.getOwnPropertyNames(s).forEach((function(t){a[t]=function(){return e[t]}}));return a.default=function(){return e},o.d(i,a),i},o.d=function(e,t){for(var r in t)o.o(t,r)&&!o.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},o.f={},o.e=function(e){return Promise.all(Object.keys(o.f).reduce((function(t,r){return o.f[r](e,t),t}),[]))},o.u=function(e){return"packs/js/"+{2:"emoji_picker",3:"error",4:"features/account_gallery",5:"features/account_timeline",6:"features/auth_login",7:"features/bookmarks",8:"features/chats",9:"features/chats/components/chat-widget",10:"features/compose",11:"features/edit_email",12:"features/email_confirmation",13:"features/external_login",14:"features/favourited_statuses",15:"features/feeds",16:"features/follow-recommendations",17:"features/follow_recommendations",18:"features/followers",19:"features/following",20:"features/generic_not_found",21:"features/groups",22:"features/hashtag_timeline",23:"features/home_timeline",24:"features/live-tv",25:"features/new_status",26:"features/notifications",27:"features/quotes",28:"features/search",29:"features/server_info",30:"features/settings",31:"features/settings/ads",32:"features/settings/blocks",33:"features/settings/delete-account",34:"features/settings/discoverability",35:"features/settings/messages",36:"features/settings/mfa",37:"features/settings/mutes",38:"features/settings/other",39:"features/settings/password",40:"features/settings/preferences",41:"features/settings/privacy",42:"features/settings/profile",43:"features/settings/security",44:"features/settings/sessions",45:"features/share",46:"features/status",47:"features/trends",48:"features/ui",49:"features/verification",50:"locale_ar-json",51:"locale_ast-json",52:"locale_bg-json",53:"locale_bn-json",54:"locale_br-json",55:"locale_bs-json",56:"locale_ca-json",57:"locale_co-json",58:"locale_cs-json",59:"locale_cy-json",60:"locale_da-json",61:"locale_de-json",62:"locale_defaultMessages-json",63:"locale_el-json",64:"locale_en-Shaw-json",65:"locale_en-json",66:"locale_eo-json",67:"locale_es-AR-json",68:"locale_es-json",69:"locale_et-json",70:"locale_eu-json",71:"locale_fa-json",72:"locale_fi-json",73:"locale_fr-json",74:"locale_ga-json",75:"locale_gl-json",76:"locale_he-json",77:"locale_hi-json",78:"locale_hr-json",79:"locale_hu-json",80:"locale_hy-json",81:"locale_id-json",82:"locale_io-json",83:"locale_is-json",84:"locale_it-json",85:"locale_ja-json",86:"locale_ka-json",87:"locale_kk-json",88:"locale_ko-json",89:"locale_lt-json",90:"locale_lv-json",91:"locale_mk-json",92:"locale_ms-json",93:"locale_nl-json",94:"locale_nn-json",95:"locale_no-json",96:"locale_oc-json",97:"locale_pl-json",98:"locale_pt-BR-json",99:"locale_pt-json",100:"locale_ro-json",101:"locale_ru-json",102:"locale_sk-json",103:"locale_sl-json",104:"locale_sq-json",105:"locale_sr-Latn-json",106:"locale_sr-json",107:"locale_sv-json",108:"locale_ta-json",109:"locale_te-json",110:"locale_th-json",111:"locale_tr-json",112:"locale_uk-json",113:"locale_whitelist_ar-json",114:"locale_whitelist_ast-json",115:"locale_whitelist_bg-json",116:"locale_whitelist_bn-json",117:"locale_whitelist_br-json",118:"locale_whitelist_ca-json",119:"locale_whitelist_co-json",120:"locale_whitelist_cs-json",121:"locale_whitelist_cy-json",122:"locale_whitelist_da-json",123:"locale_whitelist_de-json",124:"locale_whitelist_el-json",125:"locale_whitelist_en-Shaw-json",126:"locale_whitelist_en-json",127:"locale_whitelist_eo-json",128:"locale_whitelist_es-AR-json",129:"locale_whitelist_es-json",130:"locale_whitelist_et-json",131:"locale_whitelist_eu-json",132:"locale_whitelist_fa-json",133:"locale_whitelist_fi-json",134:"locale_whitelist_fr-json",135:"locale_whitelist_ga-json",136:"locale_whitelist_gl-json",137:"locale_whitelist_he-json",138:"locale_whitelist_hi-json",139:"locale_whitelist_hr-json",140:"locale_whitelist_hu-json",141:"locale_whitelist_hy-json",142:"locale_whitelist_id-json",143:"locale_whitelist_io-json",144:"locale_whitelist_is-json",145:"locale_whitelist_it-json",146:"locale_whitelist_ja-json",147:"locale_whitelist_ka-json",148:"locale_whitelist_kk-json",149:"locale_whitelist_ko-json",150:"locale_whitelist_lt-json",151:"locale_whitelist_lv-json",152:"locale_whitelist_mk-json",153:"locale_whitelist_ms-json",154:"locale_whitelist_nl-json",155:"locale_whitelist_nn-json",156:"locale_whitelist_no-json",157:"locale_whitelist_oc-json",158:"locale_whitelist_pl-json",159:"locale_whitelist_pt-BR-json",160:"locale_whitelist_pt-json",161:"locale_whitelist_ro-json",162:"locale_whitelist_ru-json",163:"locale_whitelist_sk-json",164:"locale_whitelist_sl-json",165:"locale_whitelist_sq-json",166:"locale_whitelist_sr-Latn-json",167:"locale_whitelist_sr-json",168:"locale_whitelist_sv-json",169:"locale_whitelist_ta-json",170:"locale_whitelist_te-json",171:"locale_whitelist_th-json",172:"locale_whitelist_tr-json",173:"locale_whitelist_uk-json",174:"locale_whitelist_zh-CN-json",175:"locale_whitelist_zh-HK-json",176:"locale_whitelist_zh-TW-json",177:"locale_zh-CN-json",178:"locale_zh-HK-json",179:"locale_zh-TW-json",180:"modals/change-email-modal/change-email-modal",181:"modals/embed_modal",182:"modals/live-tv-new-device-modal",183:"modals/mute_modal",184:"modals/report-modal/report-modal",185:"modals/reverify-sms-modal",186:"status/media_gallery"}[e]+"-"+{2:"87cc5b620ef6c7dc8d50",3:"5ad033e376edebc58eab",4:"4702790f572dde9a0ade",5:"d50d78cea72b87c59ff7",6:"ce129757b79aa37be81a",7:"abe5a1e39786a22da9a0",8:"f0a61e71c507e7cf875c",9:"d9a45860c0edeb33f223",10:"7944e60d8a03dcdb4dde",11:"b94d4d3b6273788e16c1",12:"dbacdfa76321f0485bce",13:"945469909fb5f7c8f8e9",14:"cbded6f0536cde4b520a",15:"71a3fb49db5f08b8fa19",16:"c654a15bd8b5e6936309",17:"f378373fd3980058ae17",18:"b513fdbec3e066d1eb23",19:"f40e681a01c57cdde0cd",20:"b5f7a701556322312ae1",21:"297dcbd983c6f14a4f8f",22:"b7cf8c3838db6d65fff0",23:"000b458a243c4d429f18",24:"783b89337bdf661ffc90",25:"bc190ff494d1e7789a0f",26:"f8d46c00e70792041e79",27:"7476558b16e9a7a540c9",28:"92308ec59d2fa55c96b8",29:"f5e15107e023cab7f392",30:"01d299f03719cf60dcbc",31:"e673f783dc836dcf354a",32:"7d2c53a76d2f2be6d217",33:"e7adc48fa9b44ef7421c",34:"628c1c4710a4df04120c",35:"53d869bdc1ef0b8fd159",36:"c005faba4e81e693044a",37:"a20a925234bac4164edb",38:"e6e7368a9f011d41de59",39:"e431469493523ec5d623",40:"42609ca408f46558affe",41:"2d08c73165a754e84084",42:"a9cbc09826c1ad143501",43:"22520c11f253f62ae82a",44:"99361d3cedb9a536f969",45:"8102825651241273b6e3",46:"1ddde55ce5c464754e0e",47:"f79eaff0f2809561625b",48:"6c9bb5883b687bfef5b5",49:"5f7395306cbcf32b93fd",50:"fc6fcc12a485f5d157ac",51:"b8ed57385b403da9c108",52:"1139b3fd79f8fd08257a",53:"ff1878465a15f4725495",54:"b43197d2cc43149214e5",55:"113df1fbe823880dfa8f",56:"81db8e3e0fe28ecbebbe",57:"fc86f8768410307ea24d",58:"4bcc916863e29ad42aa9",59:"543cd2613933d257a385",60:"590c4448d682c5ef34f1",61:"2d2a8398c303fb567300",62:"dfb9083be6cefe2fd670",63:"bd51b35f4c40433fce4f",64:"82e2df1a09191a09f53f",65:"1c9d896a7af0b6d85240",66:"c0b067a32b374eca6eb7",67:"530ccede786fae8726d0",68:"462dadec52db07b96925",69:"4f3dd945f4e780f37e96",70:"986ddb8f90652e9856a6",71:"e37f055181a8cfbac86f",72:"d53a8e4b3637cef54b43",73:"d3fd0d45a81dcd287402",74:"93e826526d7114870055",75:"742f313d0f4195a512ba",76:"686008be2bf3328b4344",77:"0be22bbddf891cb6508a",78:"72c6ce2115e189f3ed3c",79:"f6cba8f2c9b96129d7f4",80:"cfd1ae632d460984d316",81:"280d517022af9a3250ba",82:"66e41b60c499b495c82b",83:"3d549bfc85bbae81cbbc",84:"3d51f83bf9420d06e0ba",85:"22d9ee57eb52b6e6a18e",86:"a5edff0a13530ad3a85e",87:"60427305e4d1fc79cb62",88:"e81b60f59f898ab3ae21",89:"ac8795d9cc4229e2478f",90:"063a36c6be7cfb89f4d0",91:"90455404ff3f76d8de28",92:"7843f694d6d4bf5c9d3c",93:"5c0a9c8581e15c94be20",94:"99683cd800b5e50dcede",95:"78394f44ac1087407be0",96:"3ced316c950ef670a961",97:"822e15473485bc92c988",98:"7555cc7cef0fed7fa692",99:"9b04242d990e056d66cc",100:"349db4de20554d81eea7",101:"10946ee3f485e142882b",102:"c6ebfcdf74ab74c22c20",103:"e0cbf1823a5acabc01ba",104:"609710cff3cff15799e3",105:"336abab3fd2dafc80011",106:"23d2640a559005dede00",107:"9680987ddfd3fa55f152",108:"aadc9fe645a16b5f1385",109:"43d3a7dd8d1f4254e7b4",110:"83d6906ecec19287e25d",111:"5e12e446b870768f00ec",112:"a5ed49a7a7b943ec587c",113:"66bdaeb17e4b3ce2a06e",114:"7f0ca70e027d0aeb32db",115:"df17610d6a21d1f9227e",116:"e08a58f7a0b1a4d9fa55",117:"ccd7f736b458917512fa",118:"863279febf44b958255d",119:"97741b51947e93f2c16a",120:"cf8b1efebd373d54d47e",121:"1664ba5c0dad6a6b6783",122:"26dd8395d0c3adf409f6",123:"47f2982ee0634ad40d88",124:"d6576b57723415897412",125:"ff35901b1d202e52751f",126:"a0182f5886f5df573a13",127:"7f5f4b4ce5678f1b2c51",128:"727130b83d835c28d9d5",129:"316c2b89a9f59085231e",130:"627793d27bf458db7b77",131:"8328e03ffe550b1b19f5",132:"548f8aaa2c22a0b5d420",133:"9a5c0dab964351cbb486",134:"ffd3e7cc799d7e96f4dc",135:"28917d2358fd9e5adf8c",136:"b950fd0862dc69aeb4f7",137:"0523d63458f6df6ae5a8",138:"875ffe7a79327d9a7a54",139:"b687d11941d788ed507c",140:"30017329d44fe06d6a7e",141:"367a2e649c56294bd306",142:"2ffe5e7c9b5793ffab1d",143:"19f5c48b7a02dd4ff4b1",144:"28a3653ac45b9aef1d60",145:"96348d23f60ba3a06668",146:"1875342affbcfc4b6d67",147:"ede28b3b5a02a7027e72",148:"936bc22a4e60d32751d6",149:"efaf5725158159b4325b",150:"c328b0ae489ed140a422",151:"248376ee96162e1a8d1f",152:"8a9d850d1ee6a298b821",153:"fe119e9d26927df21cea",154:"8150933f4574720df34c",155:"6c1ccf972140dcf36e37",156:"26cb0cf9560ad7dcb78c",157:"b92e824ed2d6833d07dc",158:"86f73c6b64e4763aa112",159:"03a1f64f789ff54e7fb9",160:"8c351a66930c3d3eb874",161:"7fcea1fd41b8703edb83",162:"9ef3d481294087cbd343",163:"d78cdfb4c6edb7bd6afa",164:"5a59e42150368d414673",165:"2b097f35725fcd62c016",166:"dccc8b9532c324e406e6",167:"52b3de5b6227ee33b0c7",168:"90492c267254618339dd",169:"2780533127bd8e835f4c",170:"2fe2dea481a7b2ecfb05",171:"dbe46836604ff3dd29e0",172:"c7bde304f1c49604e5b7",173:"102207f1ed1430ad8b23",174:"a5b201e39eb5d4b528c7",175:"4327f7a24b04e421d54c",176:"58c967951596cd6fd404",177:"72b9df0599619a683c37",178:"55f649a9eee36e41ee40",179:"d18056b963735c5a4e00",180:"e26592d8b1e008a1c2cc",181:"ad7da667417c578d1f22",182:"d3dd1fe6c8b60ced8796",183:"30f91ee852bdcb702ce2",184:"fce8552838bb73f40d6a",185:"8652ee6751d75415a0db",186:"ffedaadc55c72265044f"}[e]+".chunk.js"},o.miniCssF=function(e){},o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),o.hmd=function(e){return(e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:function(){throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n={},i="truth-web:",o.l=function(e,t,r,a){if(n[e])n[e].push(t);else{var s,l;if(void 0!==r)for(var u=document.getElementsByTagName("script"),c=0;c<u.length;c++){var d=u[c];if(d.getAttribute("src")==e||d.getAttribute("data-webpack")==i+r){s=d;break}}s||(l=!0,(s=document.createElement("script")).charset="utf-8",s.timeout=120,o.nc&&s.setAttribute("nonce",o.nc),s.setAttribute("data-webpack",i+r),s.src=e),n[e]=[t];var f=function(t,r){s.onerror=s.onload=null,clearTimeout(h);var i=n[e];if(delete n[e],s.parentNode&&s.parentNode.removeChild(s),i&&i.forEach((function(e){return e(r)})),t)return t(r)},h=setTimeout(f.bind(null,void 0,{type:"timeout",target:s}),12e4);s.onerror=f.bind(null,s.onerror),s.onload=f.bind(null,s.onload),l&&document.head.appendChild(s)}},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e},o.p="/",function(){var e={0:0};o.f.j=function(t,r){var n=o.o(e,t)?e[t]:void 0;if(0!==n)if(n)r.push(n[2]);else{var i=new Promise((function(r,i){n=e[t]=[r,i]}));r.push(n[2]=i);var a=o.p+o.u(t),s=new Error;o.l(a,(function(r){if(o.o(e,t)&&(0!==(n=e[t])&&(e[t]=void 0),n)){var i=r&&("load"===r.type?"missing":r.type),a=r&&r.target&&r.target.src;s.message="Loading chunk "+t+" failed.\n("+i+": "+a+")",s.name="ChunkLoadError",s.type=i,s.request=a,n[1](s)}}),"chunk-"+t,t)}},o.O.j=function(t){return 0===e[t]};var t=function(t,r){var n,i,a=r[0],s=r[1],l=r[2],u=0;if(a.some((function(t){return 0!==e[t]}))){for(n in s)o.o(s,n)&&(o.m[n]=s[n]);if(l)var c=l(o)}for(t&&t(r);u<a.length;u++)i=a[u],o.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return o.O(c)},r=self.webpackChunktruth_web=self.webpackChunktruth_web||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))}()}();
//# sourceMappingURL=common-0c33f53a3c444282b953.js.map